<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>BeepBox</title>
	<meta name="mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black" />
	<meta name="theme-color" content="#444" />
	<meta name="format-detection" content="telephone=no" />
	<link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet" rel="stylesheet" media="none" onload="if (this.media != 'all') this.media='all';" /> <!-- this is a trick to load CSS asynchronously. -->
	<meta name="robots" content="noindex, nofollow" />
	<style type="text/css">
		html {
			background: var(--page-margin, black);
			overflow-x: hidden;
			font-size: large;
			font-family: 'Roboto', sans-serif;
			line-height: 1.3;
			color: var(--primary-text, white);
		}
		body {
			margin: auto;
			overflow-x: hidden;
			display: flex;
			flex-direction: column;
			align-items: center;
			align-content: center;
		}
		#beepboxEditorContainer {
			min-height: 645px;
			overflow: auto;
			background: var(--editor-background, black);
			width: 100%;
			max-width: 700px;
			padding-left: 30px;
			padding-right: 30px;
		}
		#text-content {
			overflow: auto;
			background: var(--editor-background, black);
			width: 100%;
			max-width: 700px;
			padding-left: 30px;
			padding-right: 30px;
		}
		h1 {
			font-size: 1.7rem;
			text-align: center;
			margin-top: 0.5em;
			margin-bottom: 0.5em;
			-webkit-text-stroke-width: 0;
		}
		h2 {
			font-size: 1.5rem;
			text-align: center;
			margin-top: 0.5em;
			margin-bottom: 0.5em;
			-webkit-text-stroke-width: 0;
		}
		a {
			color: var(--link-accent, #98f);
		}
		.donation form {
			display: inline;
		}
		.donation input[type="submit"] {
			-webkit-appearance: none;
			appearance: none;
			background: none;
			border: none;
			font-family: inherit;
			font-size: inherit;
			color: var(--link-accent, #98f);
			text-decoration: underline;
			cursor: pointer;
			padding: 0;
			margin: 0;
		}
		
		/* wide screen */
		@media (min-width: 701px) {
			html {
				width: 100%;
			}
			body {
				width: 100%;
			}
			.column-container {
				width: 700px;
				display: flex;
				justify-content: space-between;
			}
			/*.instructions-column {
				width: 375px;
			}
			.twitter-column {
				width: 300px;
			}*/
		}
		
		/* narrow screen */
		@media (max-width: 700px) {
			body {
				width: 100%;
			}
			p, .donation {
				margin: 1em 0.5em;
			}
			.column-container {
				display: flex;
				flex-direction: column;
				align-items: center;
			}
		}
	</style>
</head>

<body>
	<div id="beepboxEditorContainer">
		<noscript>
			Sorry, BeepBox requires a JavaScript-enabled browser.
		</noscript>
	</div>
	<div id="text-content">
		<section>
			<h1>
				BeepBox Offline
			</h1>
			<p id="introduction">
				BeepBox is an online (and offline!) tool for sketching and sharing instrumental melodies. 
			</p>
			<p>
				All song data is contained in the URL at the top of your browser. 
				When you make changes to the song, the URL is updated to reflect your changes. 
				When you are satisfied with your song, just copy and paste the URL to save and share your song! 
			</p>
			<div class="donation">
				BeepBox is a passion project, and will always be free to use. If you find it valuable and have the means, any gratuity via
				<form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_blank">
					<input type="hidden" name="cmd" value="_donations" />
					<input type="hidden" name="business" value="QZJTX9GRYEV9N" />
					<input type="hidden" name="currency_code" value="USD" />
					<input type="submit" name="submit" value="Paypal"/>
				</form>
				would be appreciated!
			</div>
		</section>
	
		<div class="column-container">
			<main class="instructions-column">
				<section>
					<h2>
						Instructions
					</h2>
					<p>
						You can add or remove notes by clicking on the gray rows at the top. 
						BeepBox automatically plays the notes out loud for you. Try it!
					</p>
					<p>
						Notes go into patterns, and you can edit one pattern at a time.
						Those numbered boxes at the bottom of the editor are the different patterns you can edit.
						<span id="bar-editing">
							Click the other boxes to move to a different part of the song, or click the arrows on the currently selected box to swap which pattern is played during that part of the song.
						</span>
					</p>
					<p>
						BeepBox can play several rows of patterns simultaneously, and each row has its own set of patterns. 
						Most rows can play melodies or harmonies, but the bottom row is for drums.
					</p>
					<p>
						The purple loop underneath the numbered boxes controls which part of the song is currently repeating. 
						Move the loop to listen to a different part of the song, or drag the ends to expand the loop to include the whole song. 
					</p>
					<div id="keyboard-instructions">
						<p>
							When BeepBox has focus (click on its interface above), you can use these keyboard shortcuts: <br/>
						</p>
						<ul>
							<li>Spacebar: play or pause the song</li>
							<li>Z: undo</li>
							<li>Y or Shift Z: redo</li>
							<li>C: copy pattern from selection</li>
							<li>V: paste pattern into selection</li>
							<li>1-8: assign a pattern number to selection</li>
							<li>Arrows: move selection</li>
							<li>[ ]: move playhead backward or forward</li>
							<li>Check BeepBox's edit menu for more!</li>
						</ul>
					</div>
					<p>
						In the note pattern editor, you can click and drag horizontally on a note to adjust its duration.
						You can also click above or below an existing note to add more notes to be played simultaneously, which is called a chord. 
					</p>
					<p>
						ADVANCED: Drag vertically from an existing note to bend its pitch, or drag vertically from above or below the note to adjust its volume. Drag on the numbered pattern boxes to select multiple patterns to copy and paste parts of your song.
					</p>
					<p>
						BeepBox has many more features. 
						Try playing with the buttons and menus on the right side to find out what it can do!
						You can also click on the label next to each option for a description of what it does.
					</p>
				</section>
				<section>
					<h2>
						About
					</h2>
					<p>
						BeepBox is developed by <a href="http://www.johnnesky.com">John Nesky</a>, also known as <a href="https://twitter.com/shaktool">@shaktool</a>. 
					</p>
					<p>
						BeepBox does not claim ownership over songs created with it, so original songs belong to their authors. 
					</p>
					<p>
						Neither John Nesky nor BeepBox assume responsibility for any copyrighted material played on BeepBox. No songs are ever received, recorded, or distributed by BeepBox's servers. All song data is contained in the URL after the hash (#) mark, and BeepBox running inside your browser converts that data into sound waves.
					</p>
					<p>
						You can download <a download="beepbox_offline.html" href="beepbox_offline.html">an offline version of BeepBox</a> to use when you don't have access to the internet. The features are otherwise the same.
					</p>
					<p>
						You can download and use <a href="https://github.com/johnnesky/beepbox">the source code</a> under the MIT license. In particular, you can use the synth code <a href="synth_example.html">as demonstrated here</a> to play BeepBox songs in your own JavaScript projects!
					</p>
					<p>
						Those who yearn for simpler times can find the old version of BeepBox <a href="2_3/" target="_blank">here</a>.
					</p>
				<section>
			</main>
		</div>
	</div>
	
	<script type="text/javascript">

if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|android|ipad|playbook|silk/i.test(navigator.userAgent) ) {
	document.getElementById("introduction").innerHTML = "BeepBox is an online tool for sketching and sharing instrumental melodies. Make sure that your volume is turned up, then press the play button!";
	document.getElementById("keyboard-instructions").style.display = "none";
	document.getElementById("bar-editing").innerHTML = "Tap the other boxes to move to a different part of the song, or tap on the currently selected box to swap which pattern is played during that part of the song.";
}

var beepbox;!function(t){class e{}function i(t){let e=0;for(let i=0;i<t.length;i++)e+=t[i];const i=e/t.length;let s=0,n=0;for(let e=0;e<t.length;e++)s+=n,n=t[e]-i,t[e]=s;return t.push(0),new Float64Array(t)}function s(i){let s=e.chipNoises[i].samples;if(null==s){if(s=new Float32Array(e.chipNoiseLength+1),e.chipNoises[i].samples=s,0==i){let t=1;for(let i=0;i<e.chipNoiseLength;i++){s[i]=2*(1&t)-1;let e=t>>1;1==(t+e&1)&&(e+=16384),t=e}}else if(1==i)for(let t=0;t<e.chipNoiseLength;t++)s[t]=2*Math.random()-1;else if(2==i){let t=1;for(let i=0;i<e.chipNoiseLength;i++){s[i]=2*(1&t)-1;let e=t>>1;1==(t+e&1)&&(e+=32768),t=e}}else if(3==i){let t=1;for(let i=0;i<e.chipNoiseLength;i++){s[i]=2*(1&t)-1;let e=t>>1;1==(t+e&1)&&(e+=40),t=e}}else{if(4!=i)throw new Error("Unrecognized drum index: "+i);n(s,10,11,1,1,0),n(s,11,14,.6578,.6578,0),t.inverseRealFourierTransform(s,e.chipNoiseLength),t.scaleElementsByFactor(s,1/Math.sqrt(e.chipNoiseLength))}s[e.chipNoiseLength]=s[0]}return s}function n(t,i,n,o,r,h){const a=0|Math.pow(2,i),l=Math.min(e.chipNoiseLength>>1,0|Math.pow(2,n)),c=s(0);let f=0;for(let s=a;s<l;s++){let a=o+(r-o)*(Math.log(s)/Math.LN2-i)/(n-i),l=Math.pow(2,(a-1)*e.spectrumMax+1)*a;f+=l*=Math.pow(s/2048,h),l*=c[s];const d=.61803398875*s*s*Math.PI*2;t[s]=Math.cos(d)*l,t[e.chipNoiseLength-s]=Math.sin(d)*l}return f}function o(t){const e={};for(let i=0;i<t.length;i++){const s=t[i];s.index=i,e[s.name]=s}const i=t;return i.dictionary=e,i}e.scales=o([{name:"easy :)",realName:"pentatonic major",flags:[!0,!1,!0,!1,!0,!1,!1,!0,!1,!0,!1,!1]},{name:"easy :(",realName:"pentatonic minor",flags:[!0,!1,!1,!0,!1,!0,!1,!0,!1,!1,!0,!1]},{name:"island :)",realName:"ryukyu",flags:[!0,!1,!1,!1,!0,!0,!1,!0,!1,!1,!1,!0]},{name:"island :(",realName:"pelog selisir",flags:[!0,!0,!1,!0,!1,!1,!1,!0,!0,!1,!1,!1]},{name:"blues :)",realName:"blues major",flags:[!0,!1,!0,!0,!0,!1,!1,!0,!1,!0,!1,!1]},{name:"blues :(",realName:"blues",flags:[!0,!1,!1,!0,!1,!0,!0,!0,!1,!1,!0,!1]},{name:"normal :)",realName:"ionian",flags:[!0,!1,!0,!1,!0,!0,!1,!0,!1,!0,!1,!0]},{name:"normal :(",realName:"aeolian",flags:[!0,!1,!0,!0,!1,!0,!1,!0,!0,!1,!0,!1]},{name:"dbl harmonic :)",realName:"double harmonic major",flags:[!0,!0,!1,!1,!0,!0,!1,!0,!0,!1,!1,!0]},{name:"dbl harmonic :(",realName:"double harmonic minor",flags:[!0,!1,!0,!0,!1,!1,!0,!0,!0,!1,!1,!0]},{name:"strange",realName:"whole tone",flags:[!0,!1,!0,!1,!0,!1,!0,!1,!0,!1,!0,!1]},{name:"expert",realName:"chromatic",flags:[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0]}]),e.keys=o([{name:"C",isWhiteKey:!0,basePitch:12},{name:"C♯",isWhiteKey:!1,basePitch:13},{name:"D",isWhiteKey:!0,basePitch:14},{name:"D♯",isWhiteKey:!1,basePitch:15},{name:"E",isWhiteKey:!0,basePitch:16},{name:"F",isWhiteKey:!0,basePitch:17},{name:"F♯",isWhiteKey:!1,basePitch:18},{name:"G",isWhiteKey:!0,basePitch:19},{name:"G♯",isWhiteKey:!1,basePitch:20},{name:"A",isWhiteKey:!0,basePitch:21},{name:"A♯",isWhiteKey:!1,basePitch:22},{name:"B",isWhiteKey:!0,basePitch:23}]),e.blackKeyNameParents=[-1,1,-1,1,-1,1,-1,-1,1,-1,1,-1],e.tempoMin=30,e.tempoMax=300,e.reverbRange=4,e.beatsPerBarMin=3,e.beatsPerBarMax=16,e.barCountMin=1,e.barCountMax=128,e.instrumentsPerChannelMin=1,e.instrumentsPerChannelMax=10,e.partsPerBeat=24,e.ticksPerPart=2,e.rhythms=o([{name:"÷3 (triplets)",stepsPerBeat:3,ticksPerArpeggio:4,arpeggioPatterns:[[0],[0,0,1,1],[0,1,2,1]],roundUpThresholds:[5,12,18]},{name:"÷4 (standard)",stepsPerBeat:4,ticksPerArpeggio:3,arpeggioPatterns:[[0],[0,0,1,1],[0,1,2,1]],roundUpThresholds:[3,9,17,21]},{name:"÷6",stepsPerBeat:6,ticksPerArpeggio:4,arpeggioPatterns:[[0],[0,1],[0,1,2,1]],roundUpThresholds:null},{name:"÷8",stepsPerBeat:8,ticksPerArpeggio:3,arpeggioPatterns:[[0],[0,1],[0,1,2,1]],roundUpThresholds:null},{name:"freehand",stepsPerBeat:24,ticksPerArpeggio:3,arpeggioPatterns:[[0],[0,1],[0,1,2,1]],roundUpThresholds:null}]),e.instrumentTypeNames=["chip","FM","noise","spectrum","drumset","harmonics","PWM"],e.instrumentTypeHasSpecialInterval=[!0,!0,!1,!1,!1,!0,!1],e.chipWaves=o([{name:"rounded",volume:.94,samples:i([0,.2,.4,.5,.6,.7,.8,.85,.9,.95,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,.95,.9,.85,.8,.7,.6,.5,.4,.2,0,-.2,-.4,-.5,-.6,-.7,-.8,-.85,-.9,-.95,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-.95,-.9,-.85,-.8,-.7,-.6,-.5,-.4,-.2])},{name:"triangle",volume:1,samples:i([1/15,.2,5/15,7/15,.6,11/15,13/15,1,1,13/15,11/15,.6,7/15,5/15,.2,1/15,-1/15,-.2,-5/15,-7/15,-.6,-11/15,-13/15,-1,-1,-13/15,-11/15,-.6,-7/15,-5/15,-.2,-1/15])},{name:"square",volume:.5,samples:i([1,-1])},{name:"1/4 pulse",volume:.5,samples:i([1,-1,-1,-1])},{name:"1/8 pulse",volume:.5,samples:i([1,-1,-1,-1,-1,-1,-1,-1])},{name:"sawtooth",volume:.65,samples:i([1/31,3/31,5/31,7/31,9/31,11/31,13/31,15/31,17/31,19/31,21/31,23/31,25/31,27/31,29/31,1,-1,-29/31,-27/31,-25/31,-23/31,-21/31,-19/31,-17/31,-15/31,-13/31,-11/31,-9/31,-7/31,-5/31,-3/31,-1/31])},{name:"double saw",volume:.5,samples:i([0,-.2,-.4,-.6,-.8,-1,1,-.8,-.6,-.4,-.2,1,.8,.6,.4,.2])},{name:"double pulse",volume:.4,samples:i([1,1,1,1,1,-1,-1,-1,1,1,1,1,-1,-1,-1,-1])},{name:"spiky",volume:.4,samples:i([1,-1,1,-1,1,0])}]),e.chipNoises=o([{name:"retro",volume:.25,basePitch:69,pitchFilterMult:1024,isSoft:!1,samples:null},{name:"white",volume:1,basePitch:69,pitchFilterMult:8,isSoft:!0,samples:null},{name:"clang",volume:.4,basePitch:69,pitchFilterMult:1024,isSoft:!1,samples:null},{name:"buzz",volume:.3,basePitch:69,pitchFilterMult:1024,isSoft:!1,samples:null},{name:"hollow",volume:1.5,basePitch:96,pitchFilterMult:1,isSoft:!0,samples:null}]),e.filterCutoffMaxHz=8e3,e.filterCutoffMinHz=1,e.filterMax=.95,e.filterMaxResonance=.95,e.filterCutoffRange=11,e.filterResonanceRange=8,e.transitions=o([{name:"seamless",isSeamless:!0,attackSeconds:0,releases:!1,releaseTicks:1,slides:!1,slideTicks:3},{name:"hard",isSeamless:!1,attackSeconds:0,releases:!1,releaseTicks:3,slides:!1,slideTicks:3},{name:"soft",isSeamless:!1,attackSeconds:.025,releases:!1,releaseTicks:3,slides:!1,slideTicks:3},{name:"slide",isSeamless:!0,attackSeconds:.025,releases:!1,releaseTicks:3,slides:!0,slideTicks:3},{name:"cross fade",isSeamless:!1,attackSeconds:.04,releases:!0,releaseTicks:6,slides:!1,slideTicks:3},{name:"hard fade",isSeamless:!1,attackSeconds:0,releases:!0,releaseTicks:48,slides:!1,slideTicks:3},{name:"medium fade",isSeamless:!1,attackSeconds:.0125,releases:!0,releaseTicks:72,slides:!1,slideTicks:3},{name:"soft fade",isSeamless:!1,attackSeconds:.06,releases:!0,releaseTicks:96,slides:!1,slideTicks:6}]),e.vibratos=o([{name:"none",amplitude:0,periodsSeconds:[.14],delayParts:0},{name:"light",amplitude:.15,periodsSeconds:[.14],delayParts:0},{name:"delayed",amplitude:.3,periodsSeconds:[.14],delayParts:18},{name:"heavy",amplitude:.45,periodsSeconds:[.14],delayParts:0},{name:"shaky",amplitude:.1,periodsSeconds:[.11,.17798,.33],delayParts:0}]),e.intervals=o([{name:"union",spread:0,offset:0,volume:.7,sign:1},{name:"shimmer",spread:.018,offset:0,volume:.8,sign:1},{name:"hum",spread:.045,offset:0,volume:1,sign:1},{name:"honky tonk",spread:.09,offset:0,volume:1,sign:1},{name:"dissonant",spread:.25,offset:0,volume:.9,sign:1},{name:"fifth",spread:3.5,offset:3.5,volume:.9,sign:1},{name:"octave",spread:6,offset:6,volume:.8,sign:1},{name:"bowed",spread:.02,offset:0,volume:1,sign:-1},{name:"piano",spread:.01,offset:0,volume:1,sign:.7}]),e.effectsNames=["none","reverb","chorus","chorus & reverb"],e.volumeRange=8,e.volumeLogScale=-.5,e.panCenter=4,e.panMax=2*e.panCenter,e.chords=o([{name:"harmony",harmonizes:!0,customInterval:!1,arpeggiates:!1,isCustomInterval:!1,strumParts:0},{name:"strum",harmonizes:!0,customInterval:!1,arpeggiates:!1,isCustomInterval:!1,strumParts:1},{name:"arpeggio",harmonizes:!1,customInterval:!1,arpeggiates:!0,isCustomInterval:!1,strumParts:0},{name:"custom interval",harmonizes:!0,customInterval:!0,arpeggiates:!0,isCustomInterval:!0,strumParts:0}]),e.maxChordSize=4,e.operatorCount=4,e.algorithms=o([{name:"1←(2 3 4)",carrierCount:1,associatedCarrier:[1,1,1,1],modulatedBy:[[2,3,4],[],[],[]]},{name:"1←(2 3←4)",carrierCount:1,associatedCarrier:[1,1,1,1],modulatedBy:[[2,3],[],[4],[]]},{name:"1←2←(3 4)",carrierCount:1,associatedCarrier:[1,1,1,1],modulatedBy:[[2],[3,4],[],[]]},{name:"1←(2 3)←4",carrierCount:1,associatedCarrier:[1,1,1,1],modulatedBy:[[2,3],[4],[4],[]]},{name:"1←2←3←4",carrierCount:1,associatedCarrier:[1,1,1,1],modulatedBy:[[2],[3],[4],[]]},{name:"1←3 2←4",carrierCount:2,associatedCarrier:[1,2,1,2],modulatedBy:[[3],[4],[],[]]},{name:"1 2←(3 4)",carrierCount:2,associatedCarrier:[1,2,2,2],modulatedBy:[[],[3,4],[],[]]},{name:"1 2←3←4",carrierCount:2,associatedCarrier:[1,2,2,2],modulatedBy:[[],[3],[4],[]]},{name:"(1 2)←3←4",carrierCount:2,associatedCarrier:[1,2,2,2],modulatedBy:[[3],[3],[4],[]]},{name:"(1 2)←(3 4)",carrierCount:2,associatedCarrier:[1,2,2,2],modulatedBy:[[3,4],[3,4],[],[]]},{name:"1 2 3←4",carrierCount:3,associatedCarrier:[1,2,3,3],modulatedBy:[[],[],[4],[]]},{name:"(1 2 3)←4",carrierCount:3,associatedCarrier:[1,2,3,3],modulatedBy:[[4],[4],[4],[]]},{name:"1 2 3 4",carrierCount:4,associatedCarrier:[1,2,3,4],modulatedBy:[[],[],[],[]]}]),e.operatorCarrierInterval=[0,.04,-.073,.091],e.operatorAmplitudeMax=15,e.operatorFrequencies=o([{name:"1×",mult:1,hzOffset:0,amplitudeSign:1},{name:"~1×",mult:1,hzOffset:1.5,amplitudeSign:-1},{name:"2×",mult:2,hzOffset:0,amplitudeSign:1},{name:"~2×",mult:2,hzOffset:-1.3,amplitudeSign:-1},{name:"3×",mult:3,hzOffset:0,amplitudeSign:1},{name:"4×",mult:4,hzOffset:0,amplitudeSign:1},{name:"5×",mult:5,hzOffset:0,amplitudeSign:1},{name:"6×",mult:6,hzOffset:0,amplitudeSign:1},{name:"7×",mult:7,hzOffset:0,amplitudeSign:1},{name:"8×",mult:8,hzOffset:0,amplitudeSign:1},{name:"9×",mult:9,hzOffset:0,amplitudeSign:1},{name:"11×",mult:11,hzOffset:0,amplitudeSign:1},{name:"13×",mult:13,hzOffset:0,amplitudeSign:1},{name:"16×",mult:16,hzOffset:0,amplitudeSign:1},{name:"20×",mult:20,hzOffset:0,amplitudeSign:1}]),e.envelopes=o([{name:"custom",type:0,speed:0},{name:"steady",type:1,speed:0},{name:"punch",type:2,speed:0},{name:"flare 1",type:3,speed:32},{name:"flare 2",type:3,speed:8},{name:"flare 3",type:3,speed:2},{name:"twang 1",type:4,speed:32},{name:"twang 2",type:4,speed:8},{name:"twang 3",type:4,speed:2},{name:"swell 1",type:5,speed:32},{name:"swell 2",type:5,speed:8},{name:"swell 3",type:5,speed:2},{name:"tremolo1",type:6,speed:4},{name:"tremolo2",type:6,speed:2},{name:"tremolo3",type:6,speed:1},{name:"tremolo4",type:7,speed:4},{name:"tremolo5",type:7,speed:2},{name:"tremolo6",type:7,speed:1},{name:"decay 1",type:8,speed:10},{name:"decay 2",type:8,speed:7},{name:"decay 3",type:8,speed:4}]),e.feedbacks=o([{name:"1⟲",indices:[[1],[],[],[]]},{name:"2⟲",indices:[[],[2],[],[]]},{name:"3⟲",indices:[[],[],[3],[]]},{name:"4⟲",indices:[[],[],[],[4]]},{name:"1⟲ 2⟲",indices:[[1],[2],[],[]]},{name:"3⟲ 4⟲",indices:[[],[],[3],[4]]},{name:"1⟲ 2⟲ 3⟲",indices:[[1],[2],[3],[]]},{name:"2⟲ 3⟲ 4⟲",indices:[[],[2],[3],[4]]},{name:"1⟲ 2⟲ 3⟲ 4⟲",indices:[[1],[2],[3],[4]]},{name:"1→2",indices:[[],[1],[],[]]},{name:"1→3",indices:[[],[],[1],[]]},{name:"1→4",indices:[[],[],[],[1]]},{name:"2→3",indices:[[],[],[2],[]]},{name:"2→4",indices:[[],[],[],[2]]},{name:"3→4",indices:[[],[],[],[3]]},{name:"1→3 2→4",indices:[[],[],[1],[2]]},{name:"1→4 2→3",indices:[[],[],[2],[1]]},{name:"1→2→3→4",indices:[[],[1],[2],[3]]}]),e.chipNoiseLength=32768,e.spectrumBasePitch=24,e.spectrumControlPoints=30,e.spectrumControlPointsPerOctave=7,e.spectrumControlPointBits=3,e.spectrumMax=(1<<e.spectrumControlPointBits)-1,e.harmonicsControlPoints=28,e.harmonicsRendered=64,e.harmonicsControlPointBits=3,e.harmonicsMax=(1<<e.harmonicsControlPointBits)-1,e.harmonicsWavelength=2048,e.pulseWidthRange=8,e.pitchChannelCountMin=1,e.pitchChannelCountMax=6,e.noiseChannelCountMin=0,e.noiseChannelCountMax=3,e.noiseInterval=6,e.pitchesPerOctave=12,e.drumCount=12,e.pitchOctaves=7,e.windowOctaves=3,e.scrollableOctaves=e.pitchOctaves-e.windowOctaves,e.windowPitchCount=e.windowOctaves*e.pitchesPerOctave+1,e.maxPitch=e.pitchOctaves*e.pitchesPerOctave,e.maximumTonesPerChannel=2*e.maxChordSize,e.sineWaveLength=256,e.sineWaveMask=e.sineWaveLength-1,e.sineWave=function(){const t=new Float64Array(e.sineWaveLength+1);for(let i=0;i<e.sineWaveLength+1;i++)t[i]=Math.sin(i*Math.PI*2/e.sineWaveLength);return t}(),t.Config=e,t.getDrumWave=s,t.drawNoiseSpectrum=n,t.getArpeggioPitchIndex=function(t,i,s){const n=e.rhythms[i].arpeggioPatterns[t-1];return null!=n?n[s%n.length]:s%t},t.toNameMap=o}(beepbox||(beepbox={})),function(t){t.isMobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|android|ipad|playbook|silk/i.test(navigator.userAgent);class e{static valueToPreset(t){const i=t>>6,s=63&t;return e.presetCategories[i].presets[s]}static midiProgramToPresetValue(t){for(let i=0;i<e.presetCategories.length;i++){const s=e.presetCategories[i];for(let e=0;e<s.presets.length;e++){const n=s.presets[e];if(n.generalMidi&&n.midiProgram==t)return(i<<6)+e}}return null}static nameToPresetValue(t){for(let i=0;i<e.presetCategories.length;i++){const s=e.presetCategories[i];for(let e=0;e<s.presets.length;e++){if(s.presets[e].name==t)return(i<<6)+e}}return null}}e.version="3.0.9",e.versionDisplayName="BeepBox "+e.version,e.presetCategories=t.toNameMap([{name:"Custom Instruments",presets:t.toNameMap([{name:"chip wave",customType:0},{name:"FM (expert)",customType:1},{name:"basic noise",customType:2},{name:"spectrum",customType:3},{name:"drumset",customType:4},{name:"harmonics",customType:5},{name:"pulse width",customType:6}])},{name:"Retro Presets",presets:t.toNameMap([{name:"square wave",midiProgram:80,settings:{type:"chip",transition:"seamless",effects:"none",chord:"arpeggio",filterCutoffHz:4e3,filterResonance:0,filterEnvelope:"steady",wave:"square",interval:"union",vibrato:"none"}},{name:"triangle wave",midiProgram:71,settings:{type:"chip",transition:"seamless",effects:"none",chord:"arpeggio",filterCutoffHz:4e3,filterResonance:0,filterEnvelope:"steady",wave:"triangle",interval:"union",vibrato:"none"}},{name:"square lead",midiProgram:80,generalMidi:!0,settings:{type:"chip",transition:"hard",effects:"reverb",chord:"harmony",filterCutoffHz:2828,filterResonance:14,filterEnvelope:"steady",wave:"square",interval:"hum",vibrato:"none"}},{name:"sawtooth lead 1",midiProgram:81,generalMidi:!0,settings:{type:"chip",transition:"hard",effects:"reverb",chord:"harmony",filterCutoffHz:2828,filterResonance:14,filterEnvelope:"steady",wave:"sawtooth",interval:"shimmer",vibrato:"none"}},{name:"sawtooth lead 2",midiProgram:81,settings:{type:"chip",effects:"reverb",transition:"medium fade",chord:"harmony",filterCutoffHz:5657,filterResonance:29,filterEnvelope:"steady",wave:"sawtooth",interval:"hum",vibrato:"light"}},{name:"chip noise",midiProgram:116,isNoise:!0,settings:{type:"noise",transition:"hard",effects:"none",chord:"arpeggio",filterCutoffHz:4e3,filterResonance:0,filterEnvelope:"steady",wave:"retro"}},{name:"FM twang",midiProgram:32,settings:{type:"FM",transition:"hard",effects:"none",chord:"harmony",filterCutoffHz:8e3,filterResonance:0,filterEnvelope:"steady",vibrato:"none",algorithm:"1←(2 3 4)",feedbackType:"1⟲",feedbackAmplitude:0,feedbackEnvelope:"steady",operators:[{frequency:"1×",amplitude:15,envelope:"custom"},{frequency:"1×",amplitude:15,envelope:"twang 2"},{frequency:"1×",amplitude:0,envelope:"steady"},{frequency:"1×",amplitude:0,envelope:"steady"}]}},{name:"FM bass",midiProgram:36,settings:{type:"FM",effects:"reverb",transition:"hard",chord:"custom interval",filterCutoffHz:8e3,filterResonance:0,filterEnvelope:"steady",vibrato:"none",algorithm:"1←(2 3←4)",feedbackType:"1⟲",feedbackAmplitude:0,feedbackEnvelope:"steady",operators:[{frequency:"2×",amplitude:11,envelope:"custom"},{frequency:"1×",amplitude:7,envelope:"twang 2"},{frequency:"1×",amplitude:9,envelope:"twang 3"},{frequency:"20×",amplitude:3,envelope:"twang 2"}]}},{name:"FM flute",midiProgram:73,settings:{type:"FM",effects:"reverb",transition:"soft",chord:"harmony",filterCutoffHz:8e3,filterResonance:0,filterEnvelope:"steady",vibrato:"none",algorithm:"1←(2 3 4)",feedbackType:"1⟲",feedbackAmplitude:0,feedbackEnvelope:"steady",operators:[{frequency:"1×",amplitude:15,envelope:"custom"},{frequency:"1×",amplitude:6,envelope:"twang 2"},{frequency:"1×",amplitude:0,envelope:"steady"},{frequency:"1×",amplitude:0,envelope:"steady"}]}},{name:"FM organ",midiProgram:16,settings:{type:"FM",effects:"reverb",transition:"soft",chord:"custom interval",filterCutoffHz:8e3,filterResonance:0,filterEnvelope:"steady",vibrato:"delayed",algorithm:"1←3 2←4",feedbackType:"1⟲ 2⟲",feedbackAmplitude:0,feedbackEnvelope:"steady",operators:[{frequency:"1×",amplitude:14,envelope:"custom"},{frequency:"2×",amplitude:14,envelope:"custom"},{frequency:"1×",amplitude:11,envelope:"steady"},{frequency:"2×",amplitude:11,envelope:"steady"}]}}])},{name:"Keyboard Presets",presets:t.toNameMap([{name:"grand piano",midiProgram:0,generalMidi:!0,settings:{type:"harmonics",effects:"reverb",transition:"hard fade",chord:"harmony",filterCutoffHz:1414,filterResonance:14,filterEnvelope:"twang 3",interval:"piano",vibrato:"none",harmonics:[100,100,86,86,86,71,71,71,0,86,71,71,71,57,57,71,57,14,57,57,57,57,57,57,57,57,29,57]}},{name:"bright piano",midiProgram:1,generalMidi:!0,settings:{type:"harmonics",effects:"reverb",transition:"hard fade",chord:"harmony",filterCutoffHz:2e3,filterResonance:14,filterEnvelope:"twang 3",interval:"piano",vibrato:"none",harmonics:[100,100,86,86,71,71,0,71,86,86,71,71,71,14,57,57,57,57,57,57,29,57,57,57,57,57,57,57]}},{name:"electric grand",midiProgram:2,generalMidi:!0,settings:{type:"chip",effects:"reverb",transition:"hard fade",chord:"harmony",filterCutoffHz:2e3,filterResonance:14,filterEnvelope:"twang 3",wave:"1/8 pulse",interval:"shimmer",vibrato:"none"}},{name:"honky-tonk piano",midiProgram:3,generalMidi:!0,settings:{type:"harmonics",effects:"reverb",transition:"hard fade",chord:"harmony",filterCutoffHz:5657,filterResonance:29,filterEnvelope:"twang 2",interval:"honky tonk",vibrato:"none",harmonics:[100,100,86,71,86,71,43,71,43,43,57,57,57,29,57,43,43,43,43,43,29,43,43,43,29,29,29,29]}},{name:"electric piano 1",midiProgram:4,generalMidi:!0,settings:{type:"harmonics",effects:"reverb",transition:"hard",chord:"harmony",filterCutoffHz:2828,filterResonance:14,filterEnvelope:"twang 2",interval:"union",vibrato:"none",harmonics:[86,100,100,71,71,57,57,43,43,43,29,29,29,14,14,14,0,0,0,0,0,57,0,0,0,0,0,0]}},{name:"electric piano 2",midiProgram:5,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"hard fade",chord:"harmony",filterCutoffHz:2828,filterResonance:0,filterEnvelope:"twang 3",vibrato:"none",algorithm:"1←3 2←4",feedbackType:"1⟲ 2⟲",feedbackAmplitude:0,feedbackEnvelope:"steady",operators:[{frequency:"1×",amplitude:12,envelope:"custom"},{frequency:"1×",amplitude:6,envelope:"custom"},{frequency:"1×",amplitude:9,envelope:"steady"},{frequency:"16×",amplitude:6,envelope:"twang 3"}]}},{name:"harpsichord",midiProgram:6,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"hard fade",chord:"harmony",filterCutoffHz:8e3,filterResonance:0,filterEnvelope:"twang 2",vibrato:"none",algorithm:"1←(2 3←4)",feedbackType:"4⟲",feedbackAmplitude:9,feedbackEnvelope:"twang 2",operators:[{frequency:"1×",amplitude:15,envelope:"custom"},{frequency:"4×",amplitude:8,envelope:"steady"},{frequency:"3×",amplitude:6,envelope:"steady"},{frequency:"5×",amplitude:7,envelope:"steady"}]}},{name:"clavinet",midiProgram:7,generalMidi:!0,settings:{type:"FM",transition:"hard",effects:"reverb",chord:"harmony",filterCutoffHz:5657,filterResonance:0,filterEnvelope:"twang 2",vibrato:"none",algorithm:"1←(2 3 4)",feedbackType:"3⟲",feedbackAmplitude:6,feedbackEnvelope:"twang 2",operators:[{frequency:"3×",amplitude:15,envelope:"custom"},{frequency:"~1×",amplitude:6,envelope:"steady"},{frequency:"8×",amplitude:4,envelope:"steady"},{frequency:"1×",amplitude:0,envelope:"steady"}]}},{name:"dulcimer",midiProgram:15,generalMidi:!0,settings:{type:"harmonics",effects:"reverb",transition:"hard fade",chord:"strum",filterCutoffHz:5657,filterResonance:14,filterEnvelope:"twang 2",interval:"piano",vibrato:"none",harmonics:[100,100,100,86,100,86,57,100,100,86,100,86,100,86,100,71,57,71,71,100,86,71,86,86,100,86,86,86]}}])},{name:"Idiophone Presets",presets:t.toNameMap([{name:"celesta",midiProgram:8,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"hard fade",chord:"strum",filterCutoffHz:5657,filterResonance:14,filterEnvelope:"twang 2",vibrato:"none",algorithm:"(1 2)←(3 4)",feedbackType:"1⟲ 2⟲",feedbackAmplitude:0,feedbackEnvelope:"steady",operators:[{frequency:"~1×",amplitude:11,envelope:"custom"},{frequency:"8×",amplitude:6,envelope:"custom"},{frequency:"20×",amplitude:3,envelope:"twang 1"},{frequency:"3×",amplitude:1,envelope:"twang 2"}]}},{name:"glockenspiel",midiProgram:9,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"hard fade",chord:"strum",filterCutoffHz:5657,filterResonance:14,filterEnvelope:"twang 2",vibrato:"none",algorithm:"(1 2 3)←4",feedbackType:"1⟲ 2⟲ 3⟲",feedbackAmplitude:2,feedbackEnvelope:"decay 1",operators:[{frequency:"1×",amplitude:7,envelope:"custom"},{frequency:"5×",amplitude:11,envelope:"custom"},{frequency:"8×",amplitude:7,envelope:"custom"},{frequency:"20×",amplitude:2,envelope:"twang 1"}]}},{name:"music box 1",midiProgram:10,generalMidi:!0,settings:{type:"harmonics",effects:"reverb",transition:"hard fade",chord:"strum",filterCutoffHz:4e3,filterResonance:14,filterEnvelope:"twang 2",interval:"union",vibrato:"none",harmonics:[100,0,0,100,0,0,0,0,0,0,100,0,0,0,0,0,0,0,0,86,0,0,0,0,0,0,71,0]}},{name:"music box 2",midiProgram:10,settings:{type:"harmonics",effects:"reverb",transition:"hard fade",chord:"strum",filterCutoffHz:2828,filterResonance:14,filterEnvelope:"twang 1",interval:"union",vibrato:"none",harmonics:[100,57,57,0,0,0,0,0,0,57,0,0,0,14,14,14,14,14,14,43,14,14,14,14,14,14,14,14]}},{name:"vibraphone",midiProgram:11,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"hard fade",chord:"harmony",filterCutoffHz:2828,filterResonance:14,filterEnvelope:"twang 2",vibrato:"none",algorithm:"1 2 3 4",feedbackType:"1→2→3→4",feedbackAmplitude:3,feedbackEnvelope:"twang 1",operators:[{frequency:"1×",amplitude:9,envelope:"custom"},{frequency:"~1×",amplitude:9,envelope:"custom"},{frequency:"9×",amplitude:3,envelope:"custom"},{frequency:"4×",amplitude:9,envelope:"custom"}]}},{name:"marimba",midiProgram:12,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"hard fade",chord:"strum",filterCutoffHz:2e3,filterResonance:29,filterEnvelope:"decay 1",vibrato:"none",algorithm:"1 2←(3 4)",feedbackType:"1⟲",feedbackAmplitude:0,feedbackEnvelope:"steady",operators:[{frequency:"1×",amplitude:10,envelope:"custom"},{frequency:"4×",amplitude:6,envelope:"custom"},{frequency:"13×",amplitude:6,envelope:"twang 1"},{frequency:"1×",amplitude:0,envelope:"steady"}]}},{name:"kalimba",midiProgram:108,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"hard fade",chord:"strum",filterCutoffHz:2828,filterResonance:14,filterEnvelope:"decay 1",vibrato:"none",algorithm:"1←(2 3 4)",feedbackType:"1⟲",feedbackAmplitude:0,feedbackEnvelope:"steady",operators:[{frequency:"1×",amplitude:11,envelope:"custom"},{frequency:"5×",amplitude:3,envelope:"twang 2"},{frequency:"20×",amplitude:3,envelope:"twang 1"},{frequency:"1×",amplitude:0,envelope:"steady"}]}},{name:"xylophone",midiProgram:13,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"hard",chord:"strum",filterCutoffHz:2e3,filterResonance:14,filterEnvelope:"twang 1",vibrato:"none",algorithm:"(1 2 3)←4",feedbackType:"1⟲ 2⟲ 3⟲",feedbackAmplitude:0,feedbackEnvelope:"steady",operators:[{frequency:"1×",amplitude:9,envelope:"custom"},{frequency:"6×",amplitude:9,envelope:"custom"},{frequency:"11×",amplitude:9,envelope:"custom"},{frequency:"20×",amplitude:6,envelope:"twang 1"}]}},{name:"tubular bell",midiProgram:14,generalMidi:!0,midiSubharmonicOctaves:1,settings:{type:"harmonics",effects:"reverb",transition:"hard fade",chord:"strum",filterCutoffHz:4e3,filterResonance:14,filterEnvelope:"twang 3",interval:"hum",vibrato:"none",harmonics:[43,71,0,100,0,100,0,86,0,0,86,0,14,71,14,14,57,14,14,43,14,14,43,14,14,43,14,14]}},{name:"bell synth",midiProgram:14,settings:{type:"FM",effects:"reverb",transition:"hard fade",chord:"strum",filterCutoffHz:2e3,filterResonance:29,filterEnvelope:"twang 3",vibrato:"none",algorithm:"1←(2 3 4)",feedbackType:"1⟲",feedbackAmplitude:0,feedbackEnvelope:"steady",operators:[{frequency:"~2×",amplitude:10,envelope:"custom"},{frequency:"7×",amplitude:6,envelope:"twang 3"},{frequency:"20×",amplitude:1,envelope:"twang 1"},{frequency:"1×",amplitude:0,envelope:"steady"}]}},{name:"rain drop",midiProgram:96,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"hard fade",chord:"strum",filterCutoffHz:4e3,filterResonance:14,filterEnvelope:"twang 1",vibrato:"none",algorithm:"(1 2)←(3 4)",feedbackType:"1⟲ 2⟲",feedbackAmplitude:0,feedbackEnvelope:"steady",operators:[{frequency:"1×",amplitude:12,envelope:"custom"},{frequency:"6×",amplitude:4,envelope:"custom"},{frequency:"20×",amplitude:3,envelope:"twang 1"},{frequency:"1×",amplitude:6,envelope:"tremolo1"}]}},{name:"crystal",midiProgram:98,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"hard fade",chord:"harmony",filterCutoffHz:2828,filterResonance:14,filterEnvelope:"twang 2",vibrato:"delayed",algorithm:"1 2 3 4",feedbackType:"1⟲ 2⟲ 3⟲ 4⟲",feedbackAmplitude:4,feedbackEnvelope:"twang 1",operators:[{frequency:"1×",amplitude:10,envelope:"custom"},{frequency:"3×",amplitude:7,envelope:"custom"},{frequency:"6×",amplitude:4,envelope:"custom"},{frequency:"13×",amplitude:4,envelope:"custom"}]}},{name:"tinkle bell",midiProgram:112,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"hard",chord:"strum",filterCutoffHz:2828,filterResonance:14,filterEnvelope:"twang 2",vibrato:"none",algorithm:"1 2 3 4",feedbackType:"1→2→3→4",feedbackAmplitude:5,feedbackEnvelope:"twang 3",operators:[{frequency:"~2×",amplitude:7,envelope:"custom"},{frequency:"5×",amplitude:7,envelope:"custom"},{frequency:"7×",amplitude:7,envelope:"custom"},{frequency:"16×",amplitude:7,envelope:"custom"}]}},{name:"agogo",midiProgram:113,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"hard fade",chord:"strum",filterCutoffHz:4e3,filterResonance:14,filterEnvelope:"decay 1",vibrato:"none",algorithm:"1 2 3 4",feedbackType:"1→4",feedbackAmplitude:15,feedbackEnvelope:"decay 1",operators:[{frequency:"2×",amplitude:9,envelope:"custom"},{frequency:"5×",amplitude:6,envelope:"custom"},{frequency:"8×",amplitude:9,envelope:"custom"},{frequency:"13×",amplitude:11,envelope:"custom"}]}}])},{name:"Guitar Presets",presets:t.toNameMap([{name:"nylon guitar",midiProgram:24,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"hard fade",chord:"strum",filterCutoffHz:5657,filterResonance:14,filterEnvelope:"twang 1",vibrato:"none",algorithm:"1←2←3←4",feedbackType:"3⟲",feedbackAmplitude:6,feedbackEnvelope:"twang 1",operators:[{frequency:"1×",amplitude:15,envelope:"custom"},{frequency:"1×",amplitude:6,envelope:"steady"},{frequency:"5×",amplitude:2,envelope:"steady"},{frequency:"7×",amplitude:4,envelope:"steady"}]}},{name:"steel guitar",midiProgram:25,generalMidi:!0,settings:{type:"harmonics",effects:"reverb",transition:"hard fade",chord:"strum",filterCutoffHz:5657,filterResonance:14,filterEnvelope:"twang 2",interval:"union",vibrato:"none",harmonics:[100,100,86,71,71,71,86,86,71,57,43,43,43,57,57,57,57,57,43,43,43,43,43,43,43,43,43,43]}},{name:"jazz guitar",midiProgram:26,generalMidi:!0,settings:{type:"harmonics",effects:"reverb",transition:"hard",chord:"strum",filterCutoffHz:2e3,filterResonance:14,filterEnvelope:"twang 2",interval:"union",vibrato:"none",harmonics:[100,100,86,71,57,71,71,43,57,71,57,43,29,29,29,29,29,29,29,29,14,14,14,14,14,14,14,0]}},{name:"clean guitar",midiProgram:27,generalMidi:!0,settings:{type:"harmonics",effects:"reverb",transition:"hard",chord:"strum",filterCutoffHz:2828,filterResonance:14,filterEnvelope:"twang 2",interval:"union",vibrato:"none",harmonics:[86,100,100,100,86,57,86,100,100,100,71,57,43,71,86,71,57,57,71,71,71,71,57,57,57,57,57,43]}},{name:"muted guitar",midiProgram:28,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"hard",chord:"strum",filterCutoffHz:2e3,filterResonance:14,filterEnvelope:"twang 1",vibrato:"none",algorithm:"1←(2 3←4)",feedbackType:"1⟲",feedbackAmplitude:7,feedbackEnvelope:"twang 2",operators:[{frequency:"1×",amplitude:13,envelope:"custom"},{frequency:"1×",amplitude:4,envelope:"twang 3"},{frequency:"4×",amplitude:4,envelope:"twang 2"},{frequency:"16×",amplitude:4,envelope:"twang 1"}]}}])},{name:"Picked Bass Presets",presets:t.toNameMap([{name:"acoustic bass",midiProgram:32,generalMidi:!0,settings:{type:"harmonics",effects:"reverb",transition:"hard fade",chord:"strum",filterCutoffHz:4e3,filterResonance:14,filterEnvelope:"twang 1",interval:"union",vibrato:"none",harmonics:[100,86,71,71,71,71,57,57,57,57,43,43,43,43,43,29,29,29,29,29,29,14,14,14,14,14,14,14]}},{name:"fingered bass",midiProgram:33,generalMidi:!0,settings:{type:"harmonics",effects:"reverb",transition:"hard fade",chord:"strum",filterCutoffHz:2828,filterResonance:14,filterEnvelope:"twang 1",interval:"union",vibrato:"none",harmonics:[100,86,71,57,71,43,57,29,29,29,29,29,29,14,14,14,14,14,14,14,14,14,14,14,14,14,14,0]}},{name:"picked bass",midiProgram:34,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"hard fade",chord:"strum",filterCutoffHz:2828,filterResonance:0,filterEnvelope:"twang 1",vibrato:"none",algorithm:"1←(2 3←4)",feedbackType:"3⟲",feedbackAmplitude:4,feedbackEnvelope:"twang 1",operators:[{frequency:"1×",amplitude:15,envelope:"custom"},{frequency:"1×",amplitude:5,envelope:"steady"},{frequency:"11×",amplitude:1,envelope:"twang 3"},{frequency:"1×",amplitude:9,envelope:"steady"}]}},{name:"fretless bass",midiProgram:35,generalMidi:!0,settings:{type:"harmonics",effects:"reverb",transition:"hard",chord:"strum",filterCutoffHz:1e3,filterResonance:14,filterEnvelope:"flare 2",interval:"union",vibrato:"none",harmonics:[100,100,86,71,71,57,57,71,71,71,57,57,57,57,57,57,57,43,43,43,43,43,43,43,43,29,29,14]}},{name:"slap bass 1",midiProgram:36,generalMidi:!0,settings:{type:"harmonics",effects:"reverb",transition:"hard",chord:"strum",filterCutoffHz:4e3,filterResonance:0,filterEnvelope:"twang 1",interval:"union",vibrato:"none",harmonics:[100,100,100,100,86,71,57,29,29,43,43,57,71,57,29,29,43,57,57,57,43,43,43,57,71,71,71,71]}},{name:"slap bass 2",midiProgram:37,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"hard",chord:"strum",filterCutoffHz:5657,filterResonance:0,filterEnvelope:"twang 1",vibrato:"none",algorithm:"1←2←3←4",feedbackType:"3⟲",feedbackAmplitude:4,feedbackEnvelope:"steady",operators:[{frequency:"3×",amplitude:13,envelope:"custom"},{frequency:"1×",amplitude:7,envelope:"steady"},{frequency:"13×",amplitude:3,envelope:"steady"},{frequency:"1×",amplitude:11,envelope:"steady"}]}},{name:"bass synth 1",midiProgram:38,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"hard",chord:"strum",filterCutoffHz:4e3,filterResonance:43,filterEnvelope:"twang 2",vibrato:"none",algorithm:"1←3 2←4",feedbackType:"3⟲ 4⟲",feedbackAmplitude:9,feedbackEnvelope:"twang 2",operators:[{frequency:"1×",amplitude:15,envelope:"custom"},{frequency:"1×",amplitude:10,envelope:"custom"},{frequency:"1×",amplitude:14,envelope:"twang 1"},{frequency:"~1×",amplitude:13,envelope:"twang 2"}]}},{name:"bass synth 2",midiProgram:39,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"hard fade",chord:"strum",filterCutoffHz:1e3,filterResonance:57,filterEnvelope:"punch",vibrato:"none",algorithm:"1←(2 3 4)",feedbackType:"1→2",feedbackAmplitude:4,feedbackEnvelope:"twang 3",operators:[{frequency:"1×",amplitude:9,envelope:"custom"},{frequency:"1×",amplitude:9,envelope:"steady"},{frequency:"3×",amplitude:0,envelope:"steady"},{frequency:"1×",amplitude:0,envelope:"steady"}]}},{name:"bass & lead",midiProgram:87,generalMidi:!0,settings:{type:"chip",transition:"hard",effects:"reverb",chord:"harmony",filterCutoffHz:4e3,filterResonance:86,filterEnvelope:"twang 2",wave:"sawtooth",interval:"shimmer",vibrato:"none"}}])},{name:"Picked String Presets",presets:t.toNameMap([{name:"pizzicato strings",midiProgram:45,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"medium fade",chord:"harmony",filterCutoffHz:1e3,filterResonance:14,filterEnvelope:"twang 1",vibrato:"none",algorithm:"(1 2 3)←4",feedbackType:"1⟲ 2⟲ 3⟲ 4⟲",feedbackAmplitude:7,feedbackEnvelope:"twang 1",operators:[{frequency:"1×",amplitude:14,envelope:"custom"},{frequency:"3×",amplitude:11,envelope:"custom"},{frequency:"6×",amplitude:9,envelope:"custom"},{frequency:"~1×",amplitude:10,envelope:"steady"}]}},{name:"harp",midiProgram:46,generalMidi:!0,settings:{type:"FM",transition:"hard fade",effects:"reverb",chord:"strum",filterCutoffHz:2828,filterResonance:0,filterEnvelope:"twang 1",vibrato:"none",algorithm:"1←3 2←4",feedbackType:"3⟲",feedbackAmplitude:6,feedbackEnvelope:"twang 2",operators:[{frequency:"1×",amplitude:15,envelope:"custom"},{frequency:"4×",amplitude:6,envelope:"custom"},{frequency:"~2×",amplitude:3,envelope:"steady"},{frequency:"1×",amplitude:6,envelope:"steady"}]}},{name:"sitar",midiProgram:104,generalMidi:!0,settings:{type:"FM",transition:"hard fade",effects:"reverb",chord:"strum",filterCutoffHz:8e3,filterResonance:57,filterEnvelope:"twang 2",vibrato:"none",algorithm:"1←(2 3 4)",feedbackType:"1⟲",feedbackAmplitude:0,feedbackEnvelope:"steady",operators:[{frequency:"1×",amplitude:15,envelope:"custom"},{frequency:"1×",amplitude:14,envelope:"twang 3"},{frequency:"9×",amplitude:3,envelope:"twang 3"},{frequency:"16×",amplitude:9,envelope:"swell 3"}]}},{name:"banjo",midiProgram:105,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"hard fade",chord:"strum",filterCutoffHz:2828,filterResonance:14,filterEnvelope:"twang 2",vibrato:"none",algorithm:"1←(2 3←4)",feedbackType:"2⟲",feedbackAmplitude:4,feedbackEnvelope:"steady",operators:[{frequency:"4×",amplitude:14,envelope:"custom"},{frequency:"1×",amplitude:10,envelope:"steady"},{frequency:"11×",amplitude:3,envelope:"twang 3"},{frequency:"1×",amplitude:11,envelope:"steady"}]}},{name:"ukulele",midiProgram:105,settings:{type:"FM",effects:"reverb",transition:"hard fade",chord:"strum",filterCutoffHz:2e3,filterResonance:0,filterEnvelope:"twang 1",vibrato:"none",algorithm:"1←(2 3←4)",feedbackType:"3⟲",feedbackAmplitude:5,feedbackEnvelope:"twang 1",operators:[{frequency:"2×",amplitude:14,envelope:"custom"},{frequency:"1×",amplitude:6,envelope:"steady"},{frequency:"9×",amplitude:4,envelope:"twang 2"},{frequency:"1×",amplitude:11,envelope:"steady"}]}},{name:"shamisen",midiProgram:106,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"hard fade",chord:"harmony",filterCutoffHz:8e3,filterResonance:14,filterEnvelope:"twang 1",vibrato:"none",algorithm:"1←(2 3←4)",feedbackType:"3⟲",feedbackAmplitude:9,feedbackEnvelope:"twang 3",operators:[{frequency:"1×",amplitude:15,envelope:"custom"},{frequency:"1×",amplitude:12,envelope:"steady"},{frequency:"16×",amplitude:4,envelope:"twang 3"},{frequency:"1×",amplitude:7,envelope:"steady"}]}},{name:"koto",midiProgram:107,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"hard fade",chord:"harmony",filterCutoffHz:4e3,filterResonance:14,filterEnvelope:"twang 2",vibrato:"none",algorithm:"1←3 2←4",feedbackType:"1⟲ 2⟲",feedbackAmplitude:5,feedbackEnvelope:"twang 2",operators:[{frequency:"~1×",amplitude:12,envelope:"custom"},{frequency:"6×",amplitude:10,envelope:"custom"},{frequency:"4×",amplitude:8,envelope:"twang 3"},{frequency:"~2×",amplitude:8,envelope:"twang 3"}]}}])},{name:"Distortion Presets",presets:t.toNameMap([{name:"overdrive guitar",midiProgram:29,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"hard",chord:"strum",filterCutoffHz:2828,filterResonance:14,filterEnvelope:"steady",vibrato:"none",algorithm:"1←(2 3←4)",feedbackType:"1→2",feedbackAmplitude:2,feedbackEnvelope:"steady",operators:[{frequency:"~1×",amplitude:13,envelope:"custom"},{frequency:"1×",amplitude:12,envelope:"steady"},{frequency:"1×",amplitude:7,envelope:"twang 3"},{frequency:"1×",amplitude:4,envelope:"swell 3"}]}},{name:"distortion guitar",midiProgram:30,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"hard",chord:"strum",filterCutoffHz:2828,filterResonance:57,filterEnvelope:"steady",vibrato:"none",algorithm:"1←(2 3←4)",feedbackType:"1→2",feedbackAmplitude:4,feedbackEnvelope:"steady",operators:[{frequency:"~1×",amplitude:13,envelope:"custom"},{frequency:"1×",amplitude:11,envelope:"steady"},{frequency:"1×",amplitude:9,envelope:"swell 1"},{frequency:"~2×",amplitude:5,envelope:"swell 3"}]}},{name:"charango synth",midiProgram:84,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"hard",chord:"strum",filterCutoffHz:5657,filterResonance:0,filterEnvelope:"twang 3",vibrato:"none",algorithm:"1←(2 3←4)",feedbackType:"1→2→3→4",feedbackAmplitude:8,feedbackEnvelope:"twang 3",operators:[{frequency:"3×",amplitude:13,envelope:"custom"},{frequency:"~1×",amplitude:5,envelope:"steady"},{frequency:"4×",amplitude:6,envelope:"steady"},{frequency:"3×",amplitude:7,envelope:"steady"}]}},{name:"guitar harmonics",midiProgram:31,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"hard",chord:"strum",filterCutoffHz:2e3,filterResonance:29,filterEnvelope:"steady",vibrato:"none",algorithm:"1←(2 3)←4",feedbackType:"1⟲",feedbackAmplitude:2,feedbackEnvelope:"steady",operators:[{frequency:"4×",amplitude:12,envelope:"custom"},{frequency:"16×",amplitude:5,envelope:"swell 1"},{frequency:"1×",amplitude:2,envelope:"punch"},{frequency:"~1×",amplitude:12,envelope:"twang 1"}]}},{name:"distorted synth 1",midiProgram:30,settings:{type:"PWM",effects:"reverb",transition:"hard",chord:"strum",filterCutoffHz:4e3,filterResonance:29,filterEnvelope:"steady",pulseWidth:17.6875,pulseEnvelope:"punch",vibrato:"none"}},{name:"distorted synth 2",midiProgram:30,settings:{type:"FM",effects:"reverb",transition:"seamless",chord:"strum",filterCutoffHz:8e3,filterResonance:0,filterEnvelope:"steady",vibrato:"none",algorithm:"1←(2 3 4)",feedbackType:"1⟲",feedbackAmplitude:7,feedbackEnvelope:"steady",operators:[{frequency:"1×",amplitude:15,envelope:"custom"},{frequency:"1×",amplitude:13,envelope:"steady"},{frequency:"1×",amplitude:11,envelope:"swell 1"},{frequency:"1×",amplitude:0,envelope:"flare 1"}]}},{name:"distorted synth 3",midiProgram:30,settings:{type:"FM",effects:"reverb",transition:"hard",chord:"strum",filterCutoffHz:8e3,filterResonance:0,filterEnvelope:"steady",vibrato:"delayed",algorithm:"1←(2 3 4)",feedbackType:"1→2",feedbackAmplitude:3,feedbackEnvelope:"steady",operators:[{frequency:"~1×",amplitude:13,envelope:"custom"},{frequency:"1×",amplitude:11,envelope:"steady"},{frequency:"1×",amplitude:12,envelope:"swell 1"},{frequency:"1×",amplitude:0,envelope:"steady"}]}},{name:"distorted synth 4",midiProgram:30,settings:{type:"PWM",effects:"reverb",transition:"hard",chord:"strum",filterCutoffHz:2828,filterResonance:57,filterEnvelope:"steady",pulseWidth:50,pulseEnvelope:"swell 1",vibrato:"delayed"}}])},{name:"Bellows Presets",presets:t.toNameMap([{name:"drawbar organ 1",midiProgram:16,generalMidi:!0,midiSubharmonicOctaves:1,settings:{type:"harmonics",effects:"reverb",transition:"hard",chord:"harmony",filterCutoffHz:2828,filterResonance:14,filterEnvelope:"steady",interval:"union",vibrato:"none",harmonics:[86,86,0,86,0,0,0,86,0,0,0,0,0,0,0,86,0,0,0,0,0,0,0,0,0,0,0,0]}},{name:"drawbar organ 2",midiProgram:16,midiSubharmonicOctaves:1,settings:{type:"harmonics",effects:"reverb",transition:"hard",chord:"harmony",filterCutoffHz:2828,filterResonance:14,filterEnvelope:"steady",interval:"union",vibrato:"none",harmonics:[86,29,71,86,71,14,0,100,0,0,0,86,0,0,0,71,0,0,0,57,0,0,0,29,0,0,0,0]}},{name:"percussive organ",midiProgram:17,generalMidi:!0,midiSubharmonicOctaves:1,settings:{type:"FM",transition:"hard",effects:"reverb",chord:"harmony",filterCutoffHz:2e3,filterResonance:14,filterEnvelope:"punch",vibrato:"light",algorithm:"1 2 3 4",feedbackType:"1→3 2→4",feedbackAmplitude:7,feedbackEnvelope:"decay 1",operators:[{frequency:"1×",amplitude:7,envelope:"custom"},{frequency:"2×",amplitude:7,envelope:"custom"},{frequency:"3×",amplitude:8,envelope:"custom"},{frequency:"4×",amplitude:8,envelope:"custom"}]}},{name:"rock organ",midiProgram:18,generalMidi:!0,midiSubharmonicOctaves:1,settings:{type:"FM",effects:"chorus & reverb",transition:"hard",chord:"harmony",filterCutoffHz:4e3,filterResonance:14,filterEnvelope:"punch",vibrato:"delayed",algorithm:"(1 2 3)←4",feedbackType:"1⟲ 2⟲ 3⟲",feedbackAmplitude:2,feedbackEnvelope:"flare 1",operators:[{frequency:"1×",amplitude:9,envelope:"custom"},{frequency:"4×",amplitude:9,envelope:"custom"},{frequency:"6×",amplitude:9,envelope:"custom"},{frequency:"2×",amplitude:5,envelope:"steady"}]}},{name:"pipe organ",midiProgram:19,generalMidi:!0,midiSubharmonicOctaves:1,settings:{type:"FM",transition:"cross fade",effects:"reverb",chord:"harmony",filterCutoffHz:5657,filterResonance:43,filterEnvelope:"steady",vibrato:"none",algorithm:"1 2 3 4",feedbackType:"1⟲ 2⟲ 3⟲ 4⟲",feedbackAmplitude:5,feedbackEnvelope:"steady",operators:[{frequency:"1×",amplitude:8,envelope:"custom"},{frequency:"2×",amplitude:9,envelope:"custom"},{frequency:"4×",amplitude:9,envelope:"custom"},{frequency:"8×",amplitude:8,envelope:"custom"}]}},{name:"reed organ",midiProgram:20,generalMidi:!0,settings:{type:"harmonics",effects:"reverb",transition:"soft",chord:"harmony",filterCutoffHz:2e3,filterResonance:29,filterEnvelope:"steady",interval:"union",vibrato:"none",harmonics:[71,86,100,86,71,100,57,71,71,71,43,43,43,71,43,71,57,57,57,57,57,57,57,29,43,29,29,14]}},{name:"accordion",midiProgram:21,generalMidi:!0,settings:{type:"chip",effects:"reverb",transition:"cross fade",chord:"harmony",filterCutoffHz:5657,filterResonance:0,filterEnvelope:"swell 1",wave:"double saw",interval:"honky tonk",vibrato:"none"}},{name:"bandoneon",midiProgram:23,generalMidi:!0,settings:{type:"harmonics",effects:"reverb",transition:"soft",chord:"harmony",filterCutoffHz:4e3,filterResonance:29,filterEnvelope:"swell 1",interval:"hum",vibrato:"none",harmonics:[86,86,86,57,71,86,57,71,71,71,57,43,57,43,71,43,71,57,57,43,43,43,57,43,43,29,29,29]}},{name:"bagpipe",midiProgram:109,generalMidi:!0,settings:{type:"harmonics",effects:"reverb",transition:"cross fade",chord:"harmony",filterCutoffHz:5657,filterResonance:43,filterEnvelope:"punch",interval:"hum",vibrato:"none",harmonics:[71,86,86,100,100,86,57,100,86,71,71,71,57,57,57,71,57,71,57,71,43,57,57,43,43,43,43,43]}}])},{name:"String Presets",presets:t.toNameMap([{name:"violin",midiProgram:40,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"cross fade",chord:"harmony",filterCutoffHz:2828,filterResonance:43,filterEnvelope:"steady",vibrato:"delayed",algorithm:"(1 2)←(3 4)",feedbackType:"4⟲",feedbackAmplitude:5,feedbackEnvelope:"twang 3",operators:[{frequency:"4×",amplitude:9,envelope:"custom"},{frequency:"3×",amplitude:9,envelope:"custom"},{frequency:"2×",amplitude:7,envelope:"steady"},{frequency:"7×",amplitude:5,envelope:"swell 1"}]}},{name:"viola",midiProgram:41,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"cross fade",chord:"harmony",filterCutoffHz:2e3,filterResonance:29,filterEnvelope:"steady",vibrato:"delayed",algorithm:"(1 2 3)←4",feedbackType:"1⟲ 2⟲ 3⟲",feedbackAmplitude:8,feedbackEnvelope:"swell 1",operators:[{frequency:"2×",amplitude:11,envelope:"custom"},{frequency:"7×",amplitude:7,envelope:"custom"},{frequency:"13×",amplitude:4,envelope:"custom"},{frequency:"1×",amplitude:5,envelope:"steady"}]}},{name:"cello",midiProgram:42,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"cross fade",chord:"harmony",filterCutoffHz:2828,filterResonance:29,filterEnvelope:"steady",vibrato:"delayed",algorithm:"(1 2 3)←4",feedbackType:"1⟲ 2⟲ 3⟲",feedbackAmplitude:6,feedbackEnvelope:"swell 1",operators:[{frequency:"1×",amplitude:11,envelope:"custom"},{frequency:"3×",amplitude:9,envelope:"custom"},{frequency:"8×",amplitude:7,envelope:"custom"},{frequency:"1×",amplitude:6,envelope:"steady"}]}},{name:"contrabass",midiProgram:43,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"cross fade",chord:"harmony",filterCutoffHz:2e3,filterResonance:29,filterEnvelope:"steady",vibrato:"delayed",algorithm:"(1 2)←3←4",feedbackType:"1⟲ 2⟲",feedbackAmplitude:0,feedbackEnvelope:"steady",operators:[{frequency:"16×",amplitude:5,envelope:"custom"},{frequency:"1×",amplitude:10,envelope:"custom"},{frequency:"1×",amplitude:10,envelope:"steady"},{frequency:"6×",amplitude:3,envelope:"swell 1"}]}},{name:"fiddle",midiProgram:110,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"soft",chord:"harmony",filterCutoffHz:2828,filterResonance:29,filterEnvelope:"steady",vibrato:"delayed",algorithm:"(1 2)←(3 4)",feedbackType:"3⟲ 4⟲",feedbackAmplitude:5,feedbackEnvelope:"twang 1",operators:[{frequency:"2×",amplitude:10,envelope:"custom"},{frequency:"8×",amplitude:8,envelope:"custom"},{frequency:"1×",amplitude:8,envelope:"steady"},{frequency:"16×",amplitude:3,envelope:"steady"}]}},{name:"tremolo strings",midiProgram:44,generalMidi:!0,settings:{type:"FM",effects:"chorus & reverb",transition:"medium fade",chord:"harmony",filterCutoffHz:2e3,filterResonance:0,filterEnvelope:"tremolo4",vibrato:"none",algorithm:"1 2 3 4",feedbackType:"1→2→3→4",feedbackAmplitude:12,feedbackEnvelope:"steady",operators:[{frequency:"1×",amplitude:8,envelope:"custom"},{frequency:"~2×",amplitude:8,envelope:"custom"},{frequency:"4×",amplitude:8,envelope:"custom"},{frequency:"7×",amplitude:8,envelope:"custom"}]}},{name:"strings",midiProgram:48,generalMidi:!0,settings:{type:"FM",effects:"chorus & reverb",transition:"cross fade",chord:"harmony",filterCutoffHz:2828,filterResonance:43,filterEnvelope:"steady",vibrato:"none",algorithm:"(1 2)←(3 4)",feedbackType:"4⟲",feedbackAmplitude:5,feedbackEnvelope:"twang 3",operators:[{frequency:"4×",amplitude:9,envelope:"custom"},{frequency:"3×",amplitude:9,envelope:"custom"},{frequency:"2×",amplitude:7,envelope:"steady"},{frequency:"7×",amplitude:3,envelope:"swell 1"}]}},{name:"slow strings",midiProgram:49,generalMidi:!0,settings:{type:"FM",effects:"chorus & reverb",transition:"soft fade",chord:"harmony",filterCutoffHz:1414,filterResonance:0,filterEnvelope:"swell 2",vibrato:"none",algorithm:"(1 2)←(3 4)",feedbackType:"4⟲",feedbackAmplitude:6,feedbackEnvelope:"flare 3",operators:[{frequency:"4×",amplitude:10,envelope:"custom"},{frequency:"3×",amplitude:10,envelope:"custom"},{frequency:"2×",amplitude:7,envelope:"steady"},{frequency:"7×",amplitude:4,envelope:"swell 1"}]}},{name:"strings synth 1",midiProgram:50,generalMidi:!0,settings:{type:"chip",volume:60,transition:"soft fade",effects:"chorus & reverb",chord:"harmony",filterCutoffHz:1414,filterResonance:43,filterEnvelope:"steady",wave:"sawtooth",interval:"hum",vibrato:"delayed"}},{name:"strings synth 2",midiProgram:51,generalMidi:!0,settings:{type:"FM",effects:"chorus & reverb",transition:"soft fade",chord:"harmony",filterCutoffHz:2e3,filterResonance:43,filterEnvelope:"steady",vibrato:"none",algorithm:"1 2 3 4",feedbackType:"1⟲ 2⟲ 3⟲ 4⟲",feedbackAmplitude:12,feedbackEnvelope:"swell 1",operators:[{frequency:"3×",amplitude:6,envelope:"custom"},{frequency:"2×",amplitude:7,envelope:"custom"},{frequency:"1×",amplitude:8,envelope:"custom"},{frequency:"1×",amplitude:9,envelope:"custom"}]}},{name:"orchestra hit 1",midiProgram:55,generalMidi:!0,midiSubharmonicOctaves:1,settings:{type:"FM",effects:"chorus & reverb",transition:"hard fade",chord:"harmony",filterCutoffHz:8e3,filterResonance:14,filterEnvelope:"custom",vibrato:"none",algorithm:"1 2 3 4",feedbackType:"1⟲ 2⟲ 3⟲ 4⟲",feedbackAmplitude:14,feedbackEnvelope:"twang 3",operators:[{frequency:"1×",amplitude:15,envelope:"twang 3"},{frequency:"2×",amplitude:15,envelope:"flare 3"},{frequency:"4×",amplitude:15,envelope:"flare 2"},{frequency:"8×",amplitude:15,envelope:"flare 1"}]}},{name:"orchestra hit 2",midiProgram:55,midiSubharmonicOctaves:1,settings:{type:"FM",effects:"chorus & reverb",transition:"medium fade",chord:"harmony",filterCutoffHz:8e3,filterResonance:0,filterEnvelope:"decay 1",vibrato:"delayed",algorithm:"1 2 3 4",feedbackType:"1⟲ 2⟲ 3⟲ 4⟲",feedbackAmplitude:14,feedbackEnvelope:"steady",operators:[{frequency:"1×",amplitude:12,envelope:"custom"},{frequency:"2×",amplitude:14,envelope:"custom"},{frequency:"3×",amplitude:12,envelope:"custom"},{frequency:"4×",amplitude:14,envelope:"custom"}]}}])},{name:"Vocal Presets",presets:t.toNameMap([{name:"choir soprano",midiProgram:94,generalMidi:!0,settings:{type:"harmonics",effects:"chorus & reverb",transition:"soft fade",chord:"harmony",filterCutoffHz:2828,filterResonance:57,filterEnvelope:"steady",interval:"union",vibrato:"shaky",harmonics:[86,100,86,43,14,14,57,71,57,14,14,14,14,14,43,57,43,14,14,14,14,14,14,14,0,0,0,0]}},{name:"choir tenor",midiProgram:52,generalMidi:!0,settings:{type:"harmonics",effects:"chorus & reverb",transition:"soft fade",chord:"harmony",filterCutoffHz:2828,filterResonance:86,filterEnvelope:"steady",interval:"union",vibrato:"shaky",harmonics:[86,100,100,86,71,57,29,14,14,14,29,43,43,43,29,14,14,14,0,0,0,0,0,0,0,0,0,0]}},{name:"choir bass",midiProgram:52,settings:{type:"harmonics",effects:"chorus & reverb",transition:"soft fade",chord:"harmony",filterCutoffHz:2828,filterResonance:86,filterEnvelope:"steady",interval:"union",vibrato:"shaky",harmonics:[71,86,86,100,86,100,57,43,14,14,14,14,29,29,43,43,43,43,43,29,29,29,29,14,14,14,0,0]}},{name:"solo soprano",midiProgram:85,settings:{type:"harmonics",effects:"reverb",transition:"cross fade",chord:"harmony",filterCutoffHz:2828,filterResonance:71,filterEnvelope:"steady",interval:"union",vibrato:"shaky",harmonics:[86,100,86,43,14,14,57,71,57,14,14,14,14,14,43,57,43,14,14,14,14,14,14,14,0,0,0,0]}},{name:"solo tenor",midiProgram:85,settings:{type:"harmonics",effects:"reverb",transition:"cross fade",chord:"harmony",filterCutoffHz:2828,filterResonance:86,filterEnvelope:"steady",interval:"union",vibrato:"shaky",harmonics:[86,100,100,86,71,57,29,14,14,14,29,43,43,43,29,14,14,14,0,0,0,0,0,0,0,0,0,0]}},{name:"solo bass",midiProgram:85,settings:{type:"harmonics",effects:"reverb",transition:"cross fade",chord:"harmony",filterCutoffHz:2828,filterResonance:86,filterEnvelope:"steady",interval:"union",vibrato:"shaky",harmonics:[71,86,86,100,86,100,57,43,14,14,14,14,29,29,43,43,43,43,43,29,29,29,29,14,14,14,0,0]}},{name:"voice ooh",midiProgram:53,generalMidi:!0,settings:{type:"harmonics",effects:"reverb",transition:"soft",chord:"harmony",filterCutoffHz:1414,filterResonance:57,filterEnvelope:"steady",interval:"union",vibrato:"shaky",harmonics:[100,57,43,43,14,14,0,0,0,14,29,29,14,0,14,29,29,14,0,0,0,0,0,0,0,0,0,0]}},{name:"voice synth",midiProgram:54,generalMidi:!0,settings:{type:"chip",transition:"medium fade",effects:"chorus & reverb",chord:"harmony",filterCutoffHz:4e3,filterResonance:57,filterEnvelope:"steady",wave:"rounded",interval:"union",vibrato:"light"}},{name:"vox synth lead",midiProgram:85,generalMidi:!0,settings:{type:"FM",effects:"chorus & reverb",transition:"cross fade",chord:"harmony",filterCutoffHz:2828,filterResonance:14,filterEnvelope:"steady",vibrato:"light",algorithm:"(1 2 3)←4",feedbackType:"1→2→3→4",feedbackAmplitude:2,feedbackEnvelope:"punch",operators:[{frequency:"2×",amplitude:10,envelope:"custom"},{frequency:"9×",amplitude:5,envelope:"custom"},{frequency:"20×",amplitude:1,envelope:"custom"},{frequency:"~1×",amplitude:4,envelope:"steady"}]}},{name:"tiny robot",midiProgram:85,settings:{type:"FM",transition:"slide",effects:"reverb",chord:"harmony",filterCutoffHz:8e3,filterResonance:0,filterEnvelope:"steady",vibrato:"delayed",algorithm:"1←(2 3 4)",feedbackType:"1⟲",feedbackAmplitude:2,feedbackEnvelope:"twang 3",operators:[{frequency:"2×",amplitude:15,envelope:"custom"},{frequency:"1×",amplitude:7,envelope:"punch"},{frequency:"~1×",amplitude:7,envelope:"steady"},{frequency:"1×",amplitude:0,envelope:"steady"}]}},{name:"yowie",midiProgram:85,settings:{type:"FM",effects:"reverb",transition:"cross fade",chord:"harmony",filterCutoffHz:2e3,filterResonance:86,filterEnvelope:"tremolo5",vibrato:"none",algorithm:"1←2←(3 4)",feedbackType:"1⟲",feedbackAmplitude:12,feedbackEnvelope:"tremolo3",operators:[{frequency:"2×",amplitude:12,envelope:"custom"},{frequency:"16×",amplitude:5,envelope:"steady"},{frequency:"1×",amplitude:5,envelope:"steady"},{frequency:"1×",amplitude:0,envelope:"steady"}]}},{name:"mouse",midiProgram:85,settings:{type:"FM",effects:"reverb",transition:"slide",chord:"harmony",filterCutoffHz:8e3,filterResonance:0,filterEnvelope:"steady",vibrato:"light",algorithm:"1 2 3 4",feedbackType:"1⟲ 2⟲",feedbackAmplitude:5,feedbackEnvelope:"flare 2",operators:[{frequency:"2×",amplitude:13,envelope:"custom"},{frequency:"5×",amplitude:12,envelope:"custom"},{frequency:"1×",amplitude:0,envelope:"steady"},{frequency:"1×",amplitude:0,envelope:"steady"}]}},{name:"gumdrop",midiProgram:85,settings:{type:"FM",effects:"reverb",transition:"hard",chord:"harmony",filterCutoffHz:8e3,filterResonance:0,filterEnvelope:"steady",vibrato:"none",algorithm:"(1 2 3)←4",feedbackType:"1⟲ 2⟲ 3⟲",feedbackAmplitude:0,feedbackEnvelope:"steady",operators:[{frequency:"2×",amplitude:15,envelope:"punch"},{frequency:"4×",amplitude:15,envelope:"punch"},{frequency:"7×",amplitude:15,envelope:"punch"},{frequency:"1×",amplitude:10,envelope:"twang 1"}]}},{name:"echo drop",midiProgram:102,generalMidi:!0,settings:{type:"FM",effects:"chorus & reverb",transition:"hard",chord:"harmony",filterCutoffHz:2828,filterResonance:14,filterEnvelope:"punch",vibrato:"none",algorithm:"1←(2 3←4)",feedbackType:"1⟲",feedbackAmplitude:2,feedbackEnvelope:"steady",operators:[{frequency:"~2×",amplitude:11,envelope:"custom"},{frequency:"~1×",amplitude:5,envelope:"steady"},{frequency:"11×",amplitude:2,envelope:"steady"},{frequency:"16×",amplitude:5,envelope:"swell 3"}]}},{name:"dark choir",midiProgram:85,settings:{type:"spectrum",effects:"reverb",transition:"soft",chord:"harmony",filterCutoffHz:4e3,filterResonance:29,filterEnvelope:"swell 1",spectrum:[43,14,14,14,14,14,14,100,14,14,14,57,14,14,100,14,43,14,43,14,14,43,14,29,14,29,14,14,29,0]}}])},{name:"Brass Presets",presets:t.toNameMap([{name:"trumpet",midiProgram:56,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"soft",chord:"harmony",filterCutoffHz:2828,filterResonance:43,filterEnvelope:"steady",vibrato:"none",algorithm:"1←(2 3 4)",feedbackType:"1⟲",feedbackAmplitude:9,feedbackEnvelope:"swell 1",operators:[{frequency:"1×",amplitude:14,envelope:"custom"},{frequency:"1×",amplitude:8,envelope:"steady"},{frequency:"1×",amplitude:5,envelope:"flare 2"},{frequency:"1×",amplitude:0,envelope:"steady"}]}},{name:"trombone",midiProgram:57,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"soft",chord:"harmony",filterCutoffHz:2e3,filterResonance:43,filterEnvelope:"steady",vibrato:"none",algorithm:"1←(2 3 4)",feedbackType:"2⟲",feedbackAmplitude:7,feedbackEnvelope:"swell 1",operators:[{frequency:"1×",amplitude:14,envelope:"custom"},{frequency:"1×",amplitude:8,envelope:"steady"},{frequency:"1×",amplitude:0,envelope:"steady"},{frequency:"1×",amplitude:0,envelope:"steady"}]}},{name:"tuba",midiProgram:58,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"soft",chord:"harmony",filterCutoffHz:2e3,filterResonance:43,filterEnvelope:"steady",vibrato:"none",algorithm:"1←(2 3 4)",feedbackType:"2⟲",feedbackAmplitude:8,feedbackEnvelope:"swell 1",operators:[{frequency:"1×",amplitude:14,envelope:"custom"},{frequency:"1×",amplitude:6,envelope:"steady"},{frequency:"1×",amplitude:0,envelope:"steady"},{frequency:"1×",amplitude:0,envelope:"steady"}]}},{name:"muted trumpet",midiProgram:59,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"soft",chord:"harmony",filterCutoffHz:2828,filterResonance:29,filterEnvelope:"swell 1",vibrato:"none",algorithm:"1←(2 3←4)",feedbackType:"1⟲",feedbackAmplitude:5,feedbackEnvelope:"flare 2",operators:[{frequency:"1×",amplitude:13,envelope:"custom"},{frequency:"1×",amplitude:5,envelope:"steady"},{frequency:"9×",amplitude:5,envelope:"steady"},{frequency:"13×",amplitude:9,envelope:"swell 1"}]}},{name:"french horn",midiProgram:60,generalMidi:!0,settings:{type:"FM",transition:"soft",effects:"reverb",chord:"harmony",filterCutoffHz:2828,filterResonance:14,filterEnvelope:"steady",vibrato:"none",algorithm:"1←3 2←4",feedbackType:"1⟲ 2⟲",feedbackAmplitude:3,feedbackEnvelope:"swell 1",operators:[{frequency:"1×",amplitude:15,envelope:"custom"},{frequency:"1×",amplitude:12,envelope:"custom"},{frequency:"1×",amplitude:10,envelope:"swell 1"},{frequency:"~1×",amplitude:8,envelope:"flare 2"}]}},{name:"brass section",midiProgram:61,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"soft",chord:"harmony",filterCutoffHz:2828,filterResonance:14,filterEnvelope:"punch",vibrato:"none",algorithm:"1←3 2←4",feedbackType:"1⟲ 2⟲",feedbackAmplitude:6,feedbackEnvelope:"swell 1",operators:[{frequency:"1×",amplitude:14,envelope:"custom"},{frequency:"1×",amplitude:12,envelope:"custom"},{frequency:"1×",amplitude:10,envelope:"swell 1"},{frequency:"~1×",amplitude:10,envelope:"swell 1"}]}},{name:"brass synth 1",midiProgram:62,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"soft",chord:"harmony",filterCutoffHz:4e3,filterResonance:29,filterEnvelope:"steady",vibrato:"none",algorithm:"1←3 2←4",feedbackType:"1⟲ 2⟲",feedbackAmplitude:11,feedbackEnvelope:"swell 1",operators:[{frequency:"1×",amplitude:14,envelope:"custom"},{frequency:"1×",amplitude:14,envelope:"custom"},{frequency:"1×",amplitude:12,envelope:"flare 1"},{frequency:"~1×",amplitude:8,envelope:"flare 2"}]}},{name:"brass synth 2",midiProgram:63,generalMidi:!0,settings:{type:"FM",transition:"soft",effects:"reverb",chord:"harmony",filterCutoffHz:4e3,filterResonance:43,filterEnvelope:"twang 3",vibrato:"none",algorithm:"1←3 2←4",feedbackType:"1⟲ 2⟲",feedbackAmplitude:9,feedbackEnvelope:"swell 1",operators:[{frequency:"1×",amplitude:15,envelope:"custom"},{frequency:"1×",amplitude:15,envelope:"custom"},{frequency:"1×",amplitude:10,envelope:"flare 1"},{frequency:"~1×",amplitude:7,envelope:"flare 1"}]}},{name:"pulse brass",midiProgram:62,settings:{type:"PWM",effects:"reverb",transition:"soft",chord:"harmony",filterCutoffHz:4e3,filterResonance:29,filterEnvelope:"swell 1",pulseWidth:50,pulseEnvelope:"flare 3",vibrato:"none"}}])},{name:"Reed Presets",presets:t.toNameMap([{name:"soprano sax",midiProgram:64,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"soft",chord:"harmony",filterCutoffHz:2e3,filterResonance:29,filterEnvelope:"steady",vibrato:"none",algorithm:"1←2←3←4",feedbackType:"4⟲",feedbackAmplitude:5,feedbackEnvelope:"swell 1",operators:[{frequency:"1×",amplitude:13,envelope:"custom"},{frequency:"4×",amplitude:4,envelope:"swell 1"},{frequency:"1×",amplitude:7,envelope:"steady"},{frequency:"5×",amplitude:4,envelope:"punch"}]}},{name:"alto sax",midiProgram:65,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"soft",chord:"harmony",filterCutoffHz:2e3,filterResonance:43,filterEnvelope:"steady",vibrato:"none",algorithm:"1←(2 3←4)",feedbackType:"1⟲",feedbackAmplitude:4,feedbackEnvelope:"punch",operators:[{frequency:"1×",amplitude:13,envelope:"custom"},{frequency:"1×",amplitude:6,envelope:"steady"},{frequency:"4×",amplitude:6,envelope:"swell 1"},{frequency:"1×",amplitude:12,envelope:"steady"}]}},{name:"tenor sax",midiProgram:66,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"soft",chord:"harmony",filterCutoffHz:2828,filterResonance:29,filterEnvelope:"steady",vibrato:"none",algorithm:"1←2←3←4",feedbackType:"1⟲",feedbackAmplitude:6,feedbackEnvelope:"swell 1",operators:[{frequency:"2×",amplitude:12,envelope:"custom"},{frequency:"3×",amplitude:7,envelope:"steady"},{frequency:"1×",amplitude:3,envelope:"steady"},{frequency:"8×",amplitude:3,envelope:"steady"}]}},{name:"baritone sax",midiProgram:67,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"soft",chord:"harmony",filterCutoffHz:2828,filterResonance:0,filterEnvelope:"steady",vibrato:"none",algorithm:"1←(2 3←4)",feedbackType:"1⟲",feedbackAmplitude:2,feedbackEnvelope:"swell 2",operators:[{frequency:"1×",amplitude:12,envelope:"custom"},{frequency:"8×",amplitude:4,envelope:"steady"},{frequency:"4×",amplitude:5,envelope:"steady"},{frequency:"1×",amplitude:4,envelope:"punch"}]}},{name:"sax synth",midiProgram:64,settings:{type:"FM",effects:"reverb",transition:"soft",chord:"harmony",filterCutoffHz:8e3,filterResonance:0,filterEnvelope:"steady",vibrato:"light",algorithm:"1←(2 3 4)",feedbackType:"1⟲ 2⟲",feedbackAmplitude:4,feedbackEnvelope:"steady",operators:[{frequency:"4×",amplitude:15,envelope:"custom"},{frequency:"1×",amplitude:15,envelope:"steady"},{frequency:"1×",amplitude:0,envelope:"steady"},{frequency:"1×",amplitude:0,envelope:"steady"}]}},{name:"shehnai",midiProgram:111,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"soft",chord:"harmony",filterCutoffHz:8e3,filterResonance:0,filterEnvelope:"steady",vibrato:"light",algorithm:"1←(2 3 4)",feedbackType:"1⟲",feedbackAmplitude:3,feedbackEnvelope:"steady",operators:[{frequency:"4×",amplitude:15,envelope:"custom"},{frequency:"1×",amplitude:8,envelope:"steady"},{frequency:"1×",amplitude:0,envelope:"steady"},{frequency:"1×",amplitude:0,envelope:"steady"}]}},{name:"oboe",midiProgram:68,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"cross fade",chord:"harmony",filterCutoffHz:4e3,filterResonance:14,filterEnvelope:"swell 1",vibrato:"none",algorithm:"1 2←(3 4)",feedbackType:"2⟲",feedbackAmplitude:2,feedbackEnvelope:"tremolo5",operators:[{frequency:"1×",amplitude:7,envelope:"custom"},{frequency:"4×",amplitude:12,envelope:"custom"},{frequency:"1×",amplitude:6,envelope:"steady"},{frequency:"6×",amplitude:2,envelope:"steady"}]}},{name:"english horn",midiProgram:69,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"cross fade",chord:"harmony",filterCutoffHz:2e3,filterResonance:14,filterEnvelope:"steady",vibrato:"none",algorithm:"1 2←(3 4)",feedbackType:"2⟲",feedbackAmplitude:2,feedbackEnvelope:"steady",operators:[{frequency:"4×",amplitude:12,envelope:"custom"},{frequency:"2×",amplitude:10,envelope:"custom"},{frequency:"1×",amplitude:8,envelope:"punch"},{frequency:"8×",amplitude:4,envelope:"steady"}]}},{name:"bassoon",midiProgram:70,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"soft",chord:"harmony",filterCutoffHz:707,filterResonance:57,filterEnvelope:"steady",vibrato:"none",algorithm:"1←(2 3←4)",feedbackType:"1⟲",feedbackAmplitude:2,feedbackEnvelope:"steady",operators:[{frequency:"2×",amplitude:11,envelope:"custom"},{frequency:"1×",amplitude:6,envelope:"steady"},{frequency:"6×",amplitude:6,envelope:"swell 1"},{frequency:"1×",amplitude:0,envelope:"steady"}]}},{name:"clarinet",midiProgram:71,generalMidi:!0,settings:{type:"harmonics",effects:"reverb",transition:"soft",chord:"harmony",filterCutoffHz:1414,filterResonance:14,filterEnvelope:"steady",interval:"union",vibrato:"none",harmonics:[100,43,86,57,86,71,86,71,71,71,71,71,71,43,71,71,57,57,57,57,57,57,43,43,43,29,14,0]}},{name:"harmonica",midiProgram:22,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"soft",chord:"harmony",filterCutoffHz:5657,filterResonance:29,filterEnvelope:"swell 1",vibrato:"none",algorithm:"1←(2 3←4)",feedbackType:"1⟲",feedbackAmplitude:9,feedbackEnvelope:"tremolo5",operators:[{frequency:"2×",amplitude:14,envelope:"custom"},{frequency:"1×",amplitude:15,envelope:"steady"},{frequency:"~2×",amplitude:2,envelope:"twang 3"},{frequency:"1×",amplitude:0,envelope:"steady"}]}}])},{name:"Flute Presets",presets:t.toNameMap([{name:"flute",midiProgram:73,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"soft",chord:"harmony",filterCutoffHz:5657,filterResonance:14,filterEnvelope:"steady",vibrato:"none",algorithm:"1←(2 3 4)",feedbackType:"4⟲",feedbackAmplitude:7,feedbackEnvelope:"decay 2",operators:[{frequency:"1×",amplitude:15,envelope:"custom"},{frequency:"2×",amplitude:4,envelope:"steady"},{frequency:"1×",amplitude:3,envelope:"steady"},{frequency:"~1×",amplitude:1,envelope:"punch"}]}},{name:"recorder",midiProgram:74,generalMidi:!0,settings:{type:"harmonics",effects:"reverb",transition:"soft",chord:"harmony",filterCutoffHz:4e3,filterResonance:29,filterEnvelope:"swell 2",interval:"union",vibrato:"none",harmonics:[100,43,57,43,57,43,43,43,43,43,43,43,43,29,29,29,29,29,29,29,14,14,14,14,14,14,14,0]}},{name:"whistle",midiProgram:78,generalMidi:!0,settings:{type:"harmonics",effects:"chorus & reverb",transition:"soft",chord:"harmony",filterCutoffHz:2e3,filterResonance:43,filterEnvelope:"steady",interval:"union",vibrato:"delayed",harmonics:[100,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},{name:"ocarina",midiProgram:79,generalMidi:!0,settings:{type:"harmonics",effects:"reverb",transition:"soft",chord:"harmony",filterCutoffHz:2828,filterResonance:43,filterEnvelope:"steady",interval:"union",vibrato:"none",harmonics:[100,14,57,14,29,14,14,14,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},{name:"piccolo",midiProgram:72,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"soft",chord:"harmony",filterCutoffHz:5657,filterResonance:43,filterEnvelope:"steady",vibrato:"none",algorithm:"1←3 2←4",feedbackType:"4⟲",feedbackAmplitude:15,feedbackEnvelope:"twang 1",operators:[{frequency:"1×",amplitude:15,envelope:"custom"},{frequency:"1×",amplitude:10,envelope:"custom"},{frequency:"~2×",amplitude:3,envelope:"punch"},{frequency:"~1×",amplitude:5,envelope:"punch"}]}},{name:"shakuhachi",midiProgram:77,generalMidi:!0,settings:{type:"FM",effects:"chorus & reverb",transition:"soft",chord:"harmony",filterCutoffHz:4e3,filterResonance:14,filterEnvelope:"steady",vibrato:"delayed",algorithm:"1←(2 3←4)",feedbackType:"3→4",feedbackAmplitude:15,feedbackEnvelope:"steady",operators:[{frequency:"1×",amplitude:15,envelope:"custom"},{frequency:"2×",amplitude:3,envelope:"punch"},{frequency:"~1×",amplitude:4,envelope:"twang 1"},{frequency:"20×",amplitude:15,envelope:"steady"}]}},{name:"pan flute",midiProgram:75,generalMidi:!0,settings:{type:"spectrum",effects:"reverb",transition:"soft",chord:"harmony",filterCutoffHz:8e3,filterResonance:43,filterEnvelope:"steady",spectrum:[100,0,0,0,0,0,0,14,0,0,0,71,0,0,14,0,57,0,29,14,29,14,14,29,14,29,14,14,29,14]}},{name:"blown bottle",midiProgram:76,generalMidi:!0,settings:{type:"FM",effects:"chorus & reverb",transition:"cross fade",chord:"harmony",filterCutoffHz:5657,filterResonance:57,filterEnvelope:"steady",vibrato:"none",algorithm:"1 2 3 4",feedbackType:"1⟲ 2⟲ 3⟲ 4⟲",feedbackAmplitude:7,feedbackEnvelope:"twang 1",operators:[{frequency:"1×",amplitude:15,envelope:"custom"},{frequency:"3×",amplitude:4,envelope:"custom"},{frequency:"6×",amplitude:2,envelope:"custom"},{frequency:"11×",amplitude:2,envelope:"custom"}]}},{name:"calliope",midiProgram:82,generalMidi:!0,settings:{type:"spectrum",transition:"cross fade",effects:"reverb",chord:"harmony",filterCutoffHz:5657,filterResonance:14,filterEnvelope:"steady",spectrum:[100,0,0,0,0,0,0,86,0,0,0,71,0,0,57,0,43,0,29,14,14,29,14,14,14,14,14,14,14,14]}},{name:"chiffer",midiProgram:83,generalMidi:!0,settings:{type:"spectrum",effects:"reverb",transition:"hard",chord:"harmony",filterCutoffHz:2e3,filterResonance:14,filterEnvelope:"punch",spectrum:[86,0,0,0,0,0,0,71,0,0,0,71,0,0,57,0,57,0,43,14,14,43,14,29,14,29,29,29,29,14]}},{name:"breath noise",midiProgram:121,generalMidi:!0,settings:{type:"spectrum",effects:"reverb",transition:"cross fade",chord:"strum",filterCutoffHz:5657,filterResonance:14,filterEnvelope:"twang 1",spectrum:[71,0,0,0,0,0,0,29,0,0,0,71,0,0,29,0,100,29,14,29,100,29,100,14,14,71,0,29,0,0]}}])},{name:"Pad Presets",presets:t.toNameMap([{name:"new age pad",midiProgram:88,generalMidi:!0,settings:{type:"FM",effects:"chorus & reverb",transition:"hard fade",chord:"harmony",filterCutoffHz:8e3,filterResonance:43,filterEnvelope:"twang 3",vibrato:"none",algorithm:"1←(2 3←4)",feedbackType:"1⟲ 2⟲",feedbackAmplitude:3,feedbackEnvelope:"swell 3",operators:[{frequency:"2×",amplitude:14,envelope:"custom"},{frequency:"~1×",amplitude:4,envelope:"swell 2"},{frequency:"6×",amplitude:3,envelope:"twang 3"},{frequency:"13×",amplitude:3,envelope:"steady"}]}},{name:"warm pad",midiProgram:89,generalMidi:!0,settings:{type:"FM",effects:"chorus & reverb",transition:"soft fade",chord:"harmony",filterCutoffHz:2828,filterResonance:29,filterEnvelope:"swell 3",vibrato:"none",algorithm:"1←(2 3 4)",feedbackType:"1⟲",feedbackAmplitude:7,feedbackEnvelope:"steady",operators:[{frequency:"1×",amplitude:14,envelope:"custom"},{frequency:"1×",amplitude:6,envelope:"swell 1"},{frequency:"1×",amplitude:0,envelope:"steady"},{frequency:"1×",amplitude:0,envelope:"steady"}]}},{name:"polysynth pad",midiProgram:90,generalMidi:!0,settings:{type:"chip",transition:"hard fade",effects:"chorus & reverb",chord:"harmony",filterCutoffHz:2828,filterResonance:43,filterEnvelope:"twang 3",wave:"sawtooth",interval:"hum",vibrato:"delayed"}},{name:"space voice pad",midiProgram:91,generalMidi:!0,settings:{type:"FM",effects:"chorus & reverb",transition:"medium fade",chord:"harmony",filterCutoffHz:4e3,filterResonance:71,filterEnvelope:"steady",vibrato:"none",algorithm:"(1 2 3)←4",feedbackType:"1⟲ 2⟲ 3⟲ 4⟲",feedbackAmplitude:5,feedbackEnvelope:"swell 2",operators:[{frequency:"1×",amplitude:10,envelope:"custom"},{frequency:"2×",amplitude:8,envelope:"custom"},{frequency:"3×",amplitude:7,envelope:"custom"},{frequency:"11×",amplitude:1,envelope:"punch"}]}},{name:"bowed glass pad",midiProgram:92,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"soft fade",chord:"harmony",filterCutoffHz:4e3,filterResonance:14,filterEnvelope:"twang 3",vibrato:"none",algorithm:"1←3 2←4",feedbackType:"1⟲ 2⟲",feedbackAmplitude:0,feedbackEnvelope:"steady",operators:[{frequency:"1×",amplitude:10,envelope:"custom"},{frequency:"2×",amplitude:12,envelope:"custom"},{frequency:"3×",amplitude:7,envelope:"twang 3"},{frequency:"7×",amplitude:4,envelope:"flare 3"}]}},{name:"metallic pad",midiProgram:93,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"medium fade",chord:"harmony",filterCutoffHz:5657,filterResonance:14,filterEnvelope:"twang 3",vibrato:"none",algorithm:"1←3 2←4",feedbackType:"1⟲ 2⟲",feedbackAmplitude:13,feedbackEnvelope:"twang 3",operators:[{frequency:"1×",amplitude:15,envelope:"custom"},{frequency:"~1×",amplitude:9,envelope:"custom"},{frequency:"1×",amplitude:7,envelope:"swell 2"},{frequency:"11×",amplitude:7,envelope:"steady"}]}},{name:"sweep pad",midiProgram:95,generalMidi:!0,settings:{type:"chip",effects:"chorus & reverb",transition:"soft fade",chord:"harmony",filterCutoffHz:4e3,filterResonance:86,filterEnvelope:"flare 3",wave:"sawtooth",interval:"hum",vibrato:"none"}},{name:"atmosphere",midiProgram:99,generalMidi:!0,settings:{type:"FM",effects:"chorus & reverb",transition:"hard fade",chord:"strum",filterCutoffHz:4e3,filterResonance:29,filterEnvelope:"steady",vibrato:"none",algorithm:"1←(2 3 4)",feedbackType:"3⟲ 4⟲",feedbackAmplitude:3,feedbackEnvelope:"steady",operators:[{frequency:"1×",amplitude:14,envelope:"custom"},{frequency:"1×",amplitude:10,envelope:"swell 3"},{frequency:"3×",amplitude:7,envelope:"twang 2"},{frequency:"1×",amplitude:7,envelope:"twang 3"}]}},{name:"brightness",midiProgram:100,generalMidi:!0,settings:{type:"harmonics",effects:"chorus & reverb",transition:"medium fade",chord:"harmony",filterCutoffHz:2828,filterResonance:14,filterEnvelope:"twang 3",interval:"octave",vibrato:"none",harmonics:[100,86,86,86,43,57,43,71,43,43,43,57,43,43,57,71,57,43,29,43,57,57,43,29,29,29,29,14]}},{name:"goblins",midiProgram:101,generalMidi:!0,settings:{type:"FM",effects:"chorus & reverb",transition:"soft fade",chord:"harmony",filterCutoffHz:1414,filterResonance:14,filterEnvelope:"swell 2",vibrato:"none",algorithm:"1←2←3←4",feedbackType:"1⟲",feedbackAmplitude:10,feedbackEnvelope:"flare 3",operators:[{frequency:"1×",amplitude:15,envelope:"custom"},{frequency:"4×",amplitude:5,envelope:"swell 3"},{frequency:"1×",amplitude:10,envelope:"tremolo1"},{frequency:"1×",amplitude:0,envelope:"steady"}]}},{name:"sci-fi",midiProgram:103,generalMidi:!0,settings:{type:"FM",effects:"chorus & reverb",transition:"medium fade",chord:"harmony",filterCutoffHz:5657,filterResonance:14,filterEnvelope:"twang 3",vibrato:"none",algorithm:"(1 2)←3←4",feedbackType:"1⟲ 2⟲ 3⟲ 4⟲",feedbackAmplitude:8,feedbackEnvelope:"twang 3",operators:[{frequency:"~1×",amplitude:13,envelope:"custom"},{frequency:"2×",amplitude:10,envelope:"custom"},{frequency:"5×",amplitude:5,envelope:"twang 3"},{frequency:"11×",amplitude:8,envelope:"tremolo5"}]}},{name:"flutter pad",midiProgram:90,settings:{type:"FM",effects:"chorus & reverb",transition:"hard fade",chord:"harmony",filterCutoffHz:4e3,filterResonance:86,filterEnvelope:"twang 3",vibrato:"delayed",algorithm:"(1 2)←(3 4)",feedbackType:"1⟲ 2⟲ 3⟲",feedbackAmplitude:9,feedbackEnvelope:"steady",operators:[{frequency:"1×",amplitude:13,envelope:"custom"},{frequency:"5×",amplitude:7,envelope:"custom"},{frequency:"7×",amplitude:5,envelope:"tremolo1"},{frequency:"~1×",amplitude:6,envelope:"punch"}]}},{name:"feedback pad",midiProgram:89,settings:{type:"FM",effects:"reverb",transition:"soft fade",chord:"custom interval",filterCutoffHz:8e3,filterResonance:0,filterEnvelope:"steady",vibrato:"none",algorithm:"1 2 3 4",feedbackType:"1⟲ 2⟲ 3⟲ 4⟲",feedbackAmplitude:7,feedbackEnvelope:"swell 2",operators:[{frequency:"1×",amplitude:15,envelope:"custom"},{frequency:"1×",amplitude:15,envelope:"custom"},{frequency:"1×",amplitude:15,envelope:"custom"},{frequency:"~1×",amplitude:15,envelope:"custom"}]}}])},{name:"Drum Presets",presets:t.toNameMap([{name:"standard drumset",midiProgram:116,isNoise:!0,settings:{type:"drumset",effects:"reverb",drums:[{filterEnvelope:"twang 1",spectrum:[57,71,71,86,86,86,71,71,71,71,57,57,57,57,43,43,43,43,29,29,29,29,29,29,29,29,29,29,29,29]},{filterEnvelope:"twang 1",spectrum:[0,0,0,100,71,71,57,86,57,57,57,71,43,43,57,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43]},{filterEnvelope:"twang 1",spectrum:[0,0,0,0,100,57,43,43,29,57,43,29,71,43,43,43,43,57,43,43,43,43,43,43,43,43,29,43,43,43]},{filterEnvelope:"twang 1",spectrum:[0,0,0,0,0,71,57,43,43,43,57,57,43,29,57,43,43,43,29,43,57,43,43,43,43,43,43,29,43,43]},{filterEnvelope:"decay 2",spectrum:[0,14,29,43,86,71,29,43,43,43,43,29,71,29,71,29,43,43,43,43,57,43,43,57,43,43,43,57,57,57]},{filterEnvelope:"decay 1",spectrum:[0,0,14,14,14,14,29,29,29,43,43,43,57,57,57,71,71,71,71,71,71,71,71,57,57,57,57,43,43,43]},{filterEnvelope:"twang 3",spectrum:[43,43,43,71,29,29,43,43,43,29,43,43,43,29,29,43,43,29,29,29,57,14,57,43,43,57,43,43,57,57]},{filterEnvelope:"decay 3",spectrum:[29,43,43,43,43,29,29,43,29,29,43,29,14,29,43,29,43,29,57,29,43,57,43,71,43,71,57,57,71,71]},{filterEnvelope:"twang 3",spectrum:[43,29,29,43,29,29,29,57,29,29,29,57,43,43,29,29,57,43,43,43,71,43,43,71,57,71,71,71,71,71]},{filterEnvelope:"decay 3",spectrum:[57,57,57,43,57,57,43,43,57,43,43,43,71,57,43,57,86,71,57,86,71,57,86,100,71,86,86,86,86,86]},{filterEnvelope:"flare 1",spectrum:[0,0,14,14,14,14,29,29,29,43,43,43,57,57,71,71,86,86,100,100,100,100,100,100,100,100,86,57,29,0]},{filterEnvelope:"decay 2",spectrum:[14,14,14,14,29,14,14,29,14,43,14,43,57,86,57,57,100,57,43,43,57,100,57,43,29,14,0,0,0,0]}]}},{name:"steel pan",midiProgram:114,generalMidi:!0,settings:{type:"FM",effects:"chorus & reverb",transition:"hard fade",chord:"harmony",filterCutoffHz:2828,filterResonance:0,filterEnvelope:"decay 2",vibrato:"none",algorithm:"1←(2 3←4)",feedbackType:"1⟲",feedbackAmplitude:0,feedbackEnvelope:"steady",operators:[{frequency:"~1×",amplitude:14,envelope:"custom"},{frequency:"7×",amplitude:3,envelope:"flare 1"},{frequency:"3×",amplitude:5,envelope:"flare 2"},{frequency:"4×",amplitude:4,envelope:"swell 2"}]}},{name:"steel pan synth",midiProgram:114,settings:{type:"FM",effects:"reverb",transition:"hard",chord:"harmony",filterCutoffHz:2828,filterResonance:0,filterEnvelope:"twang 1",vibrato:"none",algorithm:"1 2 3←4",feedbackType:"1⟲",feedbackAmplitude:5,feedbackEnvelope:"flare 1",operators:[{frequency:"~1×",amplitude:12,envelope:"custom"},{frequency:"2×",amplitude:15,envelope:"custom"},{frequency:"4×",amplitude:14,envelope:"flare 1"},{frequency:"~1×",amplitude:3,envelope:"flare 2"}]}},{name:"timpani",midiProgram:47,generalMidi:!0,settings:{type:"spectrum",effects:"reverb",transition:"hard fade",chord:"harmony",filterCutoffHz:4e3,filterResonance:29,filterEnvelope:"twang 2",spectrum:[100,0,0,0,86,0,0,71,0,14,43,14,43,43,0,29,43,29,29,29,43,29,43,29,43,43,43,43,43,43]}},{name:"dark strike",midiProgram:47,settings:{type:"spectrum",effects:"reverb",transition:"hard fade",chord:"harmony",filterCutoffHz:4e3,filterResonance:29,filterEnvelope:"twang 2",spectrum:[0,0,0,0,14,14,14,29,29,43,43,86,43,43,43,29,86,29,29,29,86,29,14,14,14,14,0,0,0,0]}},{name:"woodblock",midiProgram:115,generalMidi:!0,isNoise:!0,midiSubharmonicOctaves:-2.5,settings:{type:"spectrum",effects:"reverb",transition:"hard fade",chord:"strum",filterCutoffHz:2828,filterResonance:14,filterEnvelope:"twang 1",spectrum:[0,14,29,43,43,57,86,86,71,57,57,43,43,57,86,86,43,43,71,57,57,57,57,57,86,86,71,71,71,71]}},{name:"taiko drum",midiProgram:116,generalMidi:!0,isNoise:!0,midiSubharmonicOctaves:-.5,settings:{type:"spectrum",effects:"reverb",transition:"hard fade",chord:"strum",filterCutoffHz:2828,filterResonance:29,filterEnvelope:"twang 1",spectrum:[71,100,100,43,43,71,71,43,43,43,43,43,43,57,29,57,43,57,43,43,57,43,43,43,43,43,43,43,43,43]}},{name:"melodic drum",midiProgram:117,generalMidi:!0,isNoise:!0,midiSubharmonicOctaves:-1.5,settings:{type:"spectrum",effects:"reverb",transition:"hard fade",chord:"strum",filterCutoffHz:2828,filterResonance:43,filterEnvelope:"twang 1",spectrum:[100,71,71,57,57,43,43,71,43,43,43,57,43,43,57,43,43,43,43,29,29,29,29,29,29,29,29,29,29,29]}},{name:"drum synth",midiProgram:118,generalMidi:!0,isNoise:!0,midiSubharmonicOctaves:-2,settings:{type:"spectrum",effects:"reverb",transition:"hard fade",chord:"harmony",filterCutoffHz:4e3,filterResonance:43,filterEnvelope:"decay 1",spectrum:[100,86,71,57,43,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29]}},{name:"tom-tom",midiProgram:116,isNoise:!0,midiSubharmonicOctaves:-1,settings:{type:"spectrum",effects:"reverb",transition:"hard fade",chord:"strum",filterCutoffHz:2e3,filterResonance:14,filterEnvelope:"twang 1",spectrum:[100,29,14,0,0,86,14,43,29,86,29,14,29,57,43,43,43,43,57,43,43,43,29,57,43,43,43,43,43,43]}},{name:"metal pipe",midiProgram:117,isNoise:!0,midiSubharmonicOctaves:-1.5,settings:{type:"spectrum",effects:"reverb",transition:"hard fade",chord:"strum",filterCutoffHz:8e3,filterResonance:14,filterEnvelope:"twang 2",spectrum:[29,43,86,43,43,43,43,43,100,29,14,14,100,14,14,0,0,0,0,0,14,29,29,14,0,0,14,29,0,0]}}])},{name:"Novelty Presets",presets:t.toNameMap([{name:"guitar fret noise",midiProgram:120,generalMidi:!0,settings:{type:"spectrum",effects:"reverb",transition:"hard",chord:"harmony",filterCutoffHz:8e3,filterResonance:86,filterEnvelope:"flare 1",spectrum:[0,0,0,0,0,0,0,0,0,0,0,0,0,14,0,0,0,29,14,0,0,43,0,43,0,71,43,0,57,0]}},{name:"fifth saw lead",midiProgram:86,generalMidi:!0,midiSubharmonicOctaves:1,settings:{type:"chip",effects:"chorus & reverb",transition:"hard fade",chord:"harmony",filterCutoffHz:2828,filterResonance:57,filterEnvelope:"twang 3",wave:"sawtooth",interval:"fifth",vibrato:"none"}},{name:"fifth swell",midiProgram:86,midiSubharmonicOctaves:1,settings:{type:"chip",effects:"chorus & reverb",transition:"hard fade",chord:"harmony",filterCutoffHz:2e3,filterResonance:57,filterEnvelope:"swell 3",wave:"sawtooth",interval:"fifth",vibrato:"none"}},{name:"soundtrack",midiProgram:97,generalMidi:!0,settings:{type:"chip",effects:"chorus & reverb",transition:"soft fade",chord:"harmony",filterCutoffHz:2e3,filterResonance:14,filterEnvelope:"flare 3",wave:"sawtooth",interval:"fifth",vibrato:"none"}},{name:"reverse cymbal",midiProgram:119,generalMidi:!0,isNoise:!0,midiSubharmonicOctaves:-3,settings:{type:"spectrum",effects:"none",transition:"soft",chord:"harmony",filterCutoffHz:4e3,filterResonance:14,filterEnvelope:"swell 3",spectrum:[29,57,57,29,57,57,29,29,43,29,29,43,29,29,57,57,14,57,14,57,71,71,57,86,57,100,86,86,86,86]}},{name:"seashore",midiProgram:122,generalMidi:!0,isNoise:!0,midiSubharmonicOctaves:-3,settings:{type:"spectrum",transition:"soft fade",effects:"reverb",chord:"harmony",filterCutoffHz:2828,filterResonance:0,filterEnvelope:"swell 3",spectrum:[14,14,29,29,43,43,43,57,57,57,57,57,57,71,71,71,71,71,71,71,71,71,71,71,71,71,71,71,71,57]}},{name:"bird tweet",midiProgram:123,generalMidi:!0,settings:{type:"harmonics",effects:"reverb",transition:"soft",chord:"strum",filterCutoffHz:2828,filterResonance:0,filterEnvelope:"decay 1",interval:"hum",vibrato:"heavy",harmonics:[0,0,14,100,14,0,0,14,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},{name:"telephone ring",midiProgram:124,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"hard",chord:"arpeggio",filterCutoffHz:4e3,filterResonance:14,filterEnvelope:"tremolo4",vibrato:"none",algorithm:"1←(2 3 4)",feedbackType:"1⟲",feedbackAmplitude:2,feedbackEnvelope:"steady",operators:[{frequency:"2×",amplitude:12,envelope:"custom"},{frequency:"1×",amplitude:4,envelope:"tremolo1"},{frequency:"20×",amplitude:1,envelope:"steady"},{frequency:"1×",amplitude:0,envelope:"steady"}]}},{name:"helicopter",midiProgram:125,generalMidi:!0,isNoise:!0,midiSubharmonicOctaves:-.5,settings:{type:"spectrum",effects:"reverb",transition:"seamless",chord:"arpeggio",filterCutoffHz:1414,filterResonance:14,filterEnvelope:"tremolo4",spectrum:[14,43,43,57,57,57,71,71,71,71,86,86,86,86,86,86,86,86,86,86,86,71,71,71,71,71,71,71,57,57]}},{name:"applause",midiProgram:126,generalMidi:!0,isNoise:!0,midiSubharmonicOctaves:-3,settings:{type:"spectrum",effects:"reverb",transition:"soft fade",chord:"harmony",filterCutoffHz:2e3,filterResonance:14,filterEnvelope:"swell 3",spectrum:[14,14,29,29,29,43,43,57,71,71,86,86,86,71,71,57,57,57,71,86,86,86,86,86,71,71,57,57,57,57]}},{name:"gunshot",midiProgram:127,generalMidi:!0,isNoise:!0,midiSubharmonicOctaves:-2,settings:{type:"spectrum",effects:"reverb",transition:"hard fade",chord:"strum",filterCutoffHz:1414,filterResonance:29,filterEnvelope:"twang 1",spectrum:[14,29,43,43,57,57,57,71,71,71,86,86,86,86,86,86,86,86,86,86,86,71,71,71,71,57,57,57,57,43]}},{name:"scoot",midiProgram:92,settings:{type:"chip",transition:"hard",effects:"reverb",chord:"harmony",filterCutoffHz:707,filterResonance:86,filterEnvelope:"flare 1",wave:"sawtooth",interval:"shimmer",vibrato:"none"}},{name:"buzz saw",midiProgram:30,settings:{type:"FM",effects:"reverb",transition:"soft",chord:"custom interval",filterCutoffHz:2e3,filterResonance:0,filterEnvelope:"steady",vibrato:"none",algorithm:"1←2←3←4",feedbackType:"1⟲",feedbackAmplitude:0,feedbackEnvelope:"steady",operators:[{frequency:"5×",amplitude:13,envelope:"custom"},{frequency:"1×",amplitude:10,envelope:"steady"},{frequency:"~1×",amplitude:6,envelope:"steady"},{frequency:"11×",amplitude:12,envelope:"steady"}]}},{name:"mosquito",midiProgram:93,settings:{type:"PWM",effects:"reverb",transition:"cross fade",chord:"harmony",filterCutoffHz:2828,filterResonance:57,filterEnvelope:"steady",pulseWidth:4.40625,pulseEnvelope:"tremolo6",vibrato:"shaky"}},{name:"breathing",midiProgram:126,isNoise:!0,midiSubharmonicOctaves:-1,settings:{type:"spectrum",effects:"reverb",transition:"hard fade",chord:"harmony",filterCutoffHz:2e3,filterResonance:14,filterEnvelope:"swell 2",spectrum:[14,14,14,29,29,29,29,29,43,29,29,43,43,43,29,29,71,43,86,86,57,100,86,86,86,86,71,86,71,57]}},{name:"klaxon synth",midiProgram:125,isNoise:!0,midiSubharmonicOctaves:-1,settings:{type:"noise",effects:"reverb",transition:"slide",chord:"harmony",filterCutoffHz:2e3,filterResonance:86,filterEnvelope:"steady",wave:"buzz"}},{name:"theremin",midiProgram:40,settings:{type:"harmonics",effects:"reverb",transition:"slide",chord:"harmony",filterCutoffHz:4e3,filterResonance:14,filterEnvelope:"steady",interval:"union",vibrato:"heavy",harmonics:[100,71,57,43,29,29,14,14,14,14,14,14,14,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},{name:"sonar ping",midiProgram:121,settings:{type:"spectrum",effects:"reverb",transition:"medium fade",chord:"harmony",filterCutoffHz:1414,filterResonance:14,filterEnvelope:"twang 2",spectrum:[100,43,29,29,14,14,14,14,14,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}}])}]),t.EditorConfig=e}(beepbox||(beepbox={})),function(t){const e={class:!0,classList:!0,className:!0};function i(t,s){for(const n of s)if(Array.isArray(n))i(t,n);else if(n instanceof Node)t.appendChild(n);else if(n&&n.constructor===Object)for(const i of Object.keys(n)){const s=n[i];if(e[i])if("classList"===i){const e=Array.isArray(s)?s:s.split(" ");for(const i of e)t.classList.add(i)}else t.setAttribute("class",Array.isArray(s)?s.join(" "):s);else if("style"===i)if(s&&s.constructor===Object)for(const e of Object.keys(s))e.startsWith("--")?t.style.setProperty(e,s[e]):t.style.hasOwnProperty(e)?t.style[e]=s[e]:console.log("Unrecognized style property name: "+e);else t.setAttribute(i,s);else"function"==typeof s?t[i]=s:"boolean"==typeof s?s?t.setAttribute(i,""):t.removeAttribute(i):t.setAttribute(i,s)}else t.appendChild(document.createTextNode(n));return t}const s="http://www.w3.org/2000/svg";t.HTML=function(){},t.HTML.element=function(t,...e){return i(document.createElement(t),e)},t.SVG=function(){},t.SVG.element=function(t,...e){return i(document.createElementNS(s,t),e)};for(const e of"a abbr address area article aside audio b base bdi bdo blockquote br button canvas caption cite code col colgroup datalist dd del details dfn dialog div dl dt em embed fieldset figcaption figure footer form h1 h2 h3 h4 h5 h6 header hr i iframe img input ins kbd label legend li link main map mark menu menuitem meta meter nav noscript object ol optgroup option output p param picture pre progress q rp rt ruby s samp script section select small source span strong style sub summary sup table tbody td template textarea tfoot th thead time title tr track u ul var video wbr".split(" "))t.HTML[e]=function(...t){return i(document.createElement(e),t)};for(const e of"a altGlyph altGlyphDef altGlyphItem animate animateMotion animateTransform circle clipPath color-profile cursor defs desc discard ellipse feBlend feColorMatrix feComponentTransfer feComposite feConvolveMatrix feDiffuseLighting feDisplacementMap feDistantLight feDropShadow feFlood feFuncA feFuncB feFuncG feFuncR feGaussianBlur feImage feMerge feMergeNode feMorphology feOffset fePointLight feSpecularLighting feSpotLight feTile feTurbulence filter font font-face font-face-format font-face-name font-face-src font-face-uri foreignObject g glyph glyphRef hkern image line linearGradient marker mask metadata missing-glyph mpath path pattern polygon polyline radialGradient rect script set stop style svg switch symbol text textPath title tref tspan use view vkern".split(" "))t.SVG[e]=function(...t){return i(document.createElementNS(s,e),t)};t.prettyNumber=function(t){return t.toFixed(2).replace(/\.?0*$/,"")}}(beepbox||(beepbox={})),function(t){class e{static getChannelColor(t,i){return i<t.pitchChannelCount?e.pitchChannels[i%e.pitchChannels.length]:e.noiseChannels[(i-t.pitchChannelCount)%e.noiseChannels.length]}static setTheme(t){this.t.textContent=this.themes[t];const e=document.querySelector("meta[name='theme-color']");null!=e&&e.setAttribute("content",getComputedStyle(document.documentElement).getPropertyValue("--ui-widget-background"))}}e.themes={"dark classic":"\n\t\t\t\t:root {\n\t\t\t\t\t--page-margin: black;\n\t\t\t\t\t--editor-background: black;\n\t\t\t\t\t--hover-preview: white;\n\t\t\t\t\t--playhead: white;\n\t\t\t\t\t--primary-text: white;\n\t\t\t\t\t--secondary-text: #999;\n\t\t\t\t\t--inverted-text: black;\n\t\t\t\t\t--text-selection: rgba(119,68,255,0.99);\n\t\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\n\t\t\t\t\t--loop-accent: #74f;\n\t\t\t\t\t--link-accent: #98f;\n\t\t\t\t\t--ui-widget-background: #444;\n\t\t\t\t\t--ui-widget-focus: #777;\n\t\t\t\t\t--pitch-background: #444;\n\t\t\t\t\t--tonic: #864;\n\t\t\t\t\t--fifth-note: #468;\n\t\t\t\t\t--white-piano-key: #bbb;\n\t\t\t\t\t--black-piano-key: #444;\n\t\t\t\t\t--pitch1-secondary-channel: #0099a1;\n\t\t\t\t\t--pitch1-primary-channel:   #25f3ff;\n\t\t\t\t\t--pitch1-secondary-note:    #00bdc7;\n\t\t\t\t\t--pitch1-primary-note:      #92f9ff;\n\t\t\t\t\t--pitch2-secondary-channel: #a1a100;\n\t\t\t\t\t--pitch2-primary-channel:   #ffff25;\n\t\t\t\t\t--pitch2-secondary-note:    #c7c700;\n\t\t\t\t\t--pitch2-primary-note:      #ffff92;\n\t\t\t\t\t--pitch3-secondary-channel: #c75000;\n\t\t\t\t\t--pitch3-primary-channel:   #ff9752;\n\t\t\t\t\t--pitch3-secondary-note:    #ff771c;\n\t\t\t\t\t--pitch3-primary-note:      #ffcdab;\n\t\t\t\t\t--pitch4-secondary-channel: #00a100;\n\t\t\t\t\t--pitch4-primary-channel:   #50ff50;\n\t\t\t\t\t--pitch4-secondary-note:    #00c700;\n\t\t\t\t\t--pitch4-primary-note:      #a0ffa0;\n\t\t\t\t\t--pitch5-secondary-channel: #d020d0;\n\t\t\t\t\t--pitch5-primary-channel:   #ff90ff;\n\t\t\t\t\t--pitch5-secondary-note:    #e040e0;\n\t\t\t\t\t--pitch5-primary-note:      #ffc0ff;\n\t\t\t\t\t--pitch6-secondary-channel: #7777b0;\n\t\t\t\t\t--pitch6-primary-channel:   #a0a0ff;\n\t\t\t\t\t--pitch6-secondary-note:    #8888d0;\n\t\t\t\t\t--pitch6-primary-note:      #d0d0ff;\n\t\t\t\t\t--noise1-secondary-channel: #6f6f6f;\n\t\t\t\t\t--noise1-primary-channel:   #aaaaaa;\n\t\t\t\t\t--noise1-secondary-note:    #a7a7a7;\n\t\t\t\t\t--noise1-primary-note:      #e0e0e0;\n\t\t\t\t\t--noise2-secondary-channel: #996633;\n\t\t\t\t\t--noise2-primary-channel:   #ddaa77;\n\t\t\t\t\t--noise2-secondary-note:    #cc9966;\n\t\t\t\t\t--noise2-primary-note:      #f0d0bb;\n\t\t\t\t\t--noise3-secondary-channel: #4a6d8f;\n\t\t\t\t\t--noise3-primary-channel:   #77aadd;\n\t\t\t\t\t--noise3-secondary-note:    #6f9fcf;\n\t\t\t\t\t--noise3-primary-note:      #bbd7ff;\n\t\t\t\t}\n\t\t\t","light classic":"\n\t\t\t\t:root {\n\t\t\t\t\t-webkit-text-stroke-width: 0.5px;\n\t\t\t\t\t--page-margin: #685d88;\n\t\t\t\t\t--editor-background: white;\n\t\t\t\t\t--hover-preview: black;\n\t\t\t\t\t--playhead: rgba(0,0,0,0.5);\n\t\t\t\t\t--primary-text: black;\n\t\t\t\t\t--secondary-text: #777;\n\t\t\t\t\t--inverted-text: white;\n\t\t\t\t\t--text-selection: rgba(200,170,255,0.99);\n\t\t\t\t\t--box-selection-fill: rgba(0,0,0,0.1);\n\t\t\t\t\t--loop-accent: #98f;\n\t\t\t\t\t--link-accent: #74f;\n\t\t\t\t\t--ui-widget-background: #ececec;\n\t\t\t\t\t--ui-widget-focus: #eee;\n\t\t\t\t\t--pitch-background: #ececec;\n\t\t\t\t\t--tonic: #f0d6b6;\n\t\t\t\t\t--fifth-note: #bbddf0;\n\t\t\t\t\t--white-piano-key: #eee;\n\t\t\t\t\t--black-piano-key: #666;\n\t\t\t\t\t--pitch1-secondary-channel: #6CD9ED;\n\t\t\t\t\t--pitch1-primary-channel:   #00A0BD;\n\t\t\t\t\t--pitch1-secondary-note:    #34C2DC;\n\t\t\t\t\t--pitch1-primary-note:      #00758A;\n\t\t\t\t\t--pitch2-secondary-channel: #E3C941;\n\t\t\t\t\t--pitch2-primary-channel:   #B49700;\n\t\t\t\t\t--pitch2-secondary-note:    #D1B628;\n\t\t\t\t\t--pitch2-primary-note:      #836E00;\n\t\t\t\t\t--pitch3-secondary-channel: #FF9D61;\n\t\t\t\t\t--pitch3-primary-channel:   #E14E00;\n\t\t\t\t\t--pitch3-secondary-note:    #F67D3C;\n\t\t\t\t\t--pitch3-primary-note:      #B64000;\n\t\t\t\t\t--pitch4-secondary-channel: #4BE24B;\n\t\t\t\t\t--pitch4-primary-channel:   #00A800;\n\t\t\t\t\t--pitch4-secondary-note:    #2DC82D;\n\t\t\t\t\t--pitch4-primary-note:      #008000;\n\t\t\t\t\t--pitch5-secondary-channel: #FF90FF;\n\t\t\t\t\t--pitch5-primary-channel:   #E12EDF;\n\t\t\t\t\t--pitch5-secondary-note:    #EC6EEC;\n\t\t\t\t\t--pitch5-primary-note:      #A600A5;\n\t\t\t\t\t--pitch6-secondary-channel: #B5B5FE;\n\t\t\t\t\t--pitch6-primary-channel:   #6969FD;\n\t\t\t\t\t--pitch6-secondary-note:    #9393FE;\n\t\t\t\t\t--pitch6-primary-note:      #4A4AD7;\n\t\t\t\t\t--noise1-secondary-channel: #C1C1C1;\n\t\t\t\t\t--noise1-primary-channel:   #898989;\n\t\t\t\t\t--noise1-secondary-note:    #ADADAD;\n\t\t\t\t\t--noise1-primary-note:      #6C6C6C;\n\t\t\t\t\t--noise2-secondary-channel: #E8BB8C;\n\t\t\t\t\t--noise2-primary-channel:   #BD7D3A;\n\t\t\t\t\t--noise2-secondary-note:    #D1A374;\n\t\t\t\t\t--noise2-primary-note:      #836342;\n\t\t\t\t\t--noise3-secondary-channel: #9BC4EB;\n\t\t\t\t\t--noise3-primary-channel:   #4481BE;\n\t\t\t\t\t--noise3-secondary-note:    #7CA7D3;\n\t\t\t\t\t--noise3-primary-note:      #476685;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.beepboxEditor button, .beepboxEditor select {\n\t\t\t\t\tbox-shadow: inset 0 0 0 1px var(--secondary-text);\n\t\t\t\t}\n\t\t\t"},e.pageMargin="var(--page-margin)",e.editorBackground="var(--editor-background)",e.hoverPreview="var(--hover-preview)",e.playhead="var(--playhead)",e.primaryText="var(--primary-text)",e.secondaryText="var(--secondary-text)",e.invertedText="var(--inverted-text)",e.textSelection="var(--text-selection)",e.boxSelectionFill="var(--box-selection-fill)",e.loopAccent="var(--loop-accent)",e.linkAccent="var(--link-accent)",e.uiWidgetBackground="var(--ui-widget-background)",e.uiWidgetFocus="var(--ui-widget-focus)",e.pitchBackground="var(--pitch-background)",e.tonic="var(--tonic)",e.fifthNote="var(--fifth-note)",e.whitePianoKey="var(--white-piano-key)",e.blackPianoKey="var(--black-piano-key)",e.pitchChannels=t.toNameMap([{name:"pitch1",secondaryChannel:"var(--pitch1-secondary-channel)",primaryChannel:"var(--pitch1-primary-channel)",secondaryNote:"var(--pitch1-secondary-note)",primaryNote:"var(--pitch1-primary-note)"},{name:"pitch2",secondaryChannel:"var(--pitch2-secondary-channel)",primaryChannel:"var(--pitch2-primary-channel)",secondaryNote:"var(--pitch2-secondary-note)",primaryNote:"var(--pitch2-primary-note)"},{name:"pitch3",secondaryChannel:"var(--pitch3-secondary-channel)",primaryChannel:"var(--pitch3-primary-channel)",secondaryNote:"var(--pitch3-secondary-note)",primaryNote:"var(--pitch3-primary-note)"},{name:"pitch4",secondaryChannel:"var(--pitch4-secondary-channel)",primaryChannel:"var(--pitch4-primary-channel)",secondaryNote:"var(--pitch4-secondary-note)",primaryNote:"var(--pitch4-primary-note)"},{name:"pitch5",secondaryChannel:"var(--pitch5-secondary-channel)",primaryChannel:"var(--pitch5-primary-channel)",secondaryNote:"var(--pitch5-secondary-note)",primaryNote:"var(--pitch5-primary-note)"},{name:"pitch6",secondaryChannel:"var(--pitch6-secondary-channel)",primaryChannel:"var(--pitch6-primary-channel)",secondaryNote:"var(--pitch6-secondary-note)",primaryNote:"var(--pitch6-primary-note)"}]),e.noiseChannels=t.toNameMap([{name:"noise1",secondaryChannel:"var(--noise1-secondary-channel)",primaryChannel:"var(--noise1-primary-channel)",secondaryNote:"var(--noise1-secondary-note)",primaryNote:"var(--noise1-primary-note)"},{name:"noise2",secondaryChannel:"var(--noise2-secondary-channel)",primaryChannel:"var(--noise2-primary-channel)",secondaryNote:"var(--noise2-secondary-note)",primaryNote:"var(--noise2-primary-note)"},{name:"noise3",secondaryChannel:"var(--noise3-secondary-channel)",primaryChannel:"var(--noise3-primary-channel)",secondaryNote:"var(--noise3-secondary-note)",primaryNote:"var(--noise3-primary-note)"}]),e.t=document.head.appendChild(t.HTML.style({type:"text/css"})),t.ColorConfig=e}(beepbox||(beepbox={})),function(t){const e=document.body.appendChild(t.HTML.div({style:"width:30px; height:30px; overflow: auto;"},t.HTML.div({style:"width:100%;height:40px"})));e.firstChild.clientWidth<30&&document.documentElement.classList.add("obtrusive-scrollbars"),document.body.removeChild(e),document.head.appendChild(t.HTML.style({type:"text/css"},`\n\n/* Note: "#" symbols need to be encoded as "%23" in SVG data urls, otherwise they are interpreted as fragment identifiers! */\n:root {\n\t--play-symbol: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="-13 -13 26 26"><path d="M -4 -8 L -4 8 L 9 0 z" fill="gray"/></svg>');\n\t--pause-symbol: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="-13 -13 26 26"><rect x="-4" y="-8" width="4" height="16" fill="gray"/><rect x="5" y="-8" width="4" height="16" fill="gray"/></svg>');\n\t--prev-bar-symbol: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="-13 -13 26 26"><rect x="-6" y="-6" width="2" height="12" fill="gray"/><path d="M 6 -6 L 6 6 L -3 0 z" fill="gray"/></svg>');\n\t--next-bar-symbol: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="-13 -13 26 26"><rect x="4" y="-6" width="2" height="12" fill="gray"/><path d="M -6 -6 L -6 6 L 3 0 z" fill="gray"/></svg>');\n\t--volume-symbol: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 26 26"><path d="M 4 16 L 4 10 L 8 10 L 13 5 L 13 21 L 8 16 z M 15 11 L 16 10 A 7.2 7.2 0 0 1 16 16 L 15 15 A 5.8 5.8 0 0 0 15 12 z M 18 8 L 19 7 A 11.5 11.5 0 0 1 19 19 L 18 18 A 10.1 10.1 0 0 0 18 8 z" fill="gray"/></svg>');\n\t--unmuted-symbol: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="3 3 20 20"><path d="M 4 16 L 4 10 L 8 10 L 13 5 L 13 21 L 8 16 z M 15 11 L 16 10 A 7.2 7.2 0 0 1 16 16 L 15 15 A 5.8 5.8 0 0 0 15 12 z M 18 8 L 19 7 A 11.5 11.5 0 0 1 19 19 L 18 18 A 10.1 10.1 0 0 0 18 8 z" fill="gray"/></svg>');\n\t--muted-symbol: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="3 3 20 20"><path d="M 4 16 L 4 10 L 8 10 L 13 5 L 13 21 L 8 16 z" fill="gray"/></svg>');\n\t--menu-down-symbol: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="-13 -13 26 26"><path d="M -4 -2 L 4 -2 L 0 3 z" fill="gray"/></svg>');\n\t--select-arrows-symbol: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="-13 -13 26 26"><path d="M -4 -3 L 4 -3 L 0 -8 z M -4 3 L 4 3 L 0 8 z" fill="gray"/></svg>');\n\t--file-page-symbol: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="-5 -21 26 26"><path d="M 2 0 L 2 -16 L 10 -16 L 14 -12 L 14 0 z M 3 -1 L 13 -1 L 13 -11 L 9 -11 L 9 -15 L 3 -15 z" fill="gray"/></svg>');\n\t--edit-pencil-symbol: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="-5 -21 26 26"><path d="M 0 0 L 1 -4 L 4 -1 z M 2 -5 L 10 -13 L 13 -10 L 5 -2 zM 11 -14 L 13 -16 L 14 -16 L 16 -14 L 16 -13 L 14 -11 z" fill="gray"/></svg>');\n\t--preferences-gear-symbol: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="-13 -13 26 26"><path d="M 5.78 -1.6 L 7.93 -0.94 L 7.93 0.94 L 5.78 1.6 L 4.85 3.53 L 5.68 5.61 L 4.21 6.78 L 2.36 5.52 L 0.27 5.99 L -0.85 7.94 L -2.68 7.52 L -2.84 5.28 L -4.52 3.95 L -6.73 4.28 L -7.55 2.59 L -5.9 1.07 L -5.9 -1.07 L -7.55 -2.59 L -6.73 -4.28 L -4.52 -3.95 L -2.84 -5.28 L -2.68 -7.52 L -0.85 -7.94 L 0.27 -5.99 L 2.36 -5.52 L 4.21 -6.78 L 5.68 -5.61 L 4.85 -3.53 M 2.92 0.67 L 2.92 -0.67 L 2.35 -1.87 L 1.3 -2.7 L 0 -3 L -1.3 -2.7 L -2.35 -1.87 L -2.92 -0.67 L -2.92 0.67 L -2.35 1.87 L -1.3 2.7 L -0 3 L 1.3 2.7 L 2.35 1.87 z" fill="gray"/></svg>');\n\t--customize-dial-symbol: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="-13 -13 26 26"> \t\t\t<g transform="translate(0,1)" fill="gray"> \t\t\t\t<circle cx="0" cy="0" r="6.5" stroke="gray" stroke-width="1" fill="none"/> \t\t\t\t<rect x="-1" y="-5" width="2" height="4" transform="rotate(30)"/> \t\t\t\t<circle cx="-7.79" cy="4.5" r="0.75"/> \t\t\t\t<circle cx="-9" cy="0" r="0.75"/> \t\t\t\t<circle cx="-7.79" cy="-4.5" r="0.75"/> \t\t\t\t<circle cx="-4.5" cy="-7.79" r="0.75"/> \t\t\t\t<circle cx="0" cy="-9" r="0.75"/> \t\t\t\t<circle cx="4.5" cy="-7.79" r="0.75"/> \t\t\t\t<circle cx="7.79" cy="-4.5" r="0.75"/> \t\t\t\t<circle cx="9" cy="0" r="0.75"/> \t\t\t\t<circle cx="7.79" cy="4.5" r="0.75"/> \t\t\t</g> \t\t</svg>');\n\t--export-symbol: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="-13 -13 26 26"><path fill="gray" d="M -8 3 L -8 8 L 8 8 L 8 3 L 6 3 L 6 6 L -6 6 L -6 3 z M 0 2 L -4 -2 L -1 -2 L -1 -8 L 1 -8 L 1 -2 L 4 -2 z"/></svg>');\n\t--close-symbol: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="-13 -13 26 26"><path fill="gray" d="M -8 -6 L -6 -8 L 0 -2  L 6 -8 L 8 -6 L 2 0 L 8 6 L 6 8 L 0 2 L -6 8 L -8 6 L -2 0 z"/></svg>');\n\t--checkmark-symbol: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="-13 -13 26 26"><path fill="gray" d="M -9 -2 L -8 -3 L -3 2 L 9 -8 L 10 -7 L -3 8 z"/></svg>');\n\t--drum-symbol: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="40" viewBox="0 0 32 40"> \t\t\t<defs> \t\t\t\t<linearGradient id="gold1" x1="0%" y1="0%" x2="100%" y2="0%"> \t\t\t\t\t<stop offset="0%" stop-color="%237e3302"/> \t\t\t\t\t<stop offset="40%" stop-color="%23ffec6b"/> \t\t\t\t\t<stop offset="100%" stop-color="%237e3302"/> \t\t\t\t</linearGradient> \t\t\t\t<linearGradient id="gold2" x1="0%" y1="0%" x2="100%" y2="0%"> \t\t\t\t\t<stop offset="0%" stop-color="%23faaf7d"/> \t\t\t\t\t<stop offset="15%" stop-color="%23fffba9"/> \t\t\t\t\t<stop offset="40%" stop-color="%23ffffe3"/> \t\t\t\t\t<stop offset="65%" stop-color="%23fffba9"/> \t\t\t\t\t<stop offset="100%" stop-color="%23faaf7d"/> \t\t\t\t</linearGradient> \t\t\t\t<radialGradient id="gold3" cx="0%" cy="0%" r="100%"> \t\t\t\t\t<stop offset="0%" stop-color="%23ffffe3"/> \t\t\t\t\t<stop offset="50%" stop-color="%23ffec6b"/> \t\t\t\t\t<stop offset="100%" stop-color="%237e3302"/> \t\t\t\t</radialGradient> \t\t\t\t<linearGradient id="red" x1="0%" y1="0%" x2="100%" y2="0%"> \t\t\t\t\t<stop offset="0%" stop-color="%23641919"/> \t\t\t\t\t<stop offset="40%" stop-color="%23cd2c2c"/> \t\t\t\t\t<stop offset="100%" stop-color="%23641919"/> \t\t\t\t</linearGradient> \t\t\t\t<radialGradient id="membrane"> \t\t\t\t\t<stop offset="10%" stop-color="%23cccccc" /> \t\t\t\t\t<stop offset="90%" stop-color="%23f6f6f7" /> \t\t\t\t\t<stop offset="100%" stop-color="%23999" /> \t\t\t\t</radialGradient> \t\t\t</defs> \t\t\t<ellipse cx="16" cy="26" rx="16" ry="14" fill="rgba(0,0,0,0.5)"/> \t\t\t<ellipse cx="16" cy="25" rx="16" ry="14" fill="url(%23gold1)"/> \t\t\t<rect x="0" y="23" width="32" height="2" fill="url(%23gold1)"/> \t\t\t<ellipse cx="16" cy="23" rx="16" ry="14" fill="url(%23gold2)"/> \t\t\t<ellipse cx="16" cy="23" rx="15" ry="13" fill="url(%23red)"/> \t\t\t<rect x="1" y="17" width="30" height="6" fill="url(%23red)"/> \t\t\t<rect x="5" y="27" width="1" height="5" rx="0.5" fill="rgba(0,0,0,0.5)"/> \t\t\t<rect x="15" y="31" width="2" height="5" rx="1" fill="rgba(0,0,0,0.5)"/> \t\t\t<rect x="26" y="27" width="1" height="5" rx="0.5" fill="rgba(0,0,0,0.5)"/> \t\t\t<rect x="5" y="26" width="1" height="5" rx="0.5" fill="url(%23gold3)"/> \t\t\t<rect x="15" y="30" width="2" height="5" rx="1" fill="url(%23gold3)"/> \t\t\t<rect x="26" y="26" width="1" height="5" rx="0.5" fill="url(%23gold3)"/> \t\t\t<ellipse cx="16" cy="18" rx="15" ry="13" fill="rgba(0,0,0,0.5)"/> \t\t\t<ellipse cx="16" cy="16" rx="16" ry="14" fill="url(%23gold1)"/> \t\t\t<rect x="0" y="14" width="32" height="2" fill="url(%23gold1)"/> \t\t\t<ellipse cx="16" cy="14" rx="16" ry="14" fill="url(%23gold2)"/> \t\t\t<ellipse cx="16" cy="14" rx="15" ry="13" fill="url(%23membrane)"/> \t\t</svg>');\n\t--piano-key-symbol: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="15" preserveAspectRatio="none" viewBox="0 -1 32 15"> \t\t\t<defs> \t\t\t\t<linearGradient id="shadow" x1="0%" y1="0%" x2="100%" y2="0%"> \t\t\t\t\t<stop offset="0%" stop-color="rgba(0,0,0,0.5)"/> \t\t\t\t\t<stop offset="100%" stop-color="transparent"/> \t\t\t\t</linearGradient> \t\t\t</defs> \t\t\t<rect x="-1" y="1" width="31" height="1" rx="0.6" fill="rgba(255,255,255,0.4)"/> \t\t\t<path d="M -1 11 L 30 11 L 30 2 L 33 -1 L 33 14 L -1 14 z" fill="rgba(0,0,0,0.7)"/> \t\t\t<rect x="-1" y="-1" width="19" height="15" fill="url(%23shadow)"/> \t\t</svg>');\n}\n\n\n.obtrusive-scrollbars, .obtrusive-scrollbars * {\n\tscrollbar-width: thin;\n\tscrollbar-color: ${t.ColorConfig.uiWidgetBackground} ${t.ColorConfig.editorBackground};\n}\n.obtrusive-scrollbars::-webkit-scrollbar, .obtrusive-scrollbars *::-webkit-scrollbar {\n\twidth: 12px;\n}\n.obtrusive-scrollbars::-webkit-scrollbar-track, .obtrusive-scrollbars *::-webkit-scrollbar-track {\n\tbackground: ${t.ColorConfig.editorBackground};\n}\n.obtrusive-scrollbars::-webkit-scrollbar-thumb, .obtrusive-scrollbars *::-webkit-scrollbar-thumb {\n\tbackground-color: ${t.ColorConfig.uiWidgetBackground};\n\tborder: 3px solid ${t.ColorConfig.editorBackground};\n}\n\n\n.beepboxEditor {\n\tdisplay: grid;\n    grid-template-columns: minmax(0, 1fr) max-content;\n    grid-template-rows: max-content 1fr; /* max-content minmax(0, 1fr); Chrome 80 grid layout regression. https://bugs.chromium.org/p/chromium/issues/detail?id=1050307 */\n    grid-template-areas: "pattern-area settings-area" "track-area settings-area";\n\tgrid-column-gap: 6px;\n\tgrid-row-gap: 6px;\n\tposition: relative;\n\ttouch-action: manipulation;\n\tcursor: default;\n\tfont-size: small;\n\toverflow: hidden;\n\tcolor: ${t.ColorConfig.primaryText};\n\tbackground: ${t.ColorConfig.editorBackground};\n}\n\n.beepboxEditor .noSelection {\n\t-webkit-touch-callout: none;\n\t-webkit-user-select: none;\n\t-moz-user-select: none;\n\t-ms-user-select: none;\n\tuser-select: none;\n}\n\n.beepboxEditor div {\n\tmargin: 0;\n\tpadding: 0;\n}\n\n.beepboxEditor .pattern-area {\n\tgrid-area: pattern-area;\n\theight: 481px;\n\tdisplay: flex;\n\tflex-direction: row;\n}\n\n.beepboxEditor .track-area {\n\tgrid-area: track-area;\n}\n\n.beepboxEditor .settings-area {\n\tgrid-area: settings-area;\n\tdisplay: grid;\n    grid-template-columns: auto;\n    grid-template-rows: min-content min-content min-content min-content min-content;\n    grid-template-areas: "version-area" "play-pause-area" "menu-area" "song-settings-area" "instrument-settings-area";\n\tgrid-column-gap: 6px;\n}\n\n.beepboxEditor .version-area{ grid-area: version-area; }\n.beepboxEditor .play-pause-area{ grid-area: play-pause-area; }\n.beepboxEditor .menu-area{ grid-area: menu-area; }\n.beepboxEditor .song-settings-area{ grid-area: song-settings-area; }\n.beepboxEditor .instrument-settings-area{ grid-area: instrument-settings-area; }\n\n.beepboxEditor .tip {\n\tcursor: help;\n}\n\n.beepboxEditor .tip:hover {\n\tcolor: ${t.ColorConfig.linkAccent};\n\ttext-decoration: underline;\n}\n.beepboxEditor .tip:active {\n\tcolor: ${t.ColorConfig.primaryText};\n}\n\n.beepboxEditor .volume-speaker {\n\tflex-shrink: 0;\n\twidth: 2em;\n\theight: 2em;\n\tbackground: ${t.ColorConfig.secondaryText};\n\t-webkit-mask-image: var(--volume-symbol);\n\t-webkit-mask-repeat: no-repeat;\n\t-webkit-mask-position: center;\n\tmask-image: var(--volume-symbol);\n\tmask-repeat: no-repeat;\n\tmask-position: center;\n}\n\n.beepboxEditor .drum-button {\n\tflex: 1;\n\tbackground-color: transparent;\n\tbackground-image: var(--drum-symbol);\n\tbackground-repeat: no-repeat;\n\tbackground-position: center;\n}\n\n.beepboxEditor .piano-button {\n\tflex: 1;\n\tposition: relative;\n\tdisplay: flex;\n\talign-items: center;\n}\n.beepboxEditor .piano-button::before {\n\tcontent: "";\n\tposition: absolute;\n\tleft: 0;\n\ttop: 0;\n\twidth: 100%;\n\theight: 100%;\n\tpointer-events: none;\n\tbackground-image: var(--piano-key-symbol);\n\tbackground-repeat: no-repeat;\n\tbackground-position: center;\n\tbackground-size: 100% 115.38%;\n}\n.beepboxEditor .piano-button.disabled::after {\n\tcontent: "";\n\tposition: absolute;\n\tright: 0;\n\ttop: 0;\n\twidth: 70%;\n\theight: 100%;\n\tpointer-events: none;\n\tbackground: ${t.ColorConfig.editorBackground};\n\t-webkit-mask-image: linear-gradient(90deg, transparent 0%, gray 70%, gray 100%);\n\t-webkit-mask-repeat: no-repeat;\n\t-webkit-mask-position: center;\n\tmask-image: linear-gradient(90deg, transparent 0%, gray 70%, gray 100%);\n\tmask-repeat: no-repeat;\n\tmask-position: center;\n}\n\n.beepboxEditor .customize-instrument {\n\tmargin: 2px 0;\n}\n.beepboxEditor .customize-instrument::before {\n\tcontent: "";\n\tflex-shrink: 0;\n\tposition: absolute;\n\tleft: 0;\n\ttop: 50%;\n\tmargin-top: -1em;\n\tpointer-events: none;\n\twidth: 2em;\n\theight: 2em;\n\tbackground: currentColor;\n\t-webkit-mask-image: var(--customize-dial-symbol);\n\t-webkit-mask-repeat: no-repeat;\n\t-webkit-mask-position: center;\n\tmask-image: var(--customize-dial-symbol);\n\tmask-repeat: no-repeat;\n\tmask-position: center;\n}\n\n.beepboxEditor .menu.file::before {\n\tcontent: "";\n\tflex-shrink: 0;\n\tposition: absolute;\n\tleft: 0;\n\ttop: 50%;\n\tmargin-top: -1em;\n\tpointer-events: none;\n\twidth: 2em;\n\theight: 2em;\n\tbackground: currentColor;\n\t-webkit-mask-image: var(--file-page-symbol);\n\t-webkit-mask-repeat: no-repeat;\n\t-webkit-mask-position: center;\n\tmask-image: var(--file-page-symbol);\n\tmask-repeat: no-repeat;\n\tmask-position: center;\n}\n\n.beepboxEditor .menu.edit::before {\n\tcontent: "";\n\tflex-shrink: 0;\n\tposition: absolute;\n\tleft: 0;\n\ttop: 50%;\n\tmargin-top: -1em;\n\tpointer-events: none;\n\twidth: 2em;\n\theight: 2em;\n\tbackground: currentColor;\n\t-webkit-mask-image: var(--edit-pencil-symbol);\n\t-webkit-mask-repeat: no-repeat;\n\t-webkit-mask-position: center;\n\tmask-image: var(--edit-pencil-symbol);\n\tmask-repeat: no-repeat;\n\tmask-position: center;\n}\n\n.beepboxEditor .menu.preferences::before {\n\tcontent: "";\n\tflex-shrink: 0;\n\tposition: absolute;\n\tleft: 0;\n\ttop: 50%;\n\tmargin-top: -1em;\n\tpointer-events: none;\n\twidth: 2em;\n\theight: 2em;\n\tbackground: currentColor;\n\t-webkit-mask-image: var(--preferences-gear-symbol);\n\t-webkit-mask-repeat: no-repeat;\n\t-webkit-mask-position: center;\n\tmask-image: var(--preferences-gear-symbol);\n\tmask-repeat: no-repeat;\n\tmask-position: center;\n}\n\n.beepboxEditor .mute-button::before {\n\tcontent: "";\n\tpointer-events: none;\n\twidth: 100%;\n\theight: 100%;\n\tbackground: ${t.ColorConfig.primaryText};\n\tdisplay: inline-block;\n\t-webkit-mask-image: var(--unmuted-symbol);\n\t-webkit-mask-repeat: no-repeat;\n\t-webkit-mask-position: center;\n\t-webkit-mask-size: contain;\n\tmask-image: var(--unmuted-symbol);\n\tmask-repeat: no-repeat;\n\tmask-position: center;\n\tmask-size: contain;\n}\n\n.beepboxEditor .mute-button.muted::before {\n\tbackground: ${t.ColorConfig.editorBackground};\n\t-webkit-mask-image: var(--muted-symbol);\n\tmask-image: var(--muted-symbol);\n}\n\n.beepboxEditor .promptContainer {\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\twidth: 100%;\n\theight: 100%;\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n}\n\n.beepboxEditor .promptContainer::before {\n\tcontent: "";\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\twidth: 100%;\n\theight: 100%;\n\tbackground: ${t.ColorConfig.editorBackground};\n\topacity: 0.5;\n\tdisplay: flex;\n}\n\n.beepboxEditor .prompt {\n\tmargin: auto;\n\ttext-align: center;\n\tbackground: ${t.ColorConfig.editorBackground};\n\tborder-radius: 15px;\n\tborder: 4px solid ${t.ColorConfig.uiWidgetBackground};\n\tcolor: ${t.ColorConfig.primaryText};\n\tpadding: 20px;\n\tdisplay: flex;\n\tflex-direction: column;\n\tposition: relative;\n\tbox-shadow: 5px 5px 20px 10px rgba(0,0,0,0.5);\n}\n\n.beepboxEditor .prompt > *:not(:first-child):not(.cancelButton) {\n\tmargin-top: 1.5em;\n}\n\n.beepboxEditor .prompt h2 {\n\tfont-size: 2em;\n\tmargin: 0 16px;\n\tfont-weight: normal;\n}\n\n.beepboxEditor .prompt p {\n\ttext-align: left;\n\tmargin: 1em 0;\n}\n\n.beepboxEditor .selectContainer {\n\tposition: relative;\n}\n.beepboxEditor .selectContainer:not(.menu)::after {\n\tcontent: "";\n\tflex-shrink: 0;\n\tposition: absolute;\n\tright: 0;\n\ttop: 50%;\n\tmargin-top: -1em;\n\tpointer-events: none;\n\twidth: 1.1em;\n\theight: 2em;\n\tbackground: currentColor;\n\t-webkit-mask-image: var(--select-arrows-symbol);\n\t-webkit-mask-repeat: no-repeat;\n\t-webkit-mask-position: center;\n\tmask-image: var(--select-arrows-symbol);\n\tmask-repeat: no-repeat;\n\tmask-position: center;\n}\n.beepboxEditor .selectContainer.menu::after {\n\tcontent: "";\n\tflex-shrink: 0;\n\tposition: absolute;\n\tright: 0;\n\ttop: 50%;\n\tmargin-top: -1em;\n\tpointer-events: none;\n\twidth: 2em;\n\theight: 2em;\n\tbackground: currentColor;\n\t-webkit-mask-image: var(--menu-down-symbol);\n\t-webkit-mask-repeat: no-repeat;\n\t-webkit-mask-position: center;\n\tmask-image: var(--menu-down-symbol);\n\tmask-repeat: no-repeat;\n\tmask-position: center;\n}\n.beepboxEditor select {\n\tmargin: 0;\n\tpadding: 0 0.3em;\n\tdisplay: block;\n\theight: 2em;\n\tborder: none;\n\tborder-radius: 0.4em;\n\tbackground: ${t.ColorConfig.uiWidgetBackground};\n\tcolor: inherit;\n\tfont-size: inherit;\n\tcursor: pointer;\n\tfont-family: inherit;\n\tfont-weight: inherit;\n\n\t-webkit-appearance:none;\n\t-moz-appearance: none;\n\tappearance: none;\n}\n.beepboxEditor .menu select {\n\tpadding: 0 2em;\n}\n.beepboxEditor select:focus {\n\tbackground: ${t.ColorConfig.uiWidgetFocus};\n\toutline: none;\n}\n.beepboxEditor .menu select {\n\ttext-align: center;\n\ttext-align-last: center;\n}\n.beepboxEditor .settings-area select {\n       width: 100%;\n}\n\n/* This makes it look better in firefox on my computer... What about others?\n@-moz-document url-prefix() {\n\t.beepboxEditor select { padding: 0 2px; }\n}\n*/\n.beepboxEditor button {\n\tmargin: 0;\n\tposition: relative;\n\theight: 2em;\n\tborder: none;\n\tborder-radius: 0.4em;\n\tbackground: ${t.ColorConfig.uiWidgetBackground};\n\tcolor: inherit;\n\tfont-size: inherit;\n\tfont-family: inherit;\n\tfont-weight: inherit;\n\tcursor: pointer;\n}\n.beepboxEditor button:focus {\n\tbackground: ${t.ColorConfig.uiWidgetFocus};\n\toutline: none;\n}\n\n.beepboxEditor button.cancelButton {\n\tfloat: right;\n\twidth: 2em;\n\tposition: absolute;\n\ttop: 8px;\n\tright: 8px;\n}\n\n.beepboxEditor button.playButton, .beepboxEditor button.pauseButton, .beepboxEditor button.okayButton, .beepboxEditor button.exportButton {\n\tpadding-left: 2em;\n}\n.beepboxEditor button.playButton::before {\n\tcontent: "";\n\tflex-shrink: 0;\n\tposition: absolute;\n\tleft: 0;\n\ttop: 50%;\n\tmargin-top: -1em;\n\tpointer-events: none;\n\twidth: 2em;\n\theight: 2em;\n\tbackground: currentColor;\n\t-webkit-mask-image: var(--play-symbol);\n\t-webkit-mask-repeat: no-repeat;\n\t-webkit-mask-position: center;\n\tmask-image: var(--play-symbol);\n\tmask-repeat: no-repeat;\n\tmask-position: center;\n}\n.beepboxEditor button.pauseButton::before {\n\tcontent: "";\n\tflex-shrink: 0;\n\tposition: absolute;\n\tleft: 0;\n\ttop: 50%;\n\tmargin-top: -1em;\n\tpointer-events: none;\n\twidth: 2em;\n\theight: 2em;\n\tbackground: currentColor;\n\t-webkit-mask-image: var(--pause-symbol);\n\t-webkit-mask-repeat: no-repeat;\n\t-webkit-mask-position: center;\n\tmask-image: var(--pause-symbol);\n\tmask-repeat: no-repeat;\n\tmask-position: center;\n}\n\n.beepboxEditor button.prevBarButton::before {\n\tcontent: "";\n\tflex-shrink: 0;\n\tposition: absolute;\n\tleft: 50%;\n\ttop: 50%;\n\tmargin-left: -1em;\n\tmargin-top: -1em;\n\tpointer-events: none;\n\twidth: 2em;\n\theight: 2em;\n\tbackground: currentColor;\n\t-webkit-mask-image: var(--prev-bar-symbol);\n\t-webkit-mask-repeat: no-repeat;\n\t-webkit-mask-position: center;\n\tmask-image: var(--prev-bar-symbol);\n\tmask-repeat: no-repeat;\n\tmask-position: center;\n}\n\n.beepboxEditor button.nextBarButton::before {\n\tcontent: "";\n\tflex-shrink: 0;\n\tposition: absolute;\n\tleft: 50%;\n\ttop: 50%;\n\tmargin-left: -1em;\n\tmargin-top: -1em;\n\tpointer-events: none;\n\twidth: 2em;\n\theight: 2em;\n\tbackground: currentColor;\n\t-webkit-mask-image: var(--next-bar-symbol);\n\t-webkit-mask-repeat: no-repeat;\n\t-webkit-mask-position: center;\n\tmask-image: var(--next-bar-symbol);\n\tmask-repeat: no-repeat;\n\tmask-position: center;\n}\n\n.beepboxEditor button.cancelButton::before {\n\tcontent: "";\n\tposition: absolute;\n\twidth: 2em;\n\theight: 2em;\n\tleft: 0;\n\ttop: 0;\n\tpointer-events: none;\n\tbackground: currentColor;\n\tmask-image: var(--close-symbol);\n\tmask-repeat: no-repeat;\n\tmask-position: center;\n\t-webkit-mask-image: var(--close-symbol);\n\t-webkit-mask-repeat: no-repeat;\n\t-webkit-mask-position: center;\n}\n\n.beepboxEditor button.okayButton::before {\n\tcontent: "";\n\tposition: absolute;\n\twidth: 2em;\n\theight: 2em;\n\tleft: 0;\n\ttop: 0;\n\tpointer-events: none;\n\tbackground: currentColor;\n\t-webkit-mask-image: var(--checkmark-symbol);\n\t-webkit-mask-repeat: no-repeat;\n\t-webkit-mask-position: center;\n\tmask-image: var(--checkmark-symbol);\n\tmask-repeat: no-repeat;\n\tmask-position: center;\n}\n\n.beepboxEditor button.exportButton::before {\n\tcontent: "";\n\tposition: absolute;\n\twidth: 2em;\n\theight: 2em;\n\tleft: 0;\n\ttop: 0;\n\tpointer-events: none;\n\tbackground: currentColor;\n\tmask-image: var(--export-symbol);\n\tmask-repeat: no-repeat;\n\tmask-position: center;\n\t-webkit-mask-image: var(--export-symbol);\n\t-webkit-mask-repeat: no-repeat;\n\t-webkit-mask-position: center;\n}\n\n.beepboxEditor canvas {\n\toverflow: hidden;\n\tposition: absolute;\n\tdisplay: block;\n}\n\n.beepboxEditor .trackContainer {\n\toverflow-x: hidden;\n\tflex-grow: 1;\n}\n\n.beepboxEditor .trackAndMuteContainer {\n\tdisplay: flex;\n\talign-items: flex-start;\n}\n\n.beepboxEditor .muteEditor {\n\theight: 128px;\n\twidth: 32px;\n\tflex-shrink: 0;\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: stretch;\n}\n\n.beepboxEditor .selectRow {\n\tmargin: 2px 0;\n\theight: 2em;\n\tdisplay: flex;\n\tflex-direction: row;\n\talign-items: center;\n\tjustify-content: space-between;\n}\n\n.beepboxEditor .tip {\n\tcolor: ${t.ColorConfig.secondaryText};\n}\n\n.beepboxEditor .selectRow > :nth-child(2) {\n\twidth: 61.5%;\n}\n\n.beepboxEditor .operatorRow {\n\tmargin: 2px 0;\n\theight: 2em;\n\tdisplay: flex;\n\tflex-direction: row;\n\talign-items: center;\n}\n\n.beepboxEditor .operatorRow > * {\n\tflex-grow: 1;\n\tflex-shrink: 1;\n}\n\n.beepboxEditor .menu-area {\n\tdisplay: flex;\n\tflex-direction: column;\n}\n.beepboxEditor .menu-area > * {\n\tmargin: 2px 0;\n}\n.beepboxEditor .menu-area > button {\n\tpadding: 0 2em;\n\twhite-space: nowrap;\n}\n\n.beepboxEditor .song-settings-area {\n\tdisplay: flex;\n\tflex-direction: column;\n}\n\n.beepboxEditor .editor-controls {\n\tflex-shrink: 0;\n\tdisplay: flex;\n\tflex-direction: column;\n}\n\n.beepboxEditor .instrument-settings-area {\n\tdisplay: flex;\n\tflex-direction: column;\n}\n\n.beepboxEditor .editor-right-side-top > *, .beepboxEditor .editor-right-side-bottom > * {\n\tflex-shrink: 0;\n}\n\n.beepboxEditor input[type=text], .beepboxEditor input[type=number] {\n\tfont-size: inherit;\n\tfont-weight: inherit;\n\tfont-family: inherit;\n\tbackground: transparent;\n\tborder: 1px solid ${t.ColorConfig.uiWidgetFocus};\n\tcolor: ${t.ColorConfig.primaryText};\n}\n\n.beepboxEditor input[type=text]::selection, .beepboxEditor input[type=number]::selection {\n\tbackground-color: ${t.ColorConfig.textSelection};\n\tcolor: ${t.ColorConfig.primaryText};\n}\n\n.beepboxEditor input[type=checkbox] {\n  transform: scale(1.5);\n}\n\n.beepboxEditor input[type=range] {\n\t-webkit-appearance: none;\n\tcolor: inherit;\n\twidth: 100%;\n\theight: 2em;\n\tfont-size: inherit;\n\tmargin: 0;\n\tcursor: pointer;\n\tbackground-color: ${t.ColorConfig.editorBackground};\n\ttouch-action: pan-y;\n}\n.beepboxEditor input[type=range]:focus {\n\toutline: none;\n}\n.beepboxEditor input[type=range]::-webkit-slider-runnable-track {\n\twidth: 100%;\n\theight: 0.5em;\n\tcursor: pointer;\n\tbackground: ${t.ColorConfig.uiWidgetBackground};\n}\n.beepboxEditor input[type=range]::-webkit-slider-thumb {\n\theight: 2em;\n\twidth: 0.5em;\n\tborder-radius: 0.25em;\n\tbackground: currentColor;\n\tcursor: pointer;\n\t-webkit-appearance: none;\n\tmargin-top: -0.75em;\n}\n.beepboxEditor input[type=range]:focus::-webkit-slider-runnable-track {\n\tbackground: ${t.ColorConfig.uiWidgetFocus};\n}\n.beepboxEditor input[type=range]::-moz-range-track {\n\twidth: 100%;\n\theight: 0.5em;\n\tcursor: pointer;\n\tbackground: ${t.ColorConfig.uiWidgetBackground};\n}\n.beepboxEditor input[type=range]:focus::-moz-range-track {\n\tbackground: ${t.ColorConfig.uiWidgetFocus};\n}\n.beepboxEditor input[type=range]::-moz-range-thumb {\n\theight: 2em;\n\twidth: 0.5em;\n\tborder-radius: 0.25em;\n\tborder: none;\n\tbackground: currentColor;\n\tcursor: pointer;\n}\n.beepboxEditor input[type=range]::-ms-track {\n\twidth: 100%;\n\theight: 0.5em;\n\tcursor: pointer;\n\tbackground: ${t.ColorConfig.uiWidgetBackground};\n\tborder-color: transparent;\n}\n.beepboxEditor input[type=range]:focus::-ms-track {\n\tbackground: ${t.ColorConfig.uiWidgetFocus};\n}\n.beepboxEditor input[type=range]::-ms-thumb {\n\theight: 2em;\n\twidth: 0.5em;\n\tborder-radius: 0.25em;\n\tbackground: currentColor;\n\tcursor: pointer;\n}\n.beepboxEditor .hintButton {\n\tborder: 1px solid currentColor;\n\tborder-radius: 50%;\n\ttext-decoration: none;\n\twidth: 1em;\n\theight: 1em;\n\ttext-align: center;\n\tmargin-left: auto;\n\tmargin-right: .4em;\n\tcursor: pointer;\n}\n\n/* wide screen */\n@media (min-width: 701px) {\n\t#beepboxEditorContainer {\n\t\tdisplay: table;\n\t}\n\t.beepboxEditor {\n\t\tflex-direction: row;\n\t}\n\t.beepboxEditor:focus-within {\n\t\toutline: 3px solid ${t.ColorConfig.uiWidgetBackground};\n\t}\n\t.beepboxEditor .trackAndMuteContainer {\n\t\twidth: 512px;\n\t}\n\t.beepboxEditor .play-pause-area {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t}\n\t.beepboxEditor .playback-bar-controls {\n\t\tdisplay: flex;\n\t\tflex-direction: row;\n\t\tmargin: 2px 0;\n\t}\n\t.beepboxEditor .playback-volume-controls {\n\t\tdisplay: flex;\n\t\tflex-direction: row;\n\t\tmargin: 2px 0;\n\t\talign-items: center;\n\t}\n\t.beepboxEditor .pauseButton, .beepboxEditor .playButton {\n\t\tflex-grow: 1;\n\t}\n\t.beepboxEditor .nextBarButton, .beepboxEditor .prevBarButton {\n\t\tflex-grow: 1;\n\t\tmargin-left: 10px;\n\t}\n\t.beepboxEditor .settings-area {\n\t\twidth: 14em;\n\t}\n}\n\n/* narrow screen */\n@media (max-width: 700px) {\n\t.beepboxEditor {\n\t\tgrid-template-columns: minmax(0, 1fr);\n\t\tgrid-template-rows: min-content 6px min-content min-content;\n\t\tgrid-template-areas: "pattern-area" "." "track-area" "settings-area";\n\t\tgrid-row-gap: 0;\n\t}\n\t.beepboxEditor .settings-area {\n\t\tgrid-template-columns: minmax(0, 1fr) minmax(0, 1fr);\n\t\tgrid-template-rows: min-content min-content 1fr min-content;\n\t\tgrid-template-areas:\n\t\t\t"play-pause-area play-pause-area"\n\t\t\t"menu-area instrument-settings-area"\n\t\t\t"song-settings-area instrument-settings-area"\n\t\t\t"version-area version-area";\n\t\tgrid-column-gap: 8px;\n\t\tmargin: 0 4px;\n\t}\n\t.beepboxEditor:focus-within {\n\t\toutline: none;\n\t}\n\t.beepboxEditor .pattern-area {\n\t\tmax-height: 75vh;\n\t}\n\t.beepboxEditor .trackContainer {\n\t\toverflow-x: auto;\n\t}\n\t.beepboxEditor .barScrollBar {\n\t\tdisplay: none;\n\t}\n\t.beepboxEditor .play-pause-area {\n\t\tdisplay: flex;\n\t\tflex-direction: row;\n\t\tmargin: 2px 0;\n\t}\n\t.beepboxEditor .playback-bar-controls {\n\t\tdisplay: flex;\n\t\tflex-direction: row;\n\t\tflex-grow: 1;\n\t}\n\t.beepboxEditor .playback-volume-controls {\n\t\tdisplay: flex;\n\t\tflex-direction: row;\n\t\talign-items: center;\n\t\tflex-grow: 1;\n\t\tmargin: 0 2px;\n\t}\n\t.beepboxEditor .pauseButton, .beepboxEditor .playButton,\n\t.beepboxEditor .nextBarButton, .beepboxEditor .prevBarButton {\n\t\tflex-grow: 1;\n\t\tmargin: 0 2px;\n\t}\n}\n\n`))}(beepbox||(beepbox={})),function(t){class e{static setFullScreen(t){this.t.textContent=t?this.i:this.s}}e.s="\n\t\t",e.i=`\n\t\t\t/* wide screen */\n\t\t\t@media (min-width: 701px) {\n\t\t\t\t#beepboxEditorContainer {\n\t\t\t\t\tmax-width: initial;\n\t\t\t\t\theight: 100vh;\n\t\t\t\t}\n\t\t\t\t.beepboxEditor {\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\tmin-height: 100vh;\n\t\t\t\t\tgrid-template-columns: minmax(0, 1fr) 30em; /* minmax(0, 1fr) min-content; Chrome 80 grid layout regression. https://bugs.chromium.org/p/chromium/issues/detail?id=1050307 */\n\t\t\t\t\tgrid-template-rows: minmax(481px, 1fr) min-content;\n\t\t\t\t\tgrid-template-areas: "pattern-area settings-area" "track-area track-area";\n\t\t\t\t}\n\t\t\t\t.beepboxEditor .pattern-area {\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\theight: 100%;\n\t\t\t\t}\n\t\t\t\t.beepboxEditor .track-area {\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\toverflow-y: auto;\n\t\t\t\t}\n\t\t\t\t.beepboxEditor .editor-widget-column {\n\t\t\t\t\tflex: 0;\n\t\t\t\t}\n\t\t\t\t.beepboxEditor .trackAndMuteContainer {\n\t\t\t\t\twidth: 100%;\n\t\t\t\t}\n\t\t\t\t.beepboxEditor .instrument-settings-area {\n\t\t\t\t\toverflow-y: auto;\n\t\t\t\t\tposition: relative;\n\t\t\t\t}\n\t\t\t\t.beepboxEditor .instrument-settings-area > .editor-controls {\n\t\t\t\t\tposition: absolute;\n\t\t\t\t\twidth: 100%;\n\t\t\t\t}\n\t\t\t\t.beepboxEditor .song-settings-area {\n\t\t\t\t\toverflow-y: auto;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.beepboxEditor .settings-area {\n\t\t\t\t\twidth: 30em;\n\t\t\t\t\tgrid-template-columns: minmax(0, 1fr) minmax(0, 1fr);\n\t\t\t\t\tgrid-template-rows: auto auto auto minmax(0, 1fr);\n\t\t\t\t\tgrid-template-areas:\n\t\t\t\t\t\t"instrument-settings-area version-area"\n\t\t\t\t\t\t"instrument-settings-area play-pause-area"\n\t\t\t\t\t\t"instrument-settings-area menu-area"\n\t\t\t\t\t\t"instrument-settings-area song-settings-area";\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.beepboxEditor .barScrollBar {\n\t\t\t\t\tdisplay: none;\n\t\t\t\t}\n\t\t\t\t.beepboxEditor .trackContainer {\n\t\t\t\t\toverflow-x: auto;\n\t\t\t\t\tscrollbar-width: auto;\n\t\t\t\t\tscrollbar-color: ${t.ColorConfig.uiWidgetBackground} ${t.ColorConfig.editorBackground};\n\t\t\t\t}\n\t\t\t\t.beepboxEditor .trackContainer::-webkit-scrollbar {\n\t\t\t\t\twidth: 20px;\n\t\t\t\t\theight: 20px;\n\t\t\t\t}\n\t\t\t\t.beepboxEditor .trackContainer::-webkit-scrollbar-track {\n\t\t\t\t\tbackground: ${t.ColorConfig.editorBackground};\n\t\t\t\t}\n\t\t\t\t.beepboxEditor .trackContainer::-webkit-scrollbar-thumb {\n\t\t\t\t\tbackground-color: ${t.ColorConfig.uiWidgetBackground};\n\t\t\t\t\tborder: 3px solid ${t.ColorConfig.editorBackground};\n\t\t\t\t}\n\t\t\t}\n\t\t`,e.t=document.head.appendChild(t.HTML.style({type:"text/css"})),t.Layout=e}(beepbox||(beepbox={})),function(t){function e(t){if(!function(t){return!(!t||t&t-1)}(t))throw new Error("FFT array length must be a power of 2.");return Math.round(Math.log(t)/Math.log(2))}t.scaleElementsByFactor=function(t,e){for(let i=0;i<t.length;i++)t[i]*=e},t.inverseRealFourierTransform=function(t,i){const s=e(i);if(i<4)throw new Error("FFT array length must be at least 4.");for(let e=s-1;e>=2;e--){const s=1<<e,n=s>>1,o=s<<1,r=2*Math.PI/o,h=Math.cos(r),a=Math.sin(r),l=2*h;for(let e=0;e<i;e+=o){const i=e,o=i+n,r=i+s,c=r+n,f=r+s,d=t[i],u=t[r];t[i]=d+u,t[o]*=2,t[r]=d-u,t[c]*=2;let m=h,p=-a,y=1,g=0;for(let e=1;e<n;e++){const s=i+e,n=r-e,o=r+e,h=f-e,a=t[s],c=t[n],d=t[o],u=t[h],b=a-c,v=d+u;t[s]=a+c,t[n]=u-d,t[o]=b*m-v*p,t[h]=v*m+b*p;const w=l*m-y,k=l*p-g;y=m,g=p,m=w,p=k}}}for(let e=0;e<i;e+=4){const i=e+1,s=e+2,n=e+3,o=t[e],r=2*t[i],h=t[s],a=2*t[n],l=o+h,c=o-h;t[e]=l+r,t[i]=l-r,t[s]=c+a,t[n]=c-a}!function(t,i){const s=e(i);if(s>16)throw new Error("FFT array length must not be greater than 2^16.");const n=16-s;for(let e=0;e<i;e++){let i;if((i=((i=(61680&(i=(52428&(i=(43690&e)>>1|(21845&e)<<1))>>2|(13107&i)<<2))>>4|(3855&i)<<4)>>8|(255&i)<<8)>>n)>e){let s=t[e];t[e]=t[i],t[i]=s}}}(t,i)}}(beepbox||(beepbox={})),function(t){t.Deque=class{constructor(){this.o=1,this.h=[void 0],this.l=0,this.u=0,this.m=0}pushFront(t){this.m>=this.o&&this.v(),this.u=this.u-1&this.l,this.h[this.u]=t,this.m++}pushBack(t){this.m>=this.o&&this.v(),this.h[this.u+this.m&this.l]=t,this.m++}popFront(){if(this.m<=0)throw new Error("No elements left to pop.");const t=this.h[this.u];return this.h[this.u]=void 0,this.u=this.u+1&this.l,this.m--,t}popBack(){if(this.m<=0)throw new Error("No elements left to pop.");this.m--;const t=this.u+this.m&this.l,e=this.h[t];return this.h[t]=void 0,e}peakFront(){if(this.m<=0)throw new Error("No elements left to pop.");return this.h[this.u]}peakBack(){if(this.m<=0)throw new Error("No elements left to pop.");return this.h[this.u+this.m-1&this.l]}count(){return this.m}set(t,e){if(t<0||t>=this.m)throw new Error("Invalid index");this.h[this.u+t&this.l]=e}get(t){if(t<0||t>=this.m)throw new Error("Invalid index");return this.h[this.u+t&this.l]}remove(t){if(t<0||t>=this.m)throw new Error("Invalid index");if(t<=this.m>>1){for(;t>0;)this.set(t,this.get(t-1)),t--;this.popFront()}else{for(t++;t<this.m;)this.set(t-1,this.get(t)),t++;this.popBack()}}v(){if(this.o>=1073741824)throw new Error("Capacity too big.");this.o=this.o<<1;const t=this.h,e=new Array(this.o),i=0|this.m,s=0|this.u;for(let n=0;n<i;n++)e[n]=t[s+n&this.l];for(let t=i;t<this.o;t++)e[t]=void 0;this.u=0,this.h=e,this.l=this.o-1}}}(beepbox||(beepbox={})),function(t){const e=[48,49,50,51,52,53,54,55,56,57,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,45,95],i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,62,62,0,0,1,2,3,4,5,6,7,8,9,0,0,0,0,0,0,0,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,0,0,0,0,63,0,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,0,0,0,0,0];class s{constructor(t,e,s){this.k=[],this.M=0;for(let n=e;n<s;n++){const e=i[t.charCodeAt(n)];this.k.push(e>>5&1),this.k.push(e>>4&1),this.k.push(e>>3&1),this.k.push(e>>2&1),this.k.push(e>>1&1),this.k.push(1&e)}}read(t){let e=0;for(;t>0;)e<<=1,e+=this.k[this.M++],t--;return e}readLongTail(t,e){let i=t,s=e;for(;this.k[this.M++];)i+=1<<s,s++;for(;s>0;)s--,this.k[this.M++]&&(i+=1<<s);return i}readPartDuration(){return this.readLongTail(1,3)}readLegacyPartDuration(){return this.readLongTail(1,2)}readPinCount(){return this.readLongTail(1,0)}readPitchInterval(){return this.read(1)?-this.readLongTail(1,3):this.readLongTail(1,3)}}class n{constructor(){this.q=0,this.k=[]}clear(){this.q=0}write(t,e){for(t--;t>=0;)this.k[this.q++]=e>>>t&1,t--}writeLongTail(t,e,i){if(i<t)throw new Error("value out of bounds");i-=t;let s=e;for(;i>=1<<s;)this.k[this.q++]=1,i-=1<<s,s++;for(this.k[this.q++]=0;s>0;)s--,this.k[this.q++]=i>>>s&1}writePartDuration(t){this.writeLongTail(1,3,t)}writePinCount(t){this.writeLongTail(1,0,t)}writePitchInterval(t){t<0?(this.write(1,1),this.writeLongTail(1,3,-t)):(this.write(1,0),this.writeLongTail(1,3,t))}concat(t){for(let e=0;e<t.q;e++)this.k[this.q++]=t.k[e]}encodeBase64(t){for(let i=0;i<this.q;i+=6){const s=this.k[i]<<5|this.k[i+1]<<4|this.k[i+2]<<3|this.k[i+3]<<2|this.k[i+4]<<1|this.k[i+5];t.push(e[s])}return t}lengthBase64(){return Math.ceil(this.q/6)}}function o(t,e,i){return{interval:t,time:e,volume:i}}function r(t,e,i){return i<=(e-=1)?i>=t?i:t:e}function h(t,e,i){if(t<=i&&i<=e)return i;throw new Error(`Value ${i} not in range [${t}, ${e}]`)}t.makeNotePin=o;class a{constructor(t,e,i,s,n=!1){this.pitches=[t],this.pins=[o(0,0,s),o(0,i-e,n?0:s)],this.start=e,this.end=i}pickMainInterval(){let t=0,e=0;for(let i=1;i<this.pins.length;i++){const s=this.pins[i-1],n=this.pins[i];if(s.interval==n.interval){const i=n.time-s.time;t<i&&(t=i,e=s.interval)}}if(0==t){let t=0;for(let i=0;i<this.pins.length;i++){const s=this.pins[i];t<s.volume&&(t=s.volume,e=s.interval)}}return e}}t.Note=a;class l{constructor(){this.notes=[],this.instrument=0}cloneNotes(){const t=[];for(const e of this.notes){const i=new a(-1,e.start,e.end,3);i.pitches=e.pitches.concat(),i.pins=[];for(const t of e.pins)i.pins.push(o(t.interval,t.time,t.volume));t.push(i)}return t}reset(){this.notes.length=0,this.instrument=0}}t.Pattern=l;class c{constructor(t){this.frequency=0,this.amplitude=0,this.envelope=0,this.reset(t)}reset(e){this.frequency=0,this.amplitude=e<=1?t.Config.operatorAmplitudeMax:0,this.envelope=0==e?0:1}}t.Operator=c;class f{constructor(t){this.spectrum=[],this.P=null,this.S=!1,this.reset(t)}reset(e){for(let i=0;i<t.Config.spectrumControlPoints;i++)if(e)this.spectrum[i]=Math.round(t.Config.spectrumMax*(1/Math.sqrt(1+i/3)));else{const e=0==i||7==i||11==i||14==i||16==i||18==i||21==i||23==i||i>=25;this.spectrum[i]=e?Math.max(0,Math.round(t.Config.spectrumMax*(1-i/30))):0}this.S=!1}markCustomWaveDirty(){this.S=!1}getCustomWave(e){if(!this.S||null==this.P){let s=t.Config.chipNoiseLength;null!=this.P&&this.P.length==s+1||(this.P=new Float32Array(s+1));const n=this.P;for(let t=0;t<s;t++)n[t]=0;const o=14,r=.25,h=[0,1/7,Math.log(5/4)/Math.LN2,3/7,Math.log(1.5)/Math.LN2,5/7,6/7];function i(i){return e+Math.floor(i/t.Config.spectrumControlPointsPerOctave)+h[(i+t.Config.spectrumControlPointsPerOctave)%t.Config.spectrumControlPointsPerOctave]}let a=1;for(let e=0;e<t.Config.spectrumControlPoints+1;e++){const s=e<=0?0:this.spectrum[e-1],h=e>=t.Config.spectrumControlPoints?this.spectrum[t.Config.spectrumControlPoints-1]:this.spectrum[e],l=i(e-1);let c=i(e);e>=t.Config.spectrumControlPoints&&(c=o+(c-o)*r),0==s&&0==h||(a+=.02*t.drawNoiseSpectrum(n,l,c,s/t.Config.spectrumMax,h/t.Config.spectrumMax,-.5))}this.spectrum[t.Config.spectrumControlPoints-1]>0&&(a+=.02*t.drawNoiseSpectrum(n,o+(i(t.Config.spectrumControlPoints)-o)*r,o,this.spectrum[t.Config.spectrumControlPoints-1]/t.Config.spectrumMax,0,-.5)),t.inverseRealFourierTransform(n,s),t.scaleElementsByFactor(n,5/(Math.sqrt(s)*Math.pow(a,.75))),n[s]=n[0],this.S=!0}return this.P}}t.SpectrumWave=f;class d{constructor(){this.harmonics=[],this.P=null,this.S=!1,this.reset()}reset(){for(let e=0;e<t.Config.harmonicsControlPoints;e++)this.harmonics[e]=0;this.harmonics[0]=t.Config.harmonicsMax,this.harmonics[3]=t.Config.harmonicsMax,this.harmonics[6]=t.Config.harmonicsMax,this.S=!1}markCustomWaveDirty(){this.S=!1}getCustomWave(){if(!this.S||null==this.P){let e=t.Config.harmonicsWavelength;const i=t.getDrumWave(0);null!=this.P&&this.P.length==e+1||(this.P=new Float32Array(e+1));const s=this.P;for(let t=0;t<e;t++)s[t]=0;const n=-.25;let o=1;for(let r=0;r<t.Config.harmonicsRendered;r++){const h=r+1;let a=r<t.Config.harmonicsControlPoints?this.harmonics[r]:this.harmonics[t.Config.harmonicsControlPoints-1];r>=t.Config.harmonicsControlPoints&&(a*=1-(r-t.Config.harmonicsControlPoints)/(t.Config.harmonicsRendered-t.Config.harmonicsControlPoints));const l=a/t.Config.harmonicsMax;let c=Math.pow(2,a-t.Config.harmonicsMax+1)*Math.sqrt(l);r<t.Config.harmonicsControlPoints&&(o+=c),c*=Math.pow(h,n),c*=i[r+589],s[e-h]=c}t.inverseRealFourierTransform(s,e);const r=1/Math.pow(o,.7);let h=0,a=0;for(let t=0;t<s.length;t++)h+=a,a=s[t]*r,s[t]=h;s[e]=s[0],this.S=!0}return this.P}}t.HarmonicsWave=d;class u{constructor(e){this.type=0,this.preset=0,this.chipWave=2,this.chipNoise=1,this.filterCutoff=6,this.filterResonance=0,this.filterEnvelope=1,this.transition=1,this.vibrato=0,this.interval=0,this.effects=0,this.chord=1,this.volume=0,this.pan=t.Config.panCenter,this.pulseWidth=t.Config.pulseWidthRange-1,this.pulseEnvelope=1,this.algorithm=0,this.feedbackType=0,this.feedbackAmplitude=0,this.feedbackEnvelope=1,this.operators=[],this.harmonicsWave=new d,this.drumsetEnvelopes=[],this.drumsetSpectrumWaves=[],this.spectrumWave=new f(e);for(let e=0;e<t.Config.operatorCount;e++)this.operators[e]=new c(e);for(let e=0;e<t.Config.drumCount;e++)this.drumsetEnvelopes[e]=t.Config.envelopes.dictionary["twang 2"].index,this.drumsetSpectrumWaves[e]=new f(!0)}setTypeAndReset(e,i){switch(this.type=e,this.preset=e,this.volume=0,this.pan=t.Config.panCenter,e){case 0:this.chipWave=2,this.filterCutoff=6,this.filterResonance=0,this.filterEnvelope=t.Config.envelopes.dictionary.steady.index,this.transition=1,this.vibrato=0,this.interval=0,this.effects=1,this.chord=2;break;case 1:this.transition=1,this.vibrato=0,this.effects=1,this.chord=3,this.filterCutoff=10,this.filterResonance=0,this.filterEnvelope=1,this.algorithm=0,this.feedbackType=0,this.feedbackAmplitude=0,this.feedbackEnvelope=t.Config.envelopes.dictionary.steady.index;for(let t=0;t<this.operators.length;t++)this.operators[t].reset(t);break;case 2:this.chipNoise=1,this.transition=1,this.effects=0,this.chord=2,this.filterCutoff=10,this.filterResonance=0,this.filterEnvelope=t.Config.envelopes.dictionary.steady.index;break;case 3:this.transition=1,this.effects=1,this.chord=0,this.filterCutoff=10,this.filterResonance=0,this.filterEnvelope=t.Config.envelopes.dictionary.steady.index,this.spectrumWave.reset(i);break;case 4:this.effects=0;for(let e=0;e<t.Config.drumCount;e++)this.drumsetEnvelopes[e]=t.Config.envelopes.dictionary["twang 2"].index,this.drumsetSpectrumWaves[e].reset(i);break;case 5:this.filterCutoff=10,this.filterResonance=0,this.filterEnvelope=t.Config.envelopes.dictionary.steady.index,this.transition=1,this.vibrato=0,this.interval=0,this.effects=1,this.chord=0,this.harmonicsWave.reset();break;case 6:this.filterCutoff=10,this.filterResonance=0,this.filterEnvelope=t.Config.envelopes.dictionary.steady.index,this.transition=1,this.vibrato=0,this.interval=0,this.effects=1,this.chord=2,this.pulseWidth=t.Config.pulseWidthRange-1,this.pulseEnvelope=t.Config.envelopes.dictionary["twang 2"].index;break;default:throw new Error("Unrecognized instrument type: "+e)}}toJsonObject(){const e={type:t.Config.instrumentTypeNames[this.type],volume:20*(5-this.volume),pan:100*(this.pan-t.Config.panCenter)/t.Config.panCenter,effects:t.Config.effectsNames[this.effects]};if(this.preset!=this.type&&(e.preset=this.preset),4!=this.type&&(e.transition=t.Config.transitions[this.transition].name,e.chord=this.getChord().name,e.filterCutoffHz=Math.round(t.Config.filterCutoffMaxHz*Math.pow(2,this.getFilterCutoffOctaves())),e.filterResonance=Math.round(100*this.filterResonance/(t.Config.filterResonanceRange-1)),e.filterEnvelope=this.getFilterEnvelope().name),2==this.type)e.wave=t.Config.chipNoises[this.chipNoise].name;else if(3==this.type){e.spectrum=[];for(let i=0;i<t.Config.spectrumControlPoints;i++)e.spectrum[i]=Math.round(100*this.spectrumWave.spectrum[i]/t.Config.spectrumMax)}else if(4==this.type){e.drums=[];for(let i=0;i<t.Config.drumCount;i++){const s=[];for(let e=0;e<t.Config.spectrumControlPoints;e++)s[e]=Math.round(100*this.drumsetSpectrumWaves[i].spectrum[e]/t.Config.spectrumMax);e.drums[i]={filterEnvelope:this.getDrumsetEnvelope(i).name,spectrum:s}}}else if(0==this.type)e.wave=t.Config.chipWaves[this.chipWave].name,e.interval=t.Config.intervals[this.interval].name,e.vibrato=t.Config.vibratos[this.vibrato].name;else if(6==this.type)e.pulseWidth=Math.round(50*Math.pow(.5,.5*(t.Config.pulseWidthRange-this.pulseWidth-1))*32)/32,e.pulseEnvelope=t.Config.envelopes[this.pulseEnvelope].name,e.vibrato=t.Config.vibratos[this.vibrato].name;else if(5==this.type){e.interval=t.Config.intervals[this.interval].name,e.vibrato=t.Config.vibratos[this.vibrato].name,e.harmonics=[];for(let i=0;i<t.Config.harmonicsControlPoints;i++)e.harmonics[i]=Math.round(100*this.harmonicsWave.harmonics[i]/t.Config.harmonicsMax)}else{if(1!=this.type)throw new Error("Unrecognized instrument type");{const i=[];for(const e of this.operators)i.push({frequency:t.Config.operatorFrequencies[e.frequency].name,amplitude:e.amplitude,envelope:t.Config.envelopes[e.envelope].name});e.vibrato=t.Config.vibratos[this.vibrato].name,e.algorithm=t.Config.algorithms[this.algorithm].name,e.feedbackType=t.Config.feedbacks[this.feedbackType].name,e.feedbackAmplitude=this.feedbackAmplitude,e.feedbackEnvelope=t.Config.envelopes[this.feedbackEnvelope].name,e.operators=i}}return e}fromJsonObject(e,i){void 0==e&&(e={});let s=t.Config.instrumentTypeNames.indexOf(e.type);-1==s&&(s=i?2:0),this.setTypeAndReset(s,i),void 0!=e.preset&&(this.preset=e.preset>>>0),void 0!=e.volume?this.volume=r(0,t.Config.volumeRange,Math.round(5-(0|e.volume)/20)):this.volume=0,void 0!=e.pan?this.pan=r(0,t.Config.panMax+1,Math.round(t.Config.panCenter+(0|e.pan)*t.Config.panCenter/100)):this.pan=t.Config.panCenter;const n={binary:0,sudden:1,smooth:2},o=e.transition||e.envelope;if(this.transition=void 0!=n[o]?n[o]:t.Config.transitions.findIndex(t=>t.name==o),-1==this.transition&&(this.transition=1),this.effects=t.Config.effectsNames.indexOf(e.effects),-1==this.effects&&(this.effects=2==this.type?0:1),void 0!=e.filterCutoffHz?this.filterCutoff=r(0,t.Config.filterCutoffRange,Math.round(t.Config.filterCutoffRange-1+2*Math.log((0|e.filterCutoffHz)/t.Config.filterCutoffMaxHz)/Math.LN2)):this.filterCutoff=0==this.type?6:10,void 0!=e.filterResonance?this.filterResonance=r(0,t.Config.filterResonanceRange,Math.round((t.Config.filterResonanceRange-1)*(0|e.filterResonance)/100)):this.filterResonance=0,this.filterEnvelope=t.Config.envelopes.findIndex(t=>t.name==e.filterEnvelope),-1==this.filterEnvelope&&(this.filterEnvelope=t.Config.envelopes.dictionary.steady.index),void 0!=e.filter){const t=[10,6,3,0,8,5,2],i=[1,1,1,1,18,19,20],s=["none","bright","medium","soft","decay bright","decay medium","decay soft"],n={"sustain sharp":1,"sustain medium":2,"sustain soft":3,"decay sharp":4};let o=void 0!=n[e.filter]?n[e.filter]:s.indexOf(e.filter);-1==o&&(o=0),this.filterCutoff=t[o],this.filterEnvelope=i[o],this.filterResonance=0}const h=["none","vibrato light","vibrato delayed","vibrato heavy"];if(2==this.type)this.chipNoise=t.Config.chipNoises.findIndex(t=>t.name==e.wave),-1==this.chipNoise&&(this.chipNoise=1),this.chord=t.Config.chords.findIndex(t=>t.name==e.chord),-1==this.chord&&(this.chord=2);else if(3==this.type){if(void 0!=e.spectrum)for(let i=0;i<t.Config.spectrumControlPoints;i++)this.spectrumWave.spectrum[i]=Math.max(0,Math.min(t.Config.spectrumMax,Math.round(t.Config.spectrumMax*+e.spectrum[i]/100)));this.chord=t.Config.chords.findIndex(t=>t.name==e.chord),-1==this.chord&&(this.chord=0)}else if(4==this.type){if(void 0!=e.drums)for(let i=0;i<t.Config.drumCount;i++){const s=e.drums[i];if(void 0!=s&&(void 0!=s.filterEnvelope&&(this.drumsetEnvelopes[i]=t.Config.envelopes.findIndex(t=>t.name==s.filterEnvelope),-1==this.drumsetEnvelopes[i]&&(this.drumsetEnvelopes[i]=t.Config.envelopes.dictionary["twang 2"].index)),void 0!=s.spectrum))for(let e=0;e<t.Config.spectrumControlPoints;e++)this.drumsetSpectrumWaves[i].spectrum[e]=Math.max(0,Math.min(t.Config.spectrumMax,Math.round(t.Config.spectrumMax*+s.spectrum[e]/100)))}}else if(5==this.type){if(void 0!=e.harmonics)for(let i=0;i<t.Config.harmonicsControlPoints;i++)this.harmonicsWave.harmonics[i]=Math.max(0,Math.min(t.Config.harmonicsMax,Math.round(t.Config.harmonicsMax*+e.harmonics[i]/100)));void 0!=e.interval&&(this.interval=t.Config.intervals.findIndex(t=>t.name==e.interval),-1==this.interval&&(this.interval=0)),void 0!=e.vibrato&&(this.vibrato=t.Config.vibratos.findIndex(t=>t.name==e.vibrato),-1==this.vibrato&&(this.vibrato=0)),this.chord=t.Config.chords.findIndex(t=>t.name==e.chord),-1==this.chord&&(this.chord=0)}else if(6==this.type)void 0!=e.pulseWidth?this.pulseWidth=r(0,t.Config.pulseWidthRange,Math.round(Math.log(+e.pulseWidth/50)/Math.LN2/.5-1+8)):this.pulseWidth=t.Config.pulseWidthRange-1,void 0!=e.pulseEnvelope&&(this.pulseEnvelope=t.Config.envelopes.findIndex(t=>t.name==e.pulseEnvelope),-1==this.pulseEnvelope&&(this.pulseEnvelope=t.Config.envelopes.dictionary.steady.index)),void 0!=e.vibrato&&(this.vibrato=t.Config.vibratos.findIndex(t=>t.name==e.vibrato),-1==this.vibrato&&(this.vibrato=0)),this.chord=t.Config.chords.findIndex(t=>t.name==e.chord),-1==this.chord&&(this.chord=0);else if(0==this.type){const i={triangle:1,square:2,"pulse wide":3,"pulse narrow":4,sawtooth:5,"double saw":6,"double pulse":7,spiky:8,plateau:0};if(this.chipWave=void 0!=i[e.wave]?i[e.wave]:t.Config.chipWaves.findIndex(t=>t.name==e.wave),-1==this.chipWave&&(this.chipWave=1),void 0!=e.interval)this.interval=t.Config.intervals.findIndex(t=>t.name==e.interval),-1==this.interval&&(this.interval=0);else if(void 0!=e.chorus){const i={fifths:5,octaves:6};this.interval=void 0!=i[e.chorus]?i[e.chorus]:t.Config.intervals.findIndex(t=>t.name==e.chorus),-1==this.interval&&(this.interval=0)}void 0!=e.vibrato?(this.vibrato=t.Config.vibratos.findIndex(t=>t.name==e.vibrato),-1==this.vibrato&&(this.vibrato=0)):void 0!=e.effect&&(this.vibrato=h.indexOf(e.effect),-1==this.vibrato&&(this.vibrato=0)),this.chord=t.Config.chords.findIndex(t=>t.name==e.chord),-1==this.chord&&(this.chord=2),"custom harmony"==e.chorus&&(this.interval=2,this.chord=3)}else{if(1!=this.type)throw new Error("Unrecognized instrument type.");{void 0!=e.vibrato?(this.vibrato=t.Config.vibratos.findIndex(t=>t.name==e.vibrato),-1==this.vibrato&&(this.vibrato=0)):void 0!=e.effect&&(this.vibrato=h.indexOf(e.effect),-1==this.vibrato&&(this.vibrato=0)),this.chord=t.Config.chords.findIndex(t=>t.name==e.chord),-1==this.chord&&(this.chord=3),this.algorithm=t.Config.algorithms.findIndex(t=>t.name==e.algorithm),-1==this.algorithm&&(this.algorithm=0),this.feedbackType=t.Config.feedbacks.findIndex(t=>t.name==e.feedbackType),-1==this.feedbackType&&(this.feedbackType=0),void 0!=e.feedbackAmplitude?this.feedbackAmplitude=r(0,t.Config.operatorAmplitudeMax+1,0|e.feedbackAmplitude):this.feedbackAmplitude=0;const i={"pluck 1":6,"pluck 2":7,"pluck 3":8};this.feedbackEnvelope=void 0!=i[e.feedbackEnvelope]?i[e.feedbackEnvelope]:t.Config.envelopes.findIndex(t=>t.name==e.feedbackEnvelope),-1==this.feedbackEnvelope&&(this.feedbackEnvelope=0);for(let s=0;s<t.Config.operatorCount;s++){const n=this.operators[s];let o=void 0;e.operators&&(o=e.operators[s]),void 0==o&&(o={}),n.frequency=t.Config.operatorFrequencies.findIndex(t=>t.name==o.frequency),-1==n.frequency&&(n.frequency=0),void 0!=o.amplitude?n.amplitude=r(0,t.Config.operatorAmplitudeMax+1,0|o.amplitude):n.amplitude=0,n.envelope=void 0!=i[o.envelope]?i[o.envelope]:t.Config.envelopes.findIndex(t=>t.name==o.envelope),-1==n.envelope&&(n.envelope=0)}}}}static frequencyFromPitch(t){return 440*Math.pow(2,(t-69)/12)}static drumsetIndexReferenceDelta(e){return u.frequencyFromPitch(t.Config.spectrumBasePitch+6*e)/44100}static T(t){return 15+Math.log(u.drumsetIndexReferenceDelta(t))/Math.LN2}warmUp(){if(2==this.type)t.getDrumWave(this.chipNoise);else if(5==this.type)this.harmonicsWave.getCustomWave();else if(3==this.type)this.spectrumWave.getCustomWave(8);else if(4==this.type)for(let e=0;e<t.Config.drumCount;e++)this.drumsetSpectrumWaves[e].getCustomWave(u.T(e))}getDrumWave(){if(2==this.type)return t.getDrumWave(this.chipNoise);if(3==this.type)return this.spectrumWave.getCustomWave(8);throw new Error("Unhandled instrument type in getDrumWave")}getDrumsetWave(t){if(4==this.type)return this.drumsetSpectrumWaves[t].getCustomWave(u.T(t));throw new Error("Unhandled instrument type in getDrumWave")}getTransition(){return 4==this.type?t.Config.transitions.dictionary["hard fade"]:t.Config.transitions[this.transition]}getChord(){return 4==this.type?t.Config.chords.dictionary.harmony:t.Config.chords[this.chord]}getFilterCutoffOctaves(){return 4==this.type?0:.5*(this.filterCutoff-(t.Config.filterCutoffRange-1))}getFilterIsFirstOrder(){return 4!=this.type&&0==this.filterResonance}getFilterResonance(){return 4==this.type?1:this.filterResonance}getFilterEnvelope(){if(4==this.type)throw new Error("Can't getFilterEnvelope() for drumset.");return t.Config.envelopes[this.filterEnvelope]}getDrumsetEnvelope(e){if(4!=this.type)throw new Error("Can't getDrumsetEnvelope() for non-drumset.");return t.Config.envelopes[this.drumsetEnvelopes[e]]}}t.Instrument=u;class m{constructor(){this.octave=0,this.instruments=[],this.patterns=[],this.bars=[],this.muted=!1}}t.Channel=m;class p{constructor(t){this.channels=[],void 0!=t?this.fromBase64String(t):this.initToDefault(!0)}getChannelCount(){return this.pitchChannelCount+this.noiseChannelCount}getChannelIsNoise(t){return t>=this.pitchChannelCount}initToDefault(t=!0){if(this.scale=0,this.key=0,this.loopStart=0,this.loopLength=4,this.tempo=150,this.reverb=0,this.beatsPerBar=8,this.barCount=16,this.patternsPerChannel=8,this.rhythm=1,this.instrumentsPerChannel=1,t){this.pitchChannelCount=3,this.noiseChannelCount=1;for(let t=0;t<this.getChannelCount();t++){this.channels.length<=t&&(this.channels[t]=new m);const e=this.channels[t];e.octave=3-t;for(let t=0;t<this.patternsPerChannel;t++)e.patterns.length<=t?e.patterns[t]=new l:e.patterns[t].reset();e.patterns.length=this.patternsPerChannel;const i=t>=this.pitchChannelCount;for(let t=0;t<this.instrumentsPerChannel;t++)e.instruments.length<=t&&(e.instruments[t]=new u(i)),e.instruments[t].setTypeAndReset(i?2:0,i);e.instruments.length=this.instrumentsPerChannel;for(let t=0;t<this.barCount;t++)e.bars[t]=t<4?1:0;e.bars.length=this.barCount}this.channels.length=this.getChannelCount()}}toBase64String(){let i,s=[];s.push(e[p.R]),s.push(110,e[this.pitchChannelCount],e[this.noiseChannelCount]),s.push(115,e[this.scale]),s.push(107,e[this.key]),s.push(108,e[this.loopStart>>6],e[63&this.loopStart]),s.push(101,e[this.loopLength-1>>6],e[this.loopLength-1&63]),s.push(116,e[this.tempo>>6],e[63&this.tempo]),s.push(109,e[this.reverb]),s.push(97,e[this.beatsPerBar-1]),s.push(103,e[this.barCount-1>>6],e[this.barCount-1&63]),s.push(106,e[this.patternsPerChannel-1>>6],e[this.patternsPerChannel-1&63]),s.push(105,e[this.instrumentsPerChannel-1]),s.push(114,e[this.rhythm]),s.push(111);for(let t=0;t<this.getChannelCount();t++)s.push(e[this.channels[t].octave]);for(let i=0;i<this.getChannelCount();i++)for(let o=0;o<this.instrumentsPerChannel;o++){const r=this.channels[i].instruments[o];if(s.push(84,e[r.type]),s.push(118,e[r.volume]),s.push(76,e[r.pan]),s.push(117,e[r.preset>>6],e[63&r.preset]),s.push(113,e[r.effects]),4!=r.type&&(s.push(100,e[r.transition]),s.push(102,e[r.filterCutoff]),s.push(121,e[r.filterResonance]),s.push(122,e[r.filterEnvelope]),s.push(67,e[r.chord])),0==r.type)s.push(119,e[r.chipWave]),s.push(99,e[r.vibrato]),s.push(104,e[r.interval]);else if(1==r.type){s.push(99,e[r.vibrato]),s.push(65,e[r.algorithm]),s.push(70,e[r.feedbackType]),s.push(66,e[r.feedbackAmplitude]),s.push(86,e[r.feedbackEnvelope]),s.push(81);for(let i=0;i<t.Config.operatorCount;i++)s.push(e[r.operators[i].frequency]);s.push(80);for(let i=0;i<t.Config.operatorCount;i++)s.push(e[r.operators[i].amplitude]);s.push(69);for(let i=0;i<t.Config.operatorCount;i++)s.push(e[r.operators[i].envelope])}else if(2==r.type)s.push(119,e[r.chipNoise]);else if(3==r.type){s.push(83);const e=new n;for(let i=0;i<t.Config.spectrumControlPoints;i++)e.write(t.Config.spectrumControlPointBits,r.spectrumWave.spectrum[i]);e.encodeBase64(s)}else if(4==r.type){s.push(122);for(let i=0;i<t.Config.drumCount;i++)s.push(e[r.drumsetEnvelopes[i]]);s.push(83);const i=new n;for(let e=0;e<t.Config.drumCount;e++)for(let s=0;s<t.Config.spectrumControlPoints;s++)i.write(t.Config.spectrumControlPointBits,r.drumsetSpectrumWaves[e].spectrum[s]);i.encodeBase64(s)}else if(5==r.type){s.push(99,e[r.vibrato]),s.push(104,e[r.interval]),s.push(72);const i=new n;for(let e=0;e<t.Config.harmonicsControlPoints;e++)i.write(t.Config.harmonicsControlPointBits,r.harmonicsWave.harmonics[e]);i.encodeBase64(s)}else{if(6!=r.type)throw new Error("Unknown instrument type.");s.push(99,e[r.vibrato]),s.push(87,e[r.pulseWidth],e[r.pulseEnvelope])}}s.push(98),i=new n;let o=0;for(;1<<o<this.patternsPerChannel+1;)o++;for(let t=0;t<this.getChannelCount();t++)for(let e=0;e<this.barCount;e++)i.write(o,this.channels[t].bars[e]);i.encodeBase64(s),s.push(112),i=new n;const r=new n;let h=0;for(;1<<h<this.instrumentsPerChannel;)h++;for(let e=0;e<this.getChannelCount();e++){const s=this.getChannelIsNoise(e),n=s?0:12*this.channels[e].octave;let o=(s?4:12)+n;const a=s?[4,6,7,2,3,8,0,10]:[12,19,24,31,36,7,0],l=[];for(let t=0;t<a.length;t++)a[t]+=n;for(const s of this.channels[e].patterns)if(i.write(h,s.instrument),s.notes.length>0){i.write(1,1);let e=0;for(const n of s.notes){n.start>e&&(i.write(2,0),i.writePartDuration(n.start-e)),r.clear();for(let t=1;t<n.pitches.length;t++)r.write(1,1);n.pitches.length<t.Config.maxChordSize&&r.write(1,0),r.writePinCount(n.pins.length-1),r.write(2,n.pins[0].volume);let s=0,h=n.pitches[0],c=h;const f=[];for(let t=1;t<n.pins.length;t++){const e=n.pins[t],i=h+e.interval;c!=i?(r.write(1,1),f.push(i),c=i):r.write(1,0),r.writePartDuration(e.time-s),s=e.time,r.write(2,e.volume)}const d=String.fromCharCode.apply(null,r.encodeBase64([])),u=l.indexOf(d);-1==u?(i.write(2,1),i.concat(r)):(i.write(1,1),i.writeLongTail(0,0,u),l.splice(u,1)),l.unshift(d),l.length>10&&l.pop();const m=n.pitches.concat(f);for(let t=0;t<m.length;t++){const e=m[t],s=a.indexOf(e);if(-1==s){let t=0,s=o;if(s<e)for(;s!=e;)s++,-1==a.indexOf(s)&&t++;else for(;s!=e;)s--,-1==a.indexOf(s)&&t--;i.write(1,0),i.writePitchInterval(t)}else i.write(1,1),i.write(3,s),a.splice(s,1);a.unshift(e),a.length>8&&a.pop(),o=t==n.pitches.length-1?n.pitches[0]:e}e=n.end}e<this.beatsPerBar*t.Config.partsPerBeat&&(i.write(2,0),i.writePartDuration(this.beatsPerBar*t.Config.partsPerBeat-e))}else i.write(1,0)}let a=i.lengthBase64(),l=[];for(;a>0;)l.unshift(e[63&a]),a>>=6;s.push(e[l.length]),Array.prototype.push.apply(s,l),i.encodeBase64(s);if(s.length<64e3)return String.fromCharCode.apply(null,s);{let t="";for(let e=0;e<s.length;e+=64e3)t+=String.fromCharCode.apply(null,s.slice(e,e+64e3));return t}}fromBase64String(e){if(null==e||""==e)return void this.initToDefault(!0);let n=0;for(;e.charCodeAt(n)<=32;)n++;if(35==e.charCodeAt(n)&&n++,123==e.charCodeAt(n))return void this.fromJsonObject(JSON.parse(0==n?e:e.substring(n)));const c=i[e.charCodeAt(n++)];if(-1==c||c>p.R||c<p.N)return;const f=c<3,d=c<4,y=c<5,g=c<6,b=c<7,v=c<8;if(this.initToDefault(g),f){for(const t of this.channels)t.instruments[0].transition=0;this.channels[3].instruments[0].chipNoise=0}let w,k=0,M=-1;for(;n<e.length;)switch(w=e.charCodeAt(n++)){case 110:this.pitchChannelCount=i[e.charCodeAt(n++)],this.noiseChannelCount=i[e.charCodeAt(n++)],this.pitchChannelCount=h(t.Config.pitchChannelCountMin,t.Config.pitchChannelCountMax,this.pitchChannelCount),this.noiseChannelCount=h(t.Config.noiseChannelCountMin,t.Config.noiseChannelCountMax,this.noiseChannelCount);for(let t=this.channels.length;t<this.getChannelCount();t++)this.channels[t]=new m;this.channels.length=this.getChannelCount();break;case 115:this.scale=i[e.charCodeAt(n++)],f&&10==this.scale&&(this.scale=11);break;case 107:this.key=r(0,t.Config.keys.length,b?11-i[e.charCodeAt(n++)]:i[e.charCodeAt(n++)]);break;case 108:this.loopStart=y?i[e.charCodeAt(n++)]:(i[e.charCodeAt(n++)]<<6)+i[e.charCodeAt(n++)];break;case 101:this.loopLength=y?i[e.charCodeAt(n++)]:(i[e.charCodeAt(n++)]<<6)+i[e.charCodeAt(n++)]+1;break;case 116:this.tempo=d?[95,120,151,190][i[e.charCodeAt(n++)]]:b?[88,95,103,111,120,130,140,151,163,176,190,206,222,240,259][i[e.charCodeAt(n++)]]:i[e.charCodeAt(n++)]<<6|i[e.charCodeAt(n++)],this.tempo=r(t.Config.tempoMin,t.Config.tempoMax+1,this.tempo);break;case 109:this.reverb=i[e.charCodeAt(n++)],this.reverb=r(0,t.Config.reverbRange,this.reverb);break;case 97:this.beatsPerBar=f?[6,7,8,9,10][i[e.charCodeAt(n++)]]:i[e.charCodeAt(n++)]+1,this.beatsPerBar=Math.max(t.Config.beatsPerBarMin,Math.min(t.Config.beatsPerBarMax,this.beatsPerBar));break;case 103:{const s=(i[e.charCodeAt(n++)]<<6)+i[e.charCodeAt(n++)]+1;this.barCount=h(t.Config.barCountMin,t.Config.barCountMax,s);for(let t=0;t<this.getChannelCount();t++){for(let e=this.channels[t].bars.length;e<this.barCount;e++)this.channels[t].bars[e]=1;this.channels[t].bars.length=this.barCount}}break;case 106:{let s;s=v?i[e.charCodeAt(n++)]+1:(i[e.charCodeAt(n++)]<<6)+i[e.charCodeAt(n++)]+1,this.patternsPerChannel=h(1,t.Config.barCountMax,s);for(let t=0;t<this.getChannelCount();t++){for(let e=this.channels[t].patterns.length;e<this.patternsPerChannel;e++)this.channels[t].patterns[e]=new l;this.channels[t].patterns.length=this.patternsPerChannel}}break;case 105:{const s=i[e.charCodeAt(n++)]+1;this.instrumentsPerChannel=h(t.Config.instrumentsPerChannelMin,t.Config.instrumentsPerChannelMax,s);for(let t=0;t<this.getChannelCount();t++){const e=t>=this.pitchChannelCount;for(let i=this.channels[t].instruments.length;i<this.instrumentsPerChannel;i++)this.channels[t].instruments[i]=new u(e);if(this.channels[t].instruments.length=this.instrumentsPerChannel,g)for(let i=0;i<this.instrumentsPerChannel;i++)this.channels[t].instruments[i].setTypeAndReset(e?2:0,e)}}break;case 114:this.rhythm=i[e.charCodeAt(n++)];break;case 111:if(f){const s=i[e.charCodeAt(n++)];this.channels[s].octave=r(0,t.Config.scrollableOctaves+1,i[e.charCodeAt(n++)])}else for(let s=0;s<this.getChannelCount();s++)this.channels[s].octave=r(0,t.Config.scrollableOctaves+1,i[e.charCodeAt(n++)]);break;case 84:{++M>=this.instrumentsPerChannel&&(k++,M=0),h(0,this.channels.length-1,k);const t=this.channels[k].instruments[M],s=h(0,6,i[e.charCodeAt(n++)]);t.setTypeAndReset(s,k>=this.pitchChannelCount)}break;case 117:{const t=i[e.charCodeAt(n++)]<<6|i[e.charCodeAt(n++)];this.channels[k].instruments[M].preset=t}break;case 119:if(f){const s=[1,2,3,4,5,6,7,8,0],o=i[e.charCodeAt(n++)];this.channels[o].instruments[0].chipWave=r(0,t.Config.chipWaves.length,0|s[i[e.charCodeAt(n++)]])}else if(g){const s=[1,2,3,4,5,6,7,8,0];for(let o=0;o<this.getChannelCount();o++)for(let h=0;h<this.instrumentsPerChannel;h++)o>=this.pitchChannelCount?this.channels[o].instruments[h].chipNoise=r(0,t.Config.chipNoises.length,i[e.charCodeAt(n++)]):this.channels[o].instruments[h].chipWave=r(0,t.Config.chipWaves.length,0|s[i[e.charCodeAt(n++)]])}else if(b){const s=[1,2,3,4,5,6,7,8,0];k>=this.pitchChannelCount?this.channels[k].instruments[M].chipNoise=r(0,t.Config.chipNoises.length,i[e.charCodeAt(n++)]):this.channels[k].instruments[M].chipWave=r(0,t.Config.chipWaves.length,0|s[i[e.charCodeAt(n++)]])}else k>=this.pitchChannelCount?this.channels[k].instruments[M].chipNoise=r(0,t.Config.chipNoises.length,i[e.charCodeAt(n++)]):this.channels[k].instruments[M].chipWave=r(0,t.Config.chipWaves.length,i[e.charCodeAt(n++)]);break;case 102:if(b){const t=[10,6,3,0,8,5,2],s=[1,1,1,1,18,19,20],o=["none","bright","medium","soft","decay bright","decay medium","decay soft"];if(f){const h=i[e.charCodeAt(n++)],a=this.channels[h].instruments[0],l=[1,3,4,5][r(0,o.length,i[e.charCodeAt(n++)])];a.filterCutoff=t[l],a.filterEnvelope=s[l],a.filterResonance=0}else if(g)for(let h=0;h<this.getChannelCount();h++)for(let a=0;a<this.instrumentsPerChannel;a++){const l=this.channels[h].instruments[a],c=r(0,o.length,i[e.charCodeAt(n++)]+1);h<this.pitchChannelCount?(l.filterCutoff=t[c],l.filterEnvelope=s[c],l.filterResonance=0):(l.filterCutoff=10,l.filterEnvelope=1,l.filterResonance=0)}else{const h=r(0,o.length,i[e.charCodeAt(n++)]),a=this.channels[k].instruments[M];a.filterCutoff=t[h],a.filterEnvelope=s[h],a.filterResonance=0}}else{this.channels[k].instruments[M].filterCutoff=r(0,t.Config.filterCutoffRange,i[e.charCodeAt(n++)])}break;case 121:this.channels[k].instruments[M].filterResonance=r(0,t.Config.filterResonanceRange,i[e.charCodeAt(n++)]);break;case 122:{const s=this.channels[k].instruments[M];if(4==s.type)for(let o=0;o<t.Config.drumCount;o++)s.drumsetEnvelopes[o]=r(0,t.Config.envelopes.length,i[e.charCodeAt(n++)]);else s.filterEnvelope=r(0,t.Config.envelopes.length,i[e.charCodeAt(n++)])}break;case 87:{const s=this.channels[k].instruments[M];s.pulseWidth=r(0,t.Config.pulseWidthRange,i[e.charCodeAt(n++)]),s.pulseEnvelope=r(0,t.Config.envelopes.length,i[e.charCodeAt(n++)])}break;case 100:if(f){const s=i[e.charCodeAt(n++)];this.channels[s].instruments[0].transition=r(0,t.Config.transitions.length,i[e.charCodeAt(n++)])}else if(g)for(let s=0;s<this.getChannelCount();s++)for(let o=0;o<this.instrumentsPerChannel;o++)this.channels[s].instruments[o].transition=r(0,t.Config.transitions.length,i[e.charCodeAt(n++)]);else this.channels[k].instruments[M].transition=r(0,t.Config.transitions.length,i[e.charCodeAt(n++)]);break;case 99:if(f){const t=[0,3,2,0],s=[1,1,1,13],o=i[e.charCodeAt(n++)],h=r(0,t.length,i[e.charCodeAt(n++)]),a=this.channels[o].instruments[0];a.vibrato=t[h],a.filterEnvelope=1==a.filterEnvelope?s[h]:a.filterEnvelope}else if(g){const t=[0,1,2,3,0,0],s=[1,1,1,1,16,13];for(let o=0;o<this.getChannelCount();o++)for(let h=0;h<this.instrumentsPerChannel;h++){const a=r(0,t.length,i[e.charCodeAt(n++)]),l=this.channels[o].instruments[h];l.vibrato=t[a],l.filterEnvelope=1==l.filterEnvelope?s[a]:l.filterEnvelope}}else if(b){const t=[0,1,2,3,0,0],s=[1,1,1,1,16,13],o=r(0,t.length,i[e.charCodeAt(n++)]),h=this.channels[k].instruments[M];h.vibrato=t[o],h.filterEnvelope=1==h.filterEnvelope?s[o]:h.filterEnvelope}else{const s=r(0,t.Config.vibratos.length,i[e.charCodeAt(n++)]);this.channels[k].instruments[M].vibrato=s}break;case 104:if(f){const s=i[e.charCodeAt(n++)];this.channels[s].instruments[0].interval=r(0,t.Config.intervals.length,i[e.charCodeAt(n++)])}else if(g)for(let s=0;s<this.getChannelCount();s++)for(let o=0;o<this.instrumentsPerChannel;o++){const h=i[e.charCodeAt(n++)];let a=r(0,t.Config.intervals.length,h);8==h&&(a=2,this.channels[s].instruments[o].chord=3),this.channels[s].instruments[o].interval=a}else if(b){const s=i[e.charCodeAt(n++)];let o=r(0,t.Config.intervals.length,s);8==s&&(o=2,this.channels[k].instruments[M].chord=3),this.channels[k].instruments[M].interval=o}else this.channels[k].instruments[M].interval=r(0,t.Config.intervals.length,i[e.charCodeAt(n++)]);break;case 67:this.channels[k].instruments[M].chord=r(0,t.Config.chords.length,i[e.charCodeAt(n++)]);break;case 113:this.channels[k].instruments[M].effects=r(0,t.Config.effectsNames.length,i[e.charCodeAt(n++)]);break;case 118:if(f){const s=i[e.charCodeAt(n++)],o=this.channels[s].instruments[0];o.volume=r(0,t.Config.volumeRange,i[e.charCodeAt(n++)]),5==o.volume&&(o.volume=t.Config.volumeRange-1)}else if(g)for(let s=0;s<this.getChannelCount();s++)for(let o=0;o<this.instrumentsPerChannel;o++){const h=this.channels[s].instruments[o];h.volume=r(0,t.Config.volumeRange,i[e.charCodeAt(n++)]),5==h.volume&&(h.volume=t.Config.volumeRange-1)}else if(b){const s=this.channels[k].instruments[M];s.volume=r(0,t.Config.volumeRange,i[e.charCodeAt(n++)]),5==s.volume&&(s.volume=t.Config.volumeRange-1)}else{this.channels[k].instruments[M].volume=r(0,t.Config.volumeRange,i[e.charCodeAt(n++)])}break;case 76:this.channels[k].instruments[M].pan=r(0,t.Config.panMax+1,i[e.charCodeAt(n++)]);break;case 65:this.channels[k].instruments[M].algorithm=r(0,t.Config.algorithms.length,i[e.charCodeAt(n++)]);break;case 70:this.channels[k].instruments[M].feedbackType=r(0,t.Config.feedbacks.length,i[e.charCodeAt(n++)]);break;case 66:this.channels[k].instruments[M].feedbackAmplitude=r(0,t.Config.operatorAmplitudeMax+1,i[e.charCodeAt(n++)]);break;case 86:this.channels[k].instruments[M].feedbackEnvelope=r(0,t.Config.envelopes.length,i[e.charCodeAt(n++)]);break;case 81:for(let s=0;s<t.Config.operatorCount;s++)this.channels[k].instruments[M].operators[s].frequency=r(0,t.Config.operatorFrequencies.length,i[e.charCodeAt(n++)]);break;case 80:for(let s=0;s<t.Config.operatorCount;s++)this.channels[k].instruments[M].operators[s].amplitude=r(0,t.Config.operatorAmplitudeMax+1,i[e.charCodeAt(n++)]);break;case 69:for(let s=0;s<t.Config.operatorCount;s++)this.channels[k].instruments[M].operators[s].envelope=r(0,t.Config.envelopes.length,i[e.charCodeAt(n++)]);break;case 83:{const i=this.channels[k].instruments[M];if(3==i.type){const o=Math.ceil(t.Config.spectrumControlPoints*t.Config.spectrumControlPointBits/6),r=new s(e,n,n+o);for(let e=0;e<t.Config.spectrumControlPoints;e++)i.spectrumWave.spectrum[e]=r.read(t.Config.spectrumControlPointBits);i.spectrumWave.markCustomWaveDirty(),n+=o}else{if(4!=i.type)throw new Error("Unhandled instrument type for spectrum song tag code.");{const o=Math.ceil(t.Config.drumCount*t.Config.spectrumControlPoints*t.Config.spectrumControlPointBits/6),r=new s(e,n,n+o);for(let e=0;e<t.Config.drumCount;e++){for(let s=0;s<t.Config.spectrumControlPoints;s++)i.drumsetSpectrumWaves[e].spectrum[s]=r.read(t.Config.spectrumControlPointBits);i.drumsetSpectrumWaves[e].markCustomWaveDirty()}n+=o}}}break;case 72:{const i=this.channels[k].instruments[M],o=Math.ceil(t.Config.harmonicsControlPoints*t.Config.harmonicsControlPointBits/6),r=new s(e,n,n+o);for(let e=0;e<t.Config.harmonicsControlPoints;e++)i.harmonicsWave.harmonics[e]=r.read(t.Config.harmonicsControlPointBits);i.harmonicsWave.markCustomWaveDirty(),n+=o}break;case 98:{let t;if(f){const o=i[e.charCodeAt(n++)],r=i[e.charCodeAt(n++)];t=Math.ceil(.5*r);const h=new s(e,n,n+t);for(let t=0;t<r;t++)this.channels[o].bars[t]=h.read(3)+1}else if(y){let i=0;for(;1<<i<this.patternsPerChannel;)i++;t=Math.ceil(this.getChannelCount()*this.barCount*i/6);const o=new s(e,n,n+t);for(let t=0;t<this.getChannelCount();t++)for(let e=0;e<this.barCount;e++)this.channels[t].bars[e]=o.read(i)+1}else{let i=0;for(;1<<i<this.patternsPerChannel+1;)i++;t=Math.ceil(this.getChannelCount()*this.barCount*i/6);const o=new s(e,n,n+t);for(let t=0;t<this.getChannelCount();t++)for(let e=0;e<this.barCount;e++)this.channels[t].bars[e]=o.read(i)}n+=t}break;case 112:{let r,l=0;if(f)r=i[e.charCodeAt(n++)],n++,l=i[e.charCodeAt(n++)],l<<=6,l+=i[e.charCodeAt(n++)];else{r=0;let t=h(1,4,i[e.charCodeAt(n++)]);for(;t>0;)l<<=6,l+=i[e.charCodeAt(n++)],t--}const c=new s(e,n,n+l);n+=l;let d=0;for(;1<<d<this.instrumentsPerChannel;)d++;for(;;){const e=this.getChannelIsNoise(r),i=e?0:12*this.channels[r].octave;let s=null,n=null,l=(e?4:12)+i;const u=e?[4,6,7,2,3,8,0,10]:[12,19,24,31,36,7,0],m=[];for(let t=0;t<u.length;t++)u[t]+=i;for(let e=0;e<this.patternsPerChannel;e++){const i=this.channels[r].patterns[e];if(i.reset(),i.instrument=c.read(d),!f&&0==c.read(1))continue;let p=0;const y=i.notes;for(;p<this.beatsPerBar*t.Config.partsPerBeat;){const e=1==c.read(1);let i=!1,r=0;if(e?r=h(0,m.length-1,c.readLongTail(0,0)):i=1==c.read(1),e||i){let i,f,d;if(e)i=m[r],m.splice(r,1);else{for((i={}).pitchCount=1;i.pitchCount<t.Config.maxChordSize&&1==c.read(1);)i.pitchCount++;i.pinCount=c.readPinCount(),i.initialVolume=c.read(2),i.pins=[],i.length=0,i.bendCount=0;for(let e=0;e<i.pinCount;e++)(f={}).pitchBend=1==c.read(1),f.pitchBend&&i.bendCount++,i.length+=b?c.readLegacyPartDuration()*t.Config.partsPerBeat/t.Config.rhythms[this.rhythm].stepsPerBeat:c.readPartDuration(),f.time=i.length,f.volume=c.read(2),i.pins.push(f)}m.unshift(i),m.length>10&&m.pop(),(s=new a(0,p,p+i.length,i.initialVolume)).pitches=[],s.pins.length=1;const g=[];for(let t=0;t<i.pitchCount+i.bendCount;t++){if(1==c.read(1)){const t=h(0,u.length-1,c.read(3));d=u[t],u.splice(t,1)}else{const t=c.readPitchInterval();d=l;let e=t;for(;e>0;){for(d++;-1!=u.indexOf(d);)d++;e--}for(;e<0;){for(d--;-1!=u.indexOf(d);)d--;e++}}u.unshift(d),u.length>8&&u.pop(),t<i.pitchCount?s.pitches.push(d):g.push(d),l=t==i.pitchCount-1?s.pitches[0]:d}g.unshift(s.pitches[0]);for(const t of i.pins)t.pitchBend&&g.shift(),n=o(g[0]-s.pitches[0],t.time,t.volume),s.pins.push(n);p=h(0,this.beatsPerBar*t.Config.partsPerBeat,s.end),y.push(s)}else{p+=b?c.readLegacyPartDuration()*t.Config.partsPerBeat/t.Config.rhythms[this.rhythm].stepsPerBeat:c.readPartDuration()}}}if(f)break;if(++r>=this.getChannelCount())break}}break;default:throw new Error("Unrecognized song tag code "+String.fromCharCode(w)+" at index "+(n-1))}}toJsonObject(e=!0,i=1,s=!0){const n=[];for(let o=0;o<this.getChannelCount();o++){const r=[],h=this.getChannelIsNoise(o);for(let t=0;t<this.instrumentsPerChannel;t++)r.push(this.channels[o].instruments[t].toJsonObject());const a=[];for(const e of this.channels[o].patterns){const i=[];for(const s of e.notes){const e=[];for(const i of s.pins)e.push({tick:(i.time+s.start)*t.Config.rhythms[this.rhythm].stepsPerBeat/t.Config.partsPerBeat,pitchBend:i.interval,volume:Math.round(100*i.volume/3)});i.push({pitches:s.pitches,points:e})}a.push({instrument:e.instrument+1,notes:i})}const l=[];if(e)for(let t=0;t<this.loopStart;t++)l.push(this.channels[o].bars[t]);for(let t=0;t<i;t++)for(let t=this.loopStart;t<this.loopStart+this.loopLength;t++)l.push(this.channels[o].bars[t]);if(s)for(let t=this.loopStart+this.loopLength;t<this.barCount;t++)l.push(this.channels[o].bars[t]);n.push({type:h?"drum":"pitch",octaveScrollBar:this.channels[o].octave,instruments:r,patterns:a,sequence:l})}return{format:p.L,version:p.R,scale:t.Config.scales[this.scale].name,key:t.Config.keys[this.key].name,introBars:this.loopStart,loopBars:this.loopLength,beatsPerBar:this.beatsPerBar,ticksPerBeat:t.Config.rhythms[this.rhythm].stepsPerBeat,beatsPerMinute:this.tempo,reverb:this.reverb,channels:n}}fromJsonObject(e){if(this.initToDefault(!0),!e)return;if(this.scale=11,void 0!=e.scale){const i={"romani :)":"dbl harmonic :)","romani :(":"dbl harmonic :(",enigma:"strange"},s=void 0!=i[e.scale]?i[e.scale]:e.scale,n=t.Config.scales.findIndex(t=>t.name==s);-1!=n&&(this.scale=n)}if(void 0!=e.key)if("number"==typeof e.key)this.key=(e.key+1200>>>0)%t.Config.keys.length;else if("string"==typeof e.key){const t=e.key,i=t.charAt(0).toUpperCase(),s=t.charAt(1).toLowerCase();let n={C:0,D:2,E:4,F:5,G:7,A:9,B:11}[i];const o={"#":1,"♯":1,b:-1,"♭":-1}[s];void 0!=n&&(void 0!=o&&(n+=o),n<0&&(n+=12),n%=12,this.key=n)}void 0!=e.beatsPerMinute&&(this.tempo=r(t.Config.tempoMin,t.Config.tempoMax+1,0|e.beatsPerMinute)),void 0!=e.reverb&&(this.reverb=r(0,t.Config.reverbRange,0|e.reverb)),void 0!=e.beatsPerBar&&(this.beatsPerBar=Math.max(t.Config.beatsPerBarMin,Math.min(t.Config.beatsPerBarMax,0|e.beatsPerBar)));let i=4;void 0!=e.ticksPerBeat&&(i=0|e.ticksPerBeat||4,this.rhythm=t.Config.rhythms.findIndex(t=>t.stepsPerBeat==i),-1==this.rhythm&&(this.rhythm=1));let s=1,n=1,h=1;if(e.channels)for(const t of e.channels)t.instruments&&(s=Math.max(s,0|t.instruments.length)),t.patterns&&(n=Math.max(n,0|t.patterns.length)),t.sequence&&(h=Math.max(h,0|t.sequence.length));this.instrumentsPerChannel=Math.min(s,t.Config.instrumentsPerChannelMax),this.patternsPerChannel=Math.min(n,t.Config.barCountMax),this.barCount=Math.min(h,t.Config.barCountMax),void 0!=e.introBars&&(this.loopStart=r(0,this.barCount,0|e.introBars)),void 0!=e.loopBars&&(this.loopLength=r(1,this.barCount-this.loopStart+1,0|e.loopBars));const c=[],f=[];if(e.channels)for(let s=0;s<e.channels.length;s++){let n=e.channels[s];const h=new m;let d=!1;(d=void 0!=n.type?"drum"==n.type:s>=3)?f.push(h):c.push(h),void 0!=n.octaveScrollBar&&(h.octave=r(0,t.Config.scrollableOctaves+1,0|n.octaveScrollBar));for(let t=h.instruments.length;t<this.instrumentsPerChannel;t++)h.instruments[t]=new u(d);h.instruments.length=this.instrumentsPerChannel;for(let t=h.patterns.length;t<this.patternsPerChannel;t++)h.patterns[t]=new l;h.patterns.length=this.patternsPerChannel;for(let t=0;t<this.barCount;t++)h.bars[t]=1;h.bars.length=this.barCount;for(let t=0;t<this.instrumentsPerChannel;t++){h.instruments[t].fromJsonObject(n.instruments[t],d)}for(let e=0;e<this.patternsPerChannel;e++){const s=h.patterns[e];let l=void 0;if(n.patterns&&(l=n.patterns[e]),void 0!=l&&(s.instrument=r(0,this.instrumentsPerChannel,(0|l.instrument)-1),l.notes&&l.notes.length>0)){const e=Math.min(this.beatsPerBar*t.Config.partsPerBeat,l.notes.length>>>0);let n=0;for(let r=0;r<l.notes.length&&!(r>=e);r++){const e=l.notes[r];if(!(e&&e.pitches&&e.pitches.length>=1&&e.points&&e.points.length>=2))continue;const h=new a(0,0,0,0);h.pitches=[],h.pins=[];for(let i=0;i<e.pitches.length;i++){const s=0|e.pitches[i];if(-1==h.pitches.indexOf(s)&&(h.pitches.push(s),h.pitches.length>=t.Config.maxChordSize))break}if(h.pitches.length<1)continue;let c=n,f=0;for(let s=0;s<e.points.length;s++){const n=e.points[s];if(void 0==n||void 0==n.tick)continue;const r=void 0==n.pitchBend?0:0|n.pitchBend,a=Math.round(+n.tick*t.Config.partsPerBeat/i),l=void 0==n.volume?3:Math.max(0,Math.min(3,Math.round(3*(0|n.volume)/100)));if(!(a>this.beatsPerBar*t.Config.partsPerBeat)){if(0==h.pins.length){if(a<c)continue;h.start=a,f=r}else if(a<=c)continue;c=a,h.pins.push(o(r-f,a-h.start,l))}}if(h.pins.length<2)continue;h.end=h.pins[h.pins.length-1].time+h.start;const u=d?t.Config.drumCount-1:t.Config.maxPitch;let m=u,p=0;for(let t=0;t<h.pitches.length;t++)h.pitches[t]+=f,(h.pitches[t]<0||h.pitches[t]>u)&&(h.pitches.splice(t,1),t--),h.pitches[t]<m&&(m=h.pitches[t]),h.pitches[t]>p&&(p=h.pitches[t]);if(!(h.pitches.length<1)){for(let t=0;t<h.pins.length;t++){const e=h.pins[t];e.interval+m<0&&(e.interval=-m),e.interval+p>u&&(e.interval=u-p),t>=2&&e.interval==h.pins[t-1].interval&&e.interval==h.pins[t-2].interval&&e.volume==h.pins[t-1].volume&&e.volume==h.pins[t-2].volume&&(h.pins.splice(t-1,1),t--)}s.notes.push(h),n=h.end}}}}for(let t=0;t<this.barCount;t++)h.bars[t]=n.sequence?Math.min(this.patternsPerChannel,n.sequence[t]>>>0):0}c.length>t.Config.pitchChannelCountMax&&(c.length=t.Config.pitchChannelCountMax),f.length>t.Config.noiseChannelCountMax&&(f.length=t.Config.noiseChannelCountMax),this.pitchChannelCount=c.length,this.noiseChannelCount=f.length,this.channels.length=0,Array.prototype.push.apply(this.channels,c),Array.prototype.push.apply(this.channels,f)}getPattern(t,e){if(e<0||e>=this.barCount)return null;const i=this.channels[t].bars[e];return 0==i?null:this.channels[t].patterns[i-1]}getPatternInstrument(t,e){const i=this.getPattern(t,e);return null==i?0:i.instrument}getBeatsPerMinute(){return this.tempo}}p.L="BeepBox",p.N=2,p.R=8,t.Song=p;class y{constructor(){this.pitches=[0,0,0,0],this.pitchCount=0,this.chordSize=0,this.drumsetPitch=0,this.note=null,this.prevNote=null,this.nextNote=null,this.prevNotePitchIndex=0,this.nextNotePitchIndex=0,this.active=!1,this.noteStart=0,this.noteEnd=0,this.noteLengthTicks=0,this.ticksSinceReleased=0,this.liveInputSamplesHeld=0,this.lastInterval=0,this.lastVolume=0,this.stereoVolume1=0,this.stereoVolume2=0,this.stereoOffset=0,this.stereoDelay=0,this.sample=0,this.phases=[],this.phaseDeltas=[],this.volumeStarts=[],this.volumeDeltas=[],this.volumeStart=0,this.volumeDelta=0,this.phaseDeltaScale=0,this.pulseWidth=0,this.pulseWidthDelta=0,this.filter=0,this.filterScale=0,this.filterSample0=0,this.filterSample1=0,this.vibratoScale=0,this.intervalMult=0,this.intervalVolumeMult=1,this.feedbackOutputs=[],this.feedbackMult=0,this.feedbackDelta=0,this.reset()}reset(){for(let e=0;e<t.Config.operatorCount;e++)this.phases[e]=0,this.feedbackOutputs[e]=0;this.sample=0,this.filterSample0=0,this.filterSample1=0,this.liveInputSamplesHeld=0}}class g{constructor(e=null){this.samplesPerSecond=44100,this.song=null,this.liveInputDuration=0,this.liveInputStarted=!1,this.liveInputPitches=[],this.liveInputChannel=0,this.loopRepeatCount=-1,this.volume=1,this.playheadInternal=0,this.bar=0,this.beat=0,this.part=0,this.tick=0,this.tickSampleCountdown=0,this.isPlayingSong=!1,this.liveInputEndTime=0,this.tonePool=new t.Deque,this.activeTones=[],this.releasedTones=[],this.liveInputTones=new t.Deque,this.limit=0,this.stereoBufferIndex=0,this.samplesForNone=null,this.samplesForReverb=null,this.samplesForChorus=null,this.samplesForChorusReverb=null,this.chorusDelayLine=new Float32Array(2048),this.chorusDelayPos=0,this.chorusPhase=0,this.reverbDelayLine=new Float32Array(16384),this.reverbDelayPos=0,this.reverbFeedback0=0,this.reverbFeedback1=0,this.reverbFeedback2=0,this.reverbFeedback3=0,this.audioCtx=null,this.scriptNode=null,this.audioProcessCallback=(t=>{const e=t.outputBuffer,i=e.getChannelData(0),s=e.getChannelData(1);if(performance.now()<this.liveInputEndTime||this.isPlayingSong)this.synthesize(i,s,e.length,this.isPlayingSong);else{for(let t=0;t<e.length;t++)i[t]=0,s[t]=0;this.deactivateAudio()}}),null!=e&&this.setSong(e)}static warmUpSynthesizer(t){if(null!=t)for(let e=0;e<t.getChannelCount();e++)for(let i=0;i<t.instrumentsPerChannel;i++)g.getInstrumentSynthFunction(t.channels[e].instruments[i]),t.channels[e].instruments[i].warmUp()}static operatorAmplitudeCurve(t){return(Math.pow(16,t/15)-1)/15}get playing(){return this.isPlayingSong}get playhead(){return this.playheadInternal}set playhead(e){if(null!=this.song){this.playheadInternal=Math.max(0,Math.min(this.song.barCount,e));let i=this.playheadInternal;this.bar=Math.floor(i),i=this.song.beatsPerBar*(i-this.bar),this.beat=Math.floor(i),i=t.Config.partsPerBeat*(i-this.beat),this.part=Math.floor(i),i=t.Config.ticksPerPart*(i-this.part),this.tick=Math.floor(i);const s=this.getSamplesPerTick();i=s*(i-this.tick),this.tickSampleCountdown=Math.floor(s-i)}}getSamplesPerBar(){if(null==this.song)throw new Error;return this.getSamplesPerTick()*t.Config.ticksPerPart*t.Config.partsPerBeat*this.song.beatsPerBar}getTotalBars(t,e){if(null==this.song)throw new Error;let i=this.song.loopLength*(this.loopRepeatCount+1);return t&&(i+=this.song.loopStart),e&&(i+=this.song.barCount-(this.song.loopStart+this.song.loopLength)),i}setSong(t){"string"==typeof t?this.song=new p(t):t instanceof p&&(this.song=t)}activateAudio(){null!=this.audioCtx&&null!=this.scriptNode||(this.audioCtx=this.audioCtx||new(window.AudioContext||window.webkitAudioContext),this.samplesPerSecond=this.audioCtx.sampleRate,this.scriptNode=this.audioCtx.createScriptProcessor?this.audioCtx.createScriptProcessor(2048,0,2):this.audioCtx.createJavaScriptNode(2048,0,2),this.scriptNode.onaudioprocess=this.audioProcessCallback,this.scriptNode.channelCountMode="explicit",this.scriptNode.channelInterpretation="speakers",this.scriptNode.connect(this.audioCtx.destination)),this.audioCtx.resume()}deactivateAudio(){null!=this.audioCtx&&null!=this.scriptNode&&(this.scriptNode.disconnect(this.audioCtx.destination),this.scriptNode=null,this.audioCtx.close&&this.audioCtx.close(),this.audioCtx=null)}maintainLiveInput(){this.activateAudio(),this.liveInputEndTime=performance.now()+1e4}play(){this.isPlayingSong||(this.isPlayingSong=!0,g.warmUpSynthesizer(this.song),this.activateAudio())}pause(){this.isPlayingSong&&(this.isPlayingSong=!1)}snapToStart(){this.bar=0,this.snapToBar()}goToBar(t){this.bar=t,this.playheadInternal=this.bar}snapToBar(){this.playheadInternal=this.bar,this.beat=0,this.part=0,this.tick=0,this.tickSampleCountdown=0}resetEffects(){this.reverbDelayPos=0,this.reverbFeedback0=0,this.reverbFeedback1=0,this.reverbFeedback2=0,this.reverbFeedback3=0,this.freeAllTones();for(let t=0;t<this.reverbDelayLine.length;t++)this.reverbDelayLine[t]=0;for(let t=0;t<this.chorusDelayLine.length;t++)this.chorusDelayLine[t]=0;if(null!=this.samplesForNone)for(let t=0;t<this.samplesForNone.length;t++)this.samplesForNone[t]=0;if(null!=this.samplesForReverb)for(let t=0;t<this.samplesForReverb.length;t++)this.samplesForReverb[t]=0;if(null!=this.samplesForChorus)for(let t=0;t<this.samplesForChorus.length;t++)this.samplesForChorus[t]=0;if(null!=this.samplesForChorusReverb)for(let t=0;t<this.samplesForChorusReverb.length;t++)this.samplesForChorusReverb[t]=0}jumpIntoLoop(){if(this.song&&(this.bar<this.song.loopStart||this.bar>=this.song.loopStart+this.song.loopLength)){const t=this.bar;this.bar=this.song.loopStart,this.playheadInternal+=this.bar-t}}nextBar(){if(!this.song)return;const t=this.bar;this.bar++,this.bar>=this.song.barCount&&(this.bar=0),this.playheadInternal+=this.bar-t}prevBar(){if(!this.song)return;const t=this.bar;this.bar--,(this.bar<0||this.bar>=this.song.barCount)&&(this.bar=this.song.barCount-1),this.playheadInternal+=this.bar-t}synthesize(e,i,s,n=!0){if(null==this.song){for(let t=0;t<s;t++)e[t]=0,i[t]=0;return void this.deactivateAudio()}const o=this.song.getChannelCount();for(let e=this.activeTones.length;e<o;e++)this.activeTones[e]=new t.Deque,this.releasedTones[e]=new t.Deque;this.activeTones.length=o,this.releasedTones.length=o;const r=this.getSamplesPerTick();let h=0,a=!1;(0==this.tickSampleCountdown||this.tickSampleCountdown>r)&&(this.tickSampleCountdown=r),n&&(this.beat>=this.song.beatsPerBar&&(this.bar++,this.beat=0,this.part=0,this.tick=0,this.tickSampleCountdown=r,0!=this.loopRepeatCount&&this.bar==this.song.loopStart+this.song.loopLength&&(this.bar=this.song.loopStart,this.loopRepeatCount>0&&this.loopRepeatCount--)),this.bar>=this.song.barCount&&(this.bar=0,-1!=this.loopRepeatCount&&(a=!0,this.pause())));const l=4*s;null!=this.samplesForNone&&this.samplesForNone.length==l&&null!=this.samplesForReverb&&this.samplesForReverb.length==l&&null!=this.samplesForChorus&&this.samplesForChorus.length==l&&null!=this.samplesForChorusReverb&&this.samplesForChorusReverb.length==l||(this.samplesForNone=new Float32Array(l),this.samplesForReverb=new Float32Array(l),this.samplesForChorus=new Float32Array(l),this.samplesForChorusReverb=new Float32Array(l),this.stereoBufferIndex=0);let c=this.stereoBufferIndex;const f=this.samplesForNone,d=this.samplesForReverb,u=this.samplesForChorus,m=this.samplesForChorusReverb,p=+this.volume,y=this.chorusDelayLine,g=this.reverbDelayLine,b=2*Math.PI/(2*this.samplesPerSecond),v=150*this.samplesPerSecond/44100,w=2048-1.51*v,k=2048-2.1*v,M=2048-3.35*v,x=2048-1.47*v,E=2048-2.15*v,q=2048-3.25*v;let C=this.chorusPhase%(2*Math.PI),P=2047&this.chorusDelayPos,S=16383&this.reverbDelayPos,T=+this.reverbFeedback0,z=+this.reverbFeedback1,R=+this.reverbFeedback2,N=+this.reverbFeedback3;const B=.425*Math.pow(this.song.reverb/t.Config.reverbRange,.667),F=1-Math.pow(.5,4/this.samplesPerSecond),L=1-Math.pow(.5,4e3/this.samplesPerSecond);let A=+this.limit;for(;h<s&&!a;){const o=s-h,H=this.tickSampleCountdown<=o?this.tickSampleCountdown:o;for(let e=0;e<this.song.getChannelCount();e++){if(e==this.liveInputChannel){this.determineLiveInputTones(this.song);for(let t=0;t<this.liveInputTones.count();t++){const i=this.liveInputTones.get(t);this.playTone(this.song,c,l,e,r,H,i,!1,!1)}}this.determineCurrentActiveTones(this.song,e,n);for(let t=0;t<this.activeTones[e].count();t++){const i=this.activeTones[e].get(t);this.playTone(this.song,c,l,e,r,H,i,!1,!1)}for(let i=0;i<this.releasedTones[e].count();i++){const s=this.releasedTones[e].get(i);if(s.ticksSinceReleased>=s.instrument.getTransition().releaseTicks){this.freeReleasedTone(e,i),i--;continue}const n=i+this.activeTones[e].count()>=t.Config.maximumTonesPerChannel;this.playTone(this.song,c,l,e,r,H,s,!0,n)}}let I=P+w-v*Math.sin(C+0),O=P+k-v*Math.sin(C+2.1),$=P+M-v*Math.sin(C+4.2),U=P+1024+x-v*Math.sin(C+3.2),_=P+1024+E-v*Math.sin(C+5.3),D=P+1024+q-v*Math.sin(C+1);C+=b*H;const W=(P+H+w-v*Math.sin(C+0)-I)/H,V=(P+H+k-v*Math.sin(C+2.1)-O)/H,j=(P+H+M-v*Math.sin(C+4.2)-$)/H,G=(P+H+1024+x-v*Math.sin(C+3.2)-U)/H,K=(P+H+1024+E-v*Math.sin(C+5.3)-_)/H,J=(P+H+1024+q-v*Math.sin(C+1)-D)/H,Y=h+H;for(let t=h;t<Y;t++){const s=c,n=c+1,o=f[s];f[s]=0;const r=f[n];f[n]=0;const h=d[s];d[s]=0;const a=d[n];d[n]=0;const l=u[s];u[s]=0;const b=u[n];u[n]=0;const v=m[s];m[s]=0;const w=m[n];m[n]=0,c+=2;const k=l+v,M=b+w,x=I%1,E=O%1,q=$%1,C=U%1,H=_%1,Y=D%1,Z=y[2047&I],Q=y[I+1&2047],X=y[2047&O],tt=y[O+1&2047],et=y[2047&$],it=y[$+1&2047],st=y[2047&U],nt=y[U+1&2047],ot=y[2047&_],rt=y[_+1&2047],ht=y[2047&D],at=.5*(k-(Z+(Q-Z)*x)+(X+(tt-X)*E)-(et+(it-et)*q)),lt=.5*(M-(st+(nt-st)*C)+(ot+(rt-ot)*H)-(ht+(y[D+1&2047]-ht)*Y));y[P]=k,y[P+1024&2047]=M,P=P+1&2047,I+=W,O+=V,$+=j,U+=G,_+=K,D+=J;const ct=S+3041&16383,ft=S+6426&16383,dt=S+10907&16383,ut=g[S],mt=g[ct],pt=g[ft],yt=g[dt],gt=-(ut+v+h)+mt,bt=-(ut+w+a)-mt,vt=-pt+yt,wt=-pt-yt;T+=.5*((gt+vt)*B-T),z+=.5*((bt+wt)*B-z),R+=.5*((gt-vt)*B-R),N+=.5*((bt-wt)*B-N),g[ct]=T,g[ft]=z,g[dt]=R,g[S]=N,S=S+1&16383;const kt=o+at+h+mt+pt+yt,Mt=r+lt+a+ut+pt-yt,xt=kt<0?-kt:kt,Et=Mt<0?-Mt:Mt,qt=xt>Et?xt:Et,Ct=p/((A+=(qt-A)*(A<qt?L:F))>=1?1.05*A:.8*A+.25);e[t]=kt*Ct,i[t]=Mt*Ct}if(h+=H,this.tickSampleCountdown-=H,this.tickSampleCountdown<=0){for(let e=0;e<this.song.getChannelCount();e++)for(let i=0;i<this.releasedTones[e].count();i++){this.releasedTones[e].get(i).ticksSinceReleased++,i+this.activeTones[e].count()>=t.Config.maximumTonesPerChannel&&(this.freeReleasedTone(e,i),i--)}if(this.tick++,this.tickSampleCountdown=r,this.tick==t.Config.ticksPerPart){this.tick=0,this.part++,this.liveInputDuration--;for(let e=0;e<this.song.getChannelCount();e++)for(let i=0;i<this.activeTones[e].count();i++){const s=this.activeTones[e].get(i),n=s.instrument.getTransition();n.isSeamless||null==s.note||s.note.end!=this.part+this.beat*t.Config.partsPerBeat||(n.releases?this.releaseTone(e,s):this.freeTone(s),this.activeTones[e].remove(i),i--)}this.part==t.Config.partsPerBeat&&(this.part=0,n&&(this.beat++,this.beat==this.song.beatsPerBar&&(this.beat=0,this.bar++,0!=this.loopRepeatCount&&this.bar==this.song.loopStart+this.song.loopLength&&(this.bar=this.song.loopStart,this.loopRepeatCount>0&&this.loopRepeatCount--),this.bar>=this.song.barCount&&(this.bar=0,-1!=this.loopRepeatCount&&(a=!0,this.resetEffects(),this.pause())))))}}}-1e-24<T&&T<1e-24&&(T=0),-1e-24<z&&z<1e-24&&(z=0),-1e-24<R&&R<1e-24&&(R=0),-1e-24<N&&N<1e-24&&(N=0),-1e-24<A&&A<1e-24&&(A=0),this.stereoBufferIndex=(this.stereoBufferIndex+2*s)%l,this.chorusPhase=C,this.chorusDelayPos=P,this.reverbDelayPos=S,this.reverbFeedback0=T,this.reverbFeedback1=z,this.reverbFeedback2=R,this.reverbFeedback3=N,this.limit=A,n&&(this.playheadInternal=(((this.tick+1-this.tickSampleCountdown/r)/2+this.part)/t.Config.partsPerBeat+this.beat)/this.song.beatsPerBar+this.bar)}freeTone(t){this.tonePool.pushBack(t)}newTone(){if(this.tonePool.count()>0){const t=this.tonePool.popBack();return t.reset(),t.active=!1,t}return new y}releaseTone(t,e){this.releasedTones[t].pushFront(e)}freeReleasedTone(t,e){this.freeTone(this.releasedTones[t].get(e)),this.releasedTones[t].remove(e)}freeAllTones(){for(;this.liveInputTones.count()>0;)this.freeTone(this.liveInputTones.popBack());for(let t=0;t<this.activeTones.length;t++)for(;this.activeTones[t].count()>0;)this.freeTone(this.activeTones[t].popBack());for(let t=0;t<this.releasedTones.length;t++)for(;this.releasedTones[t].count()>0;)this.freeTone(this.releasedTones[t].popBack())}determineLiveInputTones(t){const e=this.liveInputTones,i=this.liveInputPitches;let s=0;if(this.liveInputDuration>0){const n=t.channels[this.liveInputChannel].instruments[t.getPatternInstrument(this.liveInputChannel,this.bar)];if(n.getChord().arpeggiates){let t;0==e.count()?(t=this.newTone(),e.pushBack(t)):!n.getTransition().isSeamless&&this.liveInputStarted?(this.releaseTone(this.liveInputChannel,e.popFront()),t=this.newTone(),e.pushBack(t)):t=e.get(0),s=1;for(let e=0;e<i.length;e++)t.pitches[e]=i[e];t.pitchCount=i.length,t.chordSize=1,t.instrument=n,t.note=t.prevNote=t.nextNote=null}else for(let t=0;t<i.length;t++){let o;e.count()<=t?(o=this.newTone(),e.pushBack(o)):!n.getTransition().isSeamless&&this.liveInputStarted?(this.releaseTone(this.liveInputChannel,e.get(t)),o=this.newTone(),e.set(t,o)):o=e.get(t),s++,o.pitches[0]=i[t],o.pitchCount=1,o.chordSize=i.length,o.instrument=n,o.note=o.prevNote=o.nextNote=null}}for(;e.count()>s;)this.releaseTone(this.liveInputChannel,e.popBack());this.liveInputStarted=!1}determineCurrentActiveTones(e,i,s){const n=e.channels[i].instruments[e.getPatternInstrument(i,this.bar)],o=e.getPattern(i,this.bar),r=this.part+this.beat*t.Config.partsPerBeat;let h=null,a=null,l=null;if(s&&null!=o&&!e.channels[i].muted)for(let t=0;t<o.notes.length;t++)if(o.notes[t].end<=r)a=o.notes[t];else if(o.notes[t].start<=r&&o.notes[t].end>r)h=o.notes[t];else if(o.notes[t].start>r){l=o.notes[t];break}const c=this.activeTones[i];if(null!=h)null!=a&&a.end!=h.start&&(a=null),null!=l&&l.start!=h.end&&(l=null),this.syncTones(i,c,n,h.pitches,h,a,l,r);else for(;c.count()>0;)c.peakBack().instrument.getTransition().releases?this.releaseTone(i,c.popBack()):this.freeTone(c.popBack())}syncTones(e,i,s,n,o,r,h,a){let l=0;if(s.getChord().arpeggiates){let t;0==i.count()?(t=this.newTone(),i.pushBack(t)):t=i.get(0),l=1;for(let e=0;e<n.length;e++)t.pitches[e]=n[e];t.pitchCount=n.length,t.chordSize=1,t.instrument=s,t.note=o,t.noteStart=o.start,t.noteEnd=o.end,t.prevNote=r,t.nextNote=h,t.prevNotePitchIndex=0,t.nextNotePitchIndex=0}else{const e=s.getTransition();for(let c=0;c<n.length;c++){const n=c*s.getChord().strumParts;let f=r&&r.pitches.length>c?r:null,d=o,u=h&&h.pitches.length>c?h:null,m=d.start+n;if(m>a){if(!(i.count()>c&&e.isSeamless&&null!=f))break;u=d,d=f,f=null,m=d.start+n}let p,y=d.end;e.isSeamless&&null!=u&&(y=Math.min(t.Config.partsPerBeat*this.song.beatsPerBar,y+n)),i.count()<=c?(p=this.newTone(),i.pushBack(p)):p=i.get(c),l++,p.pitches[0]=d.pitches[c],p.pitchCount=1,p.chordSize=d.pitches.length,p.instrument=s,p.note=d,p.noteStart=m,p.noteEnd=y,p.prevNote=f,p.nextNote=u,p.prevNotePitchIndex=c,p.nextNotePitchIndex=c}}for(;i.count()>l;)i.peakBack().instrument.getTransition().releases?this.releaseTone(e,i.popBack()):this.freeTone(i.popBack())}playTone(t,e,i,s,n,o,r,h,a){let l;switch(g.computeTone(this,t,s,n,o,r,h,a),r.instrument.effects){case 0:l=this.samplesForNone;break;case 1:l=this.samplesForReverb;break;case 2:l=this.samplesForChorus;break;case 3:l=this.samplesForChorusReverb;break;default:throw new Error}g.getInstrumentSynthFunction(r.instrument)(this,l,e,i,2*o,r,r.instrument)}static computeEnvelope(t,e,i,s){switch(t.type){case 0:return s;case 1:return 1;case 4:return 1/(1+e*t.speed);case 5:return 1-1/(1+e*t.speed);case 6:return.5-.5*Math.cos(2*i*Math.PI*t.speed);case 7:return.75-.25*Math.cos(2*i*Math.PI*t.speed);case 2:return Math.max(1,2-10*e);case 3:const n=t.speed,o=.25/Math.sqrt(n);return e<o?e/o:1/(1+(e-o)*n);case 8:return Math.pow(2,-t.speed*e);default:throw new Error("Unrecognized operator envelope type.")}}static computeChordVolume(t){return 1/(.25*(t-1)+1)}static computeTone(e,i,s,n,o,r,h,a){const l=r.instrument,c=l.getTransition(),f=l.getChord(),d=f.arpeggiates?1:g.computeChordVolume(r.chordSize),m=i.getChannelIsNoise(s),p=m?t.Config.noiseInterval:1,y=t.Config.ticksPerPart*n/e.samplesPerSecond,b=1/t.Config.partsPerBeat,v=r.active,w=e.tickSampleCountdown,k=1-w/n,M=1-(w-o)/n,x=(e.beat*t.Config.partsPerBeat+e.part)*t.Config.ticksPerPart+e.tick,E=x/t.Config.ticksPerPart,q=(x+1)/t.Config.ticksPerPart,C=E+(q-E)*k,P=E+(q-E)*M;r.phaseDeltaScale=0,r.filter=1,r.filterScale=1,r.vibratoScale=0,r.intervalMult=1,r.intervalVolumeMult=1,r.active=!1;const S=(l.pan-t.Config.panCenter)/t.Config.panCenter,T=65e-5*e.samplesPerSecond,z=2*Math.round(-S*T),R=1.414*Math.cos((1+S)*Math.PI*.25),N=1.414*Math.cos((1-S)*Math.PI*.25),B=Math.max(0,-z),F=Math.max(0,z);z>=0?(r.stereoVolume1=R,r.stereoVolume2=N,r.stereoOffset=0,r.stereoDelay=F+1):(r.stereoVolume1=N,r.stereoVolume2=R,r.stereoOffset=1,r.stereoDelay=B-1);let L,A,H,I,O=!0,$=0,U=0,_=0,D=1,W=1,V=d,j=d,G=0,K=0,J=0,Y=0;if(3==l.type)m?(A=t.Config.spectrumBasePitch,H=.6):(A=t.Config.keys[i.key].basePitch,H=.3),L=t.Config.spectrumBasePitch,I=28;else if(4==l.type)H=.45,L=A=t.Config.spectrumBasePitch,I=48;else if(2==l.type)H=.19,L=A=t.Config.chipNoises[l.chipNoise].basePitch,I=t.Config.chipNoises[l.chipNoise].isSoft?24:60;else if(1==l.type)A=t.Config.keys[i.key].basePitch,H=.03,L=16,I=48;else if(0==l.type)A=t.Config.keys[i.key].basePitch,H=.03375,L=16,I=48;else if(5==l.type)A=t.Config.keys[i.key].basePitch,H=.025,L=16,I=48;else{if(6!=l.type)throw new Error("Unknown instrument type in computeTone.");A=t.Config.keys[i.key].basePitch,H=.04725,L=16,I=48}for(let e=0;e<t.Config.operatorCount;e++)r.phaseDeltas[e]=0,r.volumeStarts[e]=0,r.volumeDeltas[e]=0;if(h){const e=r.noteLengthTicks+r.ticksSinceReleased,i=r.ticksSinceReleased+k,s=r.ticksSinceReleased+M,n=r.noteLengthTicks+i,o=r.noteLengthTicks+s,h=r.instrument.getTransition();O=!1,$=Math.floor(e/t.Config.ticksPerPart),U=_=r.lastInterval,G=K=g.expressionToVolumeMult(r.lastVolume),D=g.expressionToVolumeMult(3*(1-i/h.releaseTicks)),W=g.expressionToVolumeMult(3*(1-s/h.releaseTicks)),J=n/t.Config.ticksPerPart,Y=o/t.Config.ticksPerPart,a&&(D*=1-k,W*=1-M)}else if(null==r.note){D=W=1,G=K=1,r.lastInterval=0,r.lastVolume=3,r.ticksSinceReleased=0,O=!1;const e=r.liveInputSamplesHeld/n;r.liveInputSamplesHeld+=o;const i=r.liveInputSamplesHeld/n;r.noteLengthTicks=i;const s=e/t.Config.ticksPerPart,h=i/t.Config.ticksPerPart;$=Math.floor(s),J=s,Y=h}else{const s=r.note,n=r.prevNote,o=r.nextNote,h=e.part+e.beat*t.Config.partsPerBeat,a=t.Config.partsPerBeat*i.beatsPerBar,l=r.noteStart,u=r.noteEnd;let m;for($=h-l,m=1;m<s.pins.length-1&&!(s.pins[m].time+s.start>h);m++);const p=s.pins[m-1],y=s.pins[m],b=l*t.Config.ticksPerPart,w=u*t.Config.ticksPerPart-b,x=(s.start+p.time)*t.Config.ticksPerPart,C=(s.start+y.time)*t.Config.ticksPerPart;r.lastInterval=s.pins[s.pins.length-1].interval,r.lastVolume=s.pins[s.pins.length-1].volume,r.ticksSinceReleased=0,r.noteLengthTicks=w;const P=h*t.Config.ticksPerPart+e.tick,S=h*t.Config.ticksPerPart+e.tick+1,T=P-b,z=S-b,R=Math.min(1,(P-x)/(C-x)),N=Math.min(1,(S-x)/(C-x));let B=p.volume+(y.volume-p.volume)*R,F=p.volume+(y.volume-p.volume)*N,L=1,A=1,H=d,I=d,Z=p.interval+(y.interval-p.interval)*R,Q=p.interval+(y.interval-p.interval)*N,X=E-l,tt=q-l;O=P+k-b==0||!v;const et=.5*w;if(c.isSeamless&&!c.slides&&0==s.start)O=!v;else if(c.isSeamless&&null!=n&&(O=!v,c.slides)){const t=Math.min(et,c.slideTicks),e=Math.max(0,1-T/t),i=Math.max(0,1-z/t),o=.5*(n.pitches[r.prevNotePitchIndex]+n.pins[n.pins.length-1].interval-r.pitches[0]),h=.5*(n.pins[n.pins.length-1].volume-s.pins[0].volume),a=.5*(n.end-n.start);if(Z+=e*o,Q+=i*o,B+=e*h,F+=i*h,X+=e*a,tt+=i*a,!f.arpeggiates){const t=.5*(n.pitches.length-r.chordSize);H=g.computeChordVolume(r.chordSize+e*t),I=g.computeChordVolume(r.chordSize+i*t)}}if(c.isSeamless&&!c.slides&&s.end==a);else if(c.isSeamless&&null!=o){if(c.slides){const t=Math.min(et,c.slideTicks),e=Math.max(0,1-(w-T)/t),i=Math.max(0,1-(w-z)/t),n=.5*(o.pitches[r.nextNotePitchIndex]-(r.pitches[0]+s.pins[s.pins.length-1].interval)),h=.5*(o.pins[0].volume-s.pins[s.pins.length-1].volume),a=.5*-(u-l);if(Z+=e*n,Q+=i*n,B+=e*h,F+=i*h,X+=e*a,tt+=i*a,!f.arpeggiates){const t=.5*(o.pitches.length-r.chordSize);H=g.computeChordVolume(r.chordSize+e*t),I=g.computeChordVolume(r.chordSize+i*t)}}}else if(!c.releases){const t=c.releaseTicks;t>0&&(L*=Math.min(1,(w-T)/t),A*=Math.min(1,(w-z)/t))}U=Z+(Q-Z)*k,_=Z+(Q-Z)*M,G=g.expressionToVolumeMult(B+(F-B)*k),K=g.expressionToVolumeMult(B+(F-B)*M),D=L+(A-L)*k,W=L+(A-L)*M,V=H+(I-H)*k,j=H+(I-H)*M,J=X+(tt-X)*k,Y=X+(tt-X)*M}const Z=1/e.samplesPerSecond;if(r.active=!0,0==l.type||1==l.type||5==l.type||6==l.type){const e=g.getLFOAmplitude(l,y*C),i=g.getLFOAmplitude(l,y*P),s=$<t.Config.vibratos[l.vibrato].delayParts?0:t.Config.vibratos[l.vibrato].amplitude;U+=s*e,_+=s*i}if(!c.isSeamless||(c.slides||null==r.note||0!=r.note.start)&&null==r.prevNote){const t=c.attackSeconds;t>0&&(D*=Math.min(1,y*J/t),W*=Math.min(1,y*Y/t))}const Q=g.instrumentVolumeToVolumeMult(l.volume);4==l.type&&(r.drumsetPitch=r.pitches[0],null!=r.note&&(r.drumsetPitch+=r.note.pickMainInterval()),r.drumsetPitch=Math.max(0,Math.min(t.Config.drumCount-1,r.drumsetPitch)));const X=l.getFilterCutoffOctaves(),tt=4==l.type?l.getDrumsetEnvelope(r.drumsetPitch):l.getFilterEnvelope(),et=t.Config.filterCutoffMaxHz*Math.pow(2,X),it=2*Math.sin(Math.PI*et/e.samplesPerSecond),st=2*Math.sin(Math.PI*t.Config.filterCutoffMinHz/e.samplesPerSecond);r.filter=it*g.computeEnvelope(tt,y*J,b*C,G);let nt=it*g.computeEnvelope(tt,y*Y,b*P,K);r.filter=Math.min(t.Config.filterMax,Math.max(st,r.filter)),nt=Math.min(t.Config.filterMax,Math.max(st,nt)),r.filterScale=Math.pow(nt/r.filter,1/o);let ot=Math.pow(.5,.35*X);if(l.filterResonance>0&&(ot=Math.pow(ot,1.7)*Math.pow(.5,.125*(l.filterResonance-1))),8==tt.type?ot*=1.25+.025*tt.speed:4==tt.type&&(ot*=1+.02*tt.speed),O&&r.reset(),1==l.type){let s=1,n=0,h=0;if(r.pitchCount>1&&!f.harmonizes){const s=Math.floor((e.tick+e.part*t.Config.ticksPerPart)/t.Config.rhythms[i.rhythm].ticksPerArpeggio);h=r.pitches[t.getArpeggioPitchIndex(r.pitchCount,i.rhythm,s)]-r.pitches[0]}const a=t.Config.algorithms[l.algorithm].carrierCount;for(let e=0;e<t.Config.operatorCount;e++){const i=t.Config.algorithms[l.algorithm].associatedCarrier[e]-1,c=r.pitches[f.harmonizes?e<r.pitchCount?e:i<r.pitchCount?i:0:0],d=t.Config.operatorFrequencies[l.operators[e].frequency].mult,m=t.Config.operatorCarrierInterval[i]+h,v=A+(c+U)*p+m,w=d*u.frequencyFromPitch(v)+t.Config.operatorFrequencies[l.operators[e].frequency].hzOffset;r.phaseDeltas[e]=w*Z*t.Config.sineWaveLength;const k=g.operatorAmplitudeCurve(l.operators[e].amplitude),M=k*t.Config.operatorFrequencies[l.operators[e].frequency].amplitudeSign;let x=M,E=M;if(e<a){const t=A+(c+_)*p+m,e=Math.pow(2,-(v-L)/I),i=Math.pow(2,-(t-L)/I);x*=e,E*=i,n+=k}else x*=1.5*t.Config.sineWaveLength,E*=1.5*t.Config.sineWaveLength,s*=1-Math.min(1,l.operators[e].amplitude/15);const q=t.Config.envelopes[l.operators[e].envelope];x*=g.computeEnvelope(q,y*J,b*C,G),E*=g.computeEnvelope(q,y*Y,b*P,K),r.volumeStarts[e]=x,r.volumeDeltas[e]=(E-x)/o}const c=.3*t.Config.sineWaveLength*l.feedbackAmplitude/15,d=t.Config.envelopes[l.feedbackEnvelope];let m=c*g.computeEnvelope(d,y*J,b*C,G),v=c*g.computeEnvelope(d,y*Y,b*P,K);r.feedbackMult=m,r.feedbackDelta=(v-r.feedbackMult)/o;const w=H*Q;r.volumeStart=ot*w*D*V;const k=ot*w*W*j;r.volumeDelta=(k-r.volumeStart)/o,s*=(Math.pow(2,2-1.4*l.feedbackAmplitude/15)-1)/3,s*=1-Math.min(1,Math.max(0,n-1)/2),r.volumeStart*=1+3*s,r.volumeDelta*=1+3*s}else{let s=r.pitches[0];if(r.pitchCount>1){const n=Math.floor((e.tick+e.part*t.Config.ticksPerPart)/t.Config.rhythms[i.rhythm].ticksPerArpeggio);if(f.harmonizes){const e=r.pitches[1+t.getArpeggioPitchIndex(r.pitchCount-1,i.rhythm,n)]-r.pitches[0];r.intervalMult=Math.pow(2,e/12),r.intervalVolumeMult=Math.pow(2,-e/I)}else s=r.pitches[t.getArpeggioPitchIndex(r.pitchCount,i.rhythm,n)]}const n=A+(s+U)*p,h=A+(s+_)*p,a=u.frequencyFromPitch(n),c=Math.pow(2,-(n-L)/I),d=Math.pow(2,-(h-L)/I);let m=H*ot;if(2==l.type&&(m*=t.Config.chipNoises[l.chipNoise].volume),0==l.type&&(m*=t.Config.chipWaves[l.chipWave].volume),0!=l.type&&5!=l.type||(m*=t.Config.intervals[l.interval].volume),6==l.type){const e=t.Config.envelopes[l.pulseEnvelope],i=.5*Math.pow(.5,.5*(t.Config.pulseWidthRange-l.pulseWidth-1)),s=i*g.computeEnvelope(e,y*J,b*C,G),n=i*g.computeEnvelope(e,y*Y,b*P,K);r.pulseWidth=s,r.pulseWidthDelta=(n-s)/o}r.phaseDeltas[0]=a*Z,r.volumeStart=D*V*c*m*Q;let v=W*j*d*m*Q;0==tt.type||6==l.type&&0==t.Config.envelopes[l.pulseEnvelope].type||(r.volumeStart*=G,v*=K),r.volumeDelta=(v-r.volumeStart)/o}r.phaseDeltaScale=Math.pow(2,(_-U)*p/12/o)}static getLFOAmplitude(e,i){let s=0;for(const n of t.Config.vibratos[e.vibrato].periodsSeconds)s+=Math.sin(2*Math.PI*i/n);return s}static getInstrumentSynthFunction(e){if(1==e.type){const i=e.algorithm+"_"+e.feedbackType;if(void 0==g.fmSynthFunctionCache[i]){const s=[];for(const i of g.fmSourceTemplate)if(-1!=i.indexOf("// CARRIER OUTPUTS")){const n=[];for(let i=0;i<t.Config.algorithms[e.algorithm].carrierCount;i++)n.push("operator"+i+"Scaled");s.push(i.replace("/*operator#Scaled*/",n.join(" + ")))}else if(-1!=i.indexOf("// INSERT OPERATOR COMPUTATION HERE"))for(let i=t.Config.operatorCount-1;i>=0;i--)for(const n of g.operatorSourceTemplate)if(-1!=n.indexOf("/* + operator@Scaled*/")){let o="";for(const s of t.Config.algorithms[e.algorithm].modulatedBy[i])o+=" + operator"+(s-1)+"Scaled";const r=t.Config.feedbacks[e.feedbackType].indices[i];if(r.length>0){o+=" + feedbackMult * (";const t=[];for(const e of r)t.push("operator"+(e-1)+"Output");o+=t.join(" + ")+")"}s.push(n.replace(/\#/g,i+"").replace("/* + operator@Scaled*/",o))}else s.push(n.replace(/\#/g,i+""));else if(-1!=i.indexOf("#"))for(let e=0;e<t.Config.operatorCount;e++)s.push(i.replace(/\#/g,e+""));else s.push(i);g.fmSynthFunctionCache[i]=new Function("synth","data","stereoBufferIndex","stereoBufferLength","runLength","tone","instrument",s.join("\n"))}return g.fmSynthFunctionCache[i]}if(0==e.type)return g.chipSynth;if(5==e.type)return g.harmonicsSynth;if(6==e.type)return g.pulseWidthSynth;if(2==e.type)return g.noiseSynth;if(3==e.type)return g.spectrumSynth;if(4==e.type)return g.drumsetSynth;throw new Error("Unrecognized instrument type: "+e.type)}static chipSynth(e,i,s,n,o,r,h){const a=t.Config.chipWaves[h.chipWave].samples,l=+a.length-1,c=+Math.pow(2,(t.Config.intervals[h.interval].offset+t.Config.intervals[h.interval].spread)/12),f=Math.pow(2,(t.Config.intervals[h.interval].offset-t.Config.intervals[h.interval].spread)/12)*r.intervalMult,d=r.intervalVolumeMult*t.Config.intervals[h.interval].sign;0!=h.interval||h.getChord().customInterval||(r.phases[1]=r.phases[0]);const u=f/c;let m=r.phaseDeltas[0]*c*l,p=m*u;const y=+r.phaseDeltaScale;let g=+r.volumeStart;const b=+r.volumeDelta;let v=r.phases[0]%1*l,w=r.phases[1]%1*l,k=+r.filter,M=h.getFilterIsFirstOrder()?1:k;const x=+r.filterScale,E=h.getFilterIsFirstOrder()?1:x,q=t.Config.filterMaxResonance*Math.pow(Math.max(0,h.getFilterResonance()-1)/(t.Config.filterResonanceRange-2),.5);let C=+r.filterSample0,P=+r.filterSample1;const S=0|v,T=0|w,z=S%l,R=T%l,N=v-S,B=w-T;let F=a[z],L=a[R];F+=(a[z+1]-F)*N,L+=(a[R+1]-L)*B;const A=s+o;s+=r.stereoOffset;const H=r.stereoVolume1,I=r.stereoVolume2,O=r.stereoDelay;for(;s<A;){const t=0|(v+=m),e=0|(w+=p),o=t%l,r=e%l;let h=a[o],c=a[r];const f=v-t,u=w-e;let S=((h+=(a[o+1]-h)*f)-F)/m,T=((c+=(a[r+1]-c)*u)-L)/p;F=h,L=c,P+=M*((C+=k*(S+T*d-C+(q+q/(1-k))*(C-P)))-P),k*=x,M*=E,m*=y,p*=y;const z=P*g;g+=b,i[s]+=z*H,i[(s+O)%n]+=z*I,s+=2}r.phases[0]=v/l,r.phases[1]=w/l;-1e-24<C&&C<1e-24&&(C=0),-1e-24<P&&P<1e-24&&(P=0),r.filterSample0=C,r.filterSample1=P}static harmonicsSynth(e,i,s,n,o,r,h){const a=h.harmonicsWave.getCustomWave(),l=+a.length-1,c=+Math.pow(2,(t.Config.intervals[h.interval].offset+t.Config.intervals[h.interval].spread)/12),f=Math.pow(2,(t.Config.intervals[h.interval].offset-t.Config.intervals[h.interval].spread)/12)*r.intervalMult,d=r.intervalVolumeMult*t.Config.intervals[h.interval].sign;0!=h.interval||h.getChord().customInterval||(r.phases[1]=r.phases[0]);const u=f/c;let m=r.phaseDeltas[0]*c*l,p=m*u;const y=+r.phaseDeltaScale;let g=+r.volumeStart;const b=+r.volumeDelta;let v=r.phases[0]%1*l,w=r.phases[1]%1*l,k=+r.filter,M=h.getFilterIsFirstOrder()?1:k;const x=+r.filterScale,E=h.getFilterIsFirstOrder()?1:x,q=t.Config.filterMaxResonance*Math.pow(Math.max(0,h.getFilterResonance()-1)/(t.Config.filterResonanceRange-2),.5);let C=+r.filterSample0,P=+r.filterSample1;const S=0|v,T=0|w,z=S%l,R=T%l,N=v-S,B=w-T;let F=a[z],L=a[R];F+=(a[z+1]-F)*N,L+=(a[R+1]-L)*B;const A=s+o;s+=r.stereoOffset;const H=r.stereoVolume1,I=r.stereoVolume2,O=r.stereoDelay;for(;s<A;){const t=0|(v+=m),e=0|(w+=p),o=t%l,r=e%l;let h=a[o],c=a[r];const f=v-t,u=w-e;let S=((h+=(a[o+1]-h)*f)-F)/m,T=((c+=(a[r+1]-c)*u)-L)/p;F=h,L=c,P+=M*((C+=k*(S+T*d-C+(q+q/(1-k))*(C-P)))-P),k*=x,M*=E,m*=y,p*=y;const z=P*g;g+=b,i[s]+=z*H,i[(s+O)%n]+=z*I,s+=2}r.phases[0]=v/l,r.phases[1]=w/l;-1e-24<C&&C<1e-24&&(C=0),-1e-24<P&&P<1e-24&&(P=0),r.filterSample0=C,r.filterSample1=P}static pulseWidthSynth(e,i,s,n,o,r,h){let a=r.phaseDeltas[0];const l=+r.phaseDeltaScale;let c=+r.volumeStart;const f=+r.volumeDelta;let d=r.phases[0]%1,u=r.pulseWidth;const m=r.pulseWidthDelta;let p=+r.filter,y=h.getFilterIsFirstOrder()?1:p;const g=+r.filterScale,b=h.getFilterIsFirstOrder()?1:g,v=t.Config.filterMaxResonance*Math.pow(Math.max(0,h.getFilterResonance()-1)/(t.Config.filterResonanceRange-2),.5);let w=+r.filterSample0,k=+r.filterSample1;const M=s+o;s+=r.stereoOffset;const x=r.stereoVolume1,E=r.stereoVolume2,q=r.stereoDelay;for(;s<M;){const t=d%1,e=(d+u)%1;let o=e-t;if(t<a)o+=.5*((C=t/a)+C-C*C-1);else if(t>1-a){o+=.5*((C=(t-1)/a)+C+C*C+1)}if(e<a)o-=.5*((C=e/a)+C-C*C-1);else if(e>1-a){var C;o-=.5*((C=(e-1)/a)+C+C*C+1)}k+=y*((w+=p*(o-w+(v+v/(1-p))*(w-k)))-k),p*=g,y*=b,d+=a,a*=l,u+=m;const r=k*c;c+=f,i[s]+=r*x,i[(s+q)%n]+=r*E,s+=2}r.phases[0]=d;-1e-24<w&&w<1e-24&&(w=0),-1e-24<k&&k<1e-24&&(k=0),r.filterSample0=w,r.filterSample1=k}static noiseSynth(e,i,s,n,o,r,h){let a=h.getDrumWave(),l=+r.phaseDeltas[0];const c=+r.phaseDeltaScale;let f=+r.volumeStart;const d=+r.volumeDelta;let u=r.phases[0]%1*t.Config.chipNoiseLength;0==r.phases[0]&&(u=Math.random()*t.Config.chipNoiseLength);let m=+r.sample,p=+r.filter,y=h.getFilterIsFirstOrder()?1:p;const g=+r.filterScale,b=h.getFilterIsFirstOrder()?1:g,v=t.Config.filterMaxResonance*Math.pow(Math.max(0,h.getFilterResonance()-1)/(t.Config.filterResonanceRange-2),.5);let w=+r.filterSample0,k=+r.filterSample1;const M=Math.min(1,r.phaseDeltas[0]*t.Config.chipNoises[h.chipNoise].pitchFilterMult),x=s+o;s+=r.stereoOffset;const E=r.stereoVolume1,q=r.stereoVolume2,C=r.stereoDelay;for(;s<x;){k+=y*((w+=p*((m+=(a[32767&u]-m)*M)-w+(v+v/(1-p))*(w-k)))-k),u+=l,p*=g,y*=b,l*=c;const t=k*f;f+=d,i[s]+=t*E,i[(s+C)%n]+=t*q,s+=2}r.phases[0]=u/t.Config.chipNoiseLength,r.sample=m;-1e-24<w&&w<1e-24&&(w=0),-1e-24<k&&k<1e-24&&(k=0),r.filterSample0=w,r.filterSample1=k}static spectrumSynth(e,i,s,n,o,r,h){let a=h.getDrumWave(),l=128*r.phaseDeltas[0];const c=+r.phaseDeltaScale;let f=+r.volumeStart;const d=+r.volumeDelta;let u=+r.sample,m=+r.filter,p=h.getFilterIsFirstOrder()?1:m;const y=+r.filterScale,b=h.getFilterIsFirstOrder()?1:y,v=t.Config.filterMaxResonance*Math.pow(Math.max(0,h.getFilterResonance()-1)/(t.Config.filterResonanceRange-2),.5);let w=+r.filterSample0,k=+r.filterSample1,M=r.phases[0]%1*t.Config.chipNoiseLength;0==r.phases[0]&&(M=g.findRandomZeroCrossing(a)+l);const x=Math.min(1,l),E=s+o;s+=r.stereoOffset;const q=r.stereoVolume1,C=r.stereoVolume2,P=r.stereoDelay;for(;s<E;){const t=0|M,e=32767&t;let o=a[e];const r=M-t;k+=p*((w+=m*((u+=((o+=(a[e+1]-o)*r)-u)*x)-w+(v+v/(1-m))*(w-k)))-k),M+=l,m*=y,p*=b,l*=c;const h=k*f;f+=d,i[s]+=h*q,i[(s+P)%n]+=h*C,s+=2}r.phases[0]=M/t.Config.chipNoiseLength,r.sample=u;-1e-24<w&&w<1e-24&&(w=0),-1e-24<k&&k<1e-24&&(k=0),r.filterSample0=w,r.filterSample1=k}static drumsetSynth(e,i,s,n,o,r,h){let a=h.getDrumsetWave(r.drumsetPitch),l=r.phaseDeltas[0]/u.drumsetIndexReferenceDelta(r.drumsetPitch);const c=+r.phaseDeltaScale;let f=+r.volumeStart;const d=+r.volumeDelta;let m=+r.sample,p=+r.filter,y=h.getFilterIsFirstOrder()?1:p;const b=+r.filterScale,v=h.getFilterIsFirstOrder()?1:b,w=t.Config.filterMaxResonance*Math.pow(Math.max(0,h.getFilterResonance()-1)/(t.Config.filterResonanceRange-2),.5);let k=+r.filterSample0,M=+r.filterSample1,x=r.phases[0]%1*t.Config.chipNoiseLength;0==r.phases[0]&&(x=g.findRandomZeroCrossing(a)+l);const E=s+o;s+=r.stereoOffset;const q=r.stereoVolume1,C=r.stereoVolume2,P=r.stereoDelay;for(;s<E;){const t=0|x,e=32767&t;m=a[e];const o=x-t;M+=y*((k+=p*((m+=(a[e+1]-m)*o)-k+(w+w/(1-p))*(k-M)))-M),x+=l,p*=b,y*=v,l*=c;const r=M*f;f+=d,i[s]+=r*q,i[(s+P)%n]+=r*C,s+=2}r.phases[0]=x/t.Config.chipNoiseLength,r.sample=m;-1e-24<k&&k<1e-24&&(k=0),-1e-24<M&&M<1e-24&&(M=0),r.filterSample0=k,r.filterSample1=M}static findRandomZeroCrossing(e){let i=Math.random()*t.Config.chipNoiseLength,s=32767&i,n=e[s];for(let o=128;o>0;o--){const o=s+16&32767,r=e[o];if(n*r<=0){for(let o=0;o<16;o++){const o=s+1&32767,r=e[o];if(n*r<=0){const e=r-n;i=s,Math.abs(e)>1e-8&&(i+=-n/e),i=Math.max(0,i)%t.Config.chipNoiseLength;break}s=o,n=r}break}s=o,n=r}return i}static instrumentVolumeToVolumeMult(e){return e==t.Config.volumeRange-1?0:Math.pow(2,t.Config.volumeLogScale*e)}static volumeMultToInstrumentVolume(e){return e<=0?t.Config.volumeRange-1:Math.min(t.Config.volumeRange-2,Math.log(e)/Math.LN2/t.Config.volumeLogScale)}static expressionToVolumeMult(t){return Math.pow(Math.max(0,t)/3,1.5)}static volumeMultToExpression(t){return 3*Math.pow(Math.max(0,t),1/1.5)}getSamplesPerTick(){if(null==this.song)return 0;const e=this.song.getBeatsPerMinute()/60*t.Config.partsPerBeat*t.Config.ticksPerPart;return Math.floor(this.samplesPerSecond/e)}}g.fmSynthFunctionCache={},g.fmSourceTemplate=("\n\t\t\tconst sineWave = beepbox.Config.sineWave;\n\t\t\t\n\t\t\tlet phaseDeltaScale = +tone.phaseDeltaScale;\n\t\t\t// I'm adding 1000 to the phase to ensure that it's never negative even when modulated by other waves because negative numbers don't work with the modulus operator very well.\n\t\t\tlet operator#Phase       = +((tone.phases[#] % 1) + 1000) * beepbox.Config.sineWaveLength;\n\t\t\tlet operator#PhaseDelta  = +tone.phaseDeltas[#];\n\t\t\tlet operator#OutputMult  = +tone.volumeStarts[#];\n\t\t\tconst operator#OutputDelta = +tone.volumeDeltas[#];\n\t\t\tlet operator#Output      = +tone.feedbackOutputs[#];\n\t\t\tlet feedbackMult         = +tone.feedbackMult;\n\t\t\tconst feedbackDelta        = +tone.feedbackDelta;\n\t\t\tlet volume = +tone.volumeStart;\n\t\t\tconst volumeDelta = +tone.volumeDelta;\n\t\t\t\n\t\t\tlet filter1 = +tone.filter;\n\t\t\tlet filter2 = instrument.getFilterIsFirstOrder() ? 1.0 : filter1;\n\t\t\tconst filterScale1 = +tone.filterScale;\n\t\t\tconst filterScale2 = instrument.getFilterIsFirstOrder() ? 1.0 : filterScale1;\n\t\t\tconst filterResonance = beepbox.Config.filterMaxResonance * Math.pow(Math.max(0, instrument.getFilterResonance() - 1) / (beepbox.Config.filterResonanceRange - 2), 0.5);\n\t\t\tlet filterSample0 = +tone.filterSample0;\n\t\t\tlet filterSample1 = +tone.filterSample1;\n\t\t\t\n\t\t\tconst stopIndex = stereoBufferIndex + runLength;\n\t\t\tstereoBufferIndex += tone.stereoOffset;\n\t\t\tconst stereoVolume1 = tone.stereoVolume1;\n\t\t\tconst stereoVolume2 = tone.stereoVolume2;\n\t\t\tconst stereoDelay = tone.stereoDelay;\n\t\t\twhile (stereoBufferIndex < stopIndex) {\n\t\t\t\t// INSERT OPERATOR COMPUTATION HERE\n\t\t\t\tconst fmOutput = (/*operator#Scaled*/); // CARRIER OUTPUTS\n\t\t\t\t\n\t\t\t\tconst feedback = filterResonance + filterResonance / (1.0 - filter1);\n\t\t\t\tfilterSample0 += filter1 * (fmOutput - filterSample0 + feedback * (filterSample0 - filterSample1));\n\t\t\t\tfilterSample1 += filter2 * (filterSample0 - filterSample1);\n\t\t\t\t\n\t\t\t\tfeedbackMult += feedbackDelta;\n\t\t\t\toperator#OutputMult += operator#OutputDelta;\n\t\t\t\toperator#Phase += operator#PhaseDelta;\n\t\t\t\toperator#PhaseDelta *= phaseDeltaScale;\n\t\t\t\tfilter1 *= filterScale1;\n\t\t\t\tfilter2 *= filterScale2;\n\t\t\t\t\n\t\t\t\tconst output = filterSample1 * volume;\n\t\t\t\tvolume += volumeDelta;\n\t\t\t\t\n\t\t\t\tdata[stereoBufferIndex] += output * stereoVolume1;\n\t\t\t\tdata[(stereoBufferIndex + stereoDelay) % stereoBufferLength] += output * stereoVolume2;\n\t\t\t\tstereoBufferIndex += 2;\n\t\t\t}\n\t\t\t\n\t\t\ttone.phases[#] = operator#Phase / "+t.Config.sineWaveLength+";\n\t\t\ttone.feedbackOutputs[#] = operator#Output;\n\t\t\t\n\t\t\tconst epsilon = (1.0e-24);\n\t\t\tif (-epsilon < filterSample0 && filterSample0 < epsilon) filterSample0 = 0.0;\n\t\t\tif (-epsilon < filterSample1 && filterSample1 < epsilon) filterSample1 = 0.0;\n\t\t\ttone.filterSample0 = filterSample0;\n\t\t\ttone.filterSample1 = filterSample1;\n\t\t").split("\n"),g.operatorSourceTemplate=("\n\t\t\t\tconst operator#PhaseMix = operator#Phase/* + operator@Scaled*/;\n\t\t\t\tconst operator#PhaseInt = operator#PhaseMix|0;\n\t\t\t\tconst operator#Index    = operator#PhaseInt & "+t.Config.sineWaveMask+";\n\t\t\t\tconst operator#Sample   = sineWave[operator#Index];\n\t\t\t\toperator#Output       = operator#Sample + (sineWave[operator#Index + 1] - operator#Sample) * (operator#PhaseMix - operator#PhaseInt);\n\t\t\t\tconst operator#Scaled   = operator#OutputMult * operator#Output;\n\t\t").split("\n"),t.Synth=g}(beepbox||(beepbox={})),function(t){const e="songVersion: ",i=8,s=18e4,n=6e4;function o(t){return JSON.parse(t.substring(e.length))}function r(t){return e+JSON.stringify(t)}function h(t,e){return e.versions[0].time-t.versions[0].time}function a(t,e){return e.time-t.time}t.versionToKey=r,t.generateUid=function(){return("00000"+(Math.random()*(-1>>>0)>>>0).toString(32)).slice(-6)};class l{constructor(){this.H=0,this.I=new t.Song}static getAllRecoveredSongs(){const t=[],i={};for(let s=0;s<localStorage.length;s++){const n=localStorage.key(s);if(0==n.indexOf(e)){const e=o(n);let s=i[e.uid];void 0==s&&(s={versions:[]},i[e.uid]=s,t.push(s)),s.versions.push(e)}}for(const e of t)e.versions.sort(a);return t.sort(h),t}saveVersion(t,e){const o=Math.round(Date.now());clearTimeout(this.H),this.H=setTimeout(()=>{try{this.I.fromBase64String(e)}catch(t){return void window.alert('Whoops, the song data appears to have been corrupted! Please try to recover the last working version of the song from the "Recover Recent Song..." option in BeepBox\'s "File" menu.')}const h=l.getAllRecoveredSongs();let a=null;for(const e of h)e.versions[0].uid==t&&(a=e);null==a&&(a={versions:[]},h.unshift(a));let c=a.versions,f=1e3;if(c.length>0){const t=c[0].time;f=c[0].work+Math.min(s,o-t)}const d={uid:t,time:o,work:f},u=r(d);c.unshift(d),localStorage.setItem(u,e);let m=n;const p=Math.pow(2,.5);for(var y=1;y<c.length;y++){if(c[y].work-(y==c.length-1?0:c[y+1].work)<m){let t=y;if(y<c.length-1){const e=c[y].time,i=c[y-1].time;e-c[y+1].time<.5*(i-e)&&(t=y+1)}localStorage.removeItem(r(c[t]));break}m*=p}for(;h.length>i;){let t=null,e=Number.POSITIVE_INFINITY;for(let s=Math.round(i/2);s<h.length;s++){const i=h[s],n=1/((o-i.versions[0].time)/432e5+1),r=(i.versions[0].work+3e5)*n;e>r&&(e=r,t=i)}for(const e of t.versions)localStorage.removeItem(r(e));h.splice(h.indexOf(t),1)}},750)}}t.SongRecovery=l}(beepbox||(beepbox={})),function(t){t.ChangeNotifier=class{constructor(){this.O=[],this.$=!1}watch(t){-1==this.O.indexOf(t)&&this.O.push(t)}unwatch(t){const e=this.O.indexOf(t);-1!=e&&this.O.splice(e,1)}changed(){this.$=!0}notifyWatchers(){if(this.$){this.$=!1;for(const t of this.O.concat())t()}}}}(beepbox||(beepbox={})),function(t){class e{constructor(){this.notifier=new t.ChangeNotifier,this.channel=0,this.bar=0,this.volume=75,this.trackVisibleBars=16,this.barScrollPos=0,this.prompt=null,this.U=new t.SongRecovery,this._=null,this.W=0,this.V=0,this.j=!1,this.K=0,this.J=0,this.Y=!1,this.Z=(()=>{if(null==window.history.state&&""!=window.location.hash){this.W++,this.X();const e={canUndo:!0,sequenceNumber:this.W,bar:this.bar,channel:this.channel,recoveryUid:this.tt,prompt:null};return new t.ChangeSong(this,window.location.hash),this.prompt=e.prompt,this.displayBrowserUrl?this.et(e,this.song.toBase64String()):this.it(e,this.song.toBase64String()),this.forgetLastChange(),void this.notifier.notifyWatchers()}const e=this.st();if(null==e)throw new Error("History state is null.");e.sequenceNumber!=this.W&&(e.sequenceNumber==this.W-1?(this.bar=this.K,this.channel=this.J):e.sequenceNumber!=this.W&&(this.bar=e.bar,this.channel=e.channel),this.W=e.sequenceNumber,this.prompt=e.prompt,new t.ChangeSong(this,this.nt()),this.K=e.bar,this.J=e.channel,this.tt=e.recoveryUid,this.forgetLastChange(),this.notifier.notifyWatchers())}),this.ot=(()=>{this.notifier.notifyWatchers()}),this.rt=(()=>{this.Y=!1;const t=this.song.toBase64String();1==this.V?this.W++:this.V>=2&&(this.W+=2),this.j?this.X():this.U.saveVersion(this.tt,t);let e={canUndo:!0,sequenceNumber:this.W,bar:this.bar,channel:this.channel,recoveryUid:this.tt,prompt:this.prompt};0==this.V?this.et(e,t):this.it(e,t),this.K=e.bar,this.J=e.channel,this.V=0,this.j=!1}),this.autoPlay="true"==window.localStorage.getItem("autoPlay"),this.autoFollow="true"==window.localStorage.getItem("autoFollow"),this.enableNotePreview="false"!=window.localStorage.getItem("enableNotePreview"),this.showFifth="true"==window.localStorage.getItem("showFifth"),this.showLetters="true"==window.localStorage.getItem("showLetters"),this.showChannels="true"==window.localStorage.getItem("showChannels"),this.showScrollBar="true"==window.localStorage.getItem("showScrollBar"),this.alwaysShowSettings="true"==window.localStorage.getItem("alwaysShowSettings"),this.enableChannelMuting="true"==window.localStorage.getItem("enableChannelMuting"),this.displayBrowserUrl="false"!=window.localStorage.getItem("displayBrowserUrl"),this.fullScreen="true"==window.localStorage.getItem("fullScreen"),this.colorTheme=window.localStorage.getItem("colorTheme")||"dark classic",t.ColorConfig.setTheme(this.colorTheme),t.Layout.setFullScreen(this.fullScreen),null!=window.localStorage.getItem("volume")&&(this.volume=Math.min(window.localStorage.getItem("volume")>>>0,75)),null==window.sessionStorage.getItem("currentUndoIndex")&&(window.sessionStorage.setItem("currentUndoIndex","0"),window.sessionStorage.setItem("oldestUndoIndex","0"),window.sessionStorage.setItem("newestUndoIndex","0"));let e=window.location.hash;""==e&&(e=this.nt()),this.song=new t.Song(e),""!=e&&void 0!=e||t.setDefaultInstruments(this.song),e=this.song.toBase64String(),this.synth=new t.Synth(this.song),this.synth.volume=this.ht();let i=this.st();null==i&&(i={canUndo:!1,sequenceNumber:0,bar:0,channel:0,recoveryUid:t.generateUid(),prompt:null}),void 0==i.recoveryUid&&(i.recoveryUid=t.generateUid()),this.et(i,e),window.addEventListener("hashchange",this.Z),window.addEventListener("popstate",this.Z),this.bar=i.bar,this.channel=i.channel,this.K=i.bar,this.J=i.channel,this.tt=i.recoveryUid,this.barScrollPos=Math.max(0,this.bar-(this.trackVisibleBars-6)),this.prompt=i.prompt;for(const t of["input","change","click","keyup","keydown","mousedown","mousemove","mouseup","touchstart","touchmove","touchend","touchcancel"])window.addEventListener(t,this.ot)}toggleDisplayBrowserUrl(){const t=this.st();this.displayBrowserUrl=!this.displayBrowserUrl,this.et(t,this.song.toBase64String())}st(){if(this.displayBrowserUrl)return window.history.state;{const t=JSON.parse(window.sessionStorage.getItem(window.sessionStorage.getItem("currentUndoIndex")));return null==t?null:t.state}}nt(){if(this.displayBrowserUrl)return window.location.hash;{const t=JSON.parse(window.sessionStorage.getItem(window.sessionStorage.getItem("currentUndoIndex")));return null==t?"":t.hash}}et(t,e){this.displayBrowserUrl?window.history.replaceState(t,"","#"+e):(window.sessionStorage.setItem(window.sessionStorage.getItem("currentUndoIndex")||"0",JSON.stringify({state:t,hash:e})),window.history.replaceState(null,"",location.pathname))}it(t,i){if(this.displayBrowserUrl)window.history.pushState(t,"","#"+i);else{let s=Number(window.sessionStorage.getItem("currentUndoIndex")),n=Number(window.sessionStorage.getItem("oldestUndoIndex"));s=(s+1)%e.at,window.sessionStorage.setItem("currentUndoIndex",String(s)),window.sessionStorage.setItem("newestUndoIndex",String(s)),s==n&&(n=(n+1)%e.at,window.sessionStorage.setItem("oldestUndoIndex",String(n))),window.sessionStorage.setItem(String(s),JSON.stringify({state:t,hash:i})),window.history.replaceState(null,"",location.pathname)}}lt(){if(this.displayBrowserUrl)window.history.forward();else{let t=Number(window.sessionStorage.getItem("currentUndoIndex"));t!=Number(window.sessionStorage.getItem("newestUndoIndex"))&&(t=(t+1)%e.at,window.sessionStorage.setItem("currentUndoIndex",String(t)),setTimeout(this.Z))}}ct(){if(this.displayBrowserUrl)window.history.back();else{let t=Number(window.sessionStorage.getItem("currentUndoIndex"));t!=Number(window.sessionStorage.getItem("oldestUndoIndex"))&&(t=(t+e.at-1)%e.at,window.sessionStorage.setItem("currentUndoIndex",String(t)),setTimeout(this.Z))}}record(t,e=1,i=!1){t.isNoop()?(this._=null,0==e&&this.ct()):(t.commit(),this._=t,this.V<e&&(this.V=e),this.j=this.j||i,this.Y||(window.requestAnimationFrame(this.rt),this.Y=!0))}X(){this.tt=t.generateUid()}openPrompt(t){this.prompt=t;const e=this.song.toBase64String();this.W++;const i={canUndo:!0,sequenceNumber:this.W,bar:this.bar,channel:this.channel,recoveryUid:this.tt,prompt:this.prompt};this.it(i,e)}undo(){this.st().canUndo&&this.ct()}redo(){this.lt()}setProspectiveChange(t){this._=t}forgetLastChange(){this._=null}lastChangeWas(t){return null!=t&&t==this._}goBackToStart(){this.channel=0,this.bar=0,this.barScrollPos=0,this.notifier.changed(),this.synth.snapToStart(),this.notifier.changed()}savePreferences(){window.localStorage.setItem("autoPlay",this.autoPlay?"true":"false"),window.localStorage.setItem("autoFollow",this.autoFollow?"true":"false"),window.localStorage.setItem("enableNotePreview",this.enableNotePreview?"true":"false"),window.localStorage.setItem("showFifth",this.showFifth?"true":"false"),window.localStorage.setItem("showLetters",this.showLetters?"true":"false"),window.localStorage.setItem("showChannels",this.showChannels?"true":"false"),window.localStorage.setItem("showScrollBar",this.showScrollBar?"true":"false"),window.localStorage.setItem("alwaysShowSettings",this.alwaysShowSettings?"true":"false"),window.localStorage.setItem("enableChannelMuting",this.enableChannelMuting?"true":"false"),window.localStorage.setItem("displayBrowserUrl",this.displayBrowserUrl?"true":"false"),window.localStorage.setItem("fullScreen",this.fullScreen?"true":"false"),window.localStorage.setItem("colorTheme",this.colorTheme),window.localStorage.setItem("volume",String(this.volume))}setVolume(t){this.volume=t,this.savePreferences(),this.synth.volume=this.ht()}ht(){return Math.min(1,Math.pow(this.volume/50,.5))*Math.pow(2,(this.volume-75)/25)}getCurrentPattern(t=0){return this.song.getPattern(this.channel,this.bar+t)}getCurrentInstrument(t=0){const e=this.getCurrentPattern(t);return null==e?0:e.instrument}getMobileLayout(){return window.innerWidth<=700}getBarWidth(){return this.getMobileLayout()||!this.enableChannelMuting||this.getFullScreen()?32:30}getChannelHeight(){return this.getMobileLayout()||this.song.getChannelCount()>4||this.song.barCount>this.trackVisibleBars&&this.song.getChannelCount()>3?27:32}getFullScreen(){return!this.getMobileLayout()&&this.fullScreen}}e.at=100,t.SongDocument=e}(beepbox||(beepbox={})),function(t){const{button:e,div:i,p:s,h2:n}=t.HTML;t.TipPrompt=class{constructor(t,o){let r;switch(this.ft=t,this.dt=e({className:"cancelButton"}),this.ut=(()=>{this.ft.undo()}),this.cleanUp=(()=>{this.dt.removeEventListener("click",this.ut)}),o){case"scale":r=i(n("Scale"),s("This setting limits the available pitches for adding notes. You may think that there's no point in limiting your choices, but the set of pitches you use has a strong influence on the mood and feel of your song, and these scales serve as guides to help you choose appropriate pitches. Don't worry, you can change the scale at any time, so you're not locked into it. Try making little melodies using all the available notes of a scale to get a sense for how it sounds."),s('Most of the scales have a major version, marked with a smiley face, and a minor version, marked with a sad face. Major scales tend to sound more playful or optimistic if you emphasize "tonic" notes (the brown rows in the pattern editor) at various points in your melody, whereas minor scales sound more serious or sad if you emphasize "tonic" notes.'));break;case"key":r=i(n("Song Key"),s('This setting can shift the frequency of every note in your entire song up or down to align the tonic notes (the brown rows) with the selected "key" pitch.'));break;case"tempo":r=i(n("Song Tempo"),s("This setting controls the speed of your song, measured in beats-per-minute."));break;case"reverb":r=i(n("Reverb"),s("Reverb is a kind of echo effect. You can use this slider to control the amount of reverb for instruments that enable it. A little bit helps instruments sound more natural. Adding a lot of reverb can add sense of depth or mystery."));break;case"rhythm":r=i(n("Rhythm"),s("This setting determines how beats are divided. The pattern editor helps you align notes to fractions of a beat based on this setting."));break;case"instrumentIndex":r=i(n("Instrument Number"),s("BeepBox can have multiple instruments per channel, but it can only play one instrument at a time in each channel. This setting determines which of the instruments should be used to play the currently selected pattern. Different patterns in the channel can use different instruments."));break;case"instrumentVolume":r=i(n("Instrument Volume"),s("This setting controls the volume of the selected instrument without affecting the volume of the other instruments. This allows you to balance the loudness of each instrument relative to each other."));break;case"pan":r=i(n("Instrument Panning"),s("If you're listening through headphones or some other stereo sound system, this controls the position of the instrument and where the sound is coming from, ranging from left to right."),s("As a rule of thumb, composers typically put lead melodies, drums, and basses in the center, and spread any other instruments to either side. If too many instruments seem like they're coming from the same place, it can feel crowded and harder to distinguish individual sounds, especially if they cover a similar pitch range."));break;case"instrumentType":r=i(n("Instrument Type"),s("BeepBox comes with many instrument presets. You can also create your own custom instruments, or even generate random ones!"));break;case"filterCutoff":r=i(n("Low-Pass Filter Cutoff Frequency"),s('The lowest setting feels "muffled" or "dark", and the highest setting feels "harsh" or "bright".'),s("Most sounds include a range of frequencies from low to high. BeepBox instruments have a filter that allows the lowest frequencies to pass through at full volume, but can reduce the volume of the higher frequencies that are above a cutoff frequency. This setting controls the cutoff frequency and thus the range of higher frequencies that are reduced."),s("This cutoff setting also determines which frequency resonates when the resonance peak setting is used."));break;case"filterResonance":r=i(n("Low-Pass Filter Resonance Peak"),s("Increasing this setting emphasizes a narrow range of frequencies, based on the position of the filter cutoff setting. This can be used to imitate the resonant bodies of acoustic instruments and other interesting effects."),s("The filter preserves the volume of frequencies that are below the cutoff frequency, and reduces the volume of frequencies that are above the cutoff. If this setting is used, the filter also increases the volume of frequencies that are near the cutoff."));break;case"filterEnvelope":r=i(n("Low-Pass Filter Envelope"),s("This setting can dynamically change the filter cutoff frequency over time. Try the different options to see how they sound!"),s('The "custom" option uses the note volume as drawn in the pattern editor as the cutoff envelope.'));break;case"transition":r=i(n("Transition"),s("This setting controls how quickly notes begin and end."),s("Hard transitions start suddenly and sound like instruments that are played by hitting or plucking, whereas soft transitions start gradually and sound like instruments that are played by blowing air. Some transitions stop suddenly, but some fade out slowly after the end of the note."),s('The "seamless" and "slide" transitions connect the end of a note with the start of the next note.'));break;case"chipWave":r=i(n("Chip Wave"),s("BeepBox comes with some sound waves based on classic electronic sound chips, as well as several unique waves."));break;case"chipNoise":r=i(n("Noise"),s("BeepBox comes with several basic noise sounds. These do not have any distinct musical pitch, and can be used like drums to create beats and emphasize your song's rhythm."));break;case"pulseEnvelope":r=i(n("Pulse Wave Envelope"),s("This setting can dynamically change the pulse width over time. Try the different options to see how they sound!"),s('The "custom" option uses the note volume as drawn in the pattern editor as the pulse width envelope.'));break;case"pulseWidth":r=i(n("Pulse Wave Width"),s("This setting controls the shape and sound of a pulse wave. At the minimum width, it sounds light and buzzy. At the maximum width, it is shaped like a classic square wave."));break;case"interval":r=i(n("Instrument Interval"),s('Some BeepBox instrument types can play two waves at slightly different frequencies. The difference between the frequencies is called an "interval", and this setting controls how large it is.'),s("When two similar waves play at slightly different frequencies, they move in and out of phase with each other over time as different parts of the waves line up. This creates a dynamic, shifting sound. Pianos are a common example of this kind of sound, because each piano key strikes multiple strings that are tuned to slightly different frequencies."),s('If the interval is large, then the waves can sound out-of-tune and "dissonant". If the interval is even larger, then the two frequencies can even be distinct pitches.'));break;case"chords":r=i(n("Chords"),s("When multiple notes occur at the same time, this is called a chord. Chords can be created in BeepBox's pattern editor by adding notes above or below another note."),s('This setting determines how chords are played. The standard option is "harmony" which plays all of the notes out loud simultaneously. The "strum" option is similar, but plays the notes starting at slightly different times. The "arpeggio" option is used in "chiptune" style music and plays a single tone that rapidly alternates between all of the pitches in the chord.'),s('Some BeepBox instruments have an option called "custom interval" which uses the chord notes to control the interval between the waves of a single tone. This can create strange sound effects when combined with FM modulators.'));break;case"vibrato":r=i(n("Vibrato"),s("This setting causes the frequency of a note to wobble slightly. Singers and violinists often use vibrato."));break;case"algorithm":r=i(n("FM Algorithm"),s("FM Synthesis is a mysterious but powerful technique for crafting sounds, popularized by Yamaha keyboards and the Sega Genesis/Mega Drive. It may seem confusing, but try playing around with the options until you get a feel for it, or check out some of the preset examples!"),s("This FM synthesizer uses up to four waves, numbered 1, 2, 3, and 4. Each wave may have its own frequency, volume, and volume envelope to control its effect over time."),s('There are two kinds of waves: "carrier" waves play a tone out loud, but "modulator" waves distort other waves instead. Wave 1 is always a carrier and plays a tone, but other waves may distort it. The "Algorithm" setting determines which waves are modulators, and which other waves those modulators distort. For example, "1←2" means that wave 2 modulates wave 1, and wave 1 plays out loud.'));break;case"feedbackType":r=i(n("Feedback"),s("Modulators distort in one direction (like 1←2), but you can also use the feedback setting to make any wave distort in the opposite direction (1→2), or even itself (1⟲)."));break;case"operatorFrequency":r=i(n("Operator Frequency"),s('This setting controls the frequency of an individual FM wave. The fundamental frequency (1×) is determined by the pitch of the note, and the frequency (2×) is an octave (12 semitones) above it. The frequencies with a "~" are slightly detuned and shift in and out of phase over time compared to the other frequencies.'),s('Try different combinations of a "carrier" wave and a "modulator" wave with different frequencies to get a feel for how they sound together.'));break;case"operatorVolume":r=i(n("Operator Volume"),s('This setting controls the volume of "carrier" waves, or the amount of distortion that "modulator" waves apply to other waves.'));break;case"operatorEnvelope":r=i(n("Operator Envelope"),s("This setting can dynamically change the FM wave volume over time. Try the different options to see how they sound!"),s('The "custom" option uses the note volume as drawn in the pattern editor as the FM wave envelope.'));break;case"spectrum":r=i(n("Spectrum"),s("This setting allows you to draw your own noise spectrum! This is good for making drum sounds when combined with a hard transition and a falling filter cutoff envelope."),s("If you only use certain frequencies and a soft transition, it's also possible to make howling wind sounds or even musical blown bottle sounds."),s("The left side of the spectrum editor controls the noise energy at lower frequencies, and the right side controls higher frequencies."));break;case"harmonics":r=i(n("Harmonics"),s("This setting allows you to design your own sound wave! Most musical waves are actually a combination of sine waves at certain frequencies, and this lets you control the volume of each sine wave individually."),s("The left side of the harmonics editor controls the sine wave volumes at lower frequencies, and the right side controls higher frequencies."));break;case"effects":r=i(n("Effects"),s("BeepBox has two special effects you can add to instruments. You can turn on either effect, or both at once."),s('Reverb is a kind of echo effect. You can use the "reverb" slider in the "Song Settings" section above to control the amount of reverb for instruments that enable it. A little bit helps instruments sound more natural. Adding a lot of reverb can add sense of depth or mystery.'),s("The chorus effect combines multiple copies of the instrument's sound and adds a bit of vibrato to simulate an ensemble of instruments or voices."));break;case"drumsetEnvelope":r=i(n("Drumset Envelope"),s("This setting can dynamically change the filter cutoff frequency over time. Each row in the pattern editor gets its own envelope."),s('The "custom" option uses the note volume as drawn in the pattern editor as the drumset cutoff envelope.'));break;case"drumsetSpectrum":r=i(n("Drumset Spectrum"),s("This setting allows you to draw your own noise spectrum! This is good for making drumsets. Each row in the pattern editor gets its own spectrum."),s("The left side of the spectrum editor controls the noise energy at lower frequencies, and the right side controls higher frequencies."));break;default:throw new Error("Unhandled TipPrompt type: "+o)}this.container=i({className:"prompt",style:"width: 250px;"},r,this.dt),setTimeout(()=>this.dt.focus()),this.dt.addEventListener("click",this.ut)}}}(beepbox||(beepbox={})),function(t){class e{constructor(){this.pt=!0}yt(){this.pt=!1}isNoop(){return this.pt}commit(){}}t.Change=e;class i extends e{constructor(t){super(),this.gt=t,this.bt=!t}undo(){this.gt?(this.vt(),this.bt=!0):(this.wt(),this.bt=!1)}redo(){this.gt?(this.wt(),this.bt=!1):(this.vt(),this.bt=!0)}kt(){return this.bt}vt(){throw new Error("Change.doForwards(): Override me.")}wt(){throw new Error("Change.doBackwards(): Override me.")}}t.UndoableChange=i;t.ChangeGroup=class extends e{constructor(){super()}append(t){t.isNoop()||this.yt()}};t.ChangeSequence=class extends i{constructor(t){super(!1),this.Mt=void 0==t?[]:t.concat()}append(t){t.isNoop()||(this.Mt[this.Mt.length]=t,this.yt())}vt(){for(let t=0;t<this.Mt.length;t++)this.Mt[t].redo()}wt(){for(let t=this.Mt.length-1;t>=0;t--)this.Mt[t].undo()}}}(beepbox||(beepbox={})),function(t){function e(e,i,s,n,o){const r=new t.Note(-1,s,n,3,!1);o.push(r),r.pins.length=0,r.pitches.length=0;const h=n-s;for(const t of e.pitches)r.pitches.push(t);for(let s=0;s<e.pins.length;s++){const n=e.pins[s],o=n.time+i;if(o<0){if(s+1>=e.pins.length)throw new Error("Error converting pins in note overflow.");const h=e.pins[s+1],a=h.time+i;if(a>0){const e=-o/(a-o);r.pins.push(t.makeNotePin(Math.round(n.interval+e*(h.interval-n.interval)),0,Math.round(n.volume+e*(h.volume-n.volume))))}}else if(o<=h)r.pins.push(t.makeNotePin(n.interval,o,n.volume));else{if(s<1)throw new Error("Error converting pins in note overflow.");const a=e.pins[s-1],l=a.time+i;if(l<h){const e=(h-l)/(o-l);r.pins.push(t.makeNotePin(Math.round(a.interval+e*(n.interval-a.interval)),h,Math.round(a.volume+e*(n.volume-a.volume))))}}}const a=r.pins[0].interval;for(let t=0;t<r.pitches.length;t++)r.pitches[t]+=a;for(let t=0;t<r.pins.length;t++)r.pins[t].interval-=a}t.unionOfUsedNotes=function(t,e){for(const i of t.notes)for(const t of i.pitches)for(const s of i.pins){const i=(t+s.interval)%12;e[i]||(e[i]=!0)}},t.generateScaleMap=function(e,i){const s=t.Config.scales[i].flags,n=[],o=[];for(let t=0;t<12;t++)e[t]&&n.push(t),s[t]&&o.push(t);const r=n.length>o.length,h=r?o:n,a=r?n:o,l=["root","second","second","third","third","fourth","tritone","fifth","sixth","sixth","seventh","seventh","root"];let c=Number.MAX_SAFE_INTEGER,f=[];const d=[[0]];for(;d.length>0;){const t=d.pop();if(t.length==h.length){let e=0;for(let i=0;i<t.length;i++)e+=Math.abs(h[i]-a[t[i]]),l[h[i]]!=l[a[t[i]]]&&(e+=.75);c>e&&(c=e,f=t)}else{const e=t[t.length-1]+1,i=a.length-h.length+t.length;for(let s=e;s<=i;s++)d.push(t.concat(s))}}const u=[];for(let t=0;t<f.length;t++){const e=h[t],i=a[f[t]];u[t]=r?[i,e]:[e,i]}u.push([12,12]),o.push(12);let m=0;const p=[];for(let t=0;t<12;t++){const e=u[m][0],i=u[m][1],s=u[m+1][0],n=u[m+1][1];t==s-1&&m++;const r=(t-e)*(n-i)/(s-e)+i;let h=0,a=Number.MAX_SAFE_INTEGER;for(const e of o){let i=Math.abs(e-r);l[e]!=l[t]&&(i+=.1),a>i&&(a=i,h=e)}p[t]=h}return p};class i extends t.ChangeGroup{constructor(i,s,n){super();const o=[],r=[];for(let h=0;h<i.song.getChannelCount();h++){const a=i.song.channels[h],l=new t.Channel;h<i.song.pitchChannelCount?o.push(l):r.push(l),l.muted=a.muted,l.octave=a.octave;for(const t of a.instruments)l.instruments.push(t);const c=t.Config.partsPerBeat*i.song.beatsPerBar,f=t.Config.partsPerBeat*s;let d=-1,u=null;for(let s=0;s<i.song.barCount;s++){const o=i.song.getPattern(h,s);if(null!=o){const i=s*c;for(const s of o.notes){const r=s.start+i+n,h=s.end+i+n,a=Math.floor(r/f),c=Math.ceil(h/f);for(let i=a;i<c;i++){const n=i*f,a=Math.max(0,r-n),c=Math.min(f,h-n);if(a<c){if(d!=i||null==u){for(d++;d<i;)l.bars[d]=0,d++;u=new t.Pattern,l.patterns.push(u),l.bars[d]=l.patterns.length,u.instrument=o.instrument}e(s,r-n-a,a,c,u.notes)}}}}}}f(o),f(r),this.append(new l(i,o,r))}}t.ChangeMoveAndOverflowNotes=i;class s extends t.UndoableChange{constructor(t,e){super(!1),this.ft=t,this.xt=e,this.Et=this.xt.start,this.qt=this.xt.end,this.Ct=this.xt.start,this.Pt=this.xt.end,this.St=this.xt.pins,this.Tt=[],this.zt=this.xt.pitches,this.Rt=[]}Nt(){for(let t=0;t<this.Tt.length-1;)this.Tt[t].time>=this.Tt[t+1].time?this.Tt.splice(t,1):t++;for(let t=1;t<this.Tt.length-1;)this.Tt[t-1].interval==this.Tt[t].interval&&this.Tt[t].interval==this.Tt[t+1].interval&&this.Tt[t-1].volume==this.Tt[t].volume&&this.Tt[t].volume==this.Tt[t+1].volume?this.Tt.splice(t,1):t++;const t=this.Tt[0].interval,e=this.Tt[0].time;for(let e=0;e<this.zt.length;e++)this.Rt[e]=this.zt[e]+t;for(let i=0;i<this.Tt.length;i++)this.Tt[i].interval-=t,this.Tt[i].time-=e;this.Ct=this.Et+e,this.Pt=this.Ct+this.Tt[this.Tt.length-1].time,this.vt(),this.yt()}vt(){this.xt.pins=this.Tt,this.xt.pitches=this.Rt,this.xt.start=this.Ct,this.xt.end=this.Pt,this.ft.notifier.changed()}wt(){this.xt.pins=this.St,this.xt.pitches=this.zt,this.xt.start=this.Et,this.xt.end=this.qt,this.ft.notifier.changed()}}t.ChangePins=s;t.ChangeCustomizeInstrument=class extends t.Change{constructor(t){super();const e=t.song.channels[t.channel].instruments[t.getCurrentInstrument()];e.preset!=e.type&&(e.preset=e.type,t.notifier.changed(),this.yt())}};t.ChangePreset=class extends t.Change{constructor(e,i){super();const s=e.song.channels[e.channel].instruments[e.getCurrentInstrument()];if(s.preset!=i){const n=t.EditorConfig.valueToPreset(i);if(null!=n)if(void 0!=n.customType)s.type=n.customType,!t.Config.instrumentTypeHasSpecialInterval[s.type]&&t.Config.chords[s.chord].isCustomInterval&&(s.chord=0);else if(void 0!=n.settings){const t=s.volume,i=s.pan;s.fromJsonObject(n.settings,e.song.getChannelIsNoise(e.channel)),s.volume=t,s.pan=i}s.preset=i,e.notifier.changed(),this.yt()}}};t.ChangeRandomGeneratedInstrument=class extends t.Change{constructor(e){function i(t){let e=0;for(const i of t)e+=i.weight;let i=Math.random()*e;for(const e of t)if((i-=e.weight)<=0)return e.item;return t[Math.random()*t.length|0].item}function s(t,e,s,n){const o=[];for(let i=t;i<=e;i++)o.push({item:i,weight:1/(Math.pow((i-s)/n,2)+1)});return i(o)}super();const n=e.song.getChannelIsNoise(e.channel),o=e.song.channels[e.channel].instruments[e.getCurrentInstrument()];if(n){const e=i([{item:2,weight:1},{item:3,weight:3}]);function r(e){let i=0;for(const t of e)t>i&&(i=t);for(let s=0;s<e.length;s++)e[s]=t.Config.harmonicsMax*e[s]/i}switch(o.preset=o.type=e,o.filterCutoff=s(4,t.Config.filterCutoffRange-1,t.Config.filterCutoffRange-2,2),o.filterResonance=s(0,t.Config.filterResonanceRange-1,1,2),o.filterEnvelope=t.Config.envelopes.dictionary[i([{item:"steady",weight:2},{item:"punch",weight:4},{item:"flare 1",weight:2},{item:"flare 2",weight:2},{item:"flare 3",weight:2},{item:"twang 1",weight:8},{item:"twang 2",weight:8},{item:"twang 3",weight:8},{item:"swell 1",weight:2},{item:"swell 2",weight:2},{item:"swell 3",weight:1},{item:"tremolo1",weight:1},{item:"tremolo2",weight:1},{item:"tremolo3",weight:1},{item:"tremolo4",weight:1},{item:"tremolo5",weight:1},{item:"tremolo6",weight:1},{item:"decay 1",weight:4},{item:"decay 2",weight:4},{item:"decay 3",weight:4}])].index,o.transition=t.Config.transitions.dictionary[i([{item:"seamless",weight:1},{item:"hard",weight:4},{item:"soft",weight:2},{item:"slide",weight:1},{item:"cross fade",weight:2},{item:"hard fade",weight:8},{item:"medium fade",weight:2},{item:"soft fade",weight:1}])].index,o.effects=t.Config.effectsNames.indexOf(i([{item:"none",weight:1},{item:"reverb",weight:3}])),o.chord=t.Config.chords.dictionary[i([{item:"harmony",weight:4},{item:"strum",weight:2},{item:"arpeggio",weight:1}])].index,e){case 2:o.chipNoise=Math.random()*t.Config.chipNoises.length|0;break;case 3:{const e=[()=>{const e=[];for(let i=0;i<t.Config.spectrumControlPoints;i++)e[i]=Math.random()<.5?Math.random():0;return e},()=>{let e=1;const i=[e];for(let s=1;s<t.Config.spectrumControlPoints;s++)e*=Math.pow(2,Math.random()-.52),i[s]=e;return i},()=>{let e=1;const i=[e];for(let s=1;s<t.Config.spectrumControlPoints;s++)e*=Math.pow(2,Math.random()-.52),i[s]=e*Math.random();return i}],i=(0,e[Math.random()*e.length|0])();r(i);for(let e=0;e<t.Config.spectrumControlPoints;e++)o.spectrumWave.spectrum[e]=Math.round(i[e]);o.spectrumWave.markCustomWaveDirty()}break;default:throw new Error("Unhandled noise instrument type in random generator.")}}else{const e=i([{item:0,weight:4},{item:6,weight:4},{item:5,weight:6},{item:3,weight:1},{item:1,weight:4}]);function r(e){let i=0;for(const t of e)t>i&&(i=t);for(let s=0;s<e.length;s++)e[s]=t.Config.harmonicsMax*e[s]/i}switch(o.preset=o.type=e,o.filterCutoff=s(2,t.Config.filterCutoffRange-1,7,1.5),o.filterResonance=s(0,t.Config.filterResonanceRange-1,1,2),o.filterEnvelope=t.Config.envelopes.dictionary[i([{item:"steady",weight:10},{item:"punch",weight:6},{item:"flare 1",weight:2},{item:"flare 2",weight:4},{item:"flare 3",weight:2},{item:"twang 1",weight:2},{item:"twang 2",weight:4},{item:"twang 3",weight:4},{item:"swell 1",weight:4},{item:"swell 2",weight:2},{item:"swell 3",weight:1},{item:"tremolo1",weight:1},{item:"tremolo2",weight:1},{item:"tremolo3",weight:1},{item:"tremolo4",weight:1},{item:"tremolo5",weight:1},{item:"tremolo6",weight:1},{item:"decay 1",weight:1},{item:"decay 2",weight:2},{item:"decay 3",weight:2}])].index,o.transition=t.Config.transitions.dictionary[i([{item:"seamless",weight:1},{item:"hard",weight:4},{item:"soft",weight:4},{item:"slide",weight:2},{item:"cross fade",weight:4},{item:"hard fade",weight:4},{item:"medium fade",weight:2},{item:"soft fade",weight:2}])].index,o.effects=t.Config.effectsNames.indexOf(i([{item:"none",weight:1},{item:"reverb",weight:10},{item:"chorus",weight:2},{item:"chorus & reverb",weight:2}])),o.chord=t.Config.chords.dictionary[i([{item:"harmony",weight:7},{item:"strum",weight:2},{item:"arpeggio",weight:1}])].index,3!=e&&(o.vibrato=t.Config.vibratos.dictionary[i([{item:"none",weight:6},{item:"light",weight:2},{item:"delayed",weight:2},{item:"heavy",weight:1},{item:"shaky",weight:2}])].index),0!=e&&5!=e||(o.interval=t.Config.intervals.dictionary[i([{item:"union",weight:10},{item:"shimmer",weight:5},{item:"hum",weight:4},{item:"honky tonk",weight:3},{item:"dissonant",weight:1},{item:"fifth",weight:1},{item:"octave",weight:2},{item:"bowed",weight:2},{item:"piano",weight:5}])].index),e){case 0:o.chipWave=Math.random()*t.Config.chipWaves.length|0;break;case 6:o.pulseEnvelope=t.Config.envelopes.dictionary[i([{item:"steady",weight:10},{item:"punch",weight:6},{item:"flare 1",weight:2},{item:"flare 2",weight:4},{item:"flare 3",weight:2},{item:"twang 1",weight:4},{item:"twang 2",weight:4},{item:"twang 3",weight:4},{item:"swell 1",weight:4},{item:"swell 2",weight:4},{item:"swell 3",weight:4},{item:"tremolo1",weight:1},{item:"tremolo2",weight:1},{item:"tremolo3",weight:1},{item:"tremolo4",weight:2},{item:"tremolo5",weight:2},{item:"tremolo6",weight:2},{item:"decay 1",weight:2},{item:"decay 2",weight:2},{item:"decay 3",weight:2}])].index,o.pulseWidth=s(0,t.Config.pulseWidthRange-1,t.Config.pulseWidthRange-1,2);break;case 5:{const e=[()=>{const e=[];for(let i=0;i<t.Config.harmonicsControlPoints;i++)e[i]=Math.random()<.4?Math.random():0;return e[8*Math.random()|0]=Math.pow(Math.random(),.25),e},()=>{let e=1;const i=[e];for(let s=1;s<t.Config.harmonicsControlPoints;s++)e*=Math.pow(2,Math.random()-.55),i[s]=e;return i},()=>{let e=1;const i=[e];for(let s=1;s<t.Config.harmonicsControlPoints;s++)e*=Math.pow(2,Math.random()-.55),i[s]=e*Math.random();return i}],i=(0,e[Math.random()*e.length|0])();r(i);for(let e=0;e<t.Config.harmonicsControlPoints;e++)o.harmonicsWave.harmonics[e]=Math.round(i[e]);o.harmonicsWave.markCustomWaveDirty()}break;case 3:{const e=[];for(let i=0;i<t.Config.spectrumControlPoints;i++){const t=0==i||7==i||11==i||14==i||16==i||18==i||21==i;e[i]=t?Math.pow(Math.random(),.25):.5*Math.pow(Math.random(),3)}r(e);for(let i=0;i<t.Config.spectrumControlPoints;i++)o.spectrumWave.spectrum[i]=Math.round(e[i]);o.spectrumWave.markCustomWaveDirty()}break;case 1:{o.algorithm=Math.random()*t.Config.algorithms.length|0,o.feedbackType=Math.random()*t.Config.feedbacks.length|0;const e=t.Config.algorithms[o.algorithm];for(let i=0;i<e.carrierCount;i++)o.operators[i].frequency=s(0,t.Config.operatorFrequencies.length-1,0,3),o.operators[i].amplitude=s(0,t.Config.operatorAmplitudeMax,t.Config.operatorAmplitudeMax-1,2),o.operators[i].envelope=t.Config.envelopes.dictionary.custom.index;for(let n=e.carrierCount;n<t.Config.operatorCount;n++)o.operators[n].frequency=s(3,t.Config.operatorFrequencies.length-1,0,3),o.operators[n].amplitude=Math.pow(Math.random(),2)*t.Config.operatorAmplitudeMax|0,o.operators[n].envelope=t.Config.envelopes.dictionary[i([{item:"steady",weight:6},{item:"punch",weight:2},{item:"flare 1",weight:2},{item:"flare 2",weight:2},{item:"flare 3",weight:2},{item:"twang 1",weight:2},{item:"twang 2",weight:2},{item:"twang 3",weight:2},{item:"swell 1",weight:2},{item:"swell 2",weight:2},{item:"swell 3",weight:2},{item:"tremolo1",weight:1},{item:"tremolo2",weight:1},{item:"tremolo3",weight:1},{item:"tremolo4",weight:1},{item:"tremolo5",weight:1},{item:"tremolo6",weight:1},{item:"decay 1",weight:1},{item:"decay 2",weight:1},{item:"decay 3",weight:1}])].index;o.feedbackAmplitude=Math.pow(Math.random(),3)*t.Config.operatorAmplitudeMax|0,o.feedbackEnvelope=t.Config.envelopes.dictionary[i([{item:"steady",weight:4},{item:"punch",weight:2},{item:"flare 1",weight:2},{item:"flare 2",weight:2},{item:"flare 3",weight:2},{item:"twang 1",weight:2},{item:"twang 2",weight:2},{item:"twang 3",weight:2},{item:"swell 1",weight:2},{item:"swell 2",weight:2},{item:"swell 3",weight:2},{item:"tremolo1",weight:1},{item:"tremolo2",weight:1},{item:"tremolo3",weight:1},{item:"tremolo4",weight:1},{item:"tremolo5",weight:1},{item:"tremolo6",weight:1},{item:"decay 1",weight:1},{item:"decay 2",weight:1},{item:"decay 3",weight:1}])].index}break;default:throw new Error("Unhandled pitched instrument type in random generator.")}}e.notifier.changed(),this.yt()}};t.ChangeTransition=class extends t.Change{constructor(t,e){super();const i=t.song.channels[t.channel].instruments[t.getCurrentInstrument()];i.transition!=e&&(this.yt(),i.transition=e,i.preset=i.type,t.notifier.changed())}};t.ChangeEffects=class extends t.Change{constructor(t,e){super();const i=t.song.channels[t.channel].instruments[t.getCurrentInstrument()];i.effects!=e&&(this.yt(),i.effects=e,i.preset=i.type,t.notifier.changed())}};t.ChangePatternNumbers=class extends t.Change{constructor(t,e,i,s,n,o){if(super(),e>t.song.patternsPerChannel)throw new Error("invalid pattern");for(let r=i;r<i+n;r++)for(let i=s;i<s+o;i++)t.song.channels[i].bars[r]!=e&&(t.song.channels[i].bars[r]=e,this.yt());t.notifier.changed()}};t.ChangeBarCount=class extends t.Change{constructor(t,e,i){if(super(),t.song.barCount!=e){for(const s of t.song.channels)if(i){for(;s.bars.length<e;)s.bars.unshift(0);t.song.barCount>e&&s.bars.splice(0,t.song.barCount-e)}else{for(;s.bars.length<e;)s.bars.push(0);s.bars.length=e}if(i){const i=e-t.song.barCount;t.bar=Math.max(0,t.bar+i),(i<0||t.barScrollPos>0)&&(t.barScrollPos=Math.max(0,t.barScrollPos+i)),t.song.loopStart=Math.max(0,t.song.loopStart+i)}t.bar=Math.min(t.bar,e-1),t.barScrollPos=Math.max(0,Math.min(e-t.trackVisibleBars,t.barScrollPos)),t.song.loopLength=Math.min(e,t.song.loopLength),t.song.loopStart=Math.min(e-t.song.loopLength,t.song.loopStart),t.song.barCount=e,t.notifier.changed(),this.yt()}}};t.ChangeInsertBars=class extends t.Change{constructor(e,i,s){super();const n=Math.min(t.Config.barCountMax,e.song.barCount+s);if(0!=(s=n-e.song.barCount)){for(const t of e.song.channels)for(;t.bars.length<n;)t.bars.splice(i,0,0);e.song.barCount=n,e.bar+=s,e.barScrollPos=Math.min(n-e.trackVisibleBars,e.barScrollPos+s),e.song.loopStart>=i?e.song.loopStart+=s:e.song.loopStart+e.song.loopLength>=i&&(e.song.loopLength+=s),e.notifier.changed(),this.yt()}}};t.ChangeDeleteBars=class extends t.Change{constructor(t,e,i){super();for(const s of t.song.channels)s.bars.splice(e,i),0==s.bars.length&&s.bars.push(0);t.song.barCount=Math.max(1,t.song.barCount-i),t.bar=Math.max(0,t.bar-i),t.barScrollPos=Math.max(0,t.barScrollPos-i),t.song.loopStart>=e?t.song.loopStart=Math.max(0,t.song.loopStart-i):t.song.loopStart+t.song.loopLength>e&&(t.song.loopLength-=i),t.song.loopLength=Math.max(1,Math.min(t.song.barCount-t.song.loopStart,t.song.loopLength)),t.notifier.changed(),this.yt()}};t.ChangeChannelCount=class extends t.Change{constructor(e,i,s){if(super(),e.song.pitchChannelCount!=i||e.song.noiseChannelCount!=s){const o=[];function n(i,s,n,h,a,l){for(let c=0;c<i;c++){const i=c+n,f=c+h;if(c<s)o[i]=e.song.channels[f];else{o[i]=new t.Channel,o[i].octave=a;for(let s=0;s<e.song.instrumentsPerChannel;s++){const e=new t.Instrument(l),n=r(l),h=t.EditorConfig.valueToPreset(n);e.fromJsonObject(h.settings,l),e.preset=n,e.volume=1,o[i].instruments[s]=e}for(let s=0;s<e.song.patternsPerChannel;s++)o[i].patterns[s]=new t.Pattern;for(let t=0;t<e.song.barCount;t++)o[i].bars[t]=0}}}n(i,e.song.pitchChannelCount,0,0,2,!1),n(s,e.song.noiseChannelCount,i,e.song.pitchChannelCount,0,!0),e.song.pitchChannelCount=i,e.song.noiseChannelCount=s;for(let t=0;t<e.song.getChannelCount();t++)e.song.channels[t]=o[t];e.song.channels.length=e.song.getChannelCount(),e.channel=Math.min(e.channel,i+s-1),e.notifier.changed(),this.yt()}}};t.ChangeChannelBar=class extends t.Change{constructor(t,e,i,s=!1){super();const n=t.channel,o=t.bar;t.channel=e,t.bar=i,s||(t.barScrollPos=Math.min(t.bar,Math.max(t.bar-(t.trackVisibleBars-1),t.barScrollPos))),t.notifier.changed(),n==e&&o==i||this.yt()}};t.ChangeInterval=class extends t.Change{constructor(t,e){super();const i=t.song.channels[t.channel].instruments[t.getCurrentInstrument()];i.interval!=e&&(this.yt(),i.interval=e,i.preset=i.type,t.notifier.changed())}};t.ChangeChord=class extends t.Change{constructor(t,e){super();const i=t.song.channels[t.channel].instruments[t.getCurrentInstrument()];i.chord!=e&&(this.yt(),i.chord=e,i.preset=i.type,t.notifier.changed())}};t.ChangeVibrato=class extends t.Change{constructor(t,e){super();const i=t.song.channels[t.channel].instruments[t.getCurrentInstrument()];i.vibrato!=e&&(i.vibrato=e,i.preset=i.type,t.notifier.changed(),this.yt())}};t.ChangeSpectrum=class extends t.Change{constructor(t,e,i){super(),i.markCustomWaveDirty(),e.preset=e.type,t.notifier.changed(),this.yt()}};t.ChangeHarmonics=class extends t.Change{constructor(t,e,i){super(),i.markCustomWaveDirty(),e.preset=e.type,t.notifier.changed(),this.yt()}};t.ChangeDrumsetEnvelope=class extends t.Change{constructor(t,e,i){super();const s=t.song.channels[t.channel].instruments[t.getCurrentInstrument()];s.drumsetEnvelopes[e]!=i&&(s.drumsetEnvelopes[e]=i,s.preset=s.type,t.notifier.changed(),this.yt())}};class n extends t.Change{constructor(t){super(),this.ft=t,this.Bt=this.ft.song.channels[this.ft.channel].instruments[this.ft.getCurrentInstrument()]}commit(){this.isNoop()||(this.Bt.preset=this.Bt.type,this.ft.notifier.changed())}}t.ChangePulseWidth=class extends n{constructor(t,e,i){super(t),this.Bt.pulseWidth=i,t.notifier.changed(),e!=i&&this.yt()}};t.ChangePulseEnvelope=class extends t.Change{constructor(t,e){super();const i=t.song.channels[t.channel].instruments[t.getCurrentInstrument()];i.pulseEnvelope!=e&&(i.pulseEnvelope=e,i.preset=i.type,t.notifier.changed(),this.yt())}};t.ChangeFilterCutoff=class extends n{constructor(t,e,i){super(t),this.Bt.filterCutoff=i,t.notifier.changed(),e!=i&&this.yt()}};t.ChangeFilterResonance=class extends n{constructor(t,e,i){super(t),this.Bt.filterResonance=i,t.notifier.changed(),e!=i&&this.yt()}};t.ChangeFilterEnvelope=class extends t.Change{constructor(t,e){super();const i=t.song.channels[t.channel].instruments[t.getCurrentInstrument()];i.filterEnvelope!=e&&(i.filterEnvelope=e,i.preset=i.type,t.notifier.changed(),this.yt())}};t.ChangeAlgorithm=class extends t.Change{constructor(t,e){super();const i=t.song.channels[t.channel].instruments[t.getCurrentInstrument()];i.algorithm!=e&&(i.algorithm=e,i.preset=i.type,t.notifier.changed(),this.yt())}};t.ChangeFeedbackType=class extends t.Change{constructor(t,e){super();const i=t.song.channels[t.channel].instruments[t.getCurrentInstrument()];i.feedbackType!=e&&(i.feedbackType=e,i.preset=i.type,t.notifier.changed(),this.yt())}};t.ChangeFeedbackEnvelope=class extends t.Change{constructor(t,e){super();const i=t.song.channels[t.channel].instruments[t.getCurrentInstrument()];i.feedbackEnvelope!=e&&(i.feedbackEnvelope=e,i.preset=i.type,t.notifier.changed(),this.yt())}};t.ChangeOperatorEnvelope=class extends t.Change{constructor(t,e,i){super();const s=t.song.channels[t.channel].instruments[t.getCurrentInstrument()];s.operators[e].envelope!=i&&(s.operators[e].envelope=i,s.preset=s.type,t.notifier.changed(),this.yt())}};t.ChangeOperatorFrequency=class extends t.Change{constructor(t,e,i){super();const s=t.song.channels[t.channel].instruments[t.getCurrentInstrument()];s.operators[e].frequency!=i&&(s.operators[e].frequency=i,s.preset=s.type,t.notifier.changed(),this.yt())}};t.ChangeOperatorAmplitude=class extends n{constructor(t,e,i,s){super(t),this.Bt.operators[e].amplitude=s,t.notifier.changed(),i!=s&&this.yt()}};t.ChangeFeedbackAmplitude=class extends n{constructor(t,e,i){super(t),this.Bt.feedbackAmplitude=i,t.notifier.changed(),e!=i&&this.yt()}};t.ChangeInstrumentsPerChannel=class extends t.Change{constructor(e,i){if(super(),e.song.instrumentsPerChannel!=i){for(let s=0;s<e.song.getChannelCount();s++){const n=e.song.channels[s].instruments[e.song.instrumentsPerChannel-1],o=n.toJsonObject();for(let r=e.song.instrumentsPerChannel;r<i;r++){const i=new t.Instrument(e.song.getChannelIsNoise(s));4==n.type?i.setTypeAndReset(3,!0):i.fromJsonObject(o,e.song.getChannelIsNoise(s)),e.song.channels[s].instruments[r]=i}e.song.channels[s].instruments.length=i;for(let t=0;t<e.song.patternsPerChannel;t++)e.song.channels[s].patterns[t].instrument>=i&&(e.song.channels[s].patterns[t].instrument=0)}e.song.instrumentsPerChannel=i,e.notifier.changed(),this.yt()}}};t.ChangeKey=class extends t.Change{constructor(t,e){super(),t.song.key!=e&&(t.song.key=e,t.notifier.changed(),this.yt())}};t.ChangeLoop=class extends t.Change{constructor(t,e,i,s,n){super(),this.ft=t,this.oldStart=e,this.oldLength=i,this.newStart=s,this.newLength=n,this.ft.song.loopStart=this.newStart,this.ft.song.loopLength=this.newLength,this.ft.notifier.changed(),this.oldStart==this.newStart&&this.oldLength==this.newLength||this.yt()}};t.ChangePitchAdded=class extends t.UndoableChange{constructor(t,e,i,s,n=!1){super(n),this.ft=t,this.xt=e,this.Ft=i,this.q=s,this.yt(),this.redo()}vt(){this.xt.pitches.splice(this.q,0,this.Ft),this.ft.notifier.changed()}wt(){this.xt.pitches.splice(this.q,1),this.ft.notifier.changed()}};t.ChangeOctave=class extends t.Change{constructor(t,e,i){super(),this.oldValue=e,t.song.channels[t.channel].octave=i,t.notifier.changed(),e!=i&&this.yt()}};t.ChangeRhythm=class extends t.ChangeGroup{constructor(t,e){super(),t.song.rhythm!=e&&(t.song.rhythm=e,t.notifier.changed(),this.yt())}};t.ChangePaste=class extends t.ChangeGroup{constructor(e,i,s,n){super(),i.notes.length=0;for(const e of s){const s=new t.Note(e.pitches[0],e.start,e.end,e.pins[0].volume,!1);s.pitches.length=0;for(const t of e.pitches)s.pitches.push(t);s.pins.length=0;for(const i of e.pins)s.pins.push(t.makeNotePin(i.interval,i.time,i.volume));i.notes.push(s)}e.song.beatsPerBar<n&&this.append(new m(e,i,e.song.beatsPerBar*t.Config.partsPerBeat,n*t.Config.partsPerBeat)),e.notifier.changed(),this.yt()}};t.ChangePasteInstrument=class extends t.ChangeGroup{constructor(t,e,i){super(),e.fromJsonObject(i,i.isDrum),t.notifier.changed(),this.yt()}};t.ChangePatternInstrument=class extends t.Change{constructor(t,e,i){super(),i.instrument!=e&&(i.instrument=e,t.notifier.changed(),this.yt())}};t.ChangePatternsPerChannel=class extends t.Change{constructor(e,i){if(super(),e.song.patternsPerChannel!=i){for(let s=0;s<e.song.getChannelCount();s++){const n=e.song.channels[s].bars,o=e.song.channels[s].patterns;for(let t=0;t<n.length;t++)n[t]>i&&(n[t]=0);for(let e=o.length;e<i;e++)o[e]=new t.Pattern;o.length=i}e.song.patternsPerChannel=i,e.notifier.changed(),this.yt()}}};t.ChangeEnsurePatternExists=class extends t.UndoableChange{constructor(t,e,i){super(!1),this.Lt=null;const s=t.song;if(0!=s.channels[e].bars[i])return;this.ft=t,this.At=i,this.Ht=e,this.It=s.patternsPerChannel,this.Ot=s.patternsPerChannel;let n=null,o=null;for(let t=1;t<=s.patternsPerChannel;t++){let i=!1;for(let n=0;n<s.barCount;n++)if(s.channels[e].bars[n]==t){i=!0;break}if(!i&&(null==o&&(o=t),0==s.channels[e].patterns[t-1].notes.length)){n=t;break}}if(null!=n)this.$t=n;else if(s.patternsPerChannel<s.barCount)this.Ot=s.patternsPerChannel+1,this.$t=s.patternsPerChannel+1;else{if(null==o)throw new Error;this.$t=o,this.Lt=s.channels[e].patterns[o-1].notes}this.yt(),this.vt()}vt(){const e=this.ft.song;for(let i=e.patternsPerChannel;i<this.Ot;i++)for(let s=0;s<e.getChannelCount();s++)e.channels[s].patterns[i]=new t.Pattern;e.patternsPerChannel=this.Ot,e.channels[this.Ht].patterns[this.$t-1].notes=[],e.channels[this.Ht].bars[this.At]=this.$t,this.ft.notifier.changed()}wt(){const t=this.ft.song,e=t.channels[this.Ht].patterns[this.$t-1];null!=this.Lt&&(e.notes=this.Lt),t.channels[this.Ht].bars[this.At]=0;for(let e=0;e<t.getChannelCount();e++)t.channels[e].patterns.length=this.It;t.patternsPerChannel=this.It,this.ft.notifier.changed()}};t.ChangePinTime=class extends s{constructor(e,i,s,n){super(e,i),n-=this.Et;const o=this.St[s].time,r=Math.min(o,n),h=Math.max(o,n);let a=!1;for(let e=0;e<this.St.length;e++){const o=i.pins[e],l=o.time;l<r?this.Tt.push(t.makeNotePin(o.interval,l,o.volume)):l>h&&(a||(this.Tt.push(t.makeNotePin(this.St[s].interval,n,this.St[s].volume)),a=!0),this.Tt.push(t.makeNotePin(o.interval,l,o.volume)))}a||this.Tt.push(t.makeNotePin(this.St[s].interval,n,this.St[s].volume)),this.Nt()}};t.ChangePitchBend=class extends s{constructor(e,i,s,n,o,r){super(e,i),s-=this.Et,n-=this.Et,o-=i.pitches[r];let h,a,l,c,f=!1,d=!1,u=0,m=3,p=!0;for(n>s?(h=0,a=1,l=i.pins.length,c=(t=>{this.Tt.push(t)})):(h=i.pins.length-1,a=-1,l=-1,c=(t=>{this.Tt.unshift(t)}));h!=l;h+=a){const e=i.pins[h],r=e.time;for(;;)if(f){if(d){if(r*a==n*a)break;e.interval!=u&&(p=!1),c(t.makeNotePin(p?o:e.interval,r,e.volume));break}if(r*a<=n*a&&(u=e.interval,m=e.volume),r*a<n*a)break;c(t.makeNotePin(o,n,m)),d=!0}else{if(r*a<=s*a&&(u=e.interval,m=e.volume),r*a<s*a){c(t.makeNotePin(e.interval,r,e.volume));break}c(t.makeNotePin(u,s,m)),f=!0}}d||c(t.makeNotePin(o,n,m)),this.Nt()}};t.ChangePatternRhythm=class extends t.ChangeSequence{constructor(e,i){super();const s=t.Config.partsPerBeat/t.Config.rhythms[e.song.rhythm].stepsPerBeat,n=function(i){let n=t.Config.rhythms[e.song.rhythm].roundUpThresholds;if(null!=n){const e=Math.floor(i/t.Config.partsPerBeat)*t.Config.partsPerBeat,o=i-e;let r=e;for(const t of n){if(!(o>=t))break;r+=s}return r}return Math.round(i/s)*s};let r=0;for(;r<i.notes.length;){const t=i.notes[r];n(t.start)>=n(t.end)?this.append(new d(e,i,t,r,!0)):(this.append(new o(e,t,n)),r++)}}};class o extends s{constructor(e,i,s){super(e,i);for(const e of this.St)this.Tt.push(t.makeNotePin(e.interval,s(e.time+this.Et)-this.Et,e.volume));this.Nt()}}t.ChangeMoveNotesSideways=class extends t.ChangeGroup{constructor(s,n,o){super();let r=Math.round(n%s.song.beatsPerBar*t.Config.partsPerBeat);if(r<0&&(r+=s.song.beatsPerBar*t.Config.partsPerBeat),0!=r){switch(o){case"wrapAround":{const i=t.Config.partsPerBeat*s.song.beatsPerBar;for(const t of s.song.channels)for(const s of t.patterns){const t=[];for(let n=1;n>=0;n--){const o=n*i;for(const n of s.notes){const s=n.start+r,h=n.end+r,a=Math.max(0,s-o),l=Math.min(i,h-o);a<l&&e(n,s-o-a,a,l,t)}}s.notes=t}}break;case"overflow":{let t=s.song.barCount,e=s.song.loopStart,o=s.song.loopLength;if(this.append(new i(s,s.song.beatsPerBar,r)),n<0){let i=!0;for(const t of s.song.channels)0!=t.bars[0]&&(i=!1);if(i){for(const t of s.song.channels)t.bars.shift();s.song.barCount--}else t++,e++,s.bar++}for(;s.song.barCount<t;){for(const t of s.song.channels)t.bars.push(0);s.song.barCount++}s.song.loopStart=e,s.song.loopLength=o}break;default:throw new Error("Unrecognized beats-per-bar conversion strategy.")}s.notifier.changed(),this.yt()}}};t.ChangeBeatsPerBar=class extends t.ChangeGroup{constructor(e,s,n){if(super(),e.song.beatsPerBar!=s){switch(n){case"splice":if(e.song.beatsPerBar>s){const i=new t.ChangeSequence;for(let n=0;n<e.song.getChannelCount();n++)for(let o=0;o<e.song.channels[n].patterns.length;o++)i.append(new m(e,e.song.channels[n].patterns[o],s*t.Config.partsPerBeat,e.song.beatsPerBar*t.Config.partsPerBeat))}break;case"stretch":{const t=function(t){return Math.round(t*s/e.song.beatsPerBar)};for(let i=0;i<e.song.getChannelCount();i++)for(let s=0;s<e.song.channels[i].patterns.length;s++){const n=e.song.channels[i].patterns[s];let r=0;for(;r<n.notes.length;){const i=n.notes[r];t(i.start)>=t(i.end)?this.append(new d(e,n,i,r,!0)):(this.append(new o(e,i,t)),r++)}}}break;case"overflow":this.append(new i(e,s,0)),e.song.loopStart=0,e.song.loopLength=e.song.barCount;break;default:throw new Error("Unrecognized beats-per-bar conversion strategy.")}e.song.beatsPerBar=s,e.notifier.changed(),this.yt()}}};t.ChangeScale=class extends t.ChangeGroup{constructor(t,e){super(),t.song.scale!=e&&(t.song.scale=e,t.notifier.changed(),this.yt())}};function r(e){const i=[];for(let s=0;s<t.EditorConfig.presetCategories.length;s++){const n=t.EditorConfig.presetCategories[s];if("Novelty Presets"!=n.name)for(let t=0;t<n.presets.length;t++){const o=n.presets[t];void 0!=o.settings&&1==o.isNoise==e&&i.push((s<<6)+t)}}return i[Math.random()*i.length|0]}function h(e){for(let i=0;i<e.channels.length;i++)for(const s of e.channels[i].instruments){const n=e.getChannelIsNoise(i),o=i==e.pitchChannelCount?t.EditorConfig.nameToPresetValue(Math.random()>.5?"chip noise":"standard drumset"):r(n),h=t.EditorConfig.valueToPreset(o);s.fromJsonObject(h.settings,n),s.preset=o,s.volume=1}}t.ChangeDetectKey=class extends t.ChangeGroup{constructor(e){super();const i=e.song,s=t.Config.keys[i.key].basePitch,n=[0,0,0,0,0,0,0,0,0,0,0,0];for(let e=0;e<i.pitchChannelCount;e++)for(let o=0;o<i.barCount;o++){const r=i.getPattern(e,o);if(null!=r)for(const e of r.notes){const i=e.pins[0];for(let o=1;o<e.pins.length;o++){const r=e.pins[o];if(i.interval==r.interval){let o=r.time-i.time;o+=Math.max(0,Math.min(t.Config.partsPerBeat,r.time+e.start)-(i.time+e.start)),o*=r.volume+i.volume;for(const t of e.pitches)n[(s+i.interval+t)%12]+=o}}}}let o=0,r=0;for(let t=0;t<12;t++){const e=n[t]*(3*n[(t+7)%12]+n[(t+4)%12]+n[(t+3)%12]);r<e&&(r=e,o=t)}if(o!=i.key){const t=i.key-o,s=Math.abs(t);for(let n=0;n<i.pitchChannelCount;n++)for(const o of i.channels[n].patterns)for(let i=0;i<s;i++)this.append(new y(e,n,o,t>0,!0));i.key=o,e.notifier.changed(),this.yt()}}},t.pickRandomPresetValue=r,t.setDefaultInstruments=h;t.ChangeSong=class extends t.ChangeGroup{constructor(t,e){super(),t.song.fromBase64String(e),this.append(new a(t)),""==e&&h(t.song),t.notifier.changed(),this.yt()}};class a extends t.Change{constructor(t){super();const e=Math.min(t.channel,t.song.getChannelCount()-1),i=Math.max(0,Math.min(t.song.barCount-1,t.bar)),s=Math.min(t.bar,Math.max(t.bar-(t.trackVisibleBars-1),Math.max(0,Math.min(t.song.barCount-t.trackVisibleBars,t.barScrollPos))));t.channel==e&&t.bar==i&&t.barScrollPos==s||(t.channel=e,t.bar=i,t.barScrollPos=s,t.notifier.changed(),this.yt())}}t.ChangeValidateDoc=a;class l extends t.ChangeGroup{constructor(e,i,s){super();const n=e.song;function o(t,e){for(;t.length>e;){let e=t.length-1,i=0;for(let s=0;s<t.length-1;s++){let n=0;for(const e of t[s].bars)0==e&&n++;n>=i&&(e=s,i=n)}t.splice(e,1)}}for(o(i,t.Config.pitchChannelCountMax),o(s,t.Config.noiseChannelCountMax);i.length<t.Config.pitchChannelCountMin;)i.push(new t.Channel);for(;s.length<t.Config.noiseChannelCountMin;)s.push(new t.Channel);n.barCount=1,n.instrumentsPerChannel=1,n.patternsPerChannel=8;const r=i.concat(s);for(let t=0;t<r.length;t++){const e=r[t];n.barCount=Math.max(n.barCount,e.bars.length),n.patternsPerChannel=Math.max(n.patternsPerChannel,e.patterns.length),n.instrumentsPerChannel=Math.max(n.instrumentsPerChannel,e.instruments.length),n.channels[t]=e}n.channels.length=r.length,n.pitchChannelCount=i.length,n.noiseChannelCount=s.length,n.barCount=Math.min(t.Config.barCountMax,n.barCount),n.patternsPerChannel=Math.min(t.Config.barCountMax,n.patternsPerChannel),n.instrumentsPerChannel=Math.min(t.Config.instrumentsPerChannelMax,n.instrumentsPerChannel);for(let i=0;i<n.channels.length;i++){const s=n.channels[i];for(let t=0;t<s.bars.length;t++)(s.bars[t]>n.patternsPerChannel||s.bars[t]<0)&&(s.bars[t]=0);for(const t of s.patterns)(t.instrument>=n.instrumentsPerChannel||t.instrument<0)&&(t.instrument=0);for(;s.bars.length<n.barCount;)s.bars.push(0);for(;s.patterns.length<n.patternsPerChannel;)s.patterns.push(new t.Pattern);for(;s.instruments.length<n.instrumentsPerChannel;){const o=new t.Instrument(e.song.getChannelIsNoise(i));n.getChannelIsNoise(i)?o.setTypeAndReset(2,!0):o.setTypeAndReset(0,!1),s.instruments.push(o)}s.bars.length=n.barCount,s.patterns.length=n.patternsPerChannel,s.instruments.length=n.instrumentsPerChannel}n.loopStart=Math.max(0,Math.min(n.barCount-1,n.loopStart)),n.loopLength=Math.min(n.barCount-n.loopStart,n.loopLength),this.append(new a(e)),e.notifier.changed(),this.yt()}}function c(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++){const s=t[i],n=e[i];if(n.start!=s.start||n.end!=s.end||n.pitches.length!=s.pitches.length||n.pins.length!=s.pins.length)return!1;for(let t=0;t<s.pitches.length;t++)if(n.pitches[t]!=s.pitches[t])return!1;for(let t=0;t<s.pins.length;t++)if(n.pins[t].interval!=s.pins[t].interval||n.pins[t].time!=s.pins[t].time||n.pins[t].volume!=s.pins[t].volume)return!1}return!0}function f(t){for(const e of t){const t=[];for(let i=0;i<e.bars.length;i++){if(0==e.bars[i])continue;const s=e.patterns[e.bars[i]-1];let n=!1;for(let o=0;o<t.length;o++){const r=t[o];if(r.instrument==s.instrument&&r.notes.length==s.notes.length&&c(s.notes,r.notes)){n=!0,e.bars[i]=o+1;break}}n||(t.push(s),e.bars[i]=t.length)}for(let i=0;i<t.length;i++)e.patterns[i]=t[i];e.patterns.length=t.length}}t.ChangeReplacePatterns=l,t.comparePatternNotes=c,t.removeDuplicatePatterns=f;t.ChangeTempo=class extends t.Change{constructor(e,i,s){super(),e.song.tempo=Math.max(t.Config.tempoMin,Math.min(t.Config.tempoMax,s)),e.notifier.changed(),i!=s&&this.yt()}};t.ChangeReverb=class extends t.Change{constructor(t,e,i){super(),t.song.reverb=i,t.notifier.changed(),e!=i&&this.yt()}};class d extends t.UndoableChange{constructor(t,e,i,s,n=!1){super(n),this.ft=t,this.Ut=e,this.xt=i,this.q=s,this.yt(),this.redo()}vt(){this.Ut.notes.splice(this.q,0,this.xt),this.ft.notifier.changed()}wt(){this.Ut.notes.splice(this.q,1),this.ft.notifier.changed()}}t.ChangeNoteAdded=d;class u extends s{constructor(e,i,s,n){super(e,i),s-=this.Et,n-=this.Et;let o,r=!1,h=this.St[0].volume,a=this.St[0].interval,l=!0;for(o=0;o<this.St.length;o++){const e=this.St[o];if(e.time<s)h=e.volume,a=e.interval;else{if(!(e.time<=n))break;if(e.time>s&&!r&&this.Tt.push(t.makeNotePin(a,s,h)),this.Tt.push(t.makeNotePin(e.interval,e.time,e.volume)),r=!0,e.time==n){l=!1;break}}}l&&this.Tt.push(t.makeNotePin(this.St[o].interval,n,this.St[o].volume)),this.Nt()}}t.ChangeNoteLength=u;class m extends t.ChangeSequence{constructor(t,e,i,s,n){super();let o=0;for(;o<e.notes.length;){const r=e.notes[o];if(r==n&&void 0!=n)o++;else if(r.end<=i)o++;else{if(r.start>=s)break;r.start<i?(this.append(new u(t,r,r.start,i)),o++):r.end>s?(this.append(new u(t,r,s,r.end)),o++):this.append(new d(t,e,r,o,!0))}}}}t.ChangeNoteTruncate=m;class p extends t.UndoableChange{constructor(e,i,s,n,o=!1,r=!1){super(!1),this.ft=e,this.xt=s,this.St=s.pins,this.Tt=[],this.zt=s.pitches,this.Rt=[];const h=e.song.getChannelIsNoise(i);if(h!=e.song.getChannelIsNoise(e.channel))return;const a=h?t.Config.drumCount-1:t.Config.maxPitch;for(let i=0;i<this.zt.length;i++){let s=this.zt[i];if(r&&!h)s=n?Math.min(a,s+12):Math.max(0,s-12);else if(n){for(let i=s+1;i<=a;i++)if(h||o||t.Config.scales[e.song.scale].flags[i%12]){s=i;break}}else for(let i=s-1;i>=0;i--)if(h||o||t.Config.scales[e.song.scale].flags[i%12]){s=i;break}let l=!1;for(let t=0;t<this.Rt.length;t++)if(this.Rt[t]==s){l=!0;break}l||this.Rt.push(s)}let l=0,c=a;for(let t=1;t<this.Rt.length;t++){const e=this.Rt[0]-this.Rt[t];l<e&&(l=e),c>e+a&&(c=e+a)}for(const i of this.St){let s=i.interval+this.zt[0];if(s<l&&(s=l),s>c&&(s=c),r&&!h)s=n?Math.min(c,s+12):Math.max(l,s-12);else if(n){for(let i=s+1;i<=c;i++)if(h||o||t.Config.scales[e.song.scale].flags[i%12]){s=i;break}}else for(let i=s-1;i>=l;i--)if(h||o||t.Config.scales[e.song.scale].flags[i%12]){s=i;break}s-=this.Rt[0],this.Tt.push(t.makeNotePin(s,i.time,i.volume))}if(0!=this.Tt[0].interval)throw new Error("wrong pin start interval");for(let t=1;t<this.Tt.length-1;)this.Tt[t-1].interval==this.Tt[t].interval&&this.Tt[t].interval==this.Tt[t+1].interval&&this.Tt[t-1].volume==this.Tt[t].volume&&this.Tt[t].volume==this.Tt[t+1].volume?this.Tt.splice(t,1):t++;this.vt(),this.yt()}vt(){this.xt.pins=this.Tt,this.xt.pitches=this.Rt,this.ft.notifier.changed()}wt(){this.xt.pins=this.St,this.xt.pitches=this.zt,this.ft.notifier.changed()}}class y extends t.ChangeSequence{constructor(t,e,i,s,n=!1,o=!1){super();for(let r=0;r<i.notes.length;r++)this.append(new p(t,e,i.notes[r],s,n,o))}}t.ChangeTranspose=y;t.ChangePatternScale=class extends t.Change{constructor(e,i,s){super();const n=t.Config.maxPitch;for(const e of i.notes){const i=[],o=[];for(let t=0;t<e.pitches.length;t++){const n=e.pitches[t],o=s[n%12]+(n-n%12);-1==i.indexOf(o)&&i.push(o)}let r=0,h=n;for(let t=1;t<i.length;t++){const e=i[0]-i[t];r<e&&(r=e),h>e+n&&(h=e+n)}for(const n of e.pins){let a=n.interval+e.pitches[0];a<r&&(a=r),a>h&&(a=h);const l=s[a%12]+(a-a%12);o.push(t.makeNotePin(l-i[0],n.time,n.volume))}if(0!=o[0].interval)throw new Error("wrong pin start interval");for(let t=1;t<o.length-1;)o[t-1].interval==o[t].interval&&o[t].interval==o[t+1].interval&&o[t-1].volume==o[t].volume&&o[t].volume==o[t+1].volume?o.splice(t,1):t++;e.pitches=i,e.pins=o}this.yt(),e.notifier.changed()}};t.ChangeVolume=class extends t.Change{constructor(t,e,i){super(),t.song.channels[t.channel].instruments[t.getCurrentInstrument()].volume=i,t.notifier.changed(),e!=i&&this.yt()}};t.ChangePan=class extends t.Change{constructor(t,e,i){super(),t.song.channels[t.channel].instruments[t.getCurrentInstrument()].pan=i,t.notifier.changed(),e!=i&&this.yt()}};t.ChangeVolumeBend=class extends t.UndoableChange{constructor(e,i,s,n,o){super(!1),this.ft=e,this.xt=i,this.St=i.pins,this.Tt=[];let r=!1;for(const e of i.pins)e.time<s?this.Tt.push(e):e.time==s?(this.Tt.push(t.makeNotePin(o,s,n)),r=!0):(r||(this.Tt.push(t.makeNotePin(o,s,n)),r=!0),this.Tt.push(e));for(let t=1;t<this.Tt.length-1;)this.Tt[t-1].interval==this.Tt[t].interval&&this.Tt[t].interval==this.Tt[t+1].interval&&this.Tt[t-1].volume==this.Tt[t].volume&&this.Tt[t].volume==this.Tt[t+1].volume?this.Tt.splice(t,1):t++;this.vt(),this.yt()}vt(){this.xt.pins=this.Tt,this.ft.notifier.changed()}wt(){this.xt.pins=this.St,this.ft.notifier.changed()}};t.ChangeChipWave=class extends t.Change{constructor(t,e){super();const i=t.song.channels[t.channel].instruments[t.getCurrentInstrument()];i.chipWave!=e&&(i.chipWave=e,i.preset=i.type,t.notifier.changed(),this.yt())}};t.ChangeNoiseWave=class extends t.Change{constructor(t,e){super();const i=t.song.channels[t.channel].instruments[t.getCurrentInstrument()];i.chipNoise!=e&&(i.chipNoise=e,i.preset=i.type,t.notifier.changed(),this.yt())}}}(beepbox||(beepbox={})),function(t){class e{constructor(){this.valid=!1,this.prevNote=null,this.curNote=null,this.nextNote=null,this.pitch=0,this.pitchIndex=-1,this.curIndex=0,this.start=0,this.end=0,this.part=0,this.notePart=0,this.nearPinIndex=0,this.pins=[]}}t.PatternEditor=class{constructor(i,s,n){this.ft=i,this._t=s,this.Dt=n,this.Wt=t.SVG.pattern({id:"patternEditorNoteBackground"+this.Dt,x:"0",y:"0",patternUnits:"userSpaceOnUse"}),this.Vt=t.SVG.pattern({id:"patternEditorDrumBackground"+this.Dt,x:"0",y:"0",patternUnits:"userSpaceOnUse"}),this.jt=t.SVG.rect({x:"0",y:"0","pointer-events":"none",fill:"url(#patternEditorNoteBackground"+this.Dt+")"}),this.Gt=t.SVG.svg(),this.Kt=t.SVG.rect({id:"",x:"0",y:"0",width:"4",fill:t.ColorConfig.playhead,"pointer-events":"none"}),this.Jt=t.SVG.path({fill:"none",stroke:t.ColorConfig.hoverPreview,"stroke-width":"2","pointer-events":"none"}),this.Yt=t.SVG.svg({style:`background-color: ${t.ColorConfig.editorBackground}; touch-action: none; position: absolute;`,width:"100%",height:"100%"},t.SVG.defs(this.Wt,this.Vt),this.jt,this.Gt,this.Jt,this.Kt),this.container=t.HTML.div({style:"height: 100%; overflow:hidden; position: relative; flex-grow: 1;"},this.Yt),this.Zt=[],this.Qt=t.SVG.rect(),this.Xt=-1,this.te=0,this.ee=0,this.ie=!1,this.se=!1,this.ne=!1,this.oe=!1,this.re=!1,this.he=[],this.ae=0,this.le=0,this.ce=0,this.fe=0,this.de=0,this.ue=!1,this.me=null,this.pe=new e,this.Ut=null,this.ye=0,this.ge=0,this.be=-1,this.ve=-1,this.we=-1,this.ke=-1,this.Me=!1,this.xe=!1,this.Ee=-1,this.qe=-1,this.Ce=-1,this.Pe=-1,this.resetCopiedPins=(()=>{const e=this.Se();this.he.length=this.ft.song.getChannelCount();for(let i=0;i<this.ft.song.pitchChannelCount;i++)this.he[i]=[t.makeNotePin(0,0,3),t.makeNotePin(0,e,3)];for(let i=this.ft.song.pitchChannelCount;i<this.ft.song.getChannelCount();i++)this.he[i]=[t.makeNotePin(0,0,3),t.makeNotePin(0,e,0)]}),this.Te=(e=>{const i=Math.floor(this.ft.synth.playhead);if(this.ft.synth.playing&&(null!=this.Ut&&this.ft.song.getPattern(this.ft.channel,Math.floor(this.ft.synth.playhead))==this.Ut||Math.floor(this.ft.synth.playhead)==this.ft.bar+this.Dt)){this.Kt.setAttribute("visibility","visible");const e=this.ft.synth.playhead-i;Math.abs(e-this.ye)>.1?this.ye=e:this.ye+=.2*(e-this.ye),this.Kt.setAttribute("x",""+t.prettyNumber(this.ye*this.ze-2))}else this.Kt.setAttribute("visibility","hidden");this.ft.synth.playing&&this.ft.autoFollow&&this.Pe!=i&&(new t.ChangeChannelBar(this.ft,this.ft.channel,i),this.ft.notifier.notifyWatchers()),this.Pe=i,window.requestAnimationFrame(this.Te)}),this.Re=(t=>{this.se||(this.se=!0,this.re=!1)}),this.Ne=(t=>{this.se&&(this.se=!1)}),this.Be=(t=>{t.preventDefault();const e=this.Yt.getBoundingClientRect();this.te=((t.clientX||t.pageX)-e.left)*this.ze/(e.right-e.left),this.ee=((t.clientY||t.pageY)-e.top)*this.Fe/(e.bottom-e.top),isNaN(this.te)&&(this.te=0),isNaN(this.ee)&&(this.ee=0),this.re=!1,this.Le()}),this.Ae=(t=>{t.preventDefault();const e=this.Yt.getBoundingClientRect();this.te=(t.touches[0].clientX-e.left)*this.ze/(e.right-e.left),this.ee=(t.touches[0].clientY-e.top)*this.Fe/(e.bottom-e.top),isNaN(this.te)&&(this.te=0),isNaN(this.ee)&&(this.ee=0),this.re=!0,this.Le()}),this.He=(t=>{const e=this.Yt.getBoundingClientRect();this.te=((t.clientX||t.pageX)-e.left)*this.ze/(e.right-e.left),this.ee=((t.clientY||t.pageY)-e.top)*this.Fe/(e.bottom-e.top),isNaN(this.te)&&(this.te=0),isNaN(this.ee)&&(this.ee=0),this.re=!1,this.Ie()}),this.Oe=(t=>{if(!this.ie)return;t.preventDefault();const e=this.Yt.getBoundingClientRect();this.te=(t.touches[0].clientX-e.left)*this.ze/(e.right-e.left),this.ee=(t.touches[0].clientY-e.top)*this.Fe/(e.bottom-e.top),isNaN(this.te)&&(this.te=0),isNaN(this.ee)&&(this.ee=0),this.Ie()}),this.$e=(e=>{if(!this.pe.valid)return;const i=this.ft.lastChangeWas(this.me);if(this.ne&&i)null!=this.me&&(this.ft.record(this.me),this.me=null);else if(this.ie&&i)if(null==this.pe.curNote){const e=new t.Note(this.pe.pitch,this.pe.start,this.pe.end,3,this.ft.song.getChannelIsNoise(this.ft.channel));e.pins=[];for(const i of this.pe.pins)e.pins.push(t.makeNotePin(0,i.time,i.volume));const i=new t.ChangeSequence;i.append(new t.ChangeEnsurePatternExists(this.ft,this.ft.channel,this.ft.bar));const s=this.ft.getCurrentPattern(this.Dt);if(null==s)throw new Error;i.append(new t.ChangeNoteAdded(this.ft,s,e,this.pe.curIndex)),this.ft.record(i)}else{if(null==this.Ut)throw new Error;if(-1==this.pe.pitchIndex){const e=new t.ChangeSequence;if(this.pe.curNote.pitches.length==t.Config.maxChordSize&&e.append(new t.ChangePitchAdded(this.ft,this.pe.curNote,this.pe.curNote.pitches[0],0,!0)),e.append(new t.ChangePitchAdded(this.ft,this.pe.curNote,this.pe.pitch,this.pe.curNote.pitches.length)),this.ft.record(e),this.Ue(this.pe.curNote),this.ft.enableNotePreview&&!this.ft.synth.playing){const e=Math.min(t.Config.partsPerBeat,this.pe.end-this.pe.start);this.ft.synth.liveInputDuration=e,this.ft.synth.liveInputPitches=this.pe.curNote.pitches.concat(),this.ft.synth.liveInputStarted=!0}}else 1==this.pe.curNote.pitches.length?this.ft.record(new t.ChangeNoteAdded(this.ft,this.Ut,this.pe.curNote,this.pe.curIndex,!0)):this.ft.record(new t.ChangePitchAdded(this.ft,this.pe.curNote,this.pe.pitch,this.pe.curNote.pitches.indexOf(this.pe.pitch),!0))}this.ie=!1,this.ne=!1,this._e(),this.De()});for(let e=0;e<t.Config.pitchesPerOctave;e++){const i=t.SVG.rect();i.setAttribute("x","1"),i.setAttribute("fill",0==e?t.ColorConfig.tonic:t.ColorConfig.pitchBackground),this.Wt.appendChild(i),this.Zt[e]=i}this.Qt.setAttribute("x","1"),this.Qt.setAttribute("y","1"),this.Qt.setAttribute("fill",t.ColorConfig.pitchBackground),this.Vt.appendChild(this.Qt),this._t?(this._e(),this.De(),window.requestAnimationFrame(this.Te),this.Yt.addEventListener("mousedown",this.Be),document.addEventListener("mousemove",this.He),document.addEventListener("mouseup",this.$e),this.Yt.addEventListener("mouseover",this.Re),this.Yt.addEventListener("mouseout",this.Ne),this.Yt.addEventListener("touchstart",this.Ae),this.Yt.addEventListener("touchmove",this.Oe),this.Yt.addEventListener("touchend",this.$e),this.Yt.addEventListener("touchcancel",this.$e)):(this.Kt.style.display="none",this.Yt.appendChild(t.SVG.rect({x:0,y:0,width:1e4,height:1e4,fill:t.ColorConfig.editorBackground,style:"opacity: 0.5;"}))),this.resetCopiedPins()}Se(){const e=t.Config.rhythms[this.ft.song.rhythm].stepsPerBeat;return e%4==0?t.Config.partsPerBeat/2:e%3==0?t.Config.partsPerBeat/3:e%2==0?t.Config.partsPerBeat/2:t.Config.partsPerBeat}We(){return t.Config.partsPerBeat/t.Config.rhythms[this.ft.song.rhythm].stepsPerBeat}Ve(t){const e=this.We();return Math.floor(t/e)*e}_e(){if(this.pe=new e,this.te<0||this.te>this.ze||this.ee<0||this.ee>this.Fe||this.Xt<=0)return;const i=this.We(),s=this.te/this.je;if(this.pe.part=Math.floor(Math.max(0,Math.min(this.ft.song.beatsPerBar*t.Config.partsPerBeat-i,s))/i)*i,null!=this.Ut)for(const t of this.Ut.notes)if(t.end<=s)this.pe.prevNote=t,this.pe.curIndex++;else if(t.start<=s&&t.end>s)this.pe.curNote=t;else if(t.start>s){this.pe.nextNote=t;break}let n=this.Ge(this.ee);if(null!=this.pe.curNote){this.pe.start=this.pe.curNote.start,this.pe.end=this.pe.curNote.end,this.pe.pins=this.pe.curNote.pins;let e,i=0,s=0,o=this.pe.curNote.pins[0];for(let t=1;t<this.pe.curNote.pins.length;t++){e=o,o=this.pe.curNote.pins[t];const n=this.je*(this.pe.curNote.start+e.time),r=this.je*(this.pe.curNote.start+o.time);if(this.te>r)continue;if(this.te<n)throw new Error;const h=(this.te-n)/(r-n),a=Math.sqrt(1/Math.sqrt(4)-Math.pow(h-.5,2))-.5,l=Math.abs(o.interval-e.interval);i=e.interval*(1-h)+o.interval*h,s=a*l+.95;break}let r=Number.MAX_VALUE,h=-Number.MAX_VALUE,a=Number.MAX_VALUE;for(const t of this.pe.curNote.pins){r>t.interval&&(r=t.interval),h<t.interval&&(h=t.interval);const e=Math.abs(this.pe.curNote.start+t.time-this.te/this.je);a>e&&(a=e,this.pe.nearPinIndex=this.pe.curNote.pins.indexOf(t))}if(n-=i,this.pe.pitch=this.Ke(n,-r,(this.ft.song.getChannelIsNoise(this.ft.channel)?t.Config.drumCount-1:t.Config.maxPitch)-h),!this.ft.song.getChannelIsNoise(this.ft.channel)){let t=s;for(let e=0;e<this.pe.curNote.pitches.length;e++){const i=Math.abs(this.pe.curNote.pitches[e]-n+.5);i>t||(t=i,this.pe.pitch=this.pe.curNote.pitches[e])}}for(let t=0;t<this.pe.curNote.pitches.length;t++)if(this.pe.curNote.pitches[t]==this.pe.pitch){this.pe.pitchIndex=t;break}}else{this.pe.pitch=this.Ke(n,0,t.Config.maxPitch);const e=this.Je[this.Je.length-1].time,i=Math.floor(this.pe.part/t.Config.partsPerBeat),s=this.Se(),o=this.pe.part%t.Config.partsPerBeat;if(1==e)this.pe.start=this.pe.part;else if(e>t.Config.partsPerBeat)this.pe.start=i*t.Config.partsPerBeat;else if(e==t.Config.partsPerBeat)this.pe.start=i*t.Config.partsPerBeat,s<t.Config.partsPerBeat&&o>s&&(this.pe.start+=Math.floor(o/s)*s);else{this.pe.start=i*t.Config.partsPerBeat;let n=t.Config.partsPerBeat%e==0?e:Math.min(e,s);for(;n<s&&t.Config.partsPerBeat%n!=0;)n++;this.pe.start+=Math.floor(o/n)*n}this.pe.end=this.pe.start+e;let r=0,h=this.ft.song.beatsPerBar*t.Config.partsPerBeat;if(null!=this.pe.prevNote&&(r=this.pe.prevNote.end),null!=this.pe.nextNote&&(h=this.pe.nextNote.start),this.pe.start<r?(this.pe.start=r,this.pe.end=this.pe.start+e,this.pe.end>h&&(this.pe.end=h)):this.pe.end>h&&(this.pe.end=h,this.pe.start=this.pe.end-e,this.pe.start<r&&(this.pe.start=r)),this.pe.end-this.pe.start==e)this.pe.pins=this.Je;else{this.pe.pins=[];for(const e of this.Je){if(!(e.time<=this.pe.end-this.pe.start)){this.pe.pins.push(t.makeNotePin(0,this.pe.end-this.pe.start,e.volume));break}if(this.pe.pins.push(t.makeNotePin(0,e.time,e.volume)),e.time==this.pe.end-this.pe.start)break}}}this.pe.valid=!0}Ge(t){return Math.max(0,Math.min(this.Ye-1,this.Ye-t/this.Xt))+this.ge}Ke(e,i,s){e<i&&(e=i),e>s&&(e=s);const n=t.Config.scales[this.ft.song.scale].flags;if(n[Math.floor(e)%t.Config.pitchesPerOctave]||this.ft.song.getChannelIsNoise(this.ft.channel))return Math.floor(e);{let o=Math.floor(e)+1,r=Math.floor(e)-1;for(;!n[o%t.Config.pitchesPerOctave];)o++;for(;!n[r%t.Config.pitchesPerOctave];)r--;if(o>s)return r<i?i:r;if(r<i)return o;let h=o,a=r+1;return o%t.Config.pitchesPerOctave!=0&&o%t.Config.pitchesPerOctave!=7||(h-=.5),r%t.Config.pitchesPerOctave!=0&&r%t.Config.pitchesPerOctave!=7||(a+=.5),e-a>h-e?o:r}}Ue(e){this.Je=[];for(const i of e.pins)this.Je.push(t.makeNotePin(0,i.time,i.volume));for(let t=1;t<this.Je.length-1;)this.Je[t-1].volume==this.Je[t].volume&&this.Je[t].volume==this.Je[t+1].volume?this.Je.splice(t,1):t++;this.he[this.ft.channel]=this.Je}Le(){if(this.ft.enableNotePreview&&this.ft.synth.maintainLiveInput(),this.ie=!0,this.ae=this.te,this.le=this.ee,this._e(),this.De(),this.me=new t.ChangeSequence,this.ft.setProspectiveChange(this.me),this.ft.enableNotePreview&&!this.ft.synth.playing&&this.pe.valid&&null==this.pe.curNote){const e=Math.min(t.Config.partsPerBeat,this.pe.end-this.pe.start);this.ft.synth.liveInputDuration=e,this.ft.synth.liveInputPitches=[this.pe.pitch],this.ft.synth.liveInputStarted=!0}}Ie(){let e,i;this.ft.enableNotePreview&&this.se&&this.ft.synth.maintainLiveInput();const s=this.ft.lastChangeWas(this.me);if(this.ie&&this.pe.valid&&s){const s=this.We();if(!this.ne){const t=this.te-this.ae,e=this.ee-this.le;Math.sqrt(t*t+e*e)>5&&(this.ne=!0,this.oe=Math.abs(t)>=Math.abs(e))}if(this.ne){null!=this.me&&this.me.undo();const n=this.Ve(this.te/this.je),o=new t.ChangeSequence;if(this.me=o,this.ft.setProspectiveChange(this.me),null==this.pe.curNote){let r,h;n<this.pe.start?(r=!0,h=this.pe.start-n):(r=!1,h=n-this.pe.start+s);let a=s;for(let e=s;e<=this.ft.song.beatsPerBar*t.Config.partsPerBeat;e+=s){if(1==s){if(e<5);else if(e<=t.Config.partsPerBeat/2){if(e%3!=0&&e%4!=0)continue}else if(e<=1.5*t.Config.partsPerBeat){if(e%6!=0&&e%8!=0)continue}else if(e%t.Config.partsPerBeat!=0)continue}else if(e>=5*s&&e%t.Config.partsPerBeat!=0&&e!=3*t.Config.partsPerBeat/4&&e!=3*t.Config.partsPerBeat/2&&e!=4*t.Config.partsPerBeat/3)continue;if(e==h){a=e;break}if(e<h&&(a=e),e>h){a<h-s&&(a=e);break}}if(r?e=(i=this.pe.start)-a:i=(e=this.pe.start)+a,e<0&&(e=0),i>this.ft.song.beatsPerBar*t.Config.partsPerBeat&&(i=this.ft.song.beatsPerBar*t.Config.partsPerBeat),e<i){o.append(new t.ChangeEnsurePatternExists(this.ft,this.ft.channel,this.ft.bar));const s=this.ft.getCurrentPattern(this.Dt);if(null==s)throw new Error;let n;for(o.append(new t.ChangeNoteTruncate(this.ft,s,e,i)),n=0;n<s.notes.length&&!(s.notes[n].start>=i);n++);const h=new t.Note(this.pe.pitch,e,i,3,this.ft.song.getChannelIsNoise(this.ft.channel));o.append(new t.ChangeNoteAdded(this.ft,s,h,n)),this.Ue(h),this.ce=r?e:i,this.fe=this.pe.pitch,this.de=h.pins[r?0:1].volume,this.ue=!0}this.Ut=this.ft.getCurrentPattern(this.Dt)}else if(this.oe){const n=(this.te-this.ae)/this.je,r=this.pe.curNote.pins[this.pe.nearPinIndex];let h=Math.round((this.pe.curNote.start+r.time+n)/s)*s;if(h<0&&(h=0),h>this.ft.song.beatsPerBar*t.Config.partsPerBeat&&(h=this.ft.song.beatsPerBar*t.Config.partsPerBeat),null==this.Ut)throw new Error;h<=this.pe.curNote.start&&this.pe.nearPinIndex==this.pe.curNote.pins.length-1||h>=this.pe.curNote.end&&0==this.pe.nearPinIndex?(o.append(new t.ChangeNoteAdded(this.ft,this.Ut,this.pe.curNote,this.pe.curIndex,!0)),this.ue=!1):(e=Math.min(this.pe.curNote.start,h),i=Math.max(this.pe.curNote.end,h),this.ce=h,this.fe=this.pe.curNote.pitches[-1==this.pe.pitchIndex?0:this.pe.pitchIndex]+this.pe.curNote.pins[this.pe.nearPinIndex].interval,this.de=this.pe.curNote.pins[this.pe.nearPinIndex].volume,this.ue=!0,o.append(new t.ChangeNoteTruncate(this.ft,this.Ut,e,i,this.pe.curNote)),o.append(new t.ChangePinTime(this.ft,this.pe.curNote,this.pe.nearPinIndex,h)),this.Ue(this.pe.curNote))}else if(-1==this.pe.pitchIndex){const e=Math.max(this.pe.curNote.start,Math.min(this.pe.curNote.end,Math.round(this.te/(this.je*s))*s))-this.pe.curNote.start;let i,n=this.pe.curNote.pins[0],r=0,h=0;for(let s=1;s<this.pe.curNote.pins.length;s++){if(i=n,e>(n=this.pe.curNote.pins[s]).time)continue;if(e<i.time)throw new Error;const o=(e-i.time)/(n.time-i.time);(r=Math.round(i.volume*(1-o)+n.volume*o+(this.le-this.ee)/25))<0&&(r=0),r>3&&(r=3),h=this.Ke(i.interval*(1-o)+n.interval*o+this.pe.curNote.pitches[0],0,t.Config.maxPitch)-this.pe.curNote.pitches[0];break}this.ce=this.pe.curNote.start+e,this.fe=this.pe.curNote.pitches[-1==this.pe.pitchIndex?0:this.pe.pitchIndex]+h,this.de=r,this.ue=!0,o.append(new t.ChangeVolumeBend(this.ft,this.pe.curNote,e,r,h)),this.Ue(this.pe.curNote)}else{if(this.de=this.pe.curNote.pins[this.pe.nearPinIndex].volume,null==this.Ut)throw new Error;let e,i;this.te>=this.ae?(e=Math.max(this.pe.curNote.start,this.pe.part),i=n+s):(e=Math.min(this.pe.curNote.end,this.pe.part+s),i=n),i<0&&(i=0),i>this.ft.song.beatsPerBar*t.Config.partsPerBeat&&(i=this.ft.song.beatsPerBar*t.Config.partsPerBeat),i>this.pe.curNote.end&&o.append(new t.ChangeNoteTruncate(this.ft,this.Ut,this.pe.curNote.start,i,this.pe.curNote)),i<this.pe.curNote.start&&o.append(new t.ChangeNoteTruncate(this.ft,this.Ut,i,this.pe.curNote.end,this.pe.curNote));let r=Number.MAX_VALUE,h=-Number.MAX_VALUE;for(const t of this.pe.curNote.pitches)r>t&&(r=t),h<t&&(h=t);r-=this.pe.curNote.pitches[this.pe.pitchIndex],h-=this.pe.curNote.pitches[this.pe.pitchIndex];const a=this.Ke(this.Ge(this.ee),-r,(this.ft.song.getChannelIsNoise(this.ft.channel)?t.Config.drumCount-1:t.Config.maxPitch)-h);o.append(new t.ChangePitchBend(this.ft,this.pe.curNote,e,i,a,this.pe.pitchIndex)),this.Ue(this.pe.curNote),this.ce=i,this.fe=a,this.ue=!0}}}else this._e(),this.De()}De(){if(this.re)if(this.ie&&this.pe.valid&&this.ne&&this.ue){this.Jt.setAttribute("visibility","visible");const e=this.je*this.ce,i=this.Ze(this.fe-this.ge),s=this.Xt/2,n=80,o=60;let r="";r+="M "+t.prettyNumber(e)+" "+t.prettyNumber(i-s*(this.de/3))+" ",r+="L "+t.prettyNumber(e)+" "+t.prettyNumber(i-s*(this.de/3)-o)+" ",r+="M "+t.prettyNumber(e)+" "+t.prettyNumber(i+s*(this.de/3))+" ",r+="L "+t.prettyNumber(e)+" "+t.prettyNumber(i+s*(this.de/3)+o)+" ",r+="M "+t.prettyNumber(e)+" "+t.prettyNumber(i-s*(this.de/3))+" ",r+="L "+t.prettyNumber(e+n)+" "+t.prettyNumber(i-s*(this.de/3))+" ",r+="M "+t.prettyNumber(e)+" "+t.prettyNumber(i+s*(this.de/3))+" ",r+="L "+t.prettyNumber(e+n)+" "+t.prettyNumber(i+s*(this.de/3))+" ",r+="M "+t.prettyNumber(e)+" "+t.prettyNumber(i-s*(this.de/3))+" ",r+="L "+t.prettyNumber(e-n)+" "+t.prettyNumber(i-s*(this.de/3))+" ",r+="M "+t.prettyNumber(e)+" "+t.prettyNumber(i+s*(this.de/3))+" ",r+="L "+t.prettyNumber(e-n)+" "+t.prettyNumber(i+s*(this.de/3))+" ",this.Jt.setAttribute("d",r)}else this.Jt.setAttribute("visibility","hidden");else this.se&&!this.ie&&this.pe.valid?(this.Jt.setAttribute("visibility","visible"),this.Qe(this.Jt,this.pe.pitch,this.pe.start,this.pe.pins,this.Xt/2+1,!0,this.ge)):this.Jt.setAttribute("visibility","hidden")}render(){const e=this.ft.getCurrentPattern(this.Dt);this.Ut!=e&&(this.$e(null),this.me=null),this.Ut=e,this.ze=this.container.clientWidth,this.Fe=this.container.clientHeight,this.je=this.ze/(this.ft.song.beatsPerBar*t.Config.partsPerBeat),this.Ye=this.ft.song.getChannelIsNoise(this.ft.channel)?t.Config.drumCount:t.Config.windowPitchCount,this.Xt=this.Fe/this.Ye,this.ge=this.ft.song.channels[this.ft.channel].octave*t.Config.pitchesPerOctave,this.Ee==this.ft.song.rhythm&&this.qe==this.ft.song.pitchChannelCount&&this.Ce==this.ft.song.noiseChannelCount||(this.Ee=this.ft.song.rhythm,this.qe=this.ft.song.pitchChannelCount,this.Ce=this.ft.song.noiseChannelCount,this.resetCopiedPins()),this.Je=this.he[this.ft.channel],this.be==this.ze&&this.ve==this.Fe||(this.be=this.ze,this.ve=this.Fe,this.jt.setAttribute("width",""+this.ze),this.jt.setAttribute("height",""+this.Fe),this.Kt.setAttribute("height",""+this.Fe));const i=this.ze/this.ft.song.beatsPerBar;if(this.we!=i||this.ke!=this.Xt){this.we=i,this.ke=this.Xt,this.Wt.setAttribute("width",""+i),this.Wt.setAttribute("height",""+this.Xt*t.Config.pitchesPerOctave),this.Vt.setAttribute("width",""+i),this.Vt.setAttribute("height",""+this.Xt),this.Qt.setAttribute("width",""+(i-2)),this.Qt.setAttribute("height",""+(this.Xt-2));for(let e=0;e<t.Config.pitchesPerOctave;e++){const s=this.Zt[e],n=(t.Config.pitchesPerOctave-e)%t.Config.pitchesPerOctave;s.setAttribute("width",""+(i-2)),s.setAttribute("y",""+(n*this.Xt+1)),s.setAttribute("height",""+(this.Xt-2))}}this.Gt=function(t){const e=t.cloneNode(!1);return t.parentNode.replaceChild(e,t),e}(this.Gt),this._t&&(this.ie||this._e(),this.De()),this.Me!=this.ft.showFifth&&(this.Me=this.ft.showFifth,this.Zt[7].setAttribute("fill",this.ft.showFifth?t.ColorConfig.fifthNote:t.ColorConfig.pitchBackground));for(let e=0;e<t.Config.pitchesPerOctave;e++)this.Zt[e].style.visibility=t.Config.scales[this.ft.song.scale].flags[e]?"visible":"hidden";if(this.ft.song.getChannelIsNoise(this.ft.channel)?this.xe||(this.xe=!0,this.jt.setAttribute("fill","url(#patternEditorDrumBackground"+this.Dt+")")):this.xe&&(this.xe=!1,this.jt.setAttribute("fill","url(#patternEditorNoteBackground"+this.Dt+")")),this.ft.showChannels)for(let e=this.ft.song.getChannelCount()-1;e>=0;e--){if(e==this.ft.channel)continue;if(this.ft.song.getChannelIsNoise(e)!=this.ft.song.getChannelIsNoise(this.ft.channel))continue;const i=this.ft.song.getPattern(e,this.ft.bar+this.Dt);if(null!=i)for(const s of i.notes)for(const i of s.pitches){const n=t.SVG.path();n.setAttribute("fill",t.ColorConfig.getChannelColor(this.ft.song,e).secondaryNote),n.setAttribute("pointer-events","none"),this.Qe(n,i,s.start,s.pins,.19*this.Xt,!1,this.ft.song.channels[e].octave*t.Config.pitchesPerOctave),this.Gt.appendChild(n)}}if(null!=this.Ut)for(const e of this.Ut.notes)for(let i=0;i<e.pitches.length;i++){const s=e.pitches[i];let n=t.SVG.path();if(n.setAttribute("fill",t.ColorConfig.getChannelColor(this.ft.song,this.ft.channel).secondaryNote),n.setAttribute("pointer-events","none"),this.Qe(n,s,e.start,e.pins,this.Xt/2+1,!1,this.ge),this.Gt.appendChild(n),(n=t.SVG.path()).setAttribute("fill",t.ColorConfig.getChannelColor(this.ft.song,this.ft.channel).primaryNote),n.setAttribute("pointer-events","none"),this.Qe(n,s,e.start,e.pins,this.Xt/2+1,!0,this.ge),this.Gt.appendChild(n),e.pitches.length>1){const n=this.ft.song.channels[this.ft.channel].instruments[this.ft.getCurrentInstrument()].getChord();if(!n.harmonizes||n.arpeggiates||n.strumParts>0){let n=t.SVG.text();n.setAttribute("x",""+t.prettyNumber(this.je*e.start+2)),n.setAttribute("y",""+t.prettyNumber(this.Ze(s-this.ge))),n.setAttribute("width","30"),n.setAttribute("fill",t.ColorConfig.invertedText),n.setAttribute("text-anchor","start"),n.setAttribute("dominant-baseline","central"),n.setAttribute("pointer-events","none"),n.textContent=""+(i+1),this.Gt.appendChild(n)}}}}Qe(e,i,s,n,o,r,h){const a=this.je*(n[n.length-1].time+n[0].time),l=.5*Math.min(2,a-1);let c=n[0],f="M "+t.prettyNumber(this.je*(s+c.time)+l)+" "+t.prettyNumber(this.Ze(i-h)+o*(r?c.volume/3:1))+" ";for(let e=1;e<n.length;e++){let a=c;c=n[e];let d=this.je*(s+a.time)+(1==e?l:0),u=this.je*(s+c.time)-(e==n.length-1?l:0),m=this.Ze(i+a.interval-h),p=this.Ze(i+c.interval-h),y=r?a.volume/3:1,g=r?c.volume/3:1;f+="L "+t.prettyNumber(d)+" "+t.prettyNumber(m-o*y)+" ",a.interval>c.interval&&(f+="L "+t.prettyNumber(d+1)+" "+t.prettyNumber(m-o*y)+" "),a.interval<c.interval&&(f+="L "+t.prettyNumber(u-1)+" "+t.prettyNumber(p-o*g)+" "),f+="L "+t.prettyNumber(u)+" "+t.prettyNumber(p-o*g)+" "}for(let e=n.length-2;e>=0;e--){let a=c;c=n[e];let d=this.je*(s+a.time)-(e==n.length-2?l:0),u=this.je*(s+c.time)+(0==e?l:0),m=this.Ze(i+a.interval-h),p=this.Ze(i+c.interval-h),y=r?a.volume/3:1,g=r?c.volume/3:1;f+="L "+t.prettyNumber(d)+" "+t.prettyNumber(m+o*y)+" ",a.interval<c.interval&&(f+="L "+t.prettyNumber(d-1)+" "+t.prettyNumber(m+o*y)+" "),a.interval>c.interval&&(f+="L "+t.prettyNumber(u+1)+" "+t.prettyNumber(p+o*g)+" "),f+="L "+t.prettyNumber(u)+" "+t.prettyNumber(p+o*g)+" "}f+="z",e.setAttribute("d",f)}Ze(t){return this.Xt*(this.Ye-t-.5)}}}(beepbox||(beepbox={})),function(t){t.MuteEditor=class{constructor(e){this.ft=e,this.container=t.HTML.div({class:"muteEditor"}),this.Xe=[],this.Fe=128,this.ti=0,this.ei=-1,this.ii=(t=>{const e=this.Xe.indexOf(t.target);-1!=e&&(this.ft.song.channels[e].muted=!this.ft.song.channels[e].muted,this.ft.notifier.changed())}),this.container.addEventListener("click",this.ii)}onKeyPressed(t){t.keyCode}render(){if(!this.ft.enableChannelMuting)return;const e=this.ft.getChannelHeight();if(this.ti!=this.ft.song.getChannelCount()){for(let i=this.ti;i<this.ft.song.getChannelCount();i++){const s=t.HTML.button({class:"mute-button",style:`height: ${e-4}px; margin: 2px;`});this.container.appendChild(s),this.Xe[i]=s}for(let t=this.ft.song.getChannelCount();t<this.ti;t++)this.container.removeChild(this.Xe[t]);this.Xe.length=this.ft.song.getChannelCount()}for(let t=0;t<this.ft.song.getChannelCount();t++)this.ft.song.channels[t].muted?this.Xe[t].classList.add("muted"):this.Xe[t].classList.remove("muted");if(this.ei!=e)for(let t=0;t<this.ft.song.getChannelCount();t++)this.Xe[t].style.height=e-4+"px";this.ei==e&&this.ti==this.ft.song.getChannelCount()||(this.ei=e,this.ti=this.ft.song.getChannelCount(),this.Fe=this.ft.song.getChannelCount()*e,this.container.style.height=this.Fe+"px")}}}(beepbox||(beepbox={})),function(t){class e{constructor(e,i,s,n){this.si=i,this.ni=s,this.oi=document.createTextNode("1"),this.ri=t.SVG.text({"font-family":"sans-serif","font-size":20,"text-anchor":"middle","font-weight":"bold",fill:"red"},this.oi),this.hi=t.SVG.rect({x:1,y:1}),this.container=t.SVG.svg(this.hi,this.ri),this.ai=1,this.li=!0,this.ci=!1,this.fi="",this.hi.setAttribute("fill",t.ColorConfig.uiWidgetBackground),this.ri.setAttribute("fill",n)}setSize(t,e){this.container.setAttribute("x",""+this.si*t),this.container.setAttribute("y",""+this.ni*e),this.hi.setAttribute("width",""+(t-2)),this.hi.setAttribute("height",""+(e-2)),this.ri.setAttribute("x",""+t/2),this.ri.setAttribute("y",""+Math.round(e/2+7))}setIndex(e,i,s,n){this.ai!=e&&(this.ci||0==e==(0==this.ai)||this.hi.setAttribute("fill",0==e?"none":t.ColorConfig.uiWidgetBackground),this.ai=e,this.oi.data=""+e),this.li==i&&this.fi==n||(this.li=i,s?this.ri.setAttribute("fill",t.ColorConfig.invertedText):this.ri.setAttribute("fill",n)),this.ci==s&&this.fi==n||(this.ci=s,s?(this.hi.setAttribute("fill",n),this.ri.setAttribute("fill",t.ColorConfig.invertedText)):(this.hi.setAttribute("fill",0==this.ai?t.ColorConfig.editorBackground:t.ColorConfig.uiWidgetBackground),this.ri.setAttribute("fill",n))),this.fi=n}}t.TrackEditor=class{constructor(e){this.ft=e,this.di=t.SVG.g(),this.ui=t.SVG.rect({fill:t.ColorConfig.playhead,x:0,y:0,width:4,height:128}),this.mi=t.SVG.rect({fill:"none",stroke:t.ColorConfig.hoverPreview,"stroke-width":2,"pointer-events":"none",x:1,y:1,width:30,height:30}),this.pi=t.SVG.path({fill:t.ColorConfig.invertedText,stroke:t.ColorConfig.invertedText,"stroke-width":1,"pointer-events":"none"}),this.yi=t.SVG.path({fill:t.ColorConfig.invertedText,stroke:t.ColorConfig.invertedText,"stroke-width":1,"pointer-events":"none"}),this.gi=t.SVG.rect({fill:t.ColorConfig.boxSelectionFill,stroke:t.ColorConfig.hoverPreview,"stroke-width":2,"stroke-dasharray":"5, 3","pointer-events":"none",visibility:"hidden",x:1,y:1,width:62,height:62}),this.Yt=t.SVG.svg({style:`background-color: ${t.ColorConfig.editorBackground}; position: absolute;`,height:128},this.di,this.gi,this.mi,this.pi,this.yi,this.ui),this.bi=t.HTML.select({className:"trackSelectBox",style:"background: none; border: none; appearance: none; border-radius: initial; box-shadow: none; color: transparent; position: absolute; touch-action: none;"}),this.container=t.HTML.div({class:"noSelection",style:"height: 128px; position: relative; overflow:hidden;"},this.Yt,this.bi),this.vi=[],this.te=0,this.ee=0,this.wi=0,this.ki=0,this.Mi=0,this.xi=0,this.se=!1,this.Ei=!1,this.ne=!1,this.qi="",this.Ci=32,this.Pi=32,this.Si=0,this.Ti=0,this.zi=0,this.Ri=0,this.ti=0,this.Ni=0,this.Bi=0,this.Fi=-1,this.Li=-1,this.ei=-1,this.Ai=t.isMobile,this.Hi=null,this.Ii=(()=>{this.Oi(this.bi.selectedIndex)}),this.Te=(t=>{const e=this.Ci*this.ft.synth.playhead-2;this.Fi!=e&&(this.Fi=e,this.ui.setAttribute("x",""+e)),window.requestAnimationFrame(this.Te)}),this.$i=(t=>{this.Ei=!0,this.ne=!0,this.Ui(t),this.wi=this.Mi,this.ki=this.xi}),this._i=(t=>{this.Ui(t),this.wi==this.Mi&&this.ki==this.xi||t.preventDefault(),this.Ei&&this.Di(),this.De()}),this.Wi=(t=>{this.Ei=!1,this.ne=!1,this.De()}),this.Re=(t=>{this.se||(this.se=!0)}),this.Ne=(t=>{this.se&&(this.se=!1)}),this.Be=(t=>{t.preventDefault(),this.Ei=!0,this.Vi(t),this.wi=this.Mi,this.ki=this.xi,t.shiftKey?(this.ne=!0,this.zi=this.Mi,this.Ri=this.xi,this.ji()):(this.ne=!1,this.ft.channel==this.xi&&this.ft.bar==this.Mi||(this.Gi(this.xi,this.Mi),this.ne=!0),this.Ki())}),this.He=(t=>{this.Vi(t),this.Ei&&(this.wi==this.Mi&&this.ki==this.xi||(this.ne=!0),this.Di()),this.De()}),this.Ji=(t=>{if(this.Ei&&!this.ne&&this.ft.channel==this.xi&&this.ft.bar==this.Mi){const t=this.ee%this.Pi<this.Pi/2,e=this.ft.song.patternsPerChannel;this.Oi((this.ft.song.channels[this.xi].bars[this.Mi]+(t?1:e))%(e+1))}this.Ei=!1,this.ne=!1,this.De()}),window.requestAnimationFrame(this.Te),this.Yt.addEventListener("mousedown",this.Be),document.addEventListener("mousemove",this.He),document.addEventListener("mouseup",this.Ji),this.Yt.addEventListener("mouseover",this.Re),this.Yt.addEventListener("mouseout",this.Ne),this.bi.addEventListener("change",this.Ii),this.bi.addEventListener("touchstart",this.$i),this.bi.addEventListener("touchmove",this._i),this.bi.addEventListener("touchend",this.Wi),this.bi.addEventListener("touchcancel",this.Wi);let i=!1;document.addEventListener("mousedown",()=>{i||(this.Ai=!1,this.De()),i=!0},!0),document.addEventListener("touchstart",()=>{i||(this.Ai=!0,this.De()),i=!0},!0)}ji(){this.ft.notifier.changed(),this.qi="",this.ft.forgetLastChange()}get Yi(){return Math.min(this.Si,this.zi)}get Zi(){return Math.min(this.Ti,this.Ri)}get Qi(){return Math.abs(this.Si-this.zi)+1}get Xi(){return Math.abs(this.Ti-this.Ri)+1}ts(){this.ft.barScrollPos=Math.min(this.ft.barScrollPos,this.zi),this.ft.barScrollPos=Math.max(this.ft.barScrollPos,this.zi-(this.ft.trackVisibleBars-1))}Gi(e,i){new t.ChangeChannelBar(this.ft,e,i),this.ji()}Oi(e){this.ft.record(new t.ChangePatternNumbers(this.ft,e,this.Yi,this.Zi,this.Qi,this.Xi))}onKeyPressed(t){switch(t.keyCode){case 38:t.shiftKey?(this.Ri=Math.max(0,this.Ri-1),this.ji()):(this.Gi((this.ft.channel-1+this.ft.song.getChannelCount())%this.ft.song.getChannelCount(),this.ft.bar),this.Ki()),t.preventDefault();break;case 40:t.shiftKey?(this.Ri=Math.min(this.ft.song.getChannelCount()-1,this.Ri+1),this.ji()):(this.Gi((this.ft.channel+1)%this.ft.song.getChannelCount(),this.ft.bar),this.Ki()),t.preventDefault();break;case 37:t.shiftKey?(this.zi=Math.max(0,this.zi-1),this.ts(),this.ji()):(this.Gi(this.ft.channel,(this.ft.bar+this.ft.song.barCount-1)%this.ft.song.barCount),this.Ki()),t.preventDefault();break;case 39:t.shiftKey?(this.zi=Math.min(this.ft.song.barCount-1,this.zi+1),this.ts(),this.ji()):(this.Gi(this.ft.channel,(this.ft.bar+1)%this.ft.song.barCount),this.Ki()),t.preventDefault();break;case 48:this.es("0"),t.preventDefault();break;case 49:this.es("1"),t.preventDefault();break;case 50:this.es("2"),t.preventDefault();break;case 51:this.es("3"),t.preventDefault();break;case 52:this.es("4"),t.preventDefault();break;case 53:this.es("5"),t.preventDefault();break;case 54:this.es("6"),t.preventDefault();break;case 55:this.es("7"),t.preventDefault();break;case 56:this.es("8"),t.preventDefault();break;case 57:this.es("9"),t.preventDefault();break;default:this.qi=""}}insertBars(){this.ft.record(new t.ChangeInsertBars(this.ft,this.Yi+this.Qi,this.Qi),2);const e=this.Qi;this.Si+=e,this.zi+=e}deleteBars(){this.ft.record(new t.ChangeDeleteBars(this.ft,this.Yi,this.Qi),2);const e=this.Qi;this.Si=Math.max(0,this.Si-e),this.zi=Math.max(0,this.zi-e)}*ss(){for(let t=this.Zi;t<this.Zi+this.Xi;t++)yield t}*ns(){for(let t=this.Yi;t<this.Yi+this.Qi;t++)yield t}*os(){for(let t=0;t<this.ft.song.barCount;t++)(t<this.Yi||t>=this.Yi+this.Qi)&&(yield t)}*rs(t){const e={};for(const i of this.ns()){const s=this.ft.song.channels[t].bars[i];if(0==s)continue;if(e[String(s)])continue;e[String(s)]=!0;const n=this.ft.song.getPattern(t,i);if(null==n)throw new Error;yield n}}hs(t,e){for(let i=0;i<this.ft.song.barCount;i++)if(this.ft.song.channels[t].bars[i]==e)return!1;return!0}copy(){const t=[];for(const e of this.ss()){const i={},s=[];for(const t of this.ns()){const n=this.ft.song.channels[e].bars[t];if(s.push(n),void 0==i[String(n)]){const s=this.ft.song.getPattern(e,t);let o=0,r=[];null!=s&&(o=s.instrument,r=s.notes),i[String(n)]={instrument:o,notes:r}}}const n={isNoise:this.ft.song.getChannelIsNoise(e),patterns:i,bars:s};t.push(n)}const e={beatsPerBar:this.ft.song.beatsPerBar,channels:t};window.localStorage.setItem("selectionCopy",JSON.stringify(e))}pasteNotes(){const e=JSON.parse(String(window.localStorage.getItem("selectionCopy")));if(null==e)return;const i=e.channels||[],s=e.beatsPerBar>>>0,n=new t.ChangeGroup,o=this.Qi>1||this.Xi>1,r=o?this.Xi:Math.min(i.length,this.ft.song.getChannelCount()-this.Zi);for(let e=0;e<r;e++){const r=i[e%i.length],h=this.Zi+e,a=!!r.isNoise,l=r.patterns||{},c=r.bars||[];if(0==c.length)continue;if(a!=this.ft.song.getChannelIsNoise(h))continue;const f=o?this.Qi:Math.min(c.length,this.ft.song.barCount-this.Yi);if(o||1!=c.length||1!=i.length){for(let e=0;e<f;e++){const i=this.Yi+e,s=this.ft.song.channels[h].bars[i];0!=s&&(n.append(new t.ChangePatternNumbers(this.ft,0,i,h,1,1)),this.hs(h,s)&&(this.ft.song.channels[h].patterns[s-1].notes.length=0))}const e={};for(let i=0;i<f;i++){const o=c[i%c.length]>>>0;if(0==o)continue;const r=this.Yi+i;if(void 0!=e[String(o)])n.append(new t.ChangePatternNumbers(this.ft,e[String(o)],r,h,1,1));else{const i=l[String(o)],a=Math.min(i.instrument>>>0,this.ft.song.instrumentsPerChannel-1),c=this.ft.song.channels[h].patterns[o-1];if(void 0!=c&&t.comparePatternNotes(i.notes,c.notes)&&a==c.instrument)n.append(new t.ChangePatternNumbers(this.ft,o,r,h,1,1));else{void 0!=c&&this.hs(h,o)?n.append(new t.ChangePatternNumbers(this.ft,o,r,h,1,1)):n.append(new t.ChangeEnsurePatternExists(this.ft,h,r));const e=this.ft.song.getPattern(h,r);if(null==e)throw new Error;n.append(new t.ChangePaste(this.ft,e,i.notes,s)),n.append(new t.ChangePatternInstrument(this.ft,a,e))}e[String(o)]=this.ft.song.channels[h].bars[r]}}}else{const e=c[0]>>>0,i=this.Yi,o=this.ft.song.channels[h].bars[i];if(0==e&&0==o)continue;const r=l[String(e)],a=Math.min(r.instrument>>>0,this.ft.song.instrumentsPerChannel-1);if(0==o){const s=this.ft.song.channels[h].patterns[e-1];void 0!=s&&(t.comparePatternNotes(r.notes,s.notes)&&a==s.instrument||this.hs(h,e))?n.append(new t.ChangePatternNumbers(this.ft,e,i,h,1,1)):n.append(new t.ChangeEnsurePatternExists(this.ft,h,i))}const f=this.ft.song.getPattern(h,i);if(null==f)throw new Error;n.append(new t.ChangePaste(this.ft,f,r.notes,s)),n.append(new t.ChangePatternInstrument(this.ft,a,f))}}this.ft.record(n)}pasteNumbers(){const e=JSON.parse(String(window.localStorage.getItem("selectionCopy")));if(null==e)return;const i=e.channels||[],s=new t.ChangeGroup,n=this.Qi>1||this.Xi>1,o=n?this.Xi:Math.min(i.length,this.ft.song.getChannelCount()-this.Zi);for(let e=0;e<o;e++){const o=i[e%i.length],r=this.Zi+e,h=o.bars||[];if(0==h.length)continue;const a=n?this.Qi:Math.min(h.length,this.ft.song.barCount-this.Yi);for(let e=0;e<a;e++){const i=h[e%h.length]>>>0,n=this.Yi+e;i>this.ft.song.patternsPerChannel&&s.append(new t.ChangePatternsPerChannel(this.ft,i)),s.append(new t.ChangePatternNumbers(this.ft,i,n,r,1,1))}}this.ft.record(s)}selectAll(){0==this.Yi&&0==this.Zi&&this.Qi==this.ft.song.barCount&&this.Xi==this.ft.song.getChannelCount()?this.Ki():(this.Si=0,this.Ti=0,this.zi=this.ft.song.barCount-1,this.Ri=this.ft.song.getChannelCount()-1),this.ji()}selectChannel(){0==this.Yi&&this.Qi==this.ft.song.barCount?this.Si=this.zi=this.ft.bar:(this.Si=0,this.zi=this.ft.song.barCount-1),this.ji()}duplicatePatterns(){const e=new t.ChangeGroup;for(const i of this.ss()){const s={};for(const n of this.ns()){const o=this.ft.song.channels[i].bars[n];if(0!=o){if(void 0==s[String(o)]){let r=!1;for(const t of this.os())if(this.ft.song.channels[i].bars[t]==o){r=!0;break}if(r){const r=this.ft.song.getPattern(i,n);e.append(new t.ChangePatternNumbers(this.ft,0,n,i,1,1)),e.append(new t.ChangeEnsurePatternExists(this.ft,i,n));const h=this.ft.song.getPattern(i,n);if(null==h)throw new Error;e.append(new t.ChangePaste(this.ft,h,r.notes,this.ft.song.beatsPerBar)),e.append(new t.ChangePatternInstrument(this.ft,r.instrument,h)),s[String(o)]=this.ft.song.channels[i].bars[n]}else s[String(o)]=o}e.append(new t.ChangePatternNumbers(this.ft,s[String(o)],n,i,1,1))}}}this.ft.record(e)}muteChannels(t){if(t){let t=!1;for(let e=0;e<this.ft.song.channels.length;e++)if(this.ft.song.channels[e].muted){t=!0;break}for(let e=0;e<this.ft.song.channels.length;e++)this.ft.song.channels[e].muted=!t}else{let t=!1;for(const e of this.ss())if(!this.ft.song.channels[e].muted){t=!0;break}for(const e of this.ss())this.ft.song.channels[e].muted=t}this.ft.notifier.changed()}soloChannels(){let t=!0;for(let e=0;e<this.ft.song.channels.length;e++){const i=e<this.Zi||e>=this.Zi+this.Xi;if(this.ft.song.channels[e].muted!=i){t=!1;break}}if(t)for(let t=0;t<this.ft.song.channels.length;t++)this.ft.song.channels[t].muted=!1;else for(let t=0;t<this.ft.song.channels.length;t++)this.ft.song.channels[t].muted=t<this.Zi||t>=this.Zi+this.Xi;this.ft.notifier.changed()}forceRhythm(){const e=new t.ChangeGroup;for(const i of this.ss())for(const s of this.rs(i))e.append(new t.ChangePatternRhythm(this.ft,s));this.ft.record(e)}forceScale(){const e=new t.ChangeGroup,i=[!0,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1];for(const e of this.ss())if(!this.ft.song.getChannelIsNoise(e))for(const s of this.rs(e))t.unionOfUsedNotes(s,i);const s=t.generateScaleMap(i,this.ft.song.scale);for(const i of this.ss())if(!this.ft.song.getChannelIsNoise(i))for(const n of this.rs(i))e.append(new t.ChangePatternScale(this.ft,n,s));this.ft.record(e)}transpose(e,i){const s=this.ft.lastChangeWas(this.Hi),n=new t.ChangeGroup;this.Hi=n;for(const s of this.ss())for(const o of this.rs(s))n.append(new t.ChangeTranspose(this.ft,s,o,e,!1,i));this.ft.record(n,s?0:1)}setInstrument(e){const i=new t.ChangeGroup;for(const s of this.ss())for(const n of this.rs(s))i.append(new t.ChangePatternInstrument(this.ft,e,n));this.ft.record(i)}es(t){this.qi+=t;let e=parseInt(this.qi);e<=this.ft.song.patternsPerChannel?this.Oi(e):(this.qi=t,(e=parseInt(this.qi))<=this.ft.song.patternsPerChannel?this.Oi(e):this.qi="")}Ki(){this.Si=this.zi=this.ft.bar,this.Ti=this.Ri=this.ft.channel}Di(){this.zi=this.Mi,this.Ri=this.xi,this.ji()}Ui(t){const e=this.Yt.getBoundingClientRect();this.te=t.touches[0].clientX-e.left,this.ee=t.touches[0].clientY-e.top,isNaN(this.te)&&(this.te=0),isNaN(this.ee)&&(this.ee=0),this.Mi=Math.floor(Math.min(this.ft.song.barCount-1,Math.max(0,this.te/this.Ci))),this.xi=Math.floor(Math.min(this.ft.song.getChannelCount()-1,Math.max(0,this.ee/this.Pi)))}Vi(t){const e=this.Yt.getBoundingClientRect();this.te=(t.clientX||t.pageX)-e.left,this.ee=(t.clientY||t.pageY)-e.top,this.Mi=Math.floor(Math.min(this.ft.song.barCount-1,Math.max(0,this.te/this.Ci))),this.xi=Math.floor(Math.min(this.ft.song.getChannelCount()-1,Math.max(0,this.ee/this.Pi)))}De(){let e=this.xi,i=this.Mi;this.Ai&&(i=this.ft.bar,e=this.ft.channel);const s=i==this.ft.bar&&e==this.ft.channel;if(!this.se||this.Ei||s?this.mi.style.visibility="hidden":(this.mi.setAttribute("x",""+(1+this.Ci*i)),this.mi.setAttribute("y",""+(1+this.Pi*e)),this.mi.setAttribute("height",""+(this.Pi-2)),this.mi.setAttribute("width",""+(this.Ci-2)),this.mi.style.visibility="visible"),(this.se||this.Ai)&&s){const s=this.ee%this.Pi<this.Pi/2,n=this.Ci*(i+.8),o=this.Pi*(e+.5),r=.1*this.Pi,h=.4*this.Pi,a=.175*this.Pi;this.pi.setAttribute("fill",s&&!this.Ai?t.ColorConfig.hoverPreview:t.ColorConfig.invertedText),this.yi.setAttribute("fill",s||this.Ai?t.ColorConfig.invertedText:t.ColorConfig.hoverPreview),this.pi.setAttribute("d",`M ${n} ${o-h} L ${n+a} ${o-r} L ${n-a} ${o-r} z`),this.yi.setAttribute("d",`M ${n} ${o+h} L ${n+a} ${o+r} L ${n-a} ${o+r} z`),this.pi.style.visibility="visible",this.yi.style.visibility="visible"}else this.pi.style.visibility="hidden",this.yi.style.visibility="hidden";this.bi.style.left=this.Ci*this.ft.bar+"px",this.bi.style.width=this.Ci+"px",this.bi.style.top=this.Pi*this.ft.channel+"px",this.bi.style.height=this.Pi+"px";const n=this.ft.song.patternsPerChannel+1;for(let e=this.Bi;e<n;e++)this.bi.appendChild(t.HTML.option({value:e},e));for(let t=n;t<this.Bi;t++)this.bi.removeChild(this.bi.lastChild);this.Bi=n;const o=this.ft.song.channels[this.ft.channel].bars[this.ft.bar];this.bi.selectedIndex!=o&&(this.bi.selectedIndex=o)}render(){if(this.Ci=this.ft.getBarWidth(),this.Pi=this.ft.getChannelHeight(),this.ti!=this.ft.song.getChannelCount()){for(let i=this.ti;i<this.ft.song.getChannelCount();i++){this.vi[i]=[];for(let s=0;s<this.Ni;s++){const n=new e(i,s,i,t.ColorConfig.getChannelColor(this.ft.song,i).secondaryChannel);n.setSize(this.Ci,this.Pi),this.di.appendChild(n.container),this.vi[i][s]=n}}for(let t=this.ft.song.getChannelCount();t<this.ti;t++)for(let e=0;e<this.Ni;e++)this.di.removeChild(this.vi[t][e].container);this.vi.length=this.ft.song.getChannelCount(),this.Ei=!1}if(this.Ni!=this.ft.song.barCount)for(let i=0;i<this.ft.song.getChannelCount();i++){for(let s=this.Ni;s<this.ft.song.barCount;s++){const n=new e(i,s,i,t.ColorConfig.getChannelColor(this.ft.song,i).secondaryChannel);n.setSize(this.Ci,this.Pi),this.di.appendChild(n.container),this.vi[i][s]=n}for(let t=this.ft.song.barCount;t<this.Ni;t++)this.di.removeChild(this.vi[i][t].container);this.vi[i].length=this.ft.song.barCount}if(this.Ni!=this.ft.song.barCount||this.Li!=this.Ci){this.Ni=this.ft.song.barCount;const t=this.Ci*this.ft.song.barCount;this.container.style.width=t+"px",this.Yt.setAttribute("width",t+""),this.Ei=!1}if(this.ei!=this.Pi||this.Li!=this.Ci){this.Li=this.Ci;for(let t=0;t<this.ft.song.getChannelCount();t++)for(let e=0;e<this.Ni;e++)this.vi[t][e].setSize(this.Ci,this.Pi);this.Ei=!1}if(this.ei!=this.Pi||this.ti!=this.ft.song.getChannelCount()){this.ei=this.Pi,this.ti=this.ft.song.getChannelCount();const t=this.ft.song.getChannelCount()*this.Pi;this.Yt.setAttribute("height",""+t),this.ui.setAttribute("height",""+t),this.container.style.height=t+"px"}for(let e=0;e<this.ft.song.getChannelCount();e++)for(let i=0;i<this.Ni;i++){const s=this.ft.song.getPattern(e,i),n=i==this.ft.bar&&e==this.ft.channel,o=null==s||0==s.notes.length,r=this.vi[e][i];if(i<this.ft.song.barCount){const s=t.ColorConfig.getChannelColor(this.ft.song,e);r.setIndex(this.ft.song.channels[e].bars[i],o,n,o&&!n?s.secondaryChannel:s.primaryChannel),r.container.style.visibility="visible"}else r.container.style.visibility="hidden"}this.bi.style.display=this.Ai?"":"none",(!this.ft.synth.playing&&(this.ft.bar<this.Yi||this.Yi+this.Qi<=this.ft.bar)||this.ft.channel<this.Zi||this.Zi+this.Xi<=this.ft.channel||this.ft.song.barCount<this.Yi+this.Qi||this.ft.song.getChannelCount()<this.Zi+this.Xi||1==this.Qi&&1==this.Xi)&&this.Ki(),this.Qi>1||this.Xi>1?(this.gi.setAttribute("x",String(this.Ci*this.Yi+1)),this.gi.setAttribute("y",String(this.Pi*this.Zi+1)),this.gi.setAttribute("width",String(this.Ci*this.Qi-2)),this.gi.setAttribute("height",String(this.Pi*this.Xi-2)),this.gi.setAttribute("visibility","visible")):this.gi.setAttribute("visibility","hidden"),this.De()}}}(beepbox||(beepbox={})),function(t){t.LoopEditor=class{constructor(e){this.ft=e,this.Fe=20,this.as=0,this.ls=1,this.cs=2,this.fs=t.SVG.path({fill:"none",stroke:t.ColorConfig.loopAccent,"stroke-width":4}),this.ds=t.SVG.path({fill:t.ColorConfig.hoverPreview,"pointer-events":"none"}),this.Yt=t.SVG.svg({style:`background-color: ${t.ColorConfig.editorBackground}; touch-action: pan-y; position: absolute;`,height:this.Fe},this.fs,this.ds),this.container=t.HTML.div({style:"height: 20px; position: relative; margin: 5px 0;"},this.Yt),this.Ci=32,this.us=null,this.pe={startBar:-1,mode:-1},this.te=0,this.ms=0,this.ps=0,this.ys=!1,this.gs=!1,this.ie=!1,this.se=!1,this.bs=-1,this.vs=-1,this.Ni=0,this.Li=-1,this.Re=(t=>{this.se||(this.se=!0,this.De())}),this.Ne=(t=>{this.se&&(this.se=!1,this.De())}),this.Be=(t=>{t.preventDefault(),this.ie=!0;const e=this.Yt.getBoundingClientRect();this.te=(t.clientX||t.pageX)-e.left,this._e(),this.De(),this.He(t)}),this.Ae=(t=>{this.ie=!0;const e=this.Yt.getBoundingClientRect();this.te=t.touches[0].clientX-e.left,this._e(),this.De(),this.ms=t.touches[0].clientX,this.ps=t.touches[0].clientY,this.gs=!1,this.ys=!1}),this.He=(t=>{const e=this.Yt.getBoundingClientRect();this.te=(t.clientX||t.pageX)-e.left,this.Ie()}),this.Oe=(t=>{if(!this.ie)return;const e=this.Yt.getBoundingClientRect();this.te=t.touches[0].clientX-e.left,this.gs||this.ys||(Math.abs(t.touches[0].clientY-this.ps)>10?this.ys=!0:Math.abs(t.touches[0].clientX-this.ms)>10&&(this.gs=!0)),this.gs&&(this.Ie(),t.preventDefault())}),this.ws=(t=>{t.preventDefault(),this.ys||(this.Ie(),this.se=!1,this.$e(t),this.De()),this.ie=!1}),this.$e=(t=>{null!=this.us&&this.ft.record(this.us),this.us=null,this.ie=!1,this._e(),this.ks()}),this.Ms=(()=>{this.ks()}),this._e(),this.ks(),this.ft.notifier.watch(this.Ms),this.container.addEventListener("mousedown",this.Be),document.addEventListener("mousemove",this.He),document.addEventListener("mouseup",this.$e),this.container.addEventListener("mouseover",this.Re),this.container.addEventListener("mouseout",this.Ne),this.container.addEventListener("touchstart",this.Ae),this.container.addEventListener("touchmove",this.Oe),this.container.addEventListener("touchend",this.ws),this.container.addEventListener("touchcancel",this.ws)}_e(){const t=this.te/this.Ci;this.pe.startBar=t,t>this.ft.song.loopStart-.25&&t<this.ft.song.loopStart+this.ft.song.loopLength+.25?t-this.ft.song.loopStart<.5*this.ft.song.loopLength?this.pe.mode=this.as:this.pe.mode=this.ls:this.pe.mode=this.cs}xs(t){let e=Math.round(t-this.ft.song.loopLength/2),i=e+this.ft.song.loopLength;return e<0&&(i-=e,e=0),i>this.ft.song.barCount&&(e-=i-this.ft.song.barCount,i=this.ft.song.barCount),{start:e,length:i-e}}Ie(){if(this.ie){let e=this.ft.song.loopStart,i=this.ft.song.loopStart+this.ft.song.loopLength;null!=this.us&&this.ft.lastChangeWas(this.us)&&(i=(e=this.us.oldStart)+this.us.oldLength);const s=this.te/this.Ci;let n,o,r;if(this.pe.mode==this.as)n=e+Math.round(s-this.pe.startBar),o=i,n<0&&(n=0),n>=this.ft.song.barCount&&(n=this.ft.song.barCount),n==o?n=o-1:n>o&&(r=n,n=o,o=r),this.us=new t.ChangeLoop(this.ft,e,i-e,n,o-n);else if(this.pe.mode==this.ls)n=e,(o=i+Math.round(s-this.pe.startBar))<0&&(o=0),o>=this.ft.song.barCount&&(o=this.ft.song.barCount),o==n?o=n+1:o<n&&(r=n,n=o,o=r),this.us=new t.ChangeLoop(this.ft,e,i-e,n,o-n);else if(this.pe.mode==this.cs){const n=this.xs(s);this.us=new t.ChangeLoop(this.ft,e,i-e,n.start,n.length)}this.ft.synth.jumpIntoLoop(),this.ft.autoFollow&&new t.ChangeChannelBar(this.ft,this.ft.channel,Math.floor(this.ft.synth.playhead),!0),this.ft.setProspectiveChange(this.us)}else this._e(),this.De()}De(){const t=this.se&&!this.ie;if(this.ds.style.visibility=t?"visible":"hidden",t){const t=this.Fe/2;let e=this.ft.song.loopStart*this.Ci,i=(this.ft.song.loopStart+this.ft.song.loopLength)*this.Ci;if(this.pe.mode==this.as)i=this.ft.song.loopStart*this.Ci+2*t;else if(this.pe.mode==this.ls)e=(this.ft.song.loopStart+this.ft.song.loopLength)*this.Ci-2*t;else{const t=this.xs(this.pe.startBar);e=t.start*this.Ci,i=(t.start+t.length)*this.Ci}this.ds.setAttribute("d",`M ${e+t} 4 `+`L ${i-t} 4 `+`A ${t-4} ${t-4} 0 0 1 ${i-t} ${this.Fe-4} `+`L ${e+t} ${this.Fe-4} `+`A ${t-4} ${t-4} 0 0 1 ${e+t} 4 `+"z")}}ks(){this.Ci=this.ft.getBarWidth();const t=this.Fe/2,e=this.ft.song.loopStart*this.Ci,i=(this.ft.song.loopStart+this.ft.song.loopLength)*this.Ci;if(this.Ni!=this.ft.song.barCount||this.Li!=this.Ci){this.Ni=this.ft.song.barCount,this.Li=this.Ci;const t=this.Ci*this.ft.song.barCount;this.container.style.width=t+"px",this.Yt.setAttribute("width",t+"")}this.bs==e&&this.vs==i||(this.bs=e,this.vs=i,this.fs.setAttribute("d",`M ${e+t} 2 `+`L ${i-t} 2 `+`A ${t-2} ${t-2} 0 0 1 ${i-t} ${this.Fe-2} `+`L ${e+t} ${this.Fe-2} `+`A ${t-2} ${t-2} 0 0 1 ${e+t} 2 `+"z")),this.De()}}}(beepbox||(beepbox={})),function(t){t.SpectrumEditor=class{constructor(e,i){this.ft=e,this.Es=i,this.ze=112,this.Fe=26,this.qs=t.SVG.path({fill:t.ColorConfig.uiWidgetBackground,"pointer-events":"none"}),this.Cs=t.SVG.svg({"pointer-events":"none"}),this.Ps=t.SVG.svg({"pointer-events":"none"}),this.Ss=t.SVG.path({fill:"none",stroke:"currentColor","stroke-width":2,"pointer-events":"none"}),this.Ts=t.SVG.path({fill:"currentColor","pointer-events":"none"}),this.Yt=t.SVG.svg({style:`background-color: ${t.ColorConfig.editorBackground}; touch-action: none; cursor: crosshair;`,width:"100%",height:"100%",viewBox:"0 0 "+this.ze+" "+this.Fe,preserveAspectRatio:"none"},this.qs,this.Cs,this.Ps,this.Ss,this.Ts),this.container=t.HTML.div({className:"spectrum",style:"height: 2em;"},this.Yt),this.te=0,this.ee=0,this.zs=0,this.Rs=0,this.ie=!1,this.us=null,this.Ns="",this.Me=!0,this.Be=(t=>{t.preventDefault(),this.ie=!0;const e=this.Yt.getBoundingClientRect();this.te=((t.clientX||t.pageX)-e.left)*this.ze/(e.right-e.left),this.ee=((t.clientY||t.pageY)-e.top)*this.Fe/(e.bottom-e.top),isNaN(this.te)&&(this.te=0),isNaN(this.ee)&&(this.ee=0),this.zs=this.Bs(this.te),this.Rs=this.Fs(this.ee),this.Ie()}),this.Ae=(t=>{t.preventDefault(),this.ie=!0;const e=this.Yt.getBoundingClientRect();this.te=(t.touches[0].clientX-e.left)*this.ze/(e.right-e.left),this.ee=(t.touches[0].clientY-e.top)*this.Fe/(e.bottom-e.top),isNaN(this.te)&&(this.te=0),isNaN(this.ee)&&(this.ee=0),this.zs=this.Bs(this.te),this.Rs=this.Fs(this.ee),this.Ie()}),this.He=(t=>{if(null==this.container.offsetParent)return;const e=this.Yt.getBoundingClientRect();this.te=((t.clientX||t.pageX)-e.left)*this.ze/(e.right-e.left),this.ee=((t.clientY||t.pageY)-e.top)*this.Fe/(e.bottom-e.top),isNaN(this.te)&&(this.te=0),isNaN(this.ee)&&(this.ee=0),this.Ie()}),this.Oe=(t=>{if(null==this.container.offsetParent)return;if(!this.ie)return;t.preventDefault();const e=this.Yt.getBoundingClientRect();this.te=(t.touches[0].clientX-e.left)*this.ze/(e.right-e.left),this.ee=(t.touches[0].clientY-e.top)*this.Fe/(e.bottom-e.top),isNaN(this.te)&&(this.te=0),isNaN(this.ee)&&(this.ee=0),this.Ie()}),this.$e=(t=>{this.ie&&(this.ft.record(this.us),this.us=null),this.ie=!1});for(let e=0;e<t.Config.spectrumControlPoints;e+=t.Config.spectrumControlPointsPerOctave)this.Cs.appendChild(t.SVG.rect({fill:t.ColorConfig.tonic,x:(e+1)*this.ze/(t.Config.spectrumControlPoints+2)-1,y:0,width:2,height:this.Fe}));for(let e=4;e<=t.Config.spectrumControlPoints;e+=t.Config.spectrumControlPointsPerOctave)this.Ps.appendChild(t.SVG.rect({fill:t.ColorConfig.fifthNote,x:(e+1)*this.ze/(t.Config.spectrumControlPoints+2)-1,y:0,width:2,height:this.Fe}));this.container.addEventListener("mousedown",this.Be),document.addEventListener("mousemove",this.He),document.addEventListener("mouseup",this.$e),this.container.addEventListener("touchstart",this.Ae),this.container.addEventListener("touchmove",this.Oe),this.container.addEventListener("touchend",this.$e),this.container.addEventListener("touchcancel",this.$e)}Bs(e){return(t.Config.spectrumControlPoints+2)*e/this.ze-1}Fs(e){return t.Config.spectrumMax*(1-(e-1)/(this.Fe-2))}Ie(){if(this.ie){const e=this.Bs(this.te),i=this.Fs(this.ee),s=this.ft.song.channels[this.ft.channel].instruments[this.ft.getCurrentInstrument()],n=null==this.Es?s.spectrumWave:s.drumsetSpectrumWaves[this.Es];if(e!=this.zs){const s=(i-this.Rs)/(e-this.zs),o=this.Rs-this.zs*s,r=Math.ceil(Math.min(this.zs,e)),h=Math.floor(Math.max(this.zs,e));for(let e=r;e<=h;e++)e<0||e>=t.Config.spectrumControlPoints||(n.spectrum[e]=Math.max(0,Math.min(t.Config.spectrumMax,Math.round(e*s+o))))}n.spectrum[Math.max(0,Math.min(t.Config.spectrumControlPoints-1,Math.round(e)))]=Math.max(0,Math.min(t.Config.spectrumMax,Math.round(i))),this.zs=e,this.Rs=i,this.us=new t.ChangeSpectrum(this.ft,s,n),this.ft.setProspectiveChange(this.us)}}render(){const e=this.ft.song.channels[this.ft.channel].instruments[this.ft.getCurrentInstrument()],i=null==this.Es?e.spectrumWave:e.drumsetSpectrumWaves[this.Es],s=e=>(1-e/t.Config.spectrumMax)*(this.Fe-1)+1;let n=0,o="M 0 "+t.prettyNumber(this.Fe)+" ";for(let e=0;e<t.Config.spectrumControlPoints;e++){let r=i.spectrum[e];o+=0!=n||0!=r?"L ":"M ",o+=t.prettyNumber((e+1)*this.ze/(t.Config.spectrumControlPoints+2))+" "+t.prettyNumber(s(r))+" ",n=r}const r=s(n);n>0&&(o+="L "+(this.ze-1)+" "+t.prettyNumber(r)+" "),this.Ns!=o&&(this.Ns=o,this.Ss.setAttribute("d",o),this.qs.setAttribute("d",o+"L "+this.ze+" "+t.prettyNumber(r)+" L "+this.ze+" "+t.prettyNumber(this.Fe)+" L 0 "+t.prettyNumber(this.Fe)+" z "),this.Ts.setAttribute("d","M "+this.ze+" "+t.prettyNumber(r)+" L "+(this.ze-4)+" "+t.prettyNumber(r-4)+" L "+(this.ze-4)+" "+t.prettyNumber(r+4)+" z"),this.Ts.style.display=n>0?"":"none"),this.Me!=this.ft.showFifth&&(this.Me=this.ft.showFifth,this.Ps.style.display=this.ft.showFifth?"":"none")}}}(beepbox||(beepbox={})),function(t){t.HarmonicsEditor=class{constructor(e){this.ft=e,this.ze=112,this.Fe=26,this.Cs=t.SVG.svg({"pointer-events":"none"}),this.Ps=t.SVG.svg({"pointer-events":"none"}),this.Ss=t.SVG.path({fill:"none",stroke:"currentColor","stroke-width":2,"pointer-events":"none"}),this.Ls=[],this.As=t.SVG.svg({"pointer-events":"none"}),this.Yt=t.SVG.svg({style:`background-color: ${t.ColorConfig.editorBackground}; touch-action: none; cursor: crosshair;`,width:"100%",height:"100%",viewBox:"0 0 "+this.ze+" "+this.Fe,preserveAspectRatio:"none"},this.Cs,this.Ps,this.Ss,this.As),this.container=t.HTML.div({className:"harmonics",style:"height: 2em;"},this.Yt),this.te=0,this.ee=0,this.zs=0,this.Rs=0,this.ie=!1,this.us=null,this.Ns="",this.Me=!0,this.Be=(t=>{t.preventDefault(),this.ie=!0;const e=this.Yt.getBoundingClientRect();this.te=((t.clientX||t.pageX)-e.left)*this.ze/(e.right-e.left),this.ee=((t.clientY||t.pageY)-e.top)*this.Fe/(e.bottom-e.top),isNaN(this.te)&&(this.te=0),isNaN(this.ee)&&(this.ee=0),this.zs=this.Bs(this.te),this.Rs=this.Fs(this.ee),this.Ie()}),this.Ae=(t=>{t.preventDefault(),this.ie=!0;const e=this.Yt.getBoundingClientRect();this.te=(t.touches[0].clientX-e.left)*this.ze/(e.right-e.left),this.ee=(t.touches[0].clientY-e.top)*this.Fe/(e.bottom-e.top),isNaN(this.te)&&(this.te=0),isNaN(this.ee)&&(this.ee=0),this.zs=this.Bs(this.te),this.Rs=this.Fs(this.ee),this.Ie()}),this.He=(t=>{if(null==this.container.offsetParent)return;const e=this.Yt.getBoundingClientRect();this.te=((t.clientX||t.pageX)-e.left)*this.ze/(e.right-e.left),this.ee=((t.clientY||t.pageY)-e.top)*this.Fe/(e.bottom-e.top),isNaN(this.te)&&(this.te=0),isNaN(this.ee)&&(this.ee=0),this.Ie()}),this.Oe=(t=>{if(null==this.container.offsetParent)return;if(!this.ie)return;t.preventDefault();const e=this.Yt.getBoundingClientRect();this.te=(t.touches[0].clientX-e.left)*this.ze/(e.right-e.left),this.ee=(t.touches[0].clientY-e.top)*this.Fe/(e.bottom-e.top),isNaN(this.te)&&(this.te=0),isNaN(this.ee)&&(this.ee=0),this.Ie()}),this.$e=(t=>{this.ie&&(this.ft.record(this.us),this.us=null),this.ie=!1});for(let e=1;e<=t.Config.harmonicsControlPoints;e*=2)this.Cs.appendChild(t.SVG.rect({fill:t.ColorConfig.tonic,x:(e-.5)*(this.ze-8)/(t.Config.harmonicsControlPoints-1)-1,y:0,width:2,height:this.Fe}));for(let e=3;e<=t.Config.harmonicsControlPoints;e*=2)this.Ps.appendChild(t.SVG.rect({fill:t.ColorConfig.fifthNote,x:(e-.5)*(this.ze-8)/(t.Config.harmonicsControlPoints-1)-1,y:0,width:2,height:this.Fe}));for(let e=0;e<4;e++){const i=t.SVG.rect({fill:"currentColor",x:this.ze-2*e-1,y:0,width:1,height:this.Fe});this.Ls.push(i),this.As.appendChild(i)}this.container.addEventListener("mousedown",this.Be),document.addEventListener("mousemove",this.He),document.addEventListener("mouseup",this.$e),this.container.addEventListener("touchstart",this.Ae),this.container.addEventListener("touchmove",this.Oe),this.container.addEventListener("touchend",this.$e),this.container.addEventListener("touchcancel",this.$e)}Bs(e){return(t.Config.harmonicsControlPoints-1)*e/(this.ze-8)-.5}Fs(e){return t.Config.harmonicsMax*(1-e/this.Fe)}Ie(){if(this.ie){const e=this.Bs(this.te),i=this.Fs(this.ee),s=this.ft.song.channels[this.ft.channel].instruments[this.ft.getCurrentInstrument()],n=s.harmonicsWave;if(e!=this.zs){const s=(i-this.Rs)/(e-this.zs),o=this.Rs-this.zs*s,r=Math.ceil(Math.min(this.zs,e)),h=Math.floor(Math.max(this.zs,e));for(let e=r;e<=h;e++)e<0||e>=t.Config.harmonicsControlPoints||(n.harmonics[e]=Math.max(0,Math.min(t.Config.harmonicsMax,Math.round(e*s+o))))}n.harmonics[Math.max(0,Math.min(t.Config.harmonicsControlPoints-1,Math.round(e)))]=Math.max(0,Math.min(t.Config.harmonicsMax,Math.round(i))),this.zs=e,this.Rs=i,this.us=new t.ChangeHarmonics(this.ft,s,n),this.ft.setProspectiveChange(this.us)}}render(){const e=this.ft.song.channels[this.ft.channel].instruments[this.ft.getCurrentInstrument()].harmonicsWave,i=e=>(1-e/t.Config.harmonicsMax)*this.Fe;let s=t.prettyNumber(this.Fe),n="";for(let o=0;o<t.Config.harmonicsControlPoints-1;o++){if(0==e.harmonics[o])continue;let r=t.prettyNumber((o+.5)*(this.ze-8)/(t.Config.harmonicsControlPoints-1));n+="M "+r+" "+s+" ",n+="L "+r+" "+t.prettyNumber(i(e.harmonics[o]))+" "}const o=i(e.harmonics[t.Config.harmonicsControlPoints-1]);for(let e=0;e<4;e++){const i=this.Ls[e];i.setAttribute("y",t.prettyNumber(o)),i.setAttribute("height",t.prettyNumber(this.Fe-o))}this.Ns!=n&&(this.Ns=n,this.Ss.setAttribute("d",n)),this.Me!=this.ft.showFifth&&(this.Me=this.ft.showFifth,this.Ps.style.display=this.ft.showFifth?"":"none")}}}(beepbox||(beepbox={})),function(t){t.BarScrollBar=class{constructor(e,i){this.ft=e,this.Hs=i,this.ze=512,this.Fe=20,this.Is=t.SVG.svg({"pointer-events":"none"}),this.Os=t.SVG.rect({fill:t.ColorConfig.uiWidgetBackground,x:0,y:2,width:10,height:this.Fe-4}),this.$s=t.SVG.rect({fill:"none",stroke:t.ColorConfig.hoverPreview,"stroke-width":2,"pointer-events":"none",x:0,y:1,width:10,height:this.Fe-2}),this.Us=t.SVG.path({fill:t.ColorConfig.hoverPreview,"pointer-events":"none"}),this._s=t.SVG.path({fill:t.ColorConfig.hoverPreview,"pointer-events":"none"}),this.Yt=t.SVG.svg({style:`background-color: ${t.ColorConfig.editorBackground}; touch-action: pan-y; position: absolute;`,width:this.ze,height:this.Fe},this.Is,this.Os,this.$s,this.Us,this._s),this.container=t.HTML.div({className:"barScrollBar",style:"width: 512px; height: 20px; overflow: hidden; position: relative;"},this.Yt),this.te=0,this.ie=!1,this.se=!1,this.Ds=!1,this.Ws=-1,this.Vs=-1,this.js=(t=>{this.ft.barScrollPos=this.Hs.scrollLeft/this.ft.getBarWidth()}),this.Re=(t=>{this.se||(this.se=!0,this.De())}),this.Ne=(t=>{this.se&&(this.se=!1,this.De())}),this.Be=(t=>{t.preventDefault(),this.ie=!0;const e=this.Yt.getBoundingClientRect();this.te=(t.clientX||t.pageX)-e.left,this.De(),this.te>=this.ft.barScrollPos*this.Gs&&this.te<=(this.ft.barScrollPos+this.ft.trackVisibleBars)*this.Gs&&(this.Ds=!0,this.Ks=this.te)}),this.Ae=(t=>{t.preventDefault(),this.ie=!0;const e=this.Yt.getBoundingClientRect();this.te=t.touches[0].clientX-e.left,this.De(),this.te>=this.ft.barScrollPos*this.Gs&&this.te<=(this.ft.barScrollPos+this.ft.trackVisibleBars)*this.Gs&&(this.Ds=!0,this.Ks=this.te)}),this.He=(t=>{const e=this.Yt.getBoundingClientRect();this.te=(t.clientX||t.pageX)-e.left,this.Ie()}),this.Oe=(t=>{if(!this.ie)return;t.preventDefault();const e=this.Yt.getBoundingClientRect();this.te=t.touches[0].clientX-e.left,this.Ie()}),this.$e=(t=>{!this.Ds&&this.ie&&(this.te<(this.ft.barScrollPos+8)*this.Gs?(this.ft.barScrollPos>0&&this.ft.barScrollPos--,this.ft.notifier.changed()):(this.ft.barScrollPos<this.ft.song.barCount-this.ft.trackVisibleBars&&this.ft.barScrollPos++,this.ft.notifier.changed())),this.ie=!1,this.Ds=!1,this.De()});const s=.5*this.Fe;this.Us.setAttribute("d",`M 9 ${s} L 20 ${s+6} L 20 ${s-6} z`),this._s.setAttribute("d",`M ${this.ze-9} ${s} L ${this.ze-20} ${s+6} L ${this.ze-20} ${s-6} z`),this.container.addEventListener("mousedown",this.Be),document.addEventListener("mousemove",this.He),document.addEventListener("mouseup",this.$e),this.container.addEventListener("mouseover",this.Re),this.container.addEventListener("mouseout",this.Ne),this.container.addEventListener("touchstart",this.Ae),this.container.addEventListener("touchmove",this.Oe),this.container.addEventListener("touchend",this.$e),this.container.addEventListener("touchcancel",this.$e),this.Hs.addEventListener("scroll",this.js,{capture:!1,passive:!0})}Ie(){if(this.Ds){for(;this.te-this.Ks<.5*-this.Gs&&this.ft.barScrollPos>0;)this.ft.barScrollPos--,this.Ks-=this.Gs,this.ft.notifier.changed();for(;this.te-this.Ks>.5*this.Gs&&this.ft.barScrollPos<this.ft.song.barCount-this.ft.trackVisibleBars;)this.ft.barScrollPos++,this.Ks+=this.Gs,this.ft.notifier.changed()}this.se&&this.De()}De(){let t=!1,e=!1,i=!1;this.se&&!this.ie&&(this.te<this.ft.barScrollPos*this.Gs?t=!0:this.te>(this.ft.barScrollPos+this.ft.trackVisibleBars)*this.Gs?e=!0:i=!0),this.Us.style.visibility=t?"visible":"hidden",this._s.style.visibility=e?"visible":"hidden",this.$s.style.visibility=i?"visible":"hidden"}render(){this.Gs=(this.ze-1)/Math.max(this.ft.trackVisibleBars,this.ft.song.barCount);const e=this.Ws!=this.ft.song.barCount;if(e){for(this.Ws=this.ft.song.barCount;this.Is.firstChild;)this.Is.removeChild(this.Is.firstChild);for(let e=0;e<=this.ft.song.barCount;e++){const i=e%16==0?0:e%4==0?this.Fe/8:this.Fe/3;this.Is.appendChild(t.SVG.rect({fill:t.ColorConfig.uiWidgetBackground,x:e*this.Gs-1,y:i,width:2,height:this.Fe-2*i}))}}(e||this.Vs!=this.ft.barScrollPos)&&(this.Vs=this.ft.barScrollPos,this.Os.setAttribute("x",""+this.Gs*this.ft.barScrollPos),this.Os.setAttribute("width",""+this.Gs*this.ft.trackVisibleBars),this.$s.setAttribute("x",""+this.Gs*this.ft.barScrollPos),this.$s.setAttribute("width",""+this.Gs*this.ft.trackVisibleBars)),this.De(),this.Hs.scrollLeft=this.ft.barScrollPos*this.ft.getBarWidth()}}}(beepbox||(beepbox={})),function(t){t.OctaveScrollBar=class{constructor(e){this.ft=e,this.ze=20,this.Fe=481,this.Js=4,this.Ys=t.Config.pitchOctaves,this.Zs=(this.Fe-this.Js)/this.Ys,this.Qs=this.Zs*t.Config.windowOctaves+this.Js,this.Os=t.SVG.rect({fill:t.ColorConfig.uiWidgetBackground,x:2,y:0,width:this.ze-4,height:this.Qs}),this.$s=t.SVG.rect({fill:"none",stroke:t.ColorConfig.hoverPreview,"stroke-width":2,"pointer-events":"none",x:1,y:0,width:this.ze-2,height:this.Qs}),this.pi=t.SVG.path({fill:t.ColorConfig.hoverPreview,"pointer-events":"none"}),this.yi=t.SVG.path({fill:t.ColorConfig.hoverPreview,"pointer-events":"none"}),this.Yt=t.SVG.svg({style:`background-color: ${t.ColorConfig.editorBackground}; touch-action: pan-x; position: absolute;`,width:this.ze,height:"100%",viewBox:"0 0 20 481",preserveAspectRatio:"none"}),this.container=t.HTML.div({id:"octaveScrollBarContainer",style:"width: 20px; height: 100%; overflow: hidden; position: relative; flex-shrink: 0;"},this.Yt),this.ee=0,this.ie=!1,this.se=!1,this.Ds=!1,this.Xs=-1,this.us=null,this.Re=(t=>{this.se||(this.se=!0,this.De())}),this.Ne=(t=>{this.se&&(this.se=!1,this.De())}),this.Be=(t=>{t.preventDefault(),this.ie=!0;const e=this.Yt.getBoundingClientRect();this.ee=((t.clientY||t.pageY)-e.top)*this.Fe/(e.bottom-e.top),isNaN(this.ee)&&(this.ee=0),this.ft.song.getChannelIsNoise(this.ft.channel)||(this.De(),this.ee>=this.tn-this.Qs&&this.ee<=this.tn&&(this.Ds=!0,this.us=null,this.Ks=this.ee))}),this.Ae=(t=>{t.preventDefault(),this.ie=!0;const e=this.Yt.getBoundingClientRect();this.ee=(t.touches[0].clientY-e.top)*this.Fe/(e.bottom-e.top),isNaN(this.ee)&&(this.ee=0),this.ft.song.getChannelIsNoise(this.ft.channel)||(this.De(),this.ee>=this.tn-this.Qs&&this.ee<=this.tn&&(this.Ds=!0,this.us=null,this.Ks=this.ee))}),this.He=(t=>{const e=this.Yt.getBoundingClientRect();this.ee=((t.clientY||t.pageY)-e.top)*this.Fe/(e.bottom-e.top),isNaN(this.ee)&&(this.ee=0),this.Ie()}),this.Oe=(t=>{if(!this.ie)return;t.preventDefault();const e=this.Yt.getBoundingClientRect();this.ee=(t.touches[0].clientY-e.top)*this.Fe/(e.bottom-e.top),isNaN(this.ee)&&(this.ee=0),this.Ie()}),this.$e=(e=>{if(!this.ft.song.getChannelIsNoise(this.ft.channel)&&this.ie)if(this.Ds)null!=this.us&&this.ft.record(this.us);else{const e=this.ft.lastChangeWas(this.us),i=e?this.us.oldValue:this.ft.song.channels[this.ft.channel].octave,s=this.ft.song.channels[this.ft.channel].octave;this.ee<this.tn-.5*this.Qs?s<t.Config.scrollableOctaves&&(this.us=new t.ChangeOctave(this.ft,i,s+1),this.ft.record(this.us,e?0:1)):s>0&&(this.us=new t.ChangeOctave(this.ft,i,s-1),this.ft.record(this.us,e?0:1))}this.ie=!1,this.Ds=!1,this.De()}),this.Ms=(()=>{this.tn=this.Fe-this.Zs*this.ft.song.channels[this.ft.channel].octave,this.ks()}),this.ft.notifier.watch(this.Ms),this.Ms(),this.Yt.appendChild(this.Os);for(let e=0;e<=this.Ys;e++)this.Yt.appendChild(t.SVG.rect({fill:t.ColorConfig.tonic,x:0,y:e*this.Zs,width:this.ze,height:this.Js}));this.Yt.appendChild(this.$s),this.Yt.appendChild(this.pi),this.Yt.appendChild(this.yi);const i=.5*this.ze;this.pi.setAttribute("d",`M ${i} 9 L ${i+6} 20 L ${i-6} 20 z`),this.yi.setAttribute("d",`M ${i} ${this.Fe-9} L ${i+6} ${this.Fe-20} L ${i-6} ${this.Fe-20} z`),this.container.addEventListener("mousedown",this.Be),document.addEventListener("mousemove",this.He),document.addEventListener("mouseup",this.$e),this.container.addEventListener("mouseover",this.Re),this.container.addEventListener("mouseout",this.Ne),this.container.addEventListener("touchstart",this.Ae),this.container.addEventListener("touchmove",this.Oe),this.container.addEventListener("touchend",this.$e),this.container.addEventListener("touchcancel",this.$e)}Ie(){if(!this.ft.song.getChannelIsNoise(this.ft.channel)){if(this.Ds){const e=this.ft.song.channels[this.ft.channel].octave,i=this.ft.lastChangeWas(this.us)?this.us.oldValue:e;let s=e;for(;this.ee-this.Ks<.5*-this.Zs&&s<t.Config.scrollableOctaves;)s++,this.Ks-=this.Zs;for(;this.ee-this.Ks>.5*this.Zs&&s>0;)s--,this.Ks+=this.Zs;this.us=new t.ChangeOctave(this.ft,i,s),this.ft.setProspectiveChange(this.us)}this.se&&this.De()}}De(){let t=!1,e=!1,i=!1;this.se&&!this.ie&&(this.ee<this.tn-this.Qs?t=!0:this.ee>this.tn?e=!0:i=!0),this.pi.style.visibility=t?"inherit":"hidden",this.yi.style.visibility=e?"inherit":"hidden",this.$s.style.visibility=i?"inherit":"hidden"}ks(){this.Yt.style.visibility=this.ft.song.getChannelIsNoise(this.ft.channel)?"hidden":"visible",this.Xs!=this.tn&&(this.Xs=this.tn,this.Os.setAttribute("y",""+(this.tn-this.Qs)),this.$s.setAttribute("y",""+(this.tn-this.Qs))),this.De()}}}(beepbox||(beepbox={})),function(t){t.Piano=class{constructor(e){this.ft=e,this.en=t.HTML.div({style:"width: 100%; height: 100%; display: flex; flex-direction: column-reverse; align-items: stretch;"}),this.in=t.HTML.div({style:"width: 100%; height: 100%; display: flex; flex-direction: column-reverse; align-items: stretch;"}),this.sn=t.HTML.div({style:`width: 100%; height: 40px; border: 2px solid ${t.ColorConfig.primaryText}; position: absolute; box-sizing: border-box; pointer-events: none;`}),this.container=t.HTML.div({style:"width: 32px; height: 100%; overflow: hidden; position: relative; flex-shrink: 0; touch-action: none;"},this.en,this.in,this.sn),this.Fe=481,this.nn=[],this.rn=[],this.ee=0,this.ie=!1,this.se=!1,this.hn=-1,this.an=-1,this.xe=!1,this.ln=-1,this.Re=(t=>{this.se||(this.se=!0,this.De())}),this.Ne=(t=>{this.se&&(this.se=!1,this.De())}),this.Be=(t=>{t.preventDefault(),this.ft.synth.maintainLiveInput(),this.ie=!0;const e=this.container.getBoundingClientRect();this.ee=((t.clientY||t.pageY)-e.top)*this.Fe/(e.bottom-e.top),isNaN(this.ee)&&(this.ee=0),this.cn(),this.De()}),this.He=(t=>{(this.ie||this.se)&&this.ft.synth.maintainLiveInput();const e=this.container.getBoundingClientRect();this.ee=((t.clientY||t.pageY)-e.top)*this.Fe/(e.bottom-e.top),isNaN(this.ee)&&(this.ee=0),this.fn(),this.ie&&this.cn(),this.De()}),this.Ji=(t=>{this.ie&&this.dn(),this.ie=!1,this.De()}),this.Ae=(t=>{t.preventDefault(),this.ft.synth.maintainLiveInput(),this.ie=!0;const e=this.container.getBoundingClientRect();this.ee=(t.touches[0].clientY-e.top)*this.Fe/(e.bottom-e.top),isNaN(this.ee)&&(this.ee=0),this.fn(),this.cn()}),this.Oe=(t=>{t.preventDefault(),this.ft.synth.maintainLiveInput();const e=this.container.getBoundingClientRect();this.ee=(t.touches[0].clientY-e.top)*this.Fe/(e.bottom-e.top),isNaN(this.ee)&&(this.ee=0),this.fn(),this.ie&&this.cn()}),this.ws=(t=>{t.preventDefault(),this.dn()}),this.Ms=(()=>{const e=this.ft.song.getChannelIsNoise(this.ft.channel);this.Xt=e?40:13,this.Ye=e?t.Config.drumCount:t.Config.windowPitchCount,this.fn(),this.ie&&this.cn(),this.ft.synth.liveInputChannel=this.ft.channel,this.ks()}),this.ks=(()=>{if(!this.ft.showLetters)return;const e=this.ft.song.getChannelIsNoise(this.ft.channel);if(this.an!=this.ft.song.scale||this.ln!=this.ft.song.key||this.xe!=e){if(this.an=this.ft.song.scale,this.ln=this.ft.song.key,this.xe=e,this.en.style.display=e?"none":"flex",this.in.style.display=e?"flex":"none",!e)for(let e=0;e<this.Ye;e++){const i=(e+t.Config.keys[this.ft.song.key].basePitch)%12,s=t.Config.keys[i].isWhiteKey;if(this.nn[e].style.background=s?t.ColorConfig.whitePianoKey:t.ColorConfig.blackPianoKey,t.Config.scales[this.ft.song.scale].flags[e%12]){let s;if(this.nn[e].classList.remove("disabled"),this.rn[e].style.display="",t.Config.keys[i].isWhiteKey)s=t.Config.keys[i].name;else{const n=t.Config.blackKeyNameParents[e%12];s=t.Config.keys[(i+12+n)%12].name,1==n?s+="♭":-1==n&&(s+="♯")}const n=this.rn[e];n.style.color=t.Config.keys[i].isWhiteKey?"black":"white",n.textContent=s}else this.nn[e].classList.add("disabled"),this.rn[e].style.display="none"}this.De()}});for(let e=0;e<t.Config.windowPitchCount;e++){const e=t.HTML.div({class:"piano-label",style:"font-weight: bold; -webkit-text-stroke-width: 0; font-size: 11px; font-family: sans-serif; position: absolute; padding-left: 15px;"}),i=t.HTML.div({class:"piano-button",style:"background: gray;"},e);this.en.appendChild(i),this.rn.push(e),this.nn.push(i)}for(let e=0;e<t.Config.drumCount;e++){const i=100*(1-e/t.Config.drumCount*.35),s=1+(e-t.Config.drumCount/2)/t.Config.drumCount*.5;this.in.appendChild(t.HTML.div({class:"drum-button",style:`background-size: ${i}% ${i}%; filter: brightness(${s})`}))}this.container.addEventListener("mousedown",this.Be),document.addEventListener("mousemove",this.He),document.addEventListener("mouseup",this.Ji),this.container.addEventListener("mouseover",this.Re),this.container.addEventListener("mouseout",this.Ne),this.container.addEventListener("touchstart",this.Ae),this.container.addEventListener("touchmove",this.Oe),this.container.addEventListener("touchend",this.ws),this.container.addEventListener("touchcancel",this.ws),this.ft.notifier.watch(this.Ms),this.Ms()}fn(){const e=t.Config.scales[this.ft.song.scale].flags,i=Math.max(0,Math.min(this.Ye-1,this.Ye-this.ee/this.Xt));if(e[Math.floor(i)%12]||this.ft.song.getChannelIsNoise(this.ft.channel))this.un=Math.floor(i);else{let t=Math.floor(i)+1,s=Math.floor(i)-1;for(;!e[t%12];)t++;for(;!e[s%12];)s--;let n=t,o=s+1;t%12!=0&&t%12!=7||(n-=.5),s%12!=0&&s%12!=7||(o+=.5),this.un=i-o>n-i?t:s}}cn(){const t=this.un+12*this.ft.song.channels[this.ft.channel].octave;this.hn!=t&&(this.hn=t,this.ft.synth.liveInputDuration=Number.MAX_SAFE_INTEGER,this.ft.synth.liveInputPitches=[this.hn],this.ft.synth.liveInputStarted=!0)}dn(){this.hn=-1,this.ft.synth.liveInputDuration=0}De(){if(this.sn.style.visibility=!this.se||this.ie?"hidden":"visible",!this.se||this.ie)return;const t=this.container.getBoundingClientRect(),e=this.Xt/(this.Fe/(t.bottom-t.top));this.sn.style.left="0px",this.sn.style.top=e*(this.Ye-this.un-1)+"px",this.sn.style.height=e+"px"}}}(beepbox||(beepbox={})),function(t){const{button:e,div:i,span:s,h2:n,input:o,br:r,select:h,option:a}=t.HTML;class l{constructor(c){this.ft=c,this.mn=o({style:"width: 3em; margin-left: 1em;",type:"number",step:"1"}),this.pn=h({style:"width: 100%;"},a({value:"splice"},"Splice beats at end of bars."),a({value:"stretch"},"Stretch notes to fit in bars."),a({value:"overflow"},"Overflow notes across bars.")),this.yn=e({className:"cancelButton"}),this.gn=e({className:"okayButton",style:"width:45%;"},"Okay"),this.container=i({className:"prompt noSelection",style:"width: 250px;"},n("Beats Per Bar"),i({style:"display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;"},i({style:"text-align: right;"},"Beats per bar:",r(),s({style:`font-size: smaller; color: ${t.ColorConfig.secondaryText};`},"(Multiples of 3 or 4 are recommended)")),this.mn),i({style:"display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;"},i({className:"selectContainer",style:"width: 100%;"},this.pn)),i({style:"display: flex; flex-direction: row-reverse; justify-content: space-between;"},this.gn),this.yn),this.ut=(()=>{this.ft.undo()}),this.cleanUp=(()=>{this.gn.removeEventListener("click",this.bn),this.yn.removeEventListener("click",this.ut),this.mn.removeEventListener("keypress",l.vn),this.mn.removeEventListener("blur",l.wn),this.container.removeEventListener("keydown",this.kn)}),this.kn=(t=>{"BUTTON"!=t.target.tagName&&13==t.keyCode&&this.bn()}),this.bn=(()=>{window.localStorage.setItem("beatCountStrategy",this.pn.value),this.ft.prompt=null,this.ft.record(new t.ChangeBeatsPerBar(this.ft,l.Mn(this.mn),this.pn.value),0)}),this.mn.value=this.ft.song.beatsPerBar+"",this.mn.min=t.Config.beatsPerBarMin+"",this.mn.max=t.Config.beatsPerBarMax+"";const f=window.localStorage.getItem("beatCountStrategy");null!=f&&(this.pn.value=f),this.mn.select(),setTimeout(()=>this.mn.focus()),this.gn.addEventListener("click",this.bn),this.yn.addEventListener("click",this.ut),this.mn.addEventListener("keypress",l.vn),this.mn.addEventListener("blur",l.wn),this.container.addEventListener("keydown",this.kn)}static vn(t){const e=t.which?t.which:t.keyCode;return 46!=e&&e>31&&(e<48||e>57)&&(t.preventDefault(),!0)}static wn(t){const e=t.target;e.value=Math.floor(Math.max(Number(e.min),Math.min(Number(e.max),Number(e.value))))+""}static Mn(t){return Math.floor(Number(t.value))}}t.BeatsPerBarPrompt=l}(beepbox||(beepbox={})),function(t){const{button:e,div:i,span:s,h2:n,input:o,br:r,select:h,option:a}=t.HTML;class l{constructor(c){this.ft=c,this.mn=o({style:"width: 3em; margin-left: 1em;",type:"number",step:"0.01",value:"0"}),this.pn=h({style:"width: 100%;"},a({value:"overflow"},"Overflow notes across bars."),a({value:"wrapAround"},"Wrap notes around within bars.")),this.yn=e({className:"cancelButton"}),this.gn=e({className:"okayButton",style:"width:45%;"},"Okay"),this.container=i({className:"prompt noSelection",style:"width: 250px;"},n("Move Notes Sideways"),i({style:"display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;"},i({style:"text-align: right;"},"Beats to move:",r(),s({style:`font-size: smaller; color: ${t.ColorConfig.secondaryText};`},"(Negative is left, positive is right)")),this.mn),i({style:"display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;"},i({className:"selectContainer",style:"width: 100%;"},this.pn)),i({style:"display: flex; flex-direction: row-reverse; justify-content: space-between;"},this.gn),this.yn),this.ut=(()=>{this.ft.undo()}),this.cleanUp=(()=>{this.gn.removeEventListener("click",this.bn),this.yn.removeEventListener("click",this.ut),this.mn.removeEventListener("blur",l.wn),this.container.removeEventListener("keydown",this.kn)}),this.kn=(t=>{"BUTTON"!=t.target.tagName&&13==t.keyCode&&this.bn()}),this.bn=(()=>{window.localStorage.setItem("moveNotesSidewaysStrategy",this.pn.value),this.ft.prompt=null,this.ft.record(new t.ChangeMoveNotesSideways(this.ft,+this.mn.value,this.pn.value),0)}),this.mn.min=-this.ft.song.beatsPerBar+"",this.mn.max=this.ft.song.beatsPerBar+"";const f=window.localStorage.getItem("moveNotesSidewaysStrategy");null!=f&&(this.pn.value=f),this.mn.select(),setTimeout(()=>this.mn.focus()),this.gn.addEventListener("click",this.bn),this.yn.addEventListener("click",this.ut),this.mn.addEventListener("blur",l.wn),this.container.addEventListener("keydown",this.kn)}static wn(e){const i=e.target;let s=+i.value;s=Math.round(s*t.Config.partsPerBeat)/t.Config.partsPerBeat,s=Math.round(100*s)/100,i.value=Math.max(+i.min,Math.min(+i.max,s))+""}}t.MoveNotesSidewaysPrompt=l}(beepbox||(beepbox={})),function(t){const{button:e,div:i,span:s,h2:n,input:o,br:r,select:h,option:a}=t.HTML;class l{constructor(c){this.ft=c,this.xn=o({style:"width: 3em; margin-left: 1em;",type:"number",step:"1"}),this.En=h({style:"width: 100%;"},a({value:"end"},"Apply change at end of song."),a({value:"beginning"},"Apply change at beginning of song.")),this.yn=e({className:"cancelButton"}),this.gn=e({className:"okayButton",style:"width:45%;"},"Okay"),this.container=i({className:"prompt noSelection",style:"width: 250px;"},n("Song Length"),i({style:"display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;"},i({style:"display: inline-block; text-align: right;"},"Bars per song:",r(),s({style:`font-size: smaller; color: ${t.ColorConfig.secondaryText};`},"(Multiples of 4 are recommended)")),this.xn),i({style:"display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;"},i({className:"selectContainer",style:"width: 100%;"},this.En)),i({style:"display: flex; flex-direction: row-reverse; justify-content: space-between;"},this.gn),this.yn),this.ut=(()=>{this.ft.undo()}),this.cleanUp=(()=>{this.gn.removeEventListener("click",this.bn),this.yn.removeEventListener("click",this.ut),this.xn.removeEventListener("keypress",l.vn),this.xn.removeEventListener("blur",l.wn),this.container.removeEventListener("keydown",this.kn)}),this.kn=(t=>{"BUTTON"!=t.target.tagName&&13==t.keyCode&&this.bn()}),this.bn=(()=>{window.localStorage.setItem("barCountPosition",this.En.value);const e=new t.ChangeGroup;e.append(new t.ChangeBarCount(this.ft,l.Mn(this.xn),"beginning"==this.En.value)),this.ft.prompt=null,this.ft.record(e,0)}),this.xn.value=this.ft.song.barCount+"",this.xn.min=t.Config.barCountMin+"",this.xn.max=t.Config.barCountMax+"";const f=window.localStorage.getItem("barCountPosition");null!=f&&(this.En.value=f),this.xn.select(),setTimeout(()=>this.xn.focus()),this.gn.addEventListener("click",this.bn),this.yn.addEventListener("click",this.ut),this.xn.addEventListener("keypress",l.vn),this.xn.addEventListener("blur",l.wn),this.container.addEventListener("keydown",this.kn)}static vn(t){const e=t.which?t.which:t.keyCode;return 46!=e&&e>31&&(e<48||e>57)&&(t.preventDefault(),!0)}static wn(t){const e=t.target;e.value=Math.floor(Math.max(Number(e.min),Math.min(Number(e.max),Number(e.value))))+""}static Mn(t){return Math.floor(Number(t.value))}}t.SongDurationPrompt=l}(beepbox||(beepbox={})),function(t){const{button:e,div:i,h2:s,input:n}=t.HTML;class o{constructor(r){this.ft=r,this.qn=n({style:"width: 3em; margin-left: 1em;",type:"number",step:"1"}),this.Cn=n({style:"width: 3em; margin-left: 1em;",type:"number",step:"1"}),this.Pn=n({style:"width: 3em; margin-left: 1em;",type:"number",step:"1"}),this.Sn=n({style:"width: 3em; margin-left: 1em;",type:"number",step:"1"}),this.yn=e({className:"cancelButton"}),this.gn=e({className:"okayButton",style:"width:45%;"},"Okay"),this.container=i({className:"prompt noSelection",style:"width: 250px;"},s("Channel Settings"),i({style:"display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;"},"Pitch channels:",this.Pn),i({style:"display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;"},"Drum channels:",this.Sn),i({style:"display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;"},"Patterns per channel:",this.qn),i({style:"display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;"},"Instruments per channel:",this.Cn),i({style:"display: flex; flex-direction: row-reverse; justify-content: space-between;"},this.gn),this.yn),this.ut=(()=>{this.ft.undo()}),this.cleanUp=(()=>{this.gn.removeEventListener("click",this.bn),this.yn.removeEventListener("click",this.ut),this.qn.removeEventListener("keypress",o.vn),this.Cn.removeEventListener("keypress",o.vn),this.Pn.removeEventListener("keypress",o.vn),this.Sn.removeEventListener("keypress",o.vn),this.qn.removeEventListener("blur",o.wn),this.Cn.removeEventListener("blur",o.wn),this.Pn.removeEventListener("blur",o.wn),this.Sn.removeEventListener("blur",o.wn),this.container.removeEventListener("keydown",this.kn)}),this.kn=(t=>{"BUTTON"!=t.target.tagName&&13==t.keyCode&&this.bn()}),this.bn=(()=>{const e=new t.ChangeGroup;e.append(new t.ChangePatternsPerChannel(this.ft,o.Mn(this.qn))),e.append(new t.ChangeInstrumentsPerChannel(this.ft,o.Mn(this.Cn))),e.append(new t.ChangeChannelCount(this.ft,o.Mn(this.Pn),o.Mn(this.Sn))),this.ft.prompt=null,this.ft.record(e,0)}),this.qn.value=this.ft.song.patternsPerChannel+"",this.qn.min="1",this.qn.max=t.Config.barCountMax+"",this.Cn.value=this.ft.song.instrumentsPerChannel+"",this.Cn.min=t.Config.instrumentsPerChannelMin+"",this.Cn.max=t.Config.instrumentsPerChannelMax+"",this.Pn.value=this.ft.song.pitchChannelCount+"",this.Pn.min=t.Config.pitchChannelCountMin+"",this.Pn.max=t.Config.pitchChannelCountMax+"",this.Sn.value=this.ft.song.noiseChannelCount+"",this.Sn.min=t.Config.noiseChannelCountMin+"",this.Sn.max=t.Config.noiseChannelCountMax+"",this.Pn.select(),setTimeout(()=>this.Pn.focus()),this.gn.addEventListener("click",this.bn),this.yn.addEventListener("click",this.ut),this.qn.addEventListener("keypress",o.vn),this.Cn.addEventListener("keypress",o.vn),this.Pn.addEventListener("keypress",o.vn),this.Sn.addEventListener("keypress",o.vn),this.qn.addEventListener("blur",o.wn),this.Cn.addEventListener("blur",o.wn),this.Pn.addEventListener("blur",o.wn),this.Sn.addEventListener("blur",o.wn),this.container.addEventListener("keydown",this.kn)}static vn(t){const e=t.which?t.which:t.keyCode;return 46!=e&&e>31&&(e<48||e>57)&&(t.preventDefault(),!0)}static wn(t){const e=t.target;e.value=String(o.Mn(e))}static Mn(t){return Math.floor(Math.max(Number(t.min),Math.min(Number(t.max),Number(t.value))))}}t.ChannelSettingsPrompt=o}(beepbox||(beepbox={})),function(t){function e(t,e){const i=new ArrayBuffer(e);let s=0,n=Math.min(t.byteLength,i.byteLength);const o=[8,4,2,1];for(const e of o)if(n>=e){const o=r(e,t,i,s,n);s=o.nextOffset,n=o.leftBytes}return i;function r(t,e,i,s,n){let o=Uint8Array;switch(t){case 8:o=Float64Array;break;case 4:o=Float32Array;break;case 2:o=Uint16Array;break;case 1:default:o=Uint8Array}const r=new o(e,s,n/t|0),h=new o(i,s,n/t|0);for(let t=0;t<h.length;t++)h[t]=r[t];return{nextOffset:r.byteOffset+r.byteLength,leftBytes:n-h.length*t}}}t.ArrayBufferWriter=class{constructor(t){this.Tn=0,this.zn=0,this.Rn=new ArrayBuffer(t),this.Nn=new DataView(this.Rn)}Bn(t){this.zn+=t,this.zn>this.Rn.byteLength&&(this.Rn=e(this.Rn,Math.max(2*this.Rn.byteLength,this.zn)),this.Nn=new DataView(this.Rn))}getWriteIndex(){return this.Tn}rewriteUint32(t,e){this.Nn.setUint32(t,e>>>0,!1)}writeUint32(t){t>>>=0,this.Bn(4),this.Nn.setUint32(this.Tn,t,!1),this.Tn=this.zn}writeUint24(t){t>>>=0,this.Bn(3),this.Nn.setUint8(this.Tn,t>>16&255),this.Nn.setUint8(this.Tn+1,t>>8&255),this.Nn.setUint8(this.Tn+2,255&t),this.Tn=this.zn}writeUint16(t){t>>>=0,this.Bn(2),this.Nn.setUint16(this.Tn,t,!1),this.Tn=this.zn}writeUint8(t){t>>>=0,this.Bn(1),this.Nn.setUint8(this.Tn,t),this.Tn=this.zn}writeInt8(t){t|=0,this.Bn(1),this.Nn.setInt8(this.Tn,t),this.Tn=this.zn}writeMidi7Bits(t){if((t>>>=0)>=128)throw new Error("7 bit value contained 8th bit!");this.Bn(1),this.Nn.setUint8(this.Tn,t),this.Tn=this.zn}writeMidiVariableLength(t){if((t>>>=0)>268435455)throw new Error("writeVariableLength value too big.");let e=!1;for(let i=0;i<4;i++){const s=t>>>21-7*i&127;0==s&&3!=i||(e=!0),e&&this.writeUint8((3==i?0:128)|s)}}writeMidiAscii(t){this.writeMidiVariableLength(t.length);for(let e=0;e<t.length;e++){const i=t.charCodeAt(e);if(i>127)throw new Error("Trying to write unicode character as ascii.");this.writeUint8(i)}}toCompactArrayBuffer(){return e(this.Rn,this.zn)}}}(beepbox||(beepbox={})),function(t){t.defaultMidiExpression=127,t.defaultMidiPitchBend=8192,t.analogousDrumMap={35:{frequency:0,duration:2,volume:3},36:{frequency:0,duration:2,volume:3},37:{frequency:5,duration:1,volume:3},38:{frequency:4,duration:2,volume:3},39:{frequency:5,duration:2,volume:3},40:{frequency:4,duration:2,volume:3},41:{frequency:1,duration:2,volume:3},42:{frequency:8,duration:1,volume:3},43:{frequency:1,duration:2,volume:3},44:{frequency:8,duration:1,volume:2},45:{frequency:2,duration:2,volume:3},46:{frequency:8,duration:4,volume:3},47:{frequency:2,duration:2,volume:3},48:{frequency:3,duration:2,volume:3},49:{frequency:7,duration:4,volume:3},50:{frequency:3,duration:2,volume:3},51:{frequency:6,duration:4,volume:2},52:{frequency:7,duration:4,volume:3},53:{frequency:6,duration:2,volume:3},54:{frequency:11,duration:2,volume:3},55:{frequency:9,duration:4,volume:3},56:{frequency:7,duration:1,volume:2},57:{frequency:7,duration:4,volume:3},58:{frequency:10,duration:2,volume:2},59:{frequency:6,duration:4,volume:3},69:{frequency:10,duration:2,volume:3},70:{frequency:10,duration:2,volume:3},73:{frequency:10,duration:1,volume:2},74:{frequency:10,duration:2,volume:2}},t.midiVolumeToVolumeMult=function(t){return Math.pow(t/127,4)/.3844015376046128},t.volumeMultToMidiVolume=function(t){return 127*Math.pow(.3844015376046128*t,.25)},t.midiExpressionToVolumeMult=function(t){return Math.pow(t/127,4)},t.volumeMultToMidiExpression=function(t){return 127*Math.pow(t,.25)}}(beepbox||(beepbox={})),function(t){const{button:e,div:i,h2:s,input:n,select:o,option:r}=t.HTML;function h(t,e,i){return t+i*(e-t)}function a(t,e){if(navigator.msSaveOrOpenBlob)return void navigator.msSaveOrOpenBlob(t,e);const i=document.createElement("a");if(void 0!=i.download){const s=URL.createObjectURL(t);setTimeout(function(){URL.revokeObjectURL(s)},6e4),i.href=s,i.download=e,setTimeout(function(){i.dispatchEvent(new MouseEvent("click"))},0)}else{const e=URL.createObjectURL(t);setTimeout(function(){URL.revokeObjectURL(e)},6e4),window.open(e,"_blank")||(window.location.href=e)}}class l{constructor(t){this.ft=t,this.Fn=n({type:"text",style:"width: 10em;",value:"BeepBox-Song",maxlength:250,autofocus:"autofocus"}),this.Ln=n({type:"checkbox"}),this.An=n({style:"width: 2em;",type:"number",min:"1",max:"4",step:"1"}),this.Hn=n({type:"checkbox"}),this.In=o({style:"width: 100%;"},r({value:"wav"},"Export to .wav file."),r({value:"midi"},"Export to .mid file."),r({value:"json"},"Export to .json file.")),this.yn=e({className:"cancelButton"}),this.On=e({className:"exportButton",style:"width:45%;"},"Export"),this.container=i({className:"prompt noSelection",style:"width: 200px;"},s("Export Options"),i({style:"display: flex; flex-direction: row; align-items: center; justify-content: space-between;"},"File name:",this.Fn),i({style:"display: table; width: 100%;"},i({style:"display: table-row;"},i({style:"display: table-cell;"},"Intro:"),i({style:"display: table-cell;"},"Loop Count:"),i({style:"display: table-cell;"},"Outro:")),i({style:"display: table-row;"},i({style:"display: table-cell; vertical-align: middle;"},this.Ln),i({style:"display: table-cell; vertical-align: middle;"},this.An),i({style:"display: table-cell; vertical-align: middle;"},this.Hn))),i({className:"selectContainer",style:"width: 100%;"},this.In),i({style:"display: flex; flex-direction: row-reverse; justify-content: space-between;"},this.On),this.yn),this.ut=(()=>{this.ft.undo()}),this.cleanUp=(()=>{this.Fn.removeEventListener("input",l.$n),this.An.removeEventListener("blur",l.wn),this.On.removeEventListener("click",this.Un),this.yn.removeEventListener("click",this.ut),this.container.removeEventListener("keydown",this.kn)}),this.kn=(t=>{"BUTTON"!=t.target.tagName&&13==t.keyCode&&this.Un()}),this.Un=(()=>{switch(window.localStorage.setItem("exportFormat",this.In.value),this.In.value){case"wav":this._n();break;case"midi":this.Dn();break;case"json":this.Wn();break;default:throw new Error("Unhandled file export type.")}}),this.An.value="1",0==this.ft.song.loopStart?(this.Ln.checked=!1,this.Ln.disabled=!0):(this.Ln.checked=!0,this.Ln.disabled=!1),this.ft.song.loopStart+this.ft.song.loopLength==this.ft.song.barCount?(this.Hn.checked=!1,this.Hn.disabled=!0):(this.Hn.checked=!0,this.Hn.disabled=!1);const h=window.localStorage.getItem("exportFormat");null!=h&&(this.In.value=h),this.Fn.select(),setTimeout(()=>this.Fn.focus()),this.Fn.addEventListener("input",l.$n),this.An.addEventListener("blur",l.wn),this.On.addEventListener("click",this.Un),this.yn.addEventListener("click",this.ut),this.container.addEventListener("keydown",this.kn)}static $n(t){const e=t.target,i=/[\+\*\$\?\|\{\}\\\/<>#%!`&'"=:@]/gi;if(i.test(e.value)){let t=e.selectionStart;e.value=e.value.replace(i,""),t--,e.setSelectionRange(t,t)}}static wn(t){const e=t.target;e.value=Math.floor(Math.max(Number(e.min),Math.min(Number(e.max),Number(e.value))))+""}_n(){const e=new t.Synth(this.ft.song);if(e.loopRepeatCount=Number(this.An.value)-1,!this.Ln.checked)for(let t=0;t<this.ft.song.loopStart;t++)e.nextBar();const i=e.getSamplesPerBar()*e.getTotalBars(this.Ln.checked,this.Hn.checked),s=new Float32Array(i),n=new Float32Array(i);e.synthesize(s,n,i);const o=2*i;let r=0;const h=new ArrayBuffer(44+2*o),l=new DataView(h);l.setUint32(r,1380533830,!1),r+=4,l.setUint32(r,36+2*o,!0),r+=4,l.setUint32(r,1463899717,!1),r+=4,l.setUint32(r,1718449184,!1),r+=4,l.setUint32(r,16,!0),r+=4,l.setUint16(r,1,!0),r+=2,l.setUint16(r,2,!0),r+=2,l.setUint32(r,44100,!0),r+=4,l.setUint32(r,176400,!0),r+=4,l.setUint16(r,4,!0),r+=2,l.setUint16(r,16,!0),r+=2,l.setUint32(r,1684108385,!1),r+=4,l.setUint32(r,2*o,!0),r+=4;for(let t=0;t<i;t++){let e=Math.floor(32767*Math.max(-1,Math.min(1,s[t]))),i=Math.floor(32767*Math.max(-1,Math.min(1,n[t])));l.setInt16(r,e,!0),r+=2,l.setInt16(r,i,!0),r+=2}a(new Blob([h],{type:"audio/wav"}),this.Fn.value.trim()+".wav"),this.ut()}Dn(){const e=this.ft.song,i=2*t.Config.ticksPerPart*t.Config.partsPerBeat,s=2*t.Config.ticksPerPart,n=e.getBeatsPerMinute(),o=Math.round(6e7/n),r=i*e.beatsPerBar,c=[];if(this.Ln.checked)for(let t=0;t<e.loopStart;t++)c.push(t);for(let t=0;t<Number(this.An.value);t++)for(let t=e.loopStart;t<e.loopStart+e.loopLength;t++)c.push(t);if(this.Hn.checked)for(let t=e.loopStart+e.loopLength;t<e.barCount;t++)c.push(t);const f=[{isMeta:!0,channel:-1,midiChannel:-1,isNoise:!1,isDrumset:!1}];let d=0,u=!1;for(let t=0;t<this.ft.song.getChannelCount();t++)if(u||4!=this.ft.song.channels[t].instruments[0].type){if(d>=16)continue;f.push({isMeta:!1,channel:t,midiChannel:d++,isNoise:this.ft.song.getChannelIsNoise(t),isDrumset:!1}),9==d&&d++}else f.push({isMeta:!1,channel:t,midiChannel:9,isNoise:!0,isDrumset:!0}),u=!0;const m=new t.ArrayBufferWriter(1024);m.writeUint32(1297377380),m.writeUint32(6),m.writeUint16(1),m.writeUint16(f.length),m.writeUint16(i);for(const n of f){m.writeUint32(1297379947);const{isMeta:a,channel:f,midiChannel:d,isNoise:u,isDrumset:y}=n,g=m.getWriteIndex();m.writeUint32(0);let b=0,v=0;const w=function(t){if(t<b)throw new Error("Midi event time cannot go backwards.");m.writeMidiVariableLength(t-b),b=t},k=function(t,e){if(!(e>=0&&e<=127))throw new Error("Midi control event value out of range: "+e);m.writeUint8(176|d),m.writeMidi7Bits(t),m.writeMidi7Bits(0|e)};if(a){w(0),m.writeUint8(255),m.writeMidi7Bits(1),m.writeMidiAscii("Composed with beepbox.co"),w(0),m.writeUint8(255),m.writeMidi7Bits(81),m.writeMidiVariableLength(3),m.writeUint24(o),w(0),m.writeUint8(255),m.writeMidi7Bits(88),m.writeMidiVariableLength(4),m.writeUint8(e.beatsPerBar),m.writeUint8(2),m.writeUint8(24),m.writeUint8(8);const i=t.Config.scales[e.scale].flags[3]&&!t.Config.scales[e.scale].flags[4],s=e.key;let n=s;for(1==(1&s)&&(n+=6),i&&(n+=9);n>6;)n-=12;w(0),m.writeUint8(255),m.writeMidi7Bits(89),m.writeMidiVariableLength(2),m.writeInt8(n),m.writeUint8(i?1:0),this.Ln.checked&&(v+=r*e.loopStart),w(v),m.writeUint8(255),m.writeMidi7Bits(6),m.writeMidiAscii("Loop Start");for(let t=0;t<parseInt(this.An.value);t++)v+=r*e.loopLength,w(v),m.writeUint8(255),m.writeMidi7Bits(6),m.writeMidiAscii(t<Number(this.An.value)-1?"Loop Repeat":"Loop End");if(this.Hn.checked&&(v+=r*(e.barCount-e.loopStart-e.loopLength)),v!=r*c.length)throw new Error("Miscalculated number of bars.")}else{let n=t.ColorConfig.getChannelColor(e,f).name+" channel";w(0),m.writeUint8(255),m.writeMidi7Bits(3),m.writeMidiAscii(n),w(0),k(101,0),w(0),k(100,0),w(0),k(6,24),w(0),k(38,0),w(0),k(101,127),w(0),k(100,127);let o=-1;function p(i){const s=e.channels[f].instruments[i],n=t.EditorConfig.valueToPreset(s.preset);if(o!=i){if(o=i,w(v),m.writeUint8(255),m.writeMidi7Bits(4),m.writeMidiAscii("Instrument "+(i+1)),!y){let t=81;if(null!=n&&void 0!=n.midiProgram)t=n.midiProgram;else if(4==s.type)t=116;else{const e=s.getFilterEnvelope().type,i=8==e||4==e;if(2==s.type||3==s.type)t=u?116:i?47:75;else if(0==s.type){const e=i?l.midiDecayInstruments:l.midiSustainInstruments;e.length>s.chipWave&&(t=e[s.chipWave])}else if(6==s.type)t=i?25:81;else{if(1!=s.type&&5!=s.type)throw new Error("Unrecognized instrument type.");t=i?2:81}}w(v),m.writeUint8(192|d),m.writeMidi7Bits(t)}w(v);let e=t.volumeMultToMidiVolume(t.Synth.instrumentVolumeToVolumeMult(s.volume));k(7,Math.min(127,Math.round(e))),w(v);let r=63*(s.pan/t.Config.panCenter-1)+64;k(10,Math.min(127,Math.round(r)))}}null==e.getPattern(f,0)&&p(0);let a=t.defaultMidiPitchBend,g=t.defaultMidiExpression,b=!1;const M=u?t.Config.spectrumBasePitch:t.Config.keys[e.key].basePitch,x=u?t.Config.noiseInterval:1;for(const n of c){const o=e.getPattern(f,n);if(null!=o){const n=o.instrument,r=e.channels[f].instruments[n],l=t.EditorConfig.valueToPreset(r.preset);p(n);let c=!1,E=!0,q=1;c=r.getChord().harmonizes,(E=r.getChord().arpeggiates)?c&&(0==r.type?q=2:1==r.type?q=t.Config.operatorCount:console.error("Unrecognized instrument type for harmonizing arpeggio: "+r.type)):q=t.Config.maxChordSize;for(let n=0;n<o.notes.length;n++){const r=o.notes[n],c=v+r.start*s;let f=c,p=r.pins[0].volume,C=r.pins[0].interval;const P=[-1,-1,-1,-1],S=[-1,-1,-1,-1],T=Math.min(q,r.pitches.length),z=y?Math.max(1,Math.round(90*r.pins[0].volume/3)):90;let R=r.pickMainInterval(),N=R*x;if(!y){let t=24,e=-24;for(let i=1;i<r.pins.length;i++){const s=r.pins[i].interval*x;t=Math.min(t,s+24),e=Math.max(e,s-24)}N=Math.min(t,Math.max(e,N))}for(let n=1;n<r.pins.length;n++){const o=c+r.pins[n].time*s,b=r.pins[n].volume,q=r.pins[n].interval,B=o-f;for(let n=0;n<B;n++){const o=f+n,F=h(p,b,n/B),L=h(C,q,n/B)*x-N,A=Math.max(0,Math.min(16383,Math.round(8192*(1+L/24)))),H=Math.min(127,Math.round(t.volumeMultToMidiExpression(t.Synth.expressionToVolumeMult(F))));A!=a&&(w(o),m.writeUint8(224|d),m.writeMidi7Bits(127&A),m.writeMidi7Bits(A>>7&127),a=A),H==g||y||(w(o),k(11,H),g=H);const I=o==c;for(let n=0;n<T;n++){let h=r.pitches[n];if(y){const t=[36,41,45,48,40,39,59,49,46,55,69,54];if((h+=R)<0||h>=t.length)throw new Error("Could not find corresponding drumset pitch. "+h);h=t[h]}else{if(E&&r.pitches.length>n+1&&n==T-1){const a=(o-v)%i,l=t.Config.rhythms[e.rhythm].ticksPerArpeggio*s/t.Config.ticksPerPart,c=Math.floor(a/l);h=r.pitches[n+t.getArpeggioPitchIndex(r.pitches.length-n,e.rhythm,c)]}h=M+h*x+N,null!=l&&void 0!=l.midiSubharmonicOctaves?h+=12*l.midiSubharmonicOctaves:u&&(h+=12*+t.EditorConfig.presetCategories.dictionary["Drum Presets"].presets.dictionary["taiko drum"].midiSubharmonicOctaves),u&&(h*=2)}h=Math.max(0,Math.min(127,h)),S[n]=h,I||P[n]==S[n]||(w(o),m.writeUint8(128|d),m.writeMidi7Bits(P[n]),m.writeMidi7Bits(z))}for(let t=0;t<T;t++)(I||P[t]!=S[t])&&(w(o),m.writeUint8(144|d),m.writeMidi7Bits(S[t]),m.writeMidi7Bits(z),P[t]=S[t])}f=o,p=b,C=q}const B=v+r.end*s;for(let t=0;t<T;t++)w(B),m.writeUint8(128|d),m.writeMidi7Bits(P[t]),m.writeMidi7Bits(z);b=!0}}else b&&(b=!1,g!=t.defaultMidiExpression&&(g=t.defaultMidiExpression,w(v),k(11,g)),a!=t.defaultMidiPitchBend&&(a=t.defaultMidiPitchBend,w(v),m.writeUint8(224|d),m.writeMidi7Bits(127&a),m.writeMidi7Bits(a>>7&127)));v+=r}}w(v),m.writeUint8(255),m.writeMidi7Bits(47),m.writeMidiVariableLength(0),m.rewriteUint32(g,m.getWriteIndex()-g-4)}a(new Blob([m.toCompactArrayBuffer()],{type:"audio/midi"}),this.Fn.value.trim()+".mid"),this.ut()}Wn(){const t=this.ft.song.toJsonObject(this.Ln.checked,Number(this.An.value),this.Hn.checked),e=JSON.stringify(t,null,"\t");a(new Blob([e],{type:"application/json"}),this.Fn.value.trim()+".json"),this.ut()}}l.midiSustainInstruments=[74,71,80,70,70,68,68,81,81,81,81,81,81],l.midiDecayInstruments=[33,46,46,6,6,24,24,25,25,25,25,106,106],t.ExportPrompt=l}(beepbox||(beepbox={})),function(t){class e{constructor(t){this.M=0,this.Nn=t}getReadIndex(){return this.M}readUint32(){if(this.M+4>this.Nn.byteLength)throw new Error("Reading past the end of the buffer.");const t=this.Nn.getUint32(this.M,!1);return this.M+=4,t}readUint24(){return this.readUint8()<<16|this.readUint8()<<8|this.readUint8()}readUint16(){if(this.M+2>this.Nn.byteLength)throw new Error("Reading past the end of the buffer.");const t=this.Nn.getUint16(this.M,!1);return this.M+=2,t}readUint8(){if(this.M+1>this.Nn.byteLength)throw new Error("Reading past the end of the buffer.");const t=this.Nn.getUint8(this.M);return this.M++,t}readInt8(){if(this.M+1>this.Nn.byteLength)throw new Error("Reading past the end of the buffer.");const t=this.Nn.getInt8(this.M);return this.M++,t}peakUint8(){if(this.M+1>this.Nn.byteLength)throw new Error("Reading past the end of the buffer.");return this.Nn.getUint8(this.M)}readMidi7Bits(){const t=this.readUint8();return t>=128&&console.log("7 bit value contained 8th bit! value "+t+", index "+this.M),127&t}readMidiVariableLength(){let t=0;for(let e=0;e<4;e++){const e=this.readUint8();if(t+=127&e,!(128&e))break;t<<=7}return t}skipBytes(t){this.M+=t}hasMore(){return this.Nn.byteLength>this.M}getReaderForNextBytes(t){if(this.M+t>this.Nn.byteLength)throw new Error("Reading past the end of the buffer.");const i=new e(new DataView(this.Nn.buffer,this.Nn.byteOffset+this.M,t));return this.skipBytes(t),i}}t.ArrayBufferReader=e}(beepbox||(beepbox={})),function(t){const{button:e,p:i,div:s,h2:n,input:o}=t.HTML;t.ImportPrompt=class{constructor(r){this.ft=r,this.Vn=o({type:"file",accept:".json,application/json,.mid,.midi,audio/midi,audio/x-midi"}),this.yn=e({className:"cancelButton"}),this.container=s({className:"prompt noSelection",style:"width: 300px;"},n("Import"),i({style:"text-align: left; margin: 0.5em 0;"},"BeepBox songs can be exported and re-imported as .json files. You could also use other means to make .json files for BeepBox as long as they follow the same structure."),i({style:"text-align: left; margin: 0.5em 0;"},"BeepBox can also (crudely) import .mid files. There are many tools available for creating .mid files. Shorter and simpler songs are more likely to work well."),this.Vn,this.yn),this.ut=(()=>{this.ft.undo()}),this.cleanUp=(()=>{this.Vn.removeEventListener("change",this.jn),this.yn.removeEventListener("click",this.ut)}),this.jn=(()=>{const e=this.Vn.files[0];if(!e)return;const i=e.name.slice(2+(e.name.lastIndexOf(".")-1>>>0));if("json"==i){const i=new FileReader;i.addEventListener("load",e=>{this.ft.prompt=null,this.ft.goBackToStart(),this.ft.record(new t.ChangeSong(this.ft,i.result),0,!0)}),i.readAsText(e)}else if("midi"==i||"mid"==i){const t=new FileReader;t.addEventListener("load",e=>{this.ft.prompt=null,this.ft.goBackToStart(),this.Gn(t.result)}),t.readAsArrayBuffer(e)}else console.error("Unrecognized file extension."),this.ut()}),this.Vn.select(),setTimeout(()=>this.Vn.focus()),this.Vn.addEventListener("change",this.jn),this.yn.addEventListener("click",this.ut)}Gn(e){const i=new t.ArrayBufferReader(new DataView(e));let s=null;const n=[];for(;i.hasMore();){const t=i.readUint32(),e=i.readUint32();if(1297377380==t)null==s?s=i.getReaderForNextBytes(e):console.error("This MIDI file has more than one header chunk.");else if(1297379947==t){const t=i.getReaderForNextBytes(e);t.hasMore()&&n.push({reader:t,nextEventMidiTick:t.readMidiVariableLength(),ended:!1,runningStatus:-1})}else i.skipBytes(e)}if(null==s)return console.error("No header chunk found in this MIDI file."),void this.ut();const o=s.readUint16();s.readUint16();const r=s.readUint16();let h=0;const a=[],l=2==o;if(l)a.push(h);else for(let t=0;t<n.length;t++)a.push(t);const c=[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255],f=[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255],d=[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],u=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],m=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],p=[100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100],y=[64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64],g=[[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]],b=[[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]],v=[[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]];let w=5e5,k=8,M=0,x=!1,E=0;for(;;){let e=Number.MAX_VALUE,i=!1;for(const s of a){const o=n[s];for(;!o.ended&&o.nextEventMidiTick==E;){const s=128&o.reader.peakUint8()?o.reader.readUint8():o.runningStatus,r=240&s,q=15&s;240!=r&&(o.runningStatus=s);let C=!1;switch(r){case 128:{const t=o.reader.readMidi7Bits();o.reader.readMidi7Bits(),g[q].push({midiTick:E,pitch:t,velocity:0,program:-1,instrumentVolume:-1,instrumentPan:-1,on:!1})}break;case 144:{const e=o.reader.readMidi7Bits(),i=o.reader.readMidi7Bits();if(0==i)g[q].push({midiTick:E,pitch:e,velocity:0,program:-1,instrumentVolume:-1,instrumentPan:-1,on:!1});else{const s=Math.max(0,Math.min(t.Config.volumeRange-1,Math.round(t.Synth.volumeMultToInstrumentVolume(t.midiVolumeToVolumeMult(p[q]))))),n=Math.max(0,Math.min(t.Config.panMax,Math.round(((y[q]-64)/63+1)*t.Config.panCenter)));g[q].push({midiTick:E,pitch:e,velocity:Math.max(0,Math.min(1,(i+14)/90)),program:m[q],instrumentVolume:s,instrumentPan:n,on:!0})}}break;case 160:o.reader.readMidi7Bits(),o.reader.readMidi7Bits();break;case 176:{const e=o.reader.readMidi7Bits(),i=o.reader.readMidi7Bits();switch(e){case 6:0==c[q]&&0==f[q]&&(d[q]=i);break;case 7:p[q]=i;break;case 10:y[q]=i;break;case 11:v[q].push({midiTick:E,volume:t.Synth.volumeMultToExpression(t.midiExpressionToVolumeMult(i))});break;case 38:0==c[q]&&0==f[q]&&(u[q]=i);break;case 100:f[q]=i;break;case 101:c[q]=i}}break;case 192:{const t=o.reader.readMidi7Bits();m[q]=t}break;case 208:o.reader.readMidi7Bits();break;case 224:{const t=o.reader.readMidi7Bits(),e=((o.reader.readMidi7Bits()<<7|t)/8192-1)*(d[q]+.01*u[q]);b[q].push({midiTick:E,interval:e})}break;case 240:if(255==s){const e=o.reader.readMidi7Bits(),i=o.reader.readMidiVariableLength();if(47==e)C=!0,o.reader.skipBytes(i);else if(81==e)w=o.reader.readUint24(),o.reader.skipBytes(i-3);else if(88==e){const e=o.reader.readUint8();let s=o.reader.readUint8();for(o.reader.readUint8(),o.reader.readUint8(),o.reader.skipBytes(i-4),k=4*e;0==(1&k)&&(s>0||k>t.Config.beatsPerBarMax)&&k>=2*t.Config.beatsPerBarMin;)k>>=1,s-=1;k=Math.max(t.Config.beatsPerBarMin,Math.min(t.Config.beatsPerBarMax,k))}else 89==e?(M=o.reader.readInt8(),x=1==o.reader.readUint8(),o.reader.skipBytes(i-2)):o.reader.skipBytes(i)}else{if(240!=s&&247!=s)return console.error("Unrecognized event status: "+s),void this.ut();{const t=o.reader.readMidiVariableLength();o.reader.skipBytes(t)}}break;default:return console.error("Unrecognized event type: "+r),void this.ut()}!C&&o.reader.hasMore()?o.nextEventMidiTick=E+o.reader.readMidiVariableLength():(o.ended=!0,l&&++h<n.length&&(a[0]=h,n[h].nextEventMidiTick+=E,e=Math.min(e,n[h].nextEventMidiTick),i=!0))}o.ended||(i=!0,e=Math.min(e,o.nextEventMidiTick))}if(!i)break;E=e}const q=Math.max(t.Config.tempoMin,Math.min(t.Config.tempoMax,Math.round(6e7/w))),C=r/t.Config.partsPerBeat,P=t.Config.partsPerBeat*k,S=Math.ceil(E/C/P);function T(t){return Math.round(t/C)}let z=M;for(x&&(z+=3),1==(1&z)&&(z+=6);z<0;)z+=12;z%=12;const R=[],N=[];for(let e=0;e<16;e++){if(0==g[e].length)continue;const i=new t.Channel,s=t.EditorConfig.midiProgramToPresetValue(g[e][0].program),n=null==s?null:t.EditorConfig.valueToPreset(s),o=9==e,h=o||null!=n&&1==n.isNoise,a=h?t.Config.spectrumBasePitch:t.Config.keys[z].basePitch,l=h?t.Config.noiseInterval:1,c=h?.5:1,f=h?t.Config.drumCount-1:t.Config.maxPitch;h?o?N.unshift(i):N.push(i):R.push(i);let d=1,u=0,m=0,p=t.Config.panCenter;if(o){const s=[];let n=-1,o=null,r=0,h=!1;const a=t.EditorConfig.nameToPresetValue("standard drumset"),l=t.EditorConfig.valueToPreset(a),c=new t.Instrument(!1);c.fromJsonObject(l.settings,!1),c.preset=a,i.instruments.push(c);for(let a=0;a<=g[e].length;a++){const l=a==g[e].length?null:g[e][a],u=null==l?Number.MAX_SAFE_INTEGER:T(l.midiTick);if(s.length>0&&u>r&&(null==l||l.on)){const e=Math.floor(r/P),a=e*P;if(n!=e||null==o){for(n++;n<e;)i.bars[n]=0,n++;o=new t.Pattern,i.patterns.push(o),i.bars[n]=i.patterns.length,o.instrument=0}(!h||c.volume>m)&&(c.volume=m,c.pan=p,h=!0);const l=[];let y=f,g=0,b=1;for(const e of s){const i=t.analogousDrumMap[e];-1==l.indexOf(i.frequency)&&l.push(i.frequency),b=Math.max(b,Math.round(i.volume*d)),y=Math.min(y,i.duration),g=Math.max(g,i.duration)}const v=Math.min(g,Math.max(y,2)),w=r-a,k=Math.min(P,Math.min(u-a,w+6*v)),M=new t.Note(-1,w,k,b,!0);M.pitches.length=0;for(let e=0;e<Math.min(t.Config.maxChordSize,l.length);e++){const i=l[e+Math.max(0,l.length-t.Config.maxChordSize)];-1==M.pitches.indexOf(i)&&M.pitches.push(i)}o.notes.push(M),s.length=0}null!=l&&l.on&&void 0!=t.analogousDrumMap[l.pitch]&&(s.push(l.pitch),r=u,d=l.velocity,m=l.instrumentVolume,p=l.instrumentPan)}}else{let s=0,n=3,o=0,y=0;function B(t){for(;o<b[e].length&&b[e][o].midiTick<=t;)s=b[e][o].interval,o++}function F(t){for(;y<v[e].length&&v[e][y].midiTick<=t;)n=v[e][y].volume,y++}const w=[],M=[];let x=-1,E=null,q=0,S=0,z=0,R=0;for(let o of g[e]){const e=o.midiTick,y=T(e);if(M.length>0&&y>S){const o=Math.floor(S/P),g=Math.ceil(y/P);for(let b=o;b<g;b++){const o=b*P,g=b*k*r,v=(b+1)*k*r,T=Math.max(0,S-o),N=Math.min(P,y-o),L=Math.max(g,q),A=Math.min(v,e);if(T<N){const e=t.EditorConfig.midiProgramToPresetValue(u),r=null==e?null:t.EditorConfig.valueToPreset(e);if(x!=b||null==E){for(x++;x<b;)i.bars[x]=0,x++;if(E=new t.Pattern,i.patterns.push(E),i.bars[x]=i.patterns.length,void 0==w[u]){const s=new t.Instrument(h);w[u]=s,null!=e&&null!=r&&1==r.isNoise==h?(s.fromJsonObject(r.settings,h),s.preset=e):(s.setTypeAndReset(h?2:0,h),s.chord=0),s.volume=m,s.pan=p,i.instruments.push(s)}E.instrument=i.instruments.indexOf(w[u])}void 0!=w[u]&&(w[u].volume=Math.min(w[u].volume,m),w[u].pan=Math.min(w[u].pan,p));const y=new t.Note(-1,T,N,3,!1);y.pins.length=0,B(L),F(L);const g=M[0]*c-a,v=Math.round((g+s)/l),k=Math.round(s-a);let q=t.makeNotePin(0,0,Math.round(d*n));y.pins.push(q);const P=[{part:0,pitch:v,volume:q.volume,keyPitch:!1,keyVolume:!1}];let S=0,H=(g+s)/l,I=d*n;for(let e=T+1;e<=N;e++){const i=Math.max(L,Math.min(A-1,Math.round(C*(e+o)))),r=e-T,h=e==N;B(i),F(i);const a=(s+g)/l,c=d*n,f=Math.round(a),u=Math.abs(a-f)<.01,m=Math.abs(H-Math.round(H))<.01?Math.abs(a-H)>=1:Math.floor(a)!=Math.floor(H),p=u||m,b=Math.round(c),w=Math.abs(c-b)<.01,k=Math.abs(I-Math.round(I))?Math.abs(c-I)>=1:Math.floor(c)!=Math.floor(I),M=w||k;if(H=a,I=c,p||M||h){const e={part:r,pitch:f,volume:b,keyPitch:p||h,keyVolume:M||h},i=P[S];let s=!1,n=Number.MAX_VALUE;if(e.keyPitch){const t=(e.pitch-i.pitch)/(e.part-i.part);let o=Math.abs(t),r=!1,h=Number.MAX_VALUE;for(let e=S+1;e<P.length;e++){const s=P[e];if(s.keyPitch){const n=i.pitch+t*(s.part-i.part),a=Math.abs(n-s.pitch);o<a&&(o=a,r=!0,h=e)}}r&&(s=!0,n=Math.min(n,h))}if(e.keyVolume){const t=(e.volume-i.volume)/(e.part-i.part);let o=Math.abs(t),r=!1,h=Number.MAX_VALUE;for(let e=S+1;e<P.length;e++){const s=P[e];if(s.keyVolume){const n=i.volume+t*(s.part-i.part),a=Math.abs(n-s.volume);o<a&&(o=a,r=!0,h=e)}}r&&(s=!0,n=Math.min(n,h))}if(s){const e=P[n];y.pins.push(t.makeNotePin(e.pitch-v,e.part,e.volume)),S=n}P.push(e)}}const O=P[P.length-1];y.pins.push(t.makeNotePin(O.pitch-v,O.part,O.volume));let $=f,U=0;for(const t of y.pins)$=Math.min($,f-t.interval),U=Math.min(U,-t.interval);y.pitches.length=0;for(let e=0;e<Math.min(t.Config.maxChordSize,M.length);e++){let i=M[e+Math.max(0,M.length-t.Config.maxChordSize)]*c;null!=r&&void 0!=r.midiSubharmonicOctaves&&(i-=12*r.midiSubharmonicOctaves);const s=Math.max(U,Math.min($,Math.round((i+k)/l)));if(-1==y.pitches.indexOf(s)){y.pitches.push(s);const t=y.end-y.start;z+=s*t,R+=t}}E.notes.push(y)}}}-1!=M.indexOf(o.pitch)&&M.splice(M.indexOf(o.pitch),1),o.on&&(M.push(o.pitch),d=o.velocity,u=o.program,m=o.instrumentVolume,p=o.instrumentPan),q=e,S=y}const N=z/R;i.octave=h?0:Math.max(0,Math.min(t.Config.scrollableOctaves,Math.round(N/12-1.5)))}for(;i.bars.length<S;)i.bars.push(0)}function L(t,e){for(;t.length>e;){let e=t.length-2,i=t.length-1,s=Number.MAX_VALUE,n=Number.MAX_VALUE;for(let o=0;o<t.length-1;o++)for(let r=o+1;r<t.length;r++){const h=t[o],a=t[r];let l=0,c=0;for(let t=0;t<h.bars.length&&t<a.bars.length;t++)0!=h.bars[t]&&0!=a.bars[t]&&l++,0==h.bars[t]&&0==a.bars[t]&&c++;l<=s&&(l<s||c<n)&&(e=o,i=r,s=l,n=c)}const o=t[e],r=t[i],h=o.instruments.length,a=o.patterns.length;for(const t of r.instruments)o.instruments.push(t);for(const t of r.patterns)t.instrument+=h,o.patterns.push(t);for(let t=0;t<o.bars.length&&t<r.bars.length;t++)0==o.bars[t]&&0!=r.bars[t]&&(o.bars[t]=r.bars[t]+a);t.splice(i,1)}}L(R,t.Config.pitchChannelCountMax),L(N,t.Config.noiseChannelCountMax),this.ft.goBackToStart();for(const t of this.ft.song.channels)t.muted=!1;this.ft.prompt=null,this.ft.record(new class extends t.ChangeGroup{constructor(e){super();const i=e.song;i.tempo=q,i.beatsPerBar=k,i.key=z,i.scale=11,i.reverb=1,i.rhythm=1,t.removeDuplicatePatterns(R),t.removeDuplicatePatterns(N),this.append(new t.ChangeReplacePatterns(e,R,N)),i.loopStart=0,i.loopLength=i.barCount,this.yt(),e.notifier.changed()}}(this.ft),0,!0)}}}(beepbox||(beepbox={})),function(t){const{button:e,div:i,h2:s,p:n,select:o,option:r,iframe:h}=t.HTML;t.SongRecoveryPrompt=class{constructor(a){this.ft=a,this.Kn=i(),this.yn=e({className:"cancelButton"}),this.container=i({className:"prompt",style:"width: 300px;"},s("Song Recovery"),i({style:"max-height: 385px; overflow-y: auto;"},n("This is a TEMPORARY list of songs you have recently modified. Please keep your own backups of songs you care about!"),this.Kn,n('(If "Display Song Data in URL" is enabled in your preferences, then you may also be able to find song versions in your browser history. However, song recovery won\'t work if you were browsing in private/incognito mode.)')),this.yn),this.ut=(()=>{this.ft.undo()}),this.cleanUp=(()=>{this.yn.removeEventListener("click",this.ut)}),this.yn.addEventListener("click",this.ut);const l=t.SongRecovery.getAllRecoveredSongs();0==l.length&&this.Kn.appendChild(n("There are no recovered songs available yet. Try making a song!"));for(const e of l){const s=o({style:"width: 100%;"});for(const t of e.versions)s.appendChild(r({value:t.time},new Date(t.time).toLocaleString()));const n=h({style:"width: 100%; height: 60px; border: none; display: block;"});n.src="player/#song="+window.localStorage.getItem(t.versionToKey(e.versions[0]));const a=i({style:"margin: 4px 0;"},i({className:"selectContainer",style:"width: 100%; margin: 2px 0;"},s),n);this.Kn.appendChild(a),s.addEventListener("change",()=>{const i=e.versions[s.selectedIndex];n.contentWindow.location.replace("player/#song="+window.localStorage.getItem(t.versionToKey(i))),n.contentWindow.dispatchEvent(new Event("hashchange"))})}}}}(beepbox||(beepbox={})),function(t){const{button:e,div:i,input:s,select:n,span:o,optgroup:r,option:h}=t.HTML;function a(t,e){for(let i=0;i<e.length;i++)t.appendChild(h({value:i},e[i]));return t}function l(e){const i=n();i.appendChild(r({label:"Edit"},h({value:"copyInstrument"},"Copy Instrument"),h({value:"pasteInstrument"},"Paste Instrument"),h({value:"randomPreset"},"Random Preset"),h({value:"randomGenerated"},"Random Generated")));const s=r({label:t.EditorConfig.presetCategories[0].name});e?(s.appendChild(h({value:2},t.EditorConfig.valueToPreset(2).name)),s.appendChild(h({value:3},t.EditorConfig.valueToPreset(3).name)),s.appendChild(h({value:4},t.EditorConfig.valueToPreset(4).name))):(s.appendChild(h({value:0},t.EditorConfig.valueToPreset(0).name)),s.appendChild(h({value:6},t.EditorConfig.valueToPreset(6).name)),s.appendChild(h({value:5},t.EditorConfig.valueToPreset(5).name)),s.appendChild(h({value:3},t.EditorConfig.valueToPreset(3).name)),s.appendChild(h({value:1},t.EditorConfig.valueToPreset(1).name))),i.appendChild(s);for(let s=1;s<t.EditorConfig.presetCategories.length;s++){const n=t.EditorConfig.presetCategories[s],o=r({label:n.name});let a=!1;for(let t=0;t<n.presets.length;t++){const i=n.presets[t];1==i.isNoise==e&&(o.appendChild(h({value:(s<<6)+t},i.name)),a=!0)}a&&i.appendChild(o)}return i}function c(t,e){const i=e.toString();t.value!=i&&(t.value=i)}class f{constructor(t,e,i){this.input=t,this.ft=e,this.Jn=i,this.us=null,this.Yn=0,this.Zn=0,this.Qn=(()=>{this.ft.lastChangeWas(this.us)||(this.Zn=this.Yn),this.us=this.Jn(this.Zn,parseInt(this.input.value)),this.ft.setProspectiveChange(this.us)}),this.Xn=(()=>{this.ft.record(this.us),this.us=null}),t.addEventListener("input",this.Qn),t.addEventListener("change",this.Xn)}updateValue(t){this.Yn=t,this.input.value=String(t)}}t.SongEditor=class{constructor(d){this.ft=d,this.prompt=null,this.to=new t.PatternEditor(this.ft,!1,-1),this.eo=new t.PatternEditor(this.ft,!0,0),this.io=new t.PatternEditor(this.ft,!1,1),this.so=new t.MuteEditor(this.ft),this.no=new t.TrackEditor(this.ft),this.oo=new t.LoopEditor(this.ft),this.ro=new t.OctaveScrollBar(this.ft),this.ho=new t.Piano(this.ft),this.ao=e({style:"width: 80px;",type:"button"}),this.lo=e({class:"prevBarButton",style:"width: 40px;",type:"button",title:"Previous Bar (left bracket)"}),this.co=e({class:"nextBarButton",style:"width: 40px;",type:"button",title:"Next Bar (right bracket)"}),this.fo=s({title:"main volume",style:"width: 5em; flex-grow: 1; margin: 0;",type:"range",min:"0",max:"75",value:"50",step:"1"}),this.do=n({style:"width: 100%;"},h({selected:!0,disabled:!0,hidden:!1},"File"),h({value:"new"},"+ New Blank Song"),h({value:"import"},"↑ Import Song..."),h({value:"export"},"↓ Export Song..."),h({value:"copyUrl"},"⎘ Copy Song URL"),h({value:"shareUrl"},"⤳ Share Song URL"),h({value:"viewPlayer"},"▶ View in Song Player"),h({value:"copyEmbed"},"⎘ Copy HTML Embed Code"),h({value:"songRecovery"},"⚠ Recover Recent Song...")),this.uo=n({style:"width: 100%;"},h({selected:!0,disabled:!0,hidden:!1},"Edit"),h({value:"undo"},"Undo (Z)"),h({value:"redo"},"Redo (Y)"),h({value:"copy"},"Copy Pattern (C)"),h({value:"pasteNotes"},"Paste Pattern Notes (V)"),h({value:"pasteNumbers"},"Paste Pattern Numbers (⇧V)"),h({value:"insertBars"},"Insert Bar After Selection (⏎)"),h({value:"deleteBars"},"Delete Selected Bar (⌫)"),h({value:"selectAll"},"Select All (A)"),h({value:"selectChannel"},"Select Channel (⇧A)"),h({value:"duplicatePatterns"},"Duplicate Reused Patterns (D)"),h({value:"transposeUp"},"Move Notes Up (+)"),h({value:"transposeDown"},"Move Notes Down (-)"),h({value:"moveNotesSideways"},"Move All Notes Sideways..."),h({value:"beatsPerBar"},"Change Beats Per Bar..."),h({value:"barCount"},"Change Song Length..."),h({value:"channelSettings"},"Channel Settings...")),this.mo=n({style:"width: 100%;"},h({selected:!0,disabled:!0,hidden:!1},"Preferences"),h({value:"autoPlay"},"Auto Play On Load"),h({value:"autoFollow"},"Auto Follow Track"),h({value:"enableNotePreview"},"Preview Added Notes"),h({value:"showLetters"},"Show Piano Keys"),h({value:"showFifth"},'Highlight "Fifth" Notes'),h({value:"showChannels"},"Show All Channels"),h({value:"showScrollBar"},"Octave Scroll Bar"),h({value:"alwaysShowSettings"},"Customize All Instruments"),h({value:"enableChannelMuting"},"Enable Channel Muting"),h({value:"displayBrowserUrl"},"Display Song Data in URL"),h({value:"fullScreen"},"Full-Screen Layout"),h({value:"colorTheme"},"Light Theme")),this.po=a(n(),t.Config.scales.map(t=>t.name)),this.yo=a(n(),t.Config.keys.map(t=>t.name).reverse()),this.bo=new f(s({style:"margin: 0; width: 4em; flex-grow: 1; vertical-align: middle;",type:"range",min:"0",max:"14",value:"7",step:"1"}),this.ft,(e,i)=>new t.ChangeTempo(this.ft,e,Math.round(120*Math.pow(2,(-4+i)/9)))),this.vo=s({style:"width: 3em; margin-left: 0.4em; vertical-align: middle;",type:"number",step:"1"}),this.wo=new f(s({style:"margin: 0;",type:"range",min:"0",max:t.Config.reverbRange-1,value:"0",step:"1"}),this.ft,(e,i)=>new t.ChangeReverb(this.ft,e,i)),this.ko=a(n(),t.Config.rhythms.map(t=>t.name)),this.Mo=l(!1),this.xo=l(!0),this.Eo=a(n(),t.Config.algorithms.map(t=>t.name)),this.qo=i({class:"selectRow"},o({class:"tip",onclick:()=>this.Co("algorithm")},"Algorithm: "),i({class:"selectContainer"},this.Eo)),this.Po=n(),this.So=i({class:"selectRow",style:"display: none;"},o({class:"tip",onclick:()=>this.Co("instrumentIndex")},"Instrument: "),i({class:"selectContainer"},this.Po)),this.To=new f(s({style:"margin: 0;",type:"range",min:-(t.Config.volumeRange-1),max:"0",value:"0",step:"1"}),this.ft,(e,i)=>new t.ChangeVolume(this.ft,e,-i)),this.zo=i({class:"selectRow"},o({class:"tip",onclick:()=>this.Co("instrumentVolume")},"Volume: "),this.To.input),this.Ro=new f(s({style:"margin: 0;",type:"range",min:"0",max:t.Config.panMax,value:t.Config.panCenter,step:"1"}),this.ft,(e,i)=>new t.ChangePan(this.ft,e,i)),this.No=i({class:"selectRow"},o({class:"tip",onclick:()=>this.Co("pan")},"Panning: "),this.Ro.input),this.Bo=a(n(),t.Config.chipWaves.map(t=>t.name)),this.Fo=a(n(),t.Config.chipNoises.map(t=>t.name)),this.Lo=i({class:"selectRow"},o({class:"tip",onclick:()=>this.Co("chipWave")},"Wave: "),i({class:"selectContainer"},this.Bo)),this.Ao=i({class:"selectRow"},o({class:"tip",onclick:()=>this.Co("chipNoise")},"Noise: "),i({class:"selectContainer"},this.Fo)),this.Ho=a(n(),t.Config.transitions.map(t=>t.name)),this.Io=i({class:"selectRow"},o({class:"tip",onclick:()=>this.Co("transition")},"Transition:"),i({class:"selectContainer"},this.Ho)),this.Oo=a(n(),t.Config.effectsNames),this.$o=new f(s({style:"margin: 0;",type:"range",min:"0",max:t.Config.filterCutoffRange-1,value:"6",step:"1"}),this.ft,(e,i)=>new t.ChangeFilterCutoff(this.ft,e,i)),this.Uo=i({class:"selectRow",title:"Low-pass Filter Cutoff Frequency"},o({class:"tip",onclick:()=>this.Co("filterCutoff")},"Filter Cut:"),this.$o.input),this._o=new f(s({style:"margin: 0;",type:"range",min:"0",max:t.Config.filterResonanceRange-1,value:"6",step:"1"}),this.ft,(e,i)=>new t.ChangeFilterResonance(this.ft,e,i)),this.Do=i({class:"selectRow",title:"Low-pass Filter Peak Resonance"},o({class:"tip",onclick:()=>this.Co("filterResonance")},"Filter Peak:"),this._o.input),this.Wo=a(n(),t.Config.envelopes.map(t=>t.name)),this.Vo=i({class:"selectRow",title:"Low-pass Filter Envelope"},o({class:"tip",onclick:()=>this.Co("filterEnvelope")},"Filter Env:"),i({class:"selectContainer"},this.Wo)),this.jo=a(n(),t.Config.envelopes.map(t=>t.name)),this.Go=i({class:"selectRow",title:"Pulse Width Modulator Envelope"},o({class:"tip",onclick:()=>this.Co("pulseEnvelope")},"Pulse Env:"),i({class:"selectContainer"},this.jo)),this.Ko=new f(s({style:"margin: 0;",type:"range",min:"0",max:t.Config.pulseWidthRange-1,value:"0",step:"1"}),this.ft,(e,i)=>new t.ChangePulseWidth(this.ft,e,i)),this.Jo=i({class:"selectRow"},o({class:"tip",onclick:()=>this.Co("pulseWidth")},"Pulse Width:"),this.Ko.input),this.Yo=a(n(),t.Config.intervals.map(t=>t.name)),this.Zo=i({class:"selectRow"},o({class:"tip",onclick:()=>this.Co("interval")},"Interval:"),i({class:"selectContainer"},this.Yo)),this.Qo=a(n(),t.Config.chords.map(t=>t.name)),this.Xo=i({class:"selectRow"},o({class:"tip",onclick:()=>this.Co("chords")},"Chords:"),i({class:"selectContainer"},this.Qo)),this.tr=a(n(),t.Config.vibratos.map(t=>t.name)),this.er=i({class:"selectRow"},o({class:"tip",onclick:()=>this.Co("vibrato")},"Vibrato:"),i({class:"selectContainer"},this.tr)),this.ir=i({class:"editor-controls"}),this.sr=a(n(),t.Config.feedbacks.map(t=>t.name)),this.nr=i({class:"selectRow"},o({class:"tip",onclick:()=>this.Co("feedbackType")},"Feedback:"),i({class:"selectContainer"},this.sr)),this.or=new t.SpectrumEditor(this.ft,null),this.rr=i({class:"selectRow"},o({class:"tip",onclick:()=>this.Co("spectrum")},"Spectrum:"),this.or.container),this.hr=new t.HarmonicsEditor(this.ft),this.ar=i({class:"selectRow"},o({class:"tip",onclick:()=>this.Co("harmonics")},"Harmonics:"),this.hr.container),this.lr=i({class:"editor-controls"}),this.cr=new f(s({style:"margin: 0; width: 4em;",type:"range",min:"0",max:t.Config.operatorAmplitudeMax,value:"0",step:"1",title:"Feedback Amplitude"}),this.ft,(e,i)=>new t.ChangeFeedbackAmplitude(this.ft,e,i)),this.dr=a(n({style:"width: 100%;",title:"Feedback Envelope"}),t.Config.envelopes.map(t=>t.name)),this.ur=i({class:"operatorRow"},i({style:"margin-right: .1em; visibility: hidden;"},"1."),i({style:"width: 3em; margin-right: .3em;"}),this.cr.input,i({class:"selectContainer",style:"width: 5em; margin-left: .3em;"},this.dr)),this.mr=e({type:"button",class:"customize-instrument"},"Customize Instrument"),this.pr=i({class:"editor-controls"},this.Uo,this.Do,this.Vo,this.Io,i({class:"selectRow"},o({class:"tip",onclick:()=>this.Co("effects")},"Effects:"),i({class:"selectContainer"},this.Oo)),this.Xo,this.er,this.Zo,this.Lo,this.Ao,this.qo,this.ir,this.nr,this.ur,this.rr,this.ar,this.lr,this.Go,this.Jo),this.yr=i({class:"editor-controls"},i({style:`margin: 3px 0; text-align: center; color: ${t.ColorConfig.secondaryText};`},"Instrument Settings"),this.So,this.zo,this.No,i({class:"selectRow"},o({class:"tip",onclick:()=>this.Co("instrumentType")},"Type: "),i({class:"selectContainer"},this.Mo,this.xo)),this.mr,this.pr),this.gr=i({class:"promptContainer",style:"display: none;"}),this.vr=i({style:"flex: 1; height: 100%; display: flex; overflow: hidden; justify-content: center;"},this.to.container,this.eo.container,this.io.container),this.wr=i({class:"pattern-area"},this.ho.container,this.vr,this.ro.container),this.Hs=i({class:"trackContainer"},this.no.container,this.oo.container),this.kr=i({class:"trackAndMuteContainer"},this.so.container,this.Hs),this.Mr=new t.BarScrollBar(this.ft,this.Hs),this.xr=i({class:"track-area"},this.kr,this.Mr.container),this.Er=i({class:"settings-area noSelection"},i({class:"version-area"},i({style:`text-align: center; margin: 3px 0; color: ${t.ColorConfig.secondaryText};`},t.EditorConfig.versionDisplayName)),i({class:"play-pause-area"},i({class:"playback-bar-controls"},this.ao,this.lo,this.co),i({class:"playback-volume-controls"},o({class:"volume-speaker"}),this.fo)),i({class:"menu-area"},i({class:"selectContainer menu file"},this.do),i({class:"selectContainer menu edit"},this.uo),i({class:"selectContainer menu preferences"},this.mo)),i({class:"song-settings-area"},i({class:"editor-controls"},i({style:`margin: 3px 0; text-align: center; color: ${t.ColorConfig.secondaryText};`},"Song Settings"),i({class:"selectRow"},o({class:"tip",onclick:()=>this.Co("scale")},"Scale: "),i({class:"selectContainer"},this.po)),i({class:"selectRow"},o({class:"tip",onclick:()=>this.Co("key")},"Key: "),i({class:"selectContainer"},this.yo)),i({class:"selectRow"},o({class:"tip",onclick:()=>this.Co("tempo")},"Tempo: "),o({style:"display: flex;"},this.bo.input,this.vo)),i({class:"selectRow"},o({class:"tip",onclick:()=>this.Co("reverb")},"Reverb: "),this.wo.input),i({class:"selectRow"},o({class:"tip",onclick:()=>this.Co("rhythm")},"Rhythm: "),i({class:"selectContainer"},this.ko)))),i({class:"instrument-settings-area"},this.yr)),this.mainLayer=i({class:"beepboxEditor",tabIndex:"0"},this.wr,this.xr,this.Er,this.gr),this.qr=!1,this.Cr=null,this.Pr=[],this.Sr=[],this.Tr=[],this.zr=[],this.Rr=[],this.Nr=[],this.Br=(()=>{this.mainLayer.focus({preventScroll:!0})}),this.whenUpdated=(()=>{this.so.container.style.display=this.ft.enableChannelMuting?"":"none";const e=this.Hs.getBoundingClientRect();if(this.ft.trackVisibleBars=Math.floor((e.right-e.left)/this.ft.getBarWidth()),this.Mr.render(),this.so.render(),this.no.render(),this.ho.container.style.display=this.ft.showLetters?"":"none",this.ro.container.style.display=this.ft.showScrollBar?"":"none",this.Mr.container.style.display=this.ft.song.barCount>this.ft.trackVisibleBars?"":"none",this.ft.getFullScreen()){const e=this.vr.clientHeight/t.Config.windowPitchCount*5,i=this.vr.clientWidth/(3*this.ft.song.beatsPerBar),s=this.vr.clientWidth/(this.ft.song.beatsPerBar+2),n=Math.max(i,Math.min(s,e))*this.ft.song.beatsPerBar;this.to.container.style.width=n+"px",this.eo.container.style.width=n+"px",this.io.container.style.width=n+"px",this.to.container.style.flexShrink="0",this.eo.container.style.flexShrink="0",this.io.container.style.flexShrink="0",this.to.container.style.display="",this.io.container.style.display="",this.to.render(),this.io.render()}else this.eo.container.style.width="",this.eo.container.style.flexShrink="",this.to.container.style.display="none",this.io.container.style.display="none";this.eo.render();const i=[(this.ft.autoPlay?"✓ ":"")+"Auto Play On Load",(this.ft.autoFollow?"✓ ":"")+"Auto Follow Track",(this.ft.enableNotePreview?"✓ ":"")+"Preview Added Notes",(this.ft.showLetters?"✓ ":"")+"Show Piano Keys",(this.ft.showFifth?"✓ ":"")+'Highlight "Fifth" Notes',(this.ft.showChannels?"✓ ":"")+"Show All Channels",(this.ft.showScrollBar?"✓ ":"")+"Octave Scroll Bar",(this.ft.alwaysShowSettings?"✓ ":"")+"Customize All Instruments",(this.ft.enableChannelMuting?"✓ ":"")+"Enable Channel Muting",(this.ft.displayBrowserUrl?"✓ ":"")+"Display Song Data in URL",(this.ft.fullScreen?"✓ ":"")+"Full-Screen Layout",("light classic"==this.ft.colorTheme?"✓ ":"")+"Light Theme"];for(let t=0;t<i.length;t++){const e=this.mo.children[t+1];e.innerText!=i[t]&&(e.innerText=i[t])}const s=this.ft.song.channels[this.ft.channel],n=this.ft.getCurrentPattern(),o=this.ft.getCurrentInstrument(),r=s.instruments[o],h=this.mainLayer.contains(document.activeElement),l=document.activeElement;if(c(this.po,this.ft.song.scale),this.po.title=t.Config.scales[this.ft.song.scale].realName,c(this.yo,t.Config.keys.length-1-this.ft.song.key),this.bo.updateValue(Math.max(0,Math.min(28,Math.round(4+9*Math.log(this.ft.song.tempo/120)/Math.LN2)))),this.vo.value=this.ft.song.tempo.toString(),this.wo.updateValue(this.ft.song.reverb),c(this.ko,this.ft.song.rhythm),this.ft.song.getChannelIsNoise(this.ft.channel)?(this.Mo.style.display="none",this.xo.style.display="",c(this.xo,r.preset)):(this.Mo.style.display="",this.xo.style.display="none",c(this.Mo,r.preset)),this.ft.alwaysShowSettings||r.preset==r.type){if(this.mr.style.display="none",this.pr.style.display="",2==r.type?(this.Ao.style.display="",c(this.Fo,r.chipNoise)):this.Ao.style.display="none",3==r.type?(this.rr.style.display="",this.or.render()):this.rr.style.display="none",5==r.type?(this.ar.style.display="",this.hr.render()):this.ar.style.display="none",4==r.type){this.lr.style.display="",this.Io.style.display="none",this.Xo.style.display="none",this.Uo.style.display="none",this.Do.style.display="none",this.Vo.style.display="none";for(let e=0;e<t.Config.drumCount;e++)c(this.Nr[e],r.drumsetEnvelopes[e]),this.Rr[e].render()}else this.lr.style.display="none",this.Io.style.display="",this.Xo.style.display="",this.Uo.style.display="",this.Do.style.display="",this.Vo.style.display="";if(0==r.type?(this.Lo.style.display="",c(this.Bo,r.chipWave)):this.Lo.style.display="none",1==r.type){this.qo.style.display="",this.ir.style.display="",this.nr.style.display="",this.ur.style.display="",c(this.Eo,r.algorithm),c(this.sr,r.feedbackType),this.cr.updateValue(r.feedbackAmplitude),c(this.dr,r.feedbackEnvelope),this.dr.parentElement.style.color=r.feedbackAmplitude>0?"":t.ColorConfig.secondaryText;for(let e=0;e<t.Config.operatorCount;e++){const i=e<t.Config.algorithms[r.algorithm].carrierCount;this.Pr[e].style.color=i?t.ColorConfig.primaryText:"",c(this.zr[e],r.operators[e].frequency),this.Sr[e].updateValue(r.operators[e].amplitude),c(this.Tr[e],r.operators[e].envelope);const s=(i?"Voice ":"Modulator ")+(e+1);this.zr[e].title=s+" Frequency",this.Sr[e].input.title=s+(i?" Volume":" Amplitude"),this.Tr[e].title=s+" Envelope",this.Tr[e].parentElement.style.color=r.operators[e].amplitude>0?"":t.ColorConfig.secondaryText}}else this.qo.style.display="none",this.ir.style.display="none",this.nr.style.display="none",this.ur.style.display="none";if(6==r.type?(this.Go.style.display="",this.Jo.style.display="",this.Ko.input.title=t.prettyNumber(50*Math.pow(.5,.5*(t.Config.pulseWidthRange-r.pulseWidth-1)))+"%",c(this.jo,r.pulseEnvelope),this.Ko.updateValue(r.pulseWidth)):(this.Go.style.display="none",this.Jo.style.display="none"),2==r.type)this.er.style.display="none",this.Zo.style.display="none";else if(3==r.type)this.er.style.display="none",this.Zo.style.display="none";else if(4==r.type)this.er.style.display="none",this.Zo.style.display="none";else if(0==r.type)this.er.style.display="",this.Zo.style.display="";else if(1==r.type)this.er.style.display="",this.Zo.style.display="none";else if(5==r.type)this.er.style.display="",this.Zo.style.display="";else{if(6!=r.type)throw new Error("Unrecognized instrument type: "+r.type);this.er.style.display="",this.Zo.style.display="none"}}else this.mr.style.display="",this.pr.style.display="none";for(let e=0;e<t.Config.chords.length;e++){const i=!t.Config.instrumentTypeHasSpecialInterval[r.type]&&t.Config.chords[e].isCustomInterval,s=this.Qo.children[e];i?s.hasAttribute("hidden")||s.setAttribute("hidden",""):s.removeAttribute("hidden")}if(this.So.style.display=this.ft.song.instrumentsPerChannel>1?"":"none",this.So.style.visibility=null==n?"hidden":"",this.Po.children.length!=this.ft.song.instrumentsPerChannel){for(;this.Po.firstChild;)this.Po.removeChild(this.Po.firstChild);const t=[];for(let e=0;e<this.ft.song.instrumentsPerChannel;e++)t.push(e+1);a(this.Po,t)}this.yr.style.color=t.ColorConfig.getChannelColor(this.ft.song,this.ft.channel).primaryNote,this.$o.updateValue(r.filterCutoff),this._o.updateValue(r.filterResonance),c(this.Wo,r.filterEnvelope),c(this.Ho,r.transition),c(this.Oo,r.effects),c(this.tr,r.vibrato),c(this.Yo,r.interval),c(this.Qo,r.chord),this.To.updateValue(-r.volume),this.Ro.updateValue(r.pan),c(this.Po,o),this.fo.value=String(this.ft.volume),h&&null!=l&&0==l.clientWidth&&this.Br(),this.Fr(this.ft.prompt),this.ft.autoFollow&&!this.ft.synth.playing&&this.ft.synth.goToBar(this.ft.bar)}),this.Lr=(t=>{switch(t.keyCode){case 8:case 13:case 38:case 40:case 37:case 39:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:t.stopPropagation()}}),this.kn=(e=>{if(this.prompt)27==e.keyCode&&this.ft.undo();else switch(this.no.onKeyPressed(e),e.keyCode){case 32:this.Ar(),e.preventDefault();break;case 90:e.shiftKey?this.ft.redo():this.ft.undo(),e.preventDefault();break;case 89:this.ft.redo(),e.preventDefault();break;case 67:this.no.copy(),e.preventDefault();break;case 13:this.no.insertBars(),e.preventDefault();break;case 8:this.no.deleteBars(),e.preventDefault();break;case 65:e.shiftKey?this.no.selectChannel():this.no.selectAll(),e.preventDefault();break;case 68:this.no.duplicatePatterns(),e.preventDefault();break;case 77:this.ft.enableChannelMuting&&(this.no.muteChannels(e.shiftKey),e.preventDefault());break;case 83:this.ft.enableChannelMuting&&(e.shiftKey?this.no.muteChannels(!1):this.no.soloChannels(),e.preventDefault());break;case 86:e.shiftKey?this.no.pasteNumbers():this.no.pasteNotes(),e.preventDefault();break;case 73:if(e.shiftKey){const t=this.ft.song.channels[this.ft.channel].instruments[this.ft.getCurrentInstrument()].toJsonObject();delete t.volume,delete t.pan,delete t.preset,this.Hr(JSON.stringify(t))}e.preventDefault();break;case 219:this.ft.synth.prevBar(),this.ft.autoFollow&&new t.ChangeChannelBar(this.ft,this.ft.channel,Math.floor(this.ft.synth.playhead)),e.preventDefault();break;case 221:this.ft.synth.nextBar(),this.ft.autoFollow&&new t.ChangeChannelBar(this.ft,this.ft.channel,Math.floor(this.ft.synth.playhead)),e.preventDefault();break;case 189:case 173:this.no.transpose(!1,e.shiftKey),e.preventDefault();break;case 187:case 61:this.no.transpose(!0,e.shiftKey),e.preventDefault()}}),this.Ir=(()=>{this.ft.synth.prevBar()}),this.Or=(()=>{this.ft.synth.nextBar()}),this.Ar=(()=>{this.ft.synth.playing?this.$r():(this.ft.synth.snapToBar(),this.Ur())}),this._r=(()=>{this.ft.setVolume(Number(this.fo.value))}),this.Dr=(()=>{this.ft.record(new t.ChangeTempo(this.ft,-1,0|parseInt(this.vo.value)))}),this.Wr=(()=>{if(isNaN(this.po.value)){switch(this.po.value){case"forceScale":this.no.forceScale()}this.ft.notifier.changed()}else this.ft.record(new t.ChangeScale(this.ft,this.po.selectedIndex))}),this.Vr=(()=>{if(isNaN(this.yo.value)){switch(this.yo.value){case"detectKey":this.ft.record(new t.ChangeDetectKey(this.ft))}this.ft.notifier.changed()}else this.ft.record(new t.ChangeKey(this.ft,t.Config.keys.length-1-this.yo.selectedIndex))}),this.jr=(()=>{if(isNaN(this.ko.value)){switch(this.ko.value){case"forceRhythm":this.no.forceRhythm()}this.ft.notifier.changed()}else this.ft.record(new t.ChangeRhythm(this.ft,this.ko.selectedIndex))}),this.Gr=(()=>{this.Kr(this.Mo.value)}),this.Jr=(()=>{this.Kr(this.xo.value)}),this.Yr=(()=>{this.ft.record(new t.ChangeFeedbackType(this.ft,this.sr.selectedIndex))}),this.Zr=(()=>{this.ft.record(new t.ChangeFeedbackEnvelope(this.ft,this.dr.selectedIndex))}),this.Qr=(()=>{this.ft.record(new t.ChangeAlgorithm(this.ft,this.Eo.selectedIndex))}),this.Xr=(()=>{this.no.setInstrument(this.Po.selectedIndex)}),this.th=(()=>{this.ft.record(new t.ChangeCustomizeInstrument(this.ft))}),this.eh=(()=>{this.ft.record(new t.ChangeChipWave(this.ft,this.Bo.selectedIndex))}),this.ih=(()=>{this.ft.record(new t.ChangeNoiseWave(this.ft,this.Fo.selectedIndex))}),this.sh=(()=>{this.ft.record(new t.ChangeFilterEnvelope(this.ft,this.Wo.selectedIndex))}),this.nh=(()=>{this.ft.record(new t.ChangePulseEnvelope(this.ft,this.jo.selectedIndex))}),this.oh=(()=>{this.ft.record(new t.ChangeTransition(this.ft,this.Ho.selectedIndex))}),this.rh=(()=>{this.ft.record(new t.ChangeEffects(this.ft,this.Oo.selectedIndex))}),this.hh=(()=>{this.ft.record(new t.ChangeVibrato(this.ft,this.tr.selectedIndex))}),this.ah=(()=>{this.ft.record(new t.ChangeInterval(this.ft,this.Yo.selectedIndex))}),this.lh=(()=>{this.ft.record(new t.ChangeChord(this.ft,this.Qo.selectedIndex))}),this.fh=(e=>{switch(this.do.value){case"new":this.ft.goBackToStart();for(const t of this.ft.song.channels)t.muted=!1;this.ft.record(new t.ChangeSong(this.ft,""),1,!0);break;case"export":this.Co("export");break;case"import":this.Co("import");break;case"copyUrl":this.Hr(new URL("#"+this.ft.song.toBase64String(),location.href).href);break;case"shareUrl":navigator.share({url:new URL("#"+this.ft.song.toBase64String(),location.href).href});break;case"viewPlayer":location.href="player/#song="+this.ft.song.toBase64String();break;case"copyEmbed":this.Hr(`<iframe width="384" height="60" style="border: none;" src="${new URL("player/#song="+this.ft.song.toBase64String(),location.href).href}"></iframe>`);break;case"songRecovery":this.Co("songRecovery")}this.do.selectedIndex=0}),this.dh=(t=>{switch(this.uo.value){case"undo":this.ft.undo();break;case"redo":this.ft.redo();break;case"copy":this.no.copy();break;case"insertBars":this.no.insertBars();break;case"deleteBars":this.no.deleteBars();break;case"pasteNotes":this.no.pasteNotes();break;case"pasteNumbers":this.no.pasteNumbers();break;case"transposeUp":this.no.transpose(!0,!1);break;case"transposeDown":this.no.transpose(!1,!1);break;case"selectAll":this.no.selectAll();break;case"selectChannel":this.no.selectChannel();break;case"duplicatePatterns":this.no.duplicatePatterns();break;case"barCount":this.Co("barCount");break;case"beatsPerBar":this.Co("beatsPerBar");break;case"moveNotesSideways":this.Co("moveNotesSideways");break;case"channelSettings":this.Co("channelSettings")}this.uo.selectedIndex=0}),this.uh=(e=>{switch(this.mo.value){case"autoPlay":this.ft.autoPlay=!this.ft.autoPlay;break;case"autoFollow":this.ft.autoFollow=!this.ft.autoFollow;break;case"enableNotePreview":this.ft.enableNotePreview=!this.ft.enableNotePreview;break;case"showLetters":this.ft.showLetters=!this.ft.showLetters;break;case"showFifth":this.ft.showFifth=!this.ft.showFifth;break;case"showChannels":this.ft.showChannels=!this.ft.showChannels;break;case"showScrollBar":this.ft.showScrollBar=!this.ft.showScrollBar;break;case"alwaysShowSettings":this.ft.alwaysShowSettings=!this.ft.alwaysShowSettings;break;case"enableChannelMuting":this.ft.enableChannelMuting=!this.ft.enableChannelMuting;for(const t of this.ft.song.channels)t.muted=!1;break;case"displayBrowserUrl":this.ft.toggleDisplayBrowserUrl();break;case"fullScreen":this.ft.fullScreen=!this.ft.fullScreen,t.Layout.setFullScreen(this.ft.fullScreen);break;case"colorTheme":this.ft.colorTheme="light classic"==this.ft.colorTheme?"dark classic":"light classic",t.ColorConfig.setTheme(this.ft.colorTheme)}this.mo.selectedIndex=0,this.ft.notifier.changed(),this.ft.savePreferences()}),this.ft.notifier.watch(this.whenUpdated),window.addEventListener("resize",this.whenUpdated),"share"in navigator||this.do.removeChild(this.do.querySelector("[value='shareUrl']")),this.po.appendChild(r({label:"Edit"},h({value:"forceScale"},"Snap Notes To Scale"))),this.yo.appendChild(r({label:"Edit"},h({value:"detectKey"},"Detect Key"))),this.ko.appendChild(r({label:"Edit"},h({value:"forceRhythm"},"Snap Notes To Rhythm"))),this.ir.appendChild(i({class:"operatorRow",style:`color: ${t.ColorConfig.secondaryText}; height: 1em; margin-top: 0.5em;`},i({style:"margin-right: .1em; visibility: hidden;"},"1."),i({style:"width: 3em; margin-right: .3em;",class:"tip",onclick:()=>this.Co("operatorFrequency")},"Freq:"),i({style:"width: 4em; margin: 0;",class:"tip",onclick:()=>this.Co("operatorVolume")},"Volume:"),i({style:"width: 5em; margin-left: .3em;",class:"tip",onclick:()=>this.Co("operatorEnvelope")},"Envelope:")));for(let e=0;e<t.Config.operatorCount;e++){const o=e,r=i({style:`margin-right: .1em; color: ${t.ColorConfig.secondaryText};`},e+1+"."),h=a(n({style:"width: 100%;",title:"Frequency"}),t.Config.operatorFrequencies.map(t=>t.name)),l=new f(s({style:"margin: 0; width: 4em;",type:"range",min:"0",max:t.Config.operatorAmplitudeMax,value:"0",step:"1",title:"Volume"}),this.ft,(e,i)=>new t.ChangeOperatorAmplitude(this.ft,o,e,i)),c=a(n({style:"width: 100%;",title:"Envelope"}),t.Config.envelopes.map(t=>t.name)),d=i({class:"operatorRow"},r,i({class:"selectContainer",style:"width: 3em; margin-right: .3em;"},h),l.input,i({class:"selectContainer",style:"width: 5em; margin-left: .3em;"},c));this.ir.appendChild(d),this.Pr[e]=d,this.Sr[e]=l,this.Tr[e]=c,this.zr[e]=h,c.addEventListener("change",()=>{this.ft.record(new t.ChangeOperatorEnvelope(this.ft,o,c.selectedIndex))}),h.addEventListener("change",()=>{this.ft.record(new t.ChangeOperatorFrequency(this.ft,o,h.selectedIndex))})}this.lr.appendChild(i({class:"selectRow"},o({class:"tip",onclick:()=>this.Co("drumsetEnvelope")},"Envelope:"),o({class:"tip",onclick:()=>this.Co("drumsetSpectrum")},"Spectrum:")));for(let e=t.Config.drumCount-1;e>=0;e--){const s=e,o=new t.SpectrumEditor(this.ft,s);o.container.addEventListener("mousedown",this.Br),this.Rr[e]=o;const r=a(n({style:"width: 100%;",title:"Filter Envelope"}),t.Config.envelopes.map(t=>t.name));this.Nr[e]=r,r.addEventListener("change",()=>{this.ft.record(new t.ChangeDrumsetEnvelope(this.ft,s,r.selectedIndex))});const h=i({class:"selectRow"},i({class:"selectContainer",style:"width: 5em; margin-right: .3em;"},r),this.Rr[e].container);this.lr.appendChild(h)}if(this.do.addEventListener("change",this.fh),this.uo.addEventListener("change",this.dh),this.mo.addEventListener("change",this.uh),this.vo.addEventListener("change",this.Dr),this.po.addEventListener("change",this.Wr),this.yo.addEventListener("change",this.Vr),this.ko.addEventListener("change",this.jr),this.Mo.addEventListener("change",this.Gr),this.xo.addEventListener("change",this.Jr),this.Eo.addEventListener("change",this.Qr),this.Po.addEventListener("change",this.Xr),this.mr.addEventListener("click",this.th),this.sr.addEventListener("change",this.Yr),this.dr.addEventListener("change",this.Zr),this.Bo.addEventListener("change",this.eh),this.Fo.addEventListener("change",this.ih),this.Ho.addEventListener("change",this.oh),this.Oo.addEventListener("change",this.rh),this.Wo.addEventListener("change",this.sh),this.jo.addEventListener("change",this.nh),this.Yo.addEventListener("change",this.ah),this.Qo.addEventListener("change",this.lh),this.tr.addEventListener("change",this.hh),this.ao.addEventListener("click",this.Ar),this.lo.addEventListener("click",this.Ir),this.co.addEventListener("click",this.Or),this.fo.addEventListener("input",this._r),this.wr.addEventListener("mousedown",this.Br),this.xr.addEventListener("mousedown",this.Br),this.or.container.addEventListener("mousedown",this.Br),this.hr.container.addEventListener("mousedown",this.Br),this.vo.addEventListener("keydown",this.Lr,!1),this.mainLayer.addEventListener("keydown",this.kn),this.gr.addEventListener("click",t=>{t.target==this.gr&&this.ft.undo()}),t.isMobile){const t=this.mo.querySelector("[value=autoPlay]");t.disabled=!0,t.setAttribute("hidden","")}if(window.screen.availWidth<700||window.screen.availHeight<700){const t=this.mo.querySelector("[value=fullScreen]");t.disabled=!0,t.setAttribute("hidden","")}}Co(t){this.ft.openPrompt(t),this.Fr(t)}Fr(e){if(this.Cr!=e&&(this.Cr=e,this.prompt&&(!this.qr||this.prompt instanceof t.TipPrompt||this.Ur(),this.qr=!1,this.gr.style.display="none",this.gr.removeChild(this.prompt.container),this.prompt.cleanUp(),this.prompt=null,this.Br()),e)){switch(e){case"export":this.prompt=new t.ExportPrompt(this.ft);break;case"import":this.prompt=new t.ImportPrompt(this.ft);break;case"songRecovery":this.prompt=new t.SongRecoveryPrompt(this.ft);break;case"barCount":this.prompt=new t.SongDurationPrompt(this.ft);break;case"beatsPerBar":this.prompt=new t.BeatsPerBarPrompt(this.ft);break;case"moveNotesSideways":this.prompt=new t.MoveNotesSidewaysPrompt(this.ft);break;case"channelSettings":this.prompt=new t.ChannelSettingsPrompt(this.ft);break;default:this.prompt=new t.TipPrompt(this.ft,e)}this.prompt&&(this.prompt instanceof t.TipPrompt||(this.qr=this.ft.synth.playing,this.$r()),this.gr.style.display=null,this.gr.appendChild(this.prompt.container))}}updatePlayButton(){this.ft.synth.playing?(this.ao.classList.remove("playButton"),this.ao.classList.add("pauseButton"),this.ao.title="Pause (Space)",this.ao.innerText="Pause"):(this.ao.classList.remove("pauseButton"),this.ao.classList.add("playButton"),this.ao.title="Play (Space)",this.ao.innerText="Play")}Hr(t){if(navigator.clipboard&&navigator.clipboard.writeText)return void navigator.clipboard.writeText(t).catch(()=>{window.prompt("Copy to clipboard:",t)});const e=document.createElement("textarea");e.innerText=t,document.body.appendChild(e),e.select();const i=document.execCommand("copy");e.remove(),this.Br(),i||window.prompt("Copy this:",t)}Ur(){this.ft.synth.play(),this.updatePlayButton()}$r(){this.ft.synth.pause(),this.ft.synth.resetEffects(),this.ft.autoFollow&&this.ft.synth.goToBar(this.ft.bar),this.ft.synth.snapToBar(),this.updatePlayButton()}mh(){const t=this.ft.song.channels[this.ft.channel].instruments[this.ft.getCurrentInstrument()].toJsonObject();t.isDrum=this.ft.song.getChannelIsNoise(this.ft.channel),window.localStorage.setItem("instrumentCopy",JSON.stringify(t))}ph(){const e=this.ft.song.channels[this.ft.channel].instruments[this.ft.getCurrentInstrument()],i=JSON.parse(String(window.localStorage.getItem("instrumentCopy")));null!=i&&i.isDrum==this.ft.song.getChannelIsNoise(this.ft.channel)&&this.ft.record(new t.ChangePasteInstrument(this.ft,e,i))}yh(){const e=this.ft.song.getChannelIsNoise(this.ft.channel);this.ft.record(new t.ChangePreset(this.ft,t.pickRandomPresetValue(e)))}gh(){this.ft.record(new t.ChangeRandomGeneratedInstrument(this.ft))}Kr(e){if(isNaN(e)){switch(e){case"copyInstrument":this.mh();break;case"pasteInstrument":this.ph();break;case"randomPreset":this.yh();break;case"randomGenerated":this.gh()}this.ft.notifier.changed()}else this.ft.record(new t.ChangePreset(this.ft,parseInt(e)))}}}(beepbox||(beepbox={})),function(t){const e=new t.SongDocument,i=new t.SongEditor(e);if(document.getElementById("beepboxEditorContainer").appendChild(i.mainLayer),i.whenUpdated(),i.mainLayer.focus(),!t.isMobile&&e.autoPlay){function s(){document.hidden||(e.synth.play(),i.updatePlayButton(),window.removeEventListener("visibilitychange",s))}document.hidden?window.addEventListener("visibilitychange",s):s()}"scrollRestoration"in history&&(history.scrollRestoration="manual"),i.updatePlayButton(),"serviceWorker"in navigator&&navigator.serviceWorker.register("/service_worker.js",{updateViaCache:"all",scope:"/"}).catch(()=>{})}(beepbox||(beepbox={}));
	</script>
</body></html>
